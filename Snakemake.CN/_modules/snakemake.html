

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>snakemake &mdash; Snakemake 5.6.0+8.g89bc383.dirty documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx-argparse.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Snakemake
          

          
          </a>

          
            
            
              <div class="version">
                5.6.0+8.g89bc383.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/installation.html">安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/tutorial.html">Snakemake Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/short.html">Short tutorial</a></li>
</ul>
<p class="caption"><span class="caption-text">Executing workflows</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../executable.html">Executing Snakemake</a></li>
</ul>
<p class="caption"><span class="caption-text">Defining workflows</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/writing_snakefiles.html">Writing Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/rules.html">Rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/modularization.html">Modularization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/remote_files.html">Remote files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/utils.html">Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/deployment.html">Distribution and Reproducibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/reporting.html">Reports</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/snakemake.html">The Snakemake API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/snakemake_utils.html">Additional utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/internal/modules.html">Internal API</a></li>
</ul>
<p class="caption"><span class="caption-text">Project Info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../project_info/citations.html">Citing and Citations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project_info/more_resources.html">More Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project_info/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project_info/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project_info/authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project_info/history.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project_info/license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Snakemake</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>snakemake</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for snakemake</h1><div class="highlight"><pre>
<span></span><span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Johannes Köster&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright 2015, Johannes Köster&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s2">&quot;koester@jimmy.harvard.edu&quot;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;MIT&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="k">import</span> <span class="n">ArgumentError</span>
<span class="kn">import</span> <span class="nn">logging</span> <span class="k">as</span> <span class="nn">_logging</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">webbrowser</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="kn">from</span> <span class="nn">snakemake.workflow</span> <span class="k">import</span> <span class="n">Workflow</span>
<span class="kn">from</span> <span class="nn">snakemake.exceptions</span> <span class="k">import</span> <span class="n">print_exception</span><span class="p">,</span> <span class="n">WorkflowError</span>
<span class="kn">from</span> <span class="nn">snakemake.logging</span> <span class="k">import</span> <span class="n">setup_logger</span><span class="p">,</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">snakemake.io</span> <span class="k">import</span> <span class="n">load_configfile</span>
<span class="kn">from</span> <span class="nn">snakemake.shell</span> <span class="k">import</span> <span class="n">shell</span>
<span class="kn">from</span> <span class="nn">snakemake.utils</span> <span class="k">import</span> <span class="n">update_config</span><span class="p">,</span> <span class="n">available_cpu_count</span>
<span class="kn">from</span> <span class="nn">snakemake.common</span> <span class="k">import</span> <span class="n">Mode</span><span class="p">,</span> <span class="n">__version__</span>
<span class="kn">from</span> <span class="nn">snakemake.resources</span> <span class="k">import</span> <span class="n">parse_resources</span><span class="p">,</span> <span class="n">DefaultResources</span>


<span class="n">SNAKEFILE_CHOICES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Snakefile&quot;</span><span class="p">,</span> <span class="s2">&quot;snakefile&quot;</span><span class="p">,</span> <span class="s2">&quot;workflow/Snakefile&quot;</span><span class="p">,</span> <span class="s2">&quot;workflow/snakefile&quot;</span><span class="p">]</span>


<div class="viewcode-block" id="snakemake"><a class="viewcode-back" href="../api_reference/snakemake.html#snakemake.snakemake">[docs]</a><span class="k">def</span> <span class="nf">snakemake</span><span class="p">(</span><span class="n">snakefile</span><span class="p">,</span>
              <span class="n">report</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">listrules</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">list_target_rules</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">cores</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">nodes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">local_cores</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">resources</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span>
              <span class="n">default_resources</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">config</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span>
              <span class="n">configfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">config_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">workdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">targets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">dryrun</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">touch</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">forcetargets</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">forceall</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">forcerun</span><span class="o">=</span><span class="p">[],</span>
              <span class="n">until</span><span class="o">=</span><span class="p">[],</span>
              <span class="n">omit_from</span><span class="o">=</span><span class="p">[],</span>
              <span class="n">prioritytargets</span><span class="o">=</span><span class="p">[],</span>
              <span class="n">stats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">printreason</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">printshellcmds</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">debug_dag</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">printdag</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">printrulegraph</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">printd3dag</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">nocolor</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">keepgoing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">cluster</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">cluster_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">cluster_sync</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">drmaa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">drmaa_log_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">jobname</span><span class="o">=</span><span class="s2">&quot;snakejob.</span><span class="si">{rulename}</span><span class="s2">.</span><span class="si">{jobid}</span><span class="s2">.sh&quot;</span><span class="p">,</span>
              <span class="n">immediate_submit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">standalone</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">ignore_ambiguity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">snakemakepath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">lock</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">unlock</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">cleanup_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">cleanup_conda</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">cleanup_shadow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">force_incomplete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">ignore_incomplete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">list_version_changes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">list_code_changes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">list_input_changes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">list_params_changes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">list_untracked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">list_resources</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">summary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">archive</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">delete_all_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">delete_temp_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">detailed_summary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">latency_wait</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
              <span class="n">wait_for_files</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">print_compilation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">notemp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">keep_remote_local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">nodeps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">keep_target_files</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">allowed_rules</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">jobscript</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">greediness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">no_hooks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">overwrite_shellcmd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">updated_files</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">log_handler</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">keep_logger</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">max_jobs_per_second</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">max_status_checks_per_second</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
              <span class="n">restart_times</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
              <span class="n">attempt</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">force_use_threads</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">use_conda</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">use_singularity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">singularity_args</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
              <span class="n">conda_prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">list_conda_envs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">singularity_prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">shadow_prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">create_envs_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">mode</span><span class="o">=</span><span class="n">Mode</span><span class="o">.</span><span class="n">default</span><span class="p">,</span>
              <span class="n">wrapper_prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">kubernetes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">kubernetes_envvars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">container_image</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">default_remote_provider</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">default_remote_prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
              <span class="n">assume_shared_fs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">cluster_status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">export_cwl</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run snakemake on a given snakefile.</span>

<span class="sd">    This function provides access to the whole snakemake functionality. It is not thread-safe.</span>

<span class="sd">    Args:</span>
<span class="sd">        snakefile (str):            the path to the snakefile</span>
<span class="sd">        report (str):               create an HTML report for a previous run at the given path</span>
<span class="sd">        listrules (bool):           list rules (default False)</span>
<span class="sd">        list_target_rules (bool):   list target rules (default False)</span>
<span class="sd">        cores (int):                the number of provided cores (ignored when using cluster support) (default 1)</span>
<span class="sd">        nodes (int):                the number of provided cluster nodes (ignored without cluster support) (default 1)</span>
<span class="sd">        local_cores (int):          the number of provided local cores if in cluster mode (ignored without cluster support) (default 1)</span>
<span class="sd">        resources (dict):           provided resources, a dictionary assigning integers to resource names, e.g. {gpu=1, io=5} (default {})</span>
<span class="sd">        default_resources (DefaultResources):   default values for resources not defined in rules (default None)</span>
<span class="sd">        config (dict):              override values for workflow config</span>
<span class="sd">        workdir (str):              path to working directory (default None)</span>
<span class="sd">        targets (list):             list of targets, e.g. rule or file names (default None)</span>
<span class="sd">        dryrun (bool):              only dry-run the workflow (default False)</span>
<span class="sd">        touch (bool):               only touch all output files if present (default False)</span>
<span class="sd">        forcetargets (bool):        force given targets to be re-created (default False)</span>
<span class="sd">        forceall (bool):            force all output files to be re-created (default False)</span>
<span class="sd">        forcerun (list):            list of files and rules that shall be re-created/re-executed (default [])</span>
<span class="sd">        prioritytargets (list):     list of targets that shall be run with maximum priority (default [])</span>
<span class="sd">        stats (str):                path to file that shall contain stats about the workflow execution (default None)</span>
<span class="sd">        printreason (bool):         print the reason for the execution of each job (default false)</span>
<span class="sd">        printshellcmds (bool):      print the shell command of each job (default False)</span>
<span class="sd">        printdag (bool):            print the dag in the graphviz dot language (default False)</span>
<span class="sd">        printrulegraph (bool):      print the graph of rules in the graphviz dot language (default False)</span>
<span class="sd">        printd3dag (bool):          print a D3.js compatible JSON representation of the DAG (default False)</span>
<span class="sd">        nocolor (bool):             do not print colored output (default False)</span>
<span class="sd">        quiet (bool):               do not print any default job information (default False)</span>
<span class="sd">        keepgoing (bool):           keep goind upon errors (default False)</span>
<span class="sd">        cluster (str):              submission command of a cluster or batch system to use, e.g. qsub (default None)</span>
<span class="sd">        cluster_config (str,list):  configuration file for cluster options, or list thereof (default None)</span>
<span class="sd">        cluster_sync (str):         blocking cluster submission command (like SGE &#39;qsub -sync y&#39;)  (default None)</span>
<span class="sd">        drmaa (str):                if not None use DRMAA for cluster support, str specifies native args passed to the cluster when submitting a job</span>
<span class="sd">        drmaa_log_dir (str):        the path to stdout and stderr output of DRMAA jobs (default None)</span>
<span class="sd">        jobname (str):              naming scheme for cluster job scripts (default &quot;snakejob.{rulename}.{jobid}.sh&quot;)</span>
<span class="sd">        immediate_submit (bool):    immediately submit all cluster jobs, regardless of dependencies (default False)</span>
<span class="sd">        standalone (bool):          kill all processes very rudely in case of failure (do not use this if you use this API) (default False) (deprecated)</span>
<span class="sd">        ignore_ambiguity (bool):    ignore ambiguous rules and always take the first possible one (default False)</span>
<span class="sd">        snakemakepath (str):        deprecated parameter whose value is ignored. Do not use.</span>
<span class="sd">        lock (bool):                lock the working directory when executing the workflow (default True)</span>
<span class="sd">        unlock (bool):              just unlock the working directory (default False)</span>
<span class="sd">        cleanup_metadata (list):    just cleanup metadata of given list of output files (default None)</span>
<span class="sd">        cleanup_conda (bool):       just cleanup unused conda environments (default False)</span>
<span class="sd">        cleanup_shadow (bool):      just cleanup old shadow directories (default False)</span>
<span class="sd">        force_incomplete (bool):    force the re-creation of incomplete files (default False)</span>
<span class="sd">        ignore_incomplete (bool):   ignore incomplete files (default False)</span>
<span class="sd">        list_version_changes (bool): list output files with changed rule version (default False)</span>
<span class="sd">        list_code_changes (bool):   list output files with changed rule code (default False)</span>
<span class="sd">        list_input_changes (bool):  list output files with changed input files (default False)</span>
<span class="sd">        list_params_changes (bool): list output files with changed params (default False)</span>
<span class="sd">        list_untracked (bool):      list files in the workdir that are not used in the workflow (default False)</span>
<span class="sd">        summary (bool):             list summary of all output files and their status (default False)</span>
<span class="sd">        archive (str):              archive workflow into the given tarball</span>
<span class="sd">        delete_all_output (bool)    remove all files generated by the workflow (default False)</span>
<span class="sd">        delete_temp_output (bool)   remove all temporary files generated by the workflow (default False)</span>
<span class="sd">        latency_wait (int):         how many seconds to wait for an output file to appear after the execution of a job, e.g. to handle filesystem latency (default 3)</span>
<span class="sd">        wait_for_files (list):      wait for given files to be present before executing the workflow</span>
<span class="sd">        list_resources (bool):      list resources used in the workflow (default False)</span>
<span class="sd">        summary (bool):             list summary of all output files and their status (default False). If no option  is specified a basic summary will be ouput. If &#39;detailed&#39; is added as an option e.g --summary detailed, extra info about the input and shell commands will be included</span>
<span class="sd">        detailed_summary (bool):    list summary of all input and output files and their status (default False)</span>
<span class="sd">        print_compilation (bool):   print the compilation of the snakefile (default False)</span>
<span class="sd">        debug (bool):               allow to use the debugger within rules</span>
<span class="sd">        notemp (bool):              ignore temp file flags, e.g. do not delete output files marked as temp after use (default False)</span>
<span class="sd">        keep_remote_local (bool):   keep local copies of remote files (default False)</span>
<span class="sd">        nodeps (bool):              ignore dependencies (default False)</span>
<span class="sd">        keep_target_files (bool):   do not adjust the paths of given target files relative to the working directory.</span>
<span class="sd">        allowed_rules (set):        restrict allowed rules to the given set. If None or empty, all rules are used.</span>
<span class="sd">        jobscript (str):            path to a custom shell script template for cluster jobs (default None)</span>
<span class="sd">        greediness (float):         set the greediness of scheduling. This value between 0 and 1 determines how careful jobs are selected for execution. The default value (0.5 if prioritytargets are used, 1.0 else) provides the best speed and still acceptable scheduling quality.</span>
<span class="sd">        overwrite_shellcmd (str):   a shell command that shall be executed instead of those given in the workflow. This is for debugging purposes only.</span>
<span class="sd">        updated_files(list):        a list that will be filled with the files that are updated or created during the workflow execution</span>
<span class="sd">        verbose (bool):             show additional debug output (default False)</span>
<span class="sd">        max_jobs_per_second (int):  maximal number of cluster/drmaa jobs per second, None to impose no limit (default None)</span>
<span class="sd">        restart_times (int):        number of times to restart failing jobs (default 0)</span>
<span class="sd">        attempt (int):              initial value of Job.attempt. This is intended for internal use only (default 1).</span>
<span class="sd">        force_use_threads:          whether to force use of threads over processes. helpful if shared memory is full or unavailable (default False)</span>
<span class="sd">        use_conda (bool):           create conda environments for each job (defined with conda directive of rules)</span>
<span class="sd">        use_singularity (bool):     run jobs in singularity containers (if defined with singularity directive)</span>
<span class="sd">        singularity_args (str):     additional arguments to pass to singularity</span>
<span class="sd">        conda_prefix (str):         the directory in which conda environments will be created (default None)</span>
<span class="sd">        singularity_prefix (str):   the directory to which singularity images will be pulled (default None)</span>
<span class="sd">        shadow_prefix (str):        prefix for shadow directories. The job-specific shadow directories will be created in $SHADOW_PREFIX/shadow/ (default None)</span>
<span class="sd">        create_envs_only (bool):    if specified, only builds the conda environments specified for each job, then exits.</span>
<span class="sd">        list_conda_envs (bool):     list conda environments and their location on disk.</span>
<span class="sd">        mode (snakemake.common.Mode): execution mode</span>
<span class="sd">        wrapper_prefix (str):       prefix for wrapper script URLs (default None)</span>
<span class="sd">        kubernetes (str):           submit jobs to kubernetes, using the given namespace.</span>
<span class="sd">        kubernetes_envvars (list):  environment variables that shall be passed to kubernetes jobs.</span>
<span class="sd">        container_image (str):      Docker image to use, e.g., for kubernetes.</span>
<span class="sd">        default_remote_provider (str): default remote provider to use instead of local files (e.g. S3, GS)</span>
<span class="sd">        default_remote_prefix (str): prefix for default remote provider (e.g. name of the bucket).</span>
<span class="sd">        assume_shared_fs (bool):    assume that cluster nodes share a common filesystem (default true).</span>
<span class="sd">        cluster_status (str):       status command for cluster execution. If None, Snakemake will rely on flag files. Otherwise, it expects the command to return &quot;success&quot;, &quot;failure&quot; or &quot;running&quot; when executing with a cluster jobid as single argument.</span>
<span class="sd">        export_cwl (str):           Compile workflow to CWL and save to given file</span>
<span class="sd">        log_handler (function):     redirect snakemake output to this custom log handler, a function that takes a log message dictionary (see below) as its only argument (default None). The log message dictionary for the log handler has to following entries:</span>

<span class="sd">            :level:</span>
<span class="sd">                the log level (&quot;info&quot;, &quot;error&quot;, &quot;debug&quot;, &quot;progress&quot;, &quot;job_info&quot;)</span>

<span class="sd">            :level=&quot;info&quot;, &quot;error&quot; or &quot;debug&quot;:</span>
<span class="sd">                :msg:</span>
<span class="sd">                    the log message</span>
<span class="sd">            :level=&quot;progress&quot;:</span>
<span class="sd">                :done:</span>
<span class="sd">                    number of already executed jobs</span>

<span class="sd">                :total:</span>
<span class="sd">                    number of total jobs</span>

<span class="sd">            :level=&quot;job_info&quot;:</span>
<span class="sd">                :input:</span>
<span class="sd">                    list of input files of a job</span>

<span class="sd">                :output:</span>
<span class="sd">                    list of output files of a job</span>

<span class="sd">                :log:</span>
<span class="sd">                    path to log file of a job</span>

<span class="sd">                :local:</span>
<span class="sd">                    whether a job is executed locally (i.e. ignoring cluster)</span>

<span class="sd">                :msg:</span>
<span class="sd">                    the job message</span>

<span class="sd">                :reason:</span>
<span class="sd">                    the job reason</span>

<span class="sd">                :priority:</span>
<span class="sd">                    the job priority</span>

<span class="sd">                :threads:</span>
<span class="sd">                    the threads of the job</span>


<span class="sd">    Returns:</span>
<span class="sd">        bool:   True if workflow execution was successful.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="ow">not</span> <span class="n">immediate_submit</span> <span class="ow">or</span> <span class="p">(</span><span class="n">immediate_submit</span> <span class="ow">and</span> <span class="n">notemp</span><span class="p">),</span> <span class="s2">&quot;immediate_submit has to be combined with notemp (it does not support temp file handling)&quot;</span>

    <span class="k">if</span> <span class="n">updated_files</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">updated_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">cluster</span> <span class="ow">or</span> <span class="n">cluster_sync</span> <span class="ow">or</span> <span class="n">drmaa</span><span class="p">:</span>
        <span class="n">cores</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cluster_config</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># Loading configuration from one file is still supported for</span>
        <span class="c1"># backward compatibility</span>
        <span class="n">cluster_config</span> <span class="o">=</span> <span class="p">[</span><span class="n">cluster_config</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">cluster_config</span><span class="p">:</span>
        <span class="c1"># Load all configuration files</span>
        <span class="n">configs</span> <span class="o">=</span> <span class="p">[</span><span class="n">load_configfile</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">cluster_config</span><span class="p">]</span>
        <span class="c1"># Merge in the order as specified, overriding earlier values with</span>
        <span class="c1"># later ones</span>
        <span class="n">cluster_config_content</span> <span class="o">=</span> <span class="n">configs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">configs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">update_config</span><span class="p">(</span><span class="n">cluster_config_content</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cluster_config_content</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="n">run_local</span> <span class="o">=</span> <span class="ow">not</span> <span class="p">(</span><span class="n">cluster</span> <span class="ow">or</span> <span class="n">cluster_sync</span> <span class="ow">or</span> <span class="n">drmaa</span> <span class="ow">or</span> <span class="n">kubernetes</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">run_local</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dryrun</span><span class="p">:</span>
        <span class="c1"># clean up all previously recorded jobids.</span>
        <span class="n">shell</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>

    <span class="c1"># force thread use for any kind of cluster</span>
    <span class="n">use_threads</span> <span class="o">=</span> <span class="n">force_use_threads</span> <span class="ow">or</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;posix&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cluster</span> <span class="ow">or</span> <span class="n">cluster_sync</span> <span class="ow">or</span> <span class="n">drmaa</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">keep_logger</span><span class="p">:</span>
        <span class="n">stdout</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">dryrun</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">printdag</span> <span class="ow">or</span> <span class="n">printd3dag</span> <span class="ow">or</span> <span class="n">printrulegraph</span><span class="p">))</span> <span class="ow">or</span>
            <span class="n">listrules</span> <span class="ow">or</span> <span class="n">list_target_rules</span> <span class="ow">or</span> <span class="n">list_resources</span>
        <span class="p">)</span>
        <span class="n">setup_logger</span><span class="p">(</span><span class="n">handler</span><span class="o">=</span><span class="n">log_handler</span><span class="p">,</span>
                     <span class="n">quiet</span><span class="o">=</span><span class="n">quiet</span><span class="p">,</span>
                     <span class="n">printreason</span><span class="o">=</span><span class="n">printreason</span><span class="p">,</span>
                     <span class="n">printshellcmds</span><span class="o">=</span><span class="n">printshellcmds</span><span class="p">,</span>
                     <span class="n">debug_dag</span><span class="o">=</span><span class="n">debug_dag</span><span class="p">,</span>
                     <span class="n">nocolor</span><span class="o">=</span><span class="n">nocolor</span><span class="p">,</span>
                     <span class="n">stdout</span><span class="o">=</span><span class="n">stdout</span><span class="p">,</span>
                     <span class="n">debug</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                     <span class="n">use_threads</span><span class="o">=</span><span class="n">use_threads</span><span class="p">,</span>
                     <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">greediness</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">greediness</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="k">if</span> <span class="n">prioritytargets</span> <span class="k">else</span> <span class="mf">1.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">greediness</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error: greediness must be a float between 0 and 1.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">snakefile</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error: Snakefile </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2"> not found.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">snakefile</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">snakefile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">snakefile</span><span class="p">)</span>

    <span class="n">cluster_mode</span> <span class="o">=</span> <span class="p">(</span><span class="n">cluster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">cluster_sync</span> <span class="ow">is</span> <span class="ow">not</span>
                                            <span class="kc">None</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">drmaa</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cluster_mode</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error: cluster and drmaa args are mutually exclusive&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">debug</span> <span class="ow">and</span> <span class="p">(</span><span class="n">cores</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">cluster_mode</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Error: debug mode cannot be used with more than one core or cluster execution.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">overwrite_config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">configfile</span><span class="p">:</span>
        <span class="n">overwrite_config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">load_configfile</span><span class="p">(</span><span class="n">configfile</span><span class="p">))</span>
        <span class="n">configfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">configfile</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">config</span><span class="p">:</span>
        <span class="n">overwrite_config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">config_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">config_args</span> <span class="o">=</span> <span class="n">unparse_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">workdir</span><span class="p">:</span>
        <span class="n">olddir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">workdir</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Creating specified working directory </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workdir</span><span class="p">))</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">workdir</span><span class="p">)</span>
        <span class="n">workdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">workdir</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">workdir</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">setup_logfile</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># handle default remote provider</span>
        <span class="n">_default_remote_provider</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">default_remote_provider</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rmt</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s2">&quot;snakemake.remote.&quot;</span> <span class="o">+</span>
                                              <span class="n">default_remote_provider</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WorkflowError</span><span class="p">(</span><span class="s2">&quot;Unknown default remote provider.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rmt</span><span class="o">.</span><span class="n">RemoteProvider</span><span class="o">.</span><span class="n">supports_default</span><span class="p">:</span>
                <span class="n">_default_remote_provider</span> <span class="o">=</span> <span class="n">rmt</span><span class="o">.</span><span class="n">RemoteProvider</span><span class="p">(</span><span class="n">keep_local</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">is_default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WorkflowError</span><span class="p">(</span><span class="s2">&quot;Remote provider </span><span class="si">{}</span><span class="s2"> does not (yet) support to &quot;</span>
                                    <span class="s2">&quot;be used as default provider.&quot;</span><span class="p">)</span>

        <span class="n">workflow</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">snakefile</span><span class="o">=</span><span class="n">snakefile</span><span class="p">,</span>
                        <span class="n">jobscript</span><span class="o">=</span><span class="n">jobscript</span><span class="p">,</span>
                        <span class="n">overwrite_shellcmd</span><span class="o">=</span><span class="n">overwrite_shellcmd</span><span class="p">,</span>
                        <span class="n">overwrite_config</span><span class="o">=</span><span class="n">overwrite_config</span><span class="p">,</span>
                        <span class="n">overwrite_workdir</span><span class="o">=</span><span class="n">workdir</span><span class="p">,</span>
                        <span class="n">overwrite_configfile</span><span class="o">=</span><span class="n">configfile</span><span class="p">,</span>
                        <span class="n">overwrite_clusterconfig</span><span class="o">=</span><span class="n">cluster_config_content</span><span class="p">,</span>
                        <span class="n">config_args</span><span class="o">=</span><span class="n">config_args</span><span class="p">,</span>
                        <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
                        <span class="n">use_conda</span><span class="o">=</span><span class="n">use_conda</span> <span class="ow">or</span> <span class="n">list_conda_envs</span> <span class="ow">or</span> <span class="n">cleanup_conda</span><span class="p">,</span>
                        <span class="n">use_singularity</span><span class="o">=</span><span class="n">use_singularity</span><span class="p">,</span>
                        <span class="n">conda_prefix</span><span class="o">=</span><span class="n">conda_prefix</span><span class="p">,</span>
                        <span class="n">singularity_prefix</span><span class="o">=</span><span class="n">singularity_prefix</span><span class="p">,</span>
                        <span class="n">shadow_prefix</span><span class="o">=</span><span class="n">shadow_prefix</span><span class="p">,</span>
                        <span class="n">singularity_args</span><span class="o">=</span><span class="n">singularity_args</span><span class="p">,</span>
                        <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
                        <span class="n">wrapper_prefix</span><span class="o">=</span><span class="n">wrapper_prefix</span><span class="p">,</span>
                        <span class="n">printshellcmds</span><span class="o">=</span><span class="n">printshellcmds</span><span class="p">,</span>
                        <span class="n">restart_times</span><span class="o">=</span><span class="n">restart_times</span><span class="p">,</span>
                        <span class="n">attempt</span><span class="o">=</span><span class="n">attempt</span><span class="p">,</span>
                        <span class="n">default_remote_provider</span><span class="o">=</span><span class="n">_default_remote_provider</span><span class="p">,</span>
                        <span class="n">default_remote_prefix</span><span class="o">=</span><span class="n">default_remote_prefix</span><span class="p">,</span>
                        <span class="n">run_local</span><span class="o">=</span><span class="n">run_local</span><span class="p">,</span>
                        <span class="n">default_resources</span><span class="o">=</span><span class="n">default_resources</span><span class="p">)</span>
        <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="n">snakefile</span><span class="p">,</span>
                         <span class="n">overwrite_first_rule</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">print_compilation</span><span class="o">=</span><span class="n">print_compilation</span><span class="p">)</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">print_compilation</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">listrules</span><span class="p">:</span>
                <span class="n">workflow</span><span class="o">.</span><span class="n">list_rules</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">list_target_rules</span><span class="p">:</span>
                <span class="n">workflow</span><span class="o">.</span><span class="n">list_rules</span><span class="p">(</span><span class="n">only_targets</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">list_resources</span><span class="p">:</span>
                <span class="n">workflow</span><span class="o">.</span><span class="n">list_resources</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if not printdag and not printrulegraph:</span>
                <span class="c1"># handle subworkflows</span>
                <span class="n">subsnakemake</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">snakemake</span><span class="p">,</span>
                                       <span class="n">cores</span><span class="o">=</span><span class="n">cores</span><span class="p">,</span>
                                       <span class="n">nodes</span><span class="o">=</span><span class="n">nodes</span><span class="p">,</span>
                                       <span class="n">local_cores</span><span class="o">=</span><span class="n">local_cores</span><span class="p">,</span>
                                       <span class="n">resources</span><span class="o">=</span><span class="n">resources</span><span class="p">,</span>
                                       <span class="n">default_resources</span><span class="o">=</span><span class="n">default_resources</span><span class="p">,</span>
                                       <span class="n">dryrun</span><span class="o">=</span><span class="n">dryrun</span><span class="p">,</span>
                                       <span class="n">touch</span><span class="o">=</span><span class="n">touch</span><span class="p">,</span>
                                       <span class="n">printreason</span><span class="o">=</span><span class="n">printreason</span><span class="p">,</span>
                                       <span class="n">printshellcmds</span><span class="o">=</span><span class="n">printshellcmds</span><span class="p">,</span>
                                       <span class="n">debug_dag</span><span class="o">=</span><span class="n">debug_dag</span><span class="p">,</span>
                                       <span class="n">nocolor</span><span class="o">=</span><span class="n">nocolor</span><span class="p">,</span>
                                       <span class="n">quiet</span><span class="o">=</span><span class="n">quiet</span><span class="p">,</span>
                                       <span class="n">keepgoing</span><span class="o">=</span><span class="n">keepgoing</span><span class="p">,</span>
                                       <span class="n">cluster</span><span class="o">=</span><span class="n">cluster</span><span class="p">,</span>
                                       <span class="n">cluster_sync</span><span class="o">=</span><span class="n">cluster_sync</span><span class="p">,</span>
                                       <span class="n">drmaa</span><span class="o">=</span><span class="n">drmaa</span><span class="p">,</span>
                                       <span class="n">drmaa_log_dir</span><span class="o">=</span><span class="n">drmaa_log_dir</span><span class="p">,</span>
                                       <span class="n">jobname</span><span class="o">=</span><span class="n">jobname</span><span class="p">,</span>
                                       <span class="n">immediate_submit</span><span class="o">=</span><span class="n">immediate_submit</span><span class="p">,</span>
                                       <span class="n">standalone</span><span class="o">=</span><span class="n">standalone</span><span class="p">,</span>
                                       <span class="n">ignore_ambiguity</span><span class="o">=</span><span class="n">ignore_ambiguity</span><span class="p">,</span>
                                       <span class="n">restart_times</span><span class="o">=</span><span class="n">restart_times</span><span class="p">,</span>
                                       <span class="n">attempt</span><span class="o">=</span><span class="n">attempt</span><span class="p">,</span>
                                       <span class="n">lock</span><span class="o">=</span><span class="n">lock</span><span class="p">,</span>
                                       <span class="n">unlock</span><span class="o">=</span><span class="n">unlock</span><span class="p">,</span>
                                       <span class="n">cleanup_metadata</span><span class="o">=</span><span class="n">cleanup_metadata</span><span class="p">,</span>
                                       <span class="n">cleanup_conda</span><span class="o">=</span><span class="n">cleanup_conda</span><span class="p">,</span>
                                       <span class="n">cleanup_shadow</span><span class="o">=</span><span class="n">cleanup_shadow</span><span class="p">,</span>
                                       <span class="n">force_incomplete</span><span class="o">=</span><span class="n">force_incomplete</span><span class="p">,</span>
                                       <span class="n">ignore_incomplete</span><span class="o">=</span><span class="n">ignore_incomplete</span><span class="p">,</span>
                                       <span class="n">latency_wait</span><span class="o">=</span><span class="n">latency_wait</span><span class="p">,</span>
                                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                       <span class="n">notemp</span><span class="o">=</span><span class="n">notemp</span><span class="p">,</span>
                                       <span class="n">keep_remote_local</span><span class="o">=</span><span class="n">keep_remote_local</span><span class="p">,</span>
                                       <span class="n">nodeps</span><span class="o">=</span><span class="n">nodeps</span><span class="p">,</span>
                                       <span class="n">jobscript</span><span class="o">=</span><span class="n">jobscript</span><span class="p">,</span>
                                       <span class="n">greediness</span><span class="o">=</span><span class="n">greediness</span><span class="p">,</span>
                                       <span class="n">no_hooks</span><span class="o">=</span><span class="n">no_hooks</span><span class="p">,</span>
                                       <span class="n">overwrite_shellcmd</span><span class="o">=</span><span class="n">overwrite_shellcmd</span><span class="p">,</span>
                                       <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
                                       <span class="n">config_args</span><span class="o">=</span><span class="n">config_args</span><span class="p">,</span>
                                       <span class="n">cluster_config</span><span class="o">=</span><span class="n">cluster_config</span><span class="p">,</span>
                                       <span class="n">keep_logger</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                       <span class="n">force_use_threads</span><span class="o">=</span><span class="n">use_threads</span><span class="p">,</span>
                                       <span class="n">use_conda</span><span class="o">=</span><span class="n">use_conda</span><span class="p">,</span>
                                       <span class="n">use_singularity</span><span class="o">=</span><span class="n">use_singularity</span><span class="p">,</span>
                                       <span class="n">conda_prefix</span><span class="o">=</span><span class="n">conda_prefix</span><span class="p">,</span>
                                       <span class="n">singularity_prefix</span><span class="o">=</span><span class="n">singularity_prefix</span><span class="p">,</span>
                                       <span class="n">shadow_prefix</span><span class="o">=</span><span class="n">shadow_prefix</span><span class="p">,</span>
                                       <span class="n">singularity_args</span><span class="o">=</span><span class="n">singularity_args</span><span class="p">,</span>
                                       <span class="n">list_conda_envs</span><span class="o">=</span><span class="n">list_conda_envs</span><span class="p">,</span>
                                       <span class="n">kubernetes</span><span class="o">=</span><span class="n">kubernetes</span><span class="p">,</span>
                                       <span class="n">kubernetes_envvars</span><span class="o">=</span><span class="n">kubernetes_envvars</span><span class="p">,</span>
                                       <span class="n">container_image</span><span class="o">=</span><span class="n">container_image</span><span class="p">,</span>
                                       <span class="n">create_envs_only</span><span class="o">=</span><span class="n">create_envs_only</span><span class="p">,</span>
                                       <span class="n">default_remote_provider</span><span class="o">=</span><span class="n">default_remote_provider</span><span class="p">,</span>
                                       <span class="n">default_remote_prefix</span><span class="o">=</span><span class="n">default_remote_prefix</span><span class="p">,</span>
                                       <span class="n">assume_shared_fs</span><span class="o">=</span><span class="n">assume_shared_fs</span><span class="p">,</span>
                                       <span class="n">cluster_status</span><span class="o">=</span><span class="n">cluster_status</span><span class="p">,</span>
                                       <span class="n">max_jobs_per_second</span><span class="o">=</span><span class="n">max_jobs_per_second</span><span class="p">,</span>
                                       <span class="n">max_status_checks_per_second</span><span class="o">=</span><span class="n">max_status_checks_per_second</span><span class="p">)</span>

                <span class="n">success</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                    <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
                    <span class="n">dryrun</span><span class="o">=</span><span class="n">dryrun</span><span class="p">,</span>
                    <span class="n">touch</span><span class="o">=</span><span class="n">touch</span><span class="p">,</span>
                    <span class="n">cores</span><span class="o">=</span><span class="n">cores</span><span class="p">,</span>
                    <span class="n">nodes</span><span class="o">=</span><span class="n">nodes</span><span class="p">,</span>
                    <span class="n">local_cores</span><span class="o">=</span><span class="n">local_cores</span><span class="p">,</span>
                    <span class="n">forcetargets</span><span class="o">=</span><span class="n">forcetargets</span><span class="p">,</span>
                    <span class="n">forceall</span><span class="o">=</span><span class="n">forceall</span><span class="p">,</span>
                    <span class="n">forcerun</span><span class="o">=</span><span class="n">forcerun</span><span class="p">,</span>
                    <span class="n">prioritytargets</span><span class="o">=</span><span class="n">prioritytargets</span><span class="p">,</span>
                    <span class="n">until</span><span class="o">=</span><span class="n">until</span><span class="p">,</span>
                    <span class="n">omit_from</span><span class="o">=</span><span class="n">omit_from</span><span class="p">,</span>
                    <span class="n">quiet</span><span class="o">=</span><span class="n">quiet</span><span class="p">,</span>
                    <span class="n">keepgoing</span><span class="o">=</span><span class="n">keepgoing</span><span class="p">,</span>
                    <span class="n">printshellcmds</span><span class="o">=</span><span class="n">printshellcmds</span><span class="p">,</span>
                    <span class="n">printreason</span><span class="o">=</span><span class="n">printreason</span><span class="p">,</span>
                    <span class="n">printrulegraph</span><span class="o">=</span><span class="n">printrulegraph</span><span class="p">,</span>
                    <span class="n">printdag</span><span class="o">=</span><span class="n">printdag</span><span class="p">,</span>
                    <span class="n">cluster</span><span class="o">=</span><span class="n">cluster</span><span class="p">,</span>
                    <span class="n">cluster_sync</span><span class="o">=</span><span class="n">cluster_sync</span><span class="p">,</span>
                    <span class="n">jobname</span><span class="o">=</span><span class="n">jobname</span><span class="p">,</span>
                    <span class="n">drmaa</span><span class="o">=</span><span class="n">drmaa</span><span class="p">,</span>
                    <span class="n">drmaa_log_dir</span><span class="o">=</span><span class="n">drmaa_log_dir</span><span class="p">,</span>
                    <span class="n">kubernetes</span><span class="o">=</span><span class="n">kubernetes</span><span class="p">,</span>
                    <span class="n">kubernetes_envvars</span><span class="o">=</span><span class="n">kubernetes_envvars</span><span class="p">,</span>
                    <span class="n">container_image</span><span class="o">=</span><span class="n">container_image</span><span class="p">,</span>
                    <span class="n">max_jobs_per_second</span><span class="o">=</span><span class="n">max_jobs_per_second</span><span class="p">,</span>
                    <span class="n">max_status_checks_per_second</span><span class="o">=</span><span class="n">max_status_checks_per_second</span><span class="p">,</span>
                    <span class="n">printd3dag</span><span class="o">=</span><span class="n">printd3dag</span><span class="p">,</span>
                    <span class="n">immediate_submit</span><span class="o">=</span><span class="n">immediate_submit</span><span class="p">,</span>
                    <span class="n">ignore_ambiguity</span><span class="o">=</span><span class="n">ignore_ambiguity</span><span class="p">,</span>
                    <span class="n">stats</span><span class="o">=</span><span class="n">stats</span><span class="p">,</span>
                    <span class="n">force_incomplete</span><span class="o">=</span><span class="n">force_incomplete</span><span class="p">,</span>
                    <span class="n">ignore_incomplete</span><span class="o">=</span><span class="n">ignore_incomplete</span><span class="p">,</span>
                    <span class="n">list_version_changes</span><span class="o">=</span><span class="n">list_version_changes</span><span class="p">,</span>
                    <span class="n">list_code_changes</span><span class="o">=</span><span class="n">list_code_changes</span><span class="p">,</span>
                    <span class="n">list_input_changes</span><span class="o">=</span><span class="n">list_input_changes</span><span class="p">,</span>
                    <span class="n">list_params_changes</span><span class="o">=</span><span class="n">list_params_changes</span><span class="p">,</span>
                    <span class="n">list_untracked</span><span class="o">=</span><span class="n">list_untracked</span><span class="p">,</span>
                    <span class="n">list_conda_envs</span><span class="o">=</span><span class="n">list_conda_envs</span><span class="p">,</span>
                    <span class="n">summary</span><span class="o">=</span><span class="n">summary</span><span class="p">,</span>
                    <span class="n">archive</span><span class="o">=</span><span class="n">archive</span><span class="p">,</span>
                    <span class="n">delete_all_output</span><span class="o">=</span><span class="n">delete_all_output</span><span class="p">,</span>
                    <span class="n">delete_temp_output</span><span class="o">=</span><span class="n">delete_temp_output</span><span class="p">,</span>
                    <span class="n">latency_wait</span><span class="o">=</span><span class="n">latency_wait</span><span class="p">,</span>
                    <span class="n">wait_for_files</span><span class="o">=</span><span class="n">wait_for_files</span><span class="p">,</span>
                    <span class="n">detailed_summary</span><span class="o">=</span><span class="n">detailed_summary</span><span class="p">,</span>
                    <span class="n">nolock</span><span class="o">=</span><span class="ow">not</span> <span class="n">lock</span><span class="p">,</span>
                    <span class="n">unlock</span><span class="o">=</span><span class="n">unlock</span><span class="p">,</span>
                    <span class="n">resources</span><span class="o">=</span><span class="n">resources</span><span class="p">,</span>
                    <span class="n">notemp</span><span class="o">=</span><span class="n">notemp</span><span class="p">,</span>
                    <span class="n">keep_remote_local</span><span class="o">=</span><span class="n">keep_remote_local</span><span class="p">,</span>
                    <span class="n">nodeps</span><span class="o">=</span><span class="n">nodeps</span><span class="p">,</span>
                    <span class="n">keep_target_files</span><span class="o">=</span><span class="n">keep_target_files</span><span class="p">,</span>
                    <span class="n">cleanup_metadata</span><span class="o">=</span><span class="n">cleanup_metadata</span><span class="p">,</span>
                    <span class="n">cleanup_conda</span><span class="o">=</span><span class="n">cleanup_conda</span><span class="p">,</span>
                    <span class="n">cleanup_shadow</span><span class="o">=</span><span class="n">cleanup_shadow</span><span class="p">,</span>
                    <span class="n">subsnakemake</span><span class="o">=</span><span class="n">subsnakemake</span><span class="p">,</span>
                    <span class="n">updated_files</span><span class="o">=</span><span class="n">updated_files</span><span class="p">,</span>
                    <span class="n">allowed_rules</span><span class="o">=</span><span class="n">allowed_rules</span><span class="p">,</span>
                    <span class="n">greediness</span><span class="o">=</span><span class="n">greediness</span><span class="p">,</span>
                    <span class="n">no_hooks</span><span class="o">=</span><span class="n">no_hooks</span><span class="p">,</span>
                    <span class="n">force_use_threads</span><span class="o">=</span><span class="n">use_threads</span><span class="p">,</span>
                    <span class="n">create_envs_only</span><span class="o">=</span><span class="n">create_envs_only</span><span class="p">,</span>
                    <span class="n">assume_shared_fs</span><span class="o">=</span><span class="n">assume_shared_fs</span><span class="p">,</span>
                    <span class="n">cluster_status</span><span class="o">=</span><span class="n">cluster_status</span><span class="p">,</span>
                    <span class="n">report</span><span class="o">=</span><span class="n">report</span><span class="p">,</span>
                    <span class="n">export_cwl</span><span class="o">=</span><span class="n">export_cwl</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">BrokenPipeError</span><span class="p">:</span>
        <span class="c1"># ignore this exception and stop. It occurs if snakemake output is piped into less and less quits before reading the whole output.</span>
        <span class="c1"># in such a case, snakemake shall stop scheduling and quit with error 1</span>
        <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="ne">BaseException</span><span class="p">)</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;workflow&quot;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
            <span class="n">print_exception</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">workflow</span><span class="o">.</span><span class="n">linemaps</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">print_exception</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="nb">dict</span><span class="p">())</span>
        <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">workdir</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">olddir</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;workflow&quot;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span> <span class="ow">and</span> <span class="n">workflow</span><span class="o">.</span><span class="n">persistence</span><span class="p">:</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">persistence</span><span class="o">.</span><span class="n">unlock</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">keep_logger</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">success</span></div>


<div class="viewcode-block" id="parse_config"><a class="viewcode-back" href="../api_reference/internal/snakemake.html#snakemake.parse_config">[docs]</a><span class="k">def</span> <span class="nf">parse_config</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse config from args.&quot;&quot;&quot;</span>
    <span class="n">parsers</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">eval</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="n">config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;[a-zA-Z_]\w*$&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Config entries have to be defined as name=value pairs.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Config entry must start with a valid identifier.&quot;</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">parser</span> <span class="ow">in</span> <span class="n">parsers</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">parser</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                    <span class="c1"># avoid accidental interpretation as function</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                        <span class="k">break</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">config</span></div>


<div class="viewcode-block" id="unparse_config"><a class="viewcode-back" href="../api_reference/internal/snakemake.html#snakemake.unparse_config">[docs]</a><span class="k">def</span> <span class="nf">unparse_config</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;config is not a dict&quot;</span><span class="p">)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;config may only be a flat dict&quot;</span><span class="p">)</span>
        <span class="n">encoded</span> <span class="o">=</span> <span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span>
        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">encoded</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">items</span></div>


<span class="n">APPDIRS</span> <span class="o">=</span> <span class="kc">None</span>


<div class="viewcode-block" id="get_appdirs"><a class="viewcode-back" href="../api_reference/internal/snakemake.html#snakemake.get_appdirs">[docs]</a><span class="k">def</span> <span class="nf">get_appdirs</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">APPDIRS</span>
    <span class="k">if</span> <span class="n">APPDIRS</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">appdirs</span> <span class="k">import</span> <span class="n">AppDirs</span>
        <span class="n">APPDIRS</span> <span class="o">=</span> <span class="n">AppDirs</span><span class="p">(</span><span class="s2">&quot;snakemake&quot;</span><span class="p">,</span> <span class="s2">&quot;snakemake&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">APPDIRS</span></div>


<div class="viewcode-block" id="get_profile_file"><a class="viewcode-back" href="../api_reference/internal/snakemake.html#snakemake.get_profile_file">[docs]</a><span class="k">def</span> <span class="nf">get_profile_file</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">return_default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">dirs</span> <span class="o">=</span> <span class="n">get_appdirs</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">profile</span><span class="p">):</span>
        <span class="n">search_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">profile</span><span class="p">)]</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">search_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
                       <span class="n">dirs</span><span class="o">.</span><span class="n">user_config_dir</span><span class="p">,</span>
                       <span class="n">dirs</span><span class="o">.</span><span class="n">site_config_dir</span><span class="p">]</span>
    <span class="n">get_path</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">profile</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">search_dirs</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">get_path</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">p</span>

    <span class="k">if</span> <span class="n">return_default</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">file</span>
    <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="get_argument_parser"><a class="viewcode-back" href="../api_reference/internal/snakemake.html#snakemake.get_argument_parser">[docs]</a><span class="k">def</span> <span class="nf">get_argument_parser</span><span class="p">(</span><span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate and return argument parser.&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">configargparse</span>
    <span class="kn">from</span> <span class="nn">configargparse</span> <span class="k">import</span> <span class="n">YAMLConfigFileParser</span>

    <span class="n">dirs</span> <span class="o">=</span> <span class="n">get_appdirs</span><span class="p">()</span>
    <span class="n">config_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">profile</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">profile</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: invalid profile name.&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">config_file</span> <span class="o">=</span> <span class="n">get_profile_file</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="s2">&quot;config.yaml&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">config_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: profile given but no config.yaml found. &quot;</span>
                  <span class="s2">&quot;Profile has to be given as either absolute path, relative &quot;</span>
                  <span class="s2">&quot;path or name of a directory available in either &quot;</span>
                  <span class="s2">&quot;</span><span class="si">{site}</span><span class="s2"> or </span><span class="si">{user}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                      <span class="n">site</span><span class="o">=</span><span class="n">dirs</span><span class="o">.</span><span class="n">site_config_dir</span><span class="p">,</span>
                      <span class="n">user</span><span class="o">=</span><span class="n">dirs</span><span class="o">.</span><span class="n">user_config_dir</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">config_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">config_file</span><span class="p">]</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">configargparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Snakemake is a Python based language and execution &quot;</span>
        <span class="s2">&quot;environment for GNU Make-like workflows.&quot;</span><span class="p">,</span>
        <span class="n">default_config_files</span><span class="o">=</span><span class="n">config_files</span><span class="p">,</span>
        <span class="n">config_file_parser_class</span><span class="o">=</span><span class="n">YAMLConfigFileParser</span><span class="p">)</span>

    <span class="n">group_exec</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s2">&quot;EXECUTION&quot;</span><span class="p">)</span>

    <span class="n">group_exec</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">,</span>
                        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Targets to build. May be rules or files.&quot;</span><span class="p">)</span>

    <span class="n">group_exec</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--dry-run&quot;</span><span class="p">,</span> <span class="s2">&quot;--dryrun&quot;</span><span class="p">,</span> <span class="s2">&quot;-n&quot;</span><span class="p">,</span>
                        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;dryrun&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Do not execute anything, and display what would be done. &quot;</span>
                             <span class="s2">&quot;If you have a very large workflow, use --dry-run --quiet to just &quot;</span>
                             <span class="s2">&quot;print a summary of the DAG of jobs.&quot;</span><span class="p">)</span>

    <span class="n">group_exec</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--profile&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                        Name of profile to use for configuring</span>
<span class="s2">                        Snakemake. Snakemake will search for a corresponding</span>
<span class="s2">                        folder in </span><span class="si">{}</span><span class="s2"> and </span><span class="si">{}</span><span class="s2">. Alternatively, this can be an</span>
<span class="s2">                        absolute or relative path.</span>
<span class="s2">                        The profile folder has to contain a file &#39;config.yaml&#39;.</span>
<span class="s2">                        This file can be used to set default values for command</span>
<span class="s2">                        line options in YAML format. For example,</span>
<span class="s2">                        &#39;--cluster qsub&#39; becomes &#39;cluster: qsub&#39; in the YAML</span>
<span class="s2">                        file. Profiles can be obtained from</span>
<span class="s2">                        https://github.com/snakemake-profiles.</span>
<span class="s2">                        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dirs</span><span class="o">.</span><span class="n">site_config_dir</span><span class="p">,</span>
                                   <span class="n">dirs</span><span class="o">.</span><span class="n">user_config_dir</span><span class="p">))</span>

    <span class="n">group_exec</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--snakefile&quot;</span><span class="p">,</span> <span class="s2">&quot;-s&quot;</span><span class="p">,</span>
                        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;FILE&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;The workflow definition in form of a snakefile.&quot;</span>
                             <span class="s2">&quot;Usually, you should not need to specify this. &quot;</span>
                             <span class="s2">&quot;By default, Snakemake will search for </span><span class="si">{}</span><span class="s2"> &quot;</span>
                             <span class="s2">&quot;beneath the current working &quot;</span>
                             <span class="s2">&quot;directory, in this order. &quot;</span>
                             <span class="s2">&quot;Only if you definitely want a different layout, &quot;</span>
                             <span class="s2">&quot;you need to use this parameter.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="n">SNAKEFILE_CHOICES</span><span class="p">))</span>
                            <span class="p">))</span>
    <span class="n">group_exec</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--cores&quot;</span><span class="p">,</span> <span class="s2">&quot;--jobs&quot;</span><span class="p">,</span> <span class="s2">&quot;-j&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
        <span class="n">const</span><span class="o">=</span><span class="n">available_cpu_count</span><span class="p">(),</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;?&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;N&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Use at most N cores in parallel (default: 1). &quot;</span>
              <span class="s2">&quot;If N is omitted, the limit is set to the number of &quot;</span>
              <span class="s2">&quot;available cores.&quot;</span><span class="p">))</span>
    <span class="n">group_exec</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--local-cores&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">available_cpu_count</span><span class="p">(),</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;N&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span>
        <span class="p">(</span><span class="s2">&quot;In cluster mode, use at most N cores of the host machine in parallel &quot;</span>
         <span class="s2">&quot; (default: number of CPU cores of the host). The cores are used to execute &quot;</span>
         <span class="s2">&quot;local rules. This option is ignored when not in cluster mode.&quot;</span><span class="p">))</span>
    <span class="n">group_exec</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--resources&quot;</span><span class="p">,</span> <span class="s2">&quot;--res&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;NAME=INT&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Define additional resources that shall constrain the scheduling &quot;</span>
              <span class="s2">&quot;analogously to threads (see above). A resource is defined as &quot;</span>
              <span class="s2">&quot;a name and an integer value. E.g. --resources gpu=1. Rules can &quot;</span>
              <span class="s2">&quot;use resources by defining the resource keyword, e.g. &quot;</span>
              <span class="s2">&quot;resources: gpu=1. If now two rules require 1 of the resource &quot;</span>
              <span class="s2">&quot;&#39;gpu&#39; they won&#39;t be run in parallel by the scheduler.&quot;</span><span class="p">))</span>
    <span class="n">group_exec</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--default-resources&quot;</span><span class="p">,</span> <span class="s2">&quot;--default-res&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;NAME=INT&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Define default values of resources for rules that do not define their own values. &quot;</span>
              <span class="s2">&quot;In addition to plain integers, python expressions over inputsize are allowed (e.g. &#39;2*input.size&#39;).&quot;</span>
              <span class="s2">&quot;When specifying this without any arguments (--default-resources), it defines &#39;mem_mb=max(2*input.size, 1000)&#39; &quot;</span>
              <span class="s2">&quot;&#39;disk_mb=max(2*input.size, 1000)&#39;, i.e., default disk and mem usage is twice the input file size but at least 1GB.&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">group_exec</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--config&quot;</span><span class="p">,</span> <span class="s2">&quot;-C&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;KEY=VALUE&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span>
        <span class="p">(</span><span class="s2">&quot;Set or overwrite values in the workflow config object. &quot;</span>
         <span class="s2">&quot;The workflow config object is accessible as variable config inside &quot;</span>
         <span class="s2">&quot;the workflow. Default values can be set by providing a JSON file &quot;</span>
         <span class="s2">&quot;(see Documentation).&quot;</span><span class="p">))</span>
    <span class="n">group_exec</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--configfile&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;FILE&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span>
        <span class="p">(</span><span class="s2">&quot;Specify or overwrite the config file of the workflow (see the docs). &quot;</span>
         <span class="s2">&quot;Values specified in JSON or YAML format are available in the global config &quot;</span>
         <span class="s2">&quot;dictionary inside the workflow.&quot;</span><span class="p">))</span>
    <span class="n">group_exec</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--directory&quot;</span><span class="p">,</span> <span class="s2">&quot;-d&quot;</span><span class="p">,</span>
                        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;DIR&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Specify working directory (relative paths in &quot;</span>
                              <span class="s2">&quot;the snakefile will use this as their origin).&quot;</span><span class="p">))</span>
    <span class="n">group_exec</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--touch&quot;</span><span class="p">,</span> <span class="s2">&quot;-t&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Touch output files (mark them up to date without really &quot;</span>
              <span class="s2">&quot;changing them) instead of running their commands. This is &quot;</span>
              <span class="s2">&quot;used to pretend that the rules were executed, in order to &quot;</span>
              <span class="s2">&quot;fool future invocations of snakemake. Fails if a file does &quot;</span>
              <span class="s2">&quot;not yet exist.&quot;</span><span class="p">))</span>
    <span class="n">group_exec</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--keep-going&quot;</span><span class="p">,</span> <span class="s2">&quot;-k&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Go on with independent jobs if a job fails.&quot;</span><span class="p">)</span>
    <span class="n">group_exec</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--force&quot;</span><span class="p">,</span> <span class="s2">&quot;-f&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Force the execution of the selected target or the first rule &quot;</span>
              <span class="s2">&quot;regardless of already created output.&quot;</span><span class="p">))</span>
    <span class="n">group_exec</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--forceall&quot;</span><span class="p">,</span> <span class="s2">&quot;-F&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Force the execution of the selected (or the first) rule and &quot;</span>
              <span class="s2">&quot;all rules it is dependent on regardless of already created &quot;</span>
              <span class="s2">&quot;output.&quot;</span><span class="p">))</span>
    <span class="n">group_exec</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--forcerun&quot;</span><span class="p">,</span> <span class="s2">&quot;-R&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;TARGET&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Force the re-execution or creation of the given rules or files.&quot;</span>
              <span class="s2">&quot; Use this option if you changed a rule and want to have all its &quot;</span>
              <span class="s2">&quot;output in your workflow updated.&quot;</span><span class="p">))</span>
    <span class="n">group_exec</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--prioritize&quot;</span><span class="p">,</span> <span class="s2">&quot;-P&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;TARGET&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Tell the scheduler to assign creation of given targets &quot;</span>
              <span class="s2">&quot;(and all their dependencies) highest priority. (EXPERIMENTAL)&quot;</span><span class="p">))</span>
    <span class="n">group_exec</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--until&quot;</span><span class="p">,</span> <span class="s2">&quot;-U&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;TARGET&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Runs the pipeline until it reaches the specified rules or &quot;</span>
              <span class="s2">&quot;files. Only runs jobs that are dependencies of the specified &quot;</span>
              <span class="s2">&quot;rule or files, does not run sibling DAGs. &quot;</span><span class="p">))</span>
    <span class="n">group_exec</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--omit-from&quot;</span><span class="p">,</span> <span class="s2">&quot;-O&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;TARGET&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Prevent the execution or creation of the given rules or files &quot;</span>
              <span class="s2">&quot;as well as any rules or files that are downstream of these targets &quot;</span>
              <span class="s2">&quot;in the DAG. Also runs jobs in sibling DAGs that are independent of the &quot;</span>
              <span class="s2">&quot;rules or files specified here.&quot;</span><span class="p">))</span>
    <span class="n">group_exec</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--rerun-incomplete&quot;</span><span class="p">,</span> <span class="s2">&quot;--ri&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Re-run all &quot;</span>
                <span class="s2">&quot;jobs the output of which is recognized as incomplete.&quot;</span><span class="p">))</span>
    <span class="n">group_exec</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--shadow-prefix&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;DIR&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Specify a directory in which the &#39;shadow&#39; directory is created. &quot;</span>
                <span class="s2">&quot;If not supplied, the value is set to the &#39;.snakemake&#39; directory relative &quot;</span>
                <span class="s2">&quot;to the working directory.&quot;</span><span class="p">))</span>

    <span class="n">group_utils</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s2">&quot;UTILITIES&quot;</span><span class="p">)</span>

    <span class="n">group_utils</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--report&quot;</span><span class="p">,</span>
                        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;?&quot;</span><span class="p">,</span>
                        <span class="n">const</span><span class="o">=</span><span class="s2">&quot;report.html&quot;</span><span class="p">,</span>
                        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;HTMLFILE&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Create an HTML report with results and statistics. &quot;</span>
                             <span class="s2">&quot;If no filename is given, report.html is the default.&quot;</span><span class="p">)</span>
    <span class="n">group_utils</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--export-cwl&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
                        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;FILE&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Compile workflow to CWL and store it in given FILE.&quot;</span><span class="p">)</span>
    <span class="n">group_utils</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--list&quot;</span><span class="p">,</span> <span class="s2">&quot;-l&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show available rules in given Snakefile.&quot;</span><span class="p">)</span>
    <span class="n">group_utils</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--list-target-rules&quot;</span><span class="p">,</span> <span class="s2">&quot;--lt&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show available target rules in given Snakefile.&quot;</span><span class="p">)</span>
    <span class="n">group_utils</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--dag&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Do not execute anything and print the directed &quot;</span>
        <span class="s2">&quot;acyclic graph of jobs in the dot language. Recommended &quot;</span>
        <span class="s2">&quot;use on Unix systems: snakemake --dag | dot | display&quot;</span><span class="p">)</span>
    <span class="n">group_utils</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--rulegraph&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Do not execute anything and print the dependency graph &quot;</span>
        <span class="s2">&quot;of rules in the dot language. This will be less &quot;</span>
        <span class="s2">&quot;crowded than above DAG of jobs, but also show less information. &quot;</span>
        <span class="s2">&quot;Note that each rule is displayed once, hence the displayed graph will be &quot;</span>
        <span class="s2">&quot;cyclic if a rule appears in several steps of the workflow. &quot;</span>
        <span class="s2">&quot;Use this if above option leads to a DAG that is too large. &quot;</span>
        <span class="s2">&quot;Recommended use on Unix systems: snakemake --rulegraph | dot | display&quot;</span><span class="p">)</span>
    <span class="n">group_utils</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--d3dag&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print the DAG in D3.js compatible JSON format.&quot;</span><span class="p">)</span>
    <span class="n">group_utils</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--summary&quot;</span><span class="p">,</span> <span class="s2">&quot;-S&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print a summary of all files created by the workflow. The &quot;</span>
        <span class="s2">&quot;has the following columns: filename, modification time, &quot;</span>
        <span class="s2">&quot;rule version, status, plan.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Thereby rule version contains the version&quot;</span>
        <span class="s2">&quot;the file was created with (see the version keyword of rules), and &quot;</span>
        <span class="s2">&quot;status denotes whether the file is missing, its input files are &quot;</span>
        <span class="s2">&quot;newer or if version or implementation of the rule changed since &quot;</span>
        <span class="s2">&quot;file creation. Finally the last column denotes whether the file &quot;</span>
        <span class="s2">&quot;will be updated or created during the next workflow execution.&quot;</span><span class="p">)</span>
    <span class="n">group_utils</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--detailed-summary&quot;</span><span class="p">,</span> <span class="s2">&quot;-D&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print a summary of all files created by the workflow. The &quot;</span>
        <span class="s2">&quot;has the following columns: filename, modification time, &quot;</span>
        <span class="s2">&quot;rule version, input file(s), shell command, status, plan.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Thereby rule version contains the version&quot;</span>
        <span class="s2">&quot;the file was created with (see the version keyword of rules), and &quot;</span>
        <span class="s2">&quot;status denotes whether the file is missing, its input files are &quot;</span>
        <span class="s2">&quot;newer or if version or implementation of the rule changed since &quot;</span>
        <span class="s2">&quot;file creation. The input file and shell command columns are self&quot;</span>
        <span class="s2">&quot;explanatory. Finally the last column denotes whether the file &quot;</span>
        <span class="s2">&quot;will be updated or created during the next workflow execution.&quot;</span><span class="p">)</span>
    <span class="n">group_utils</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--archive&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;FILE&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Archive the workflow into the given tar archive FILE. The archive &quot;</span>
        <span class="s2">&quot;will be created such that the workflow can be re-executed on a vanilla &quot;</span>
        <span class="s2">&quot;system. The function needs conda and git to be installed. &quot;</span>
        <span class="s2">&quot;It will archive every file that is under git version control. &quot;</span>
        <span class="s2">&quot;Note that it is best practice to have the Snakefile, config files, and &quot;</span>
        <span class="s2">&quot;scripts under version control. Hence, they will be included in the archive. &quot;</span>
        <span class="s2">&quot;Further, it will add input files that are not generated by &quot;</span>
        <span class="s2">&quot;by the workflow itself and conda environments. Note that symlinks are &quot;</span>
        <span class="s2">&quot;dereferenced. Supported &quot;</span>
        <span class="s2">&quot;formats are .tar, .tar.gz, .tar.bz2 and .tar.xz.&quot;</span>
    <span class="p">)</span>
    <span class="n">group_utils</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--cleanup-metadata&quot;</span><span class="p">,</span> <span class="s2">&quot;--cm&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;FILE&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Cleanup the metadata &quot;</span>
        <span class="s2">&quot;of given files. That means that snakemake removes any tracked &quot;</span>
        <span class="s2">&quot;version info, and any marks that files are incomplete.&quot;</span><span class="p">)</span>
    <span class="n">group_utils</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--cleanup-shadow&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Cleanup old shadow directories which have not been deleted due &quot;</span>
             <span class="s2">&quot;to failures or power loss.&quot;</span><span class="p">)</span>
    <span class="n">group_utils</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--unlock&quot;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Remove a lock on the working directory.&quot;</span><span class="p">)</span>
    <span class="n">group_utils</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--list-version-changes&quot;</span><span class="p">,</span> <span class="s2">&quot;--lv&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;List all output files that have been created with &quot;</span>
        <span class="s2">&quot;a different version (as determined by the version keyword).&quot;</span><span class="p">)</span>
    <span class="n">group_utils</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--list-code-changes&quot;</span><span class="p">,</span> <span class="s2">&quot;--lc&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span>
        <span class="s2">&quot;List all output files for which the rule body (run or shell) have &quot;</span>
        <span class="s2">&quot;changed in the Snakefile.&quot;</span><span class="p">)</span>
    <span class="n">group_utils</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--list-input-changes&quot;</span><span class="p">,</span> <span class="s2">&quot;--li&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span>
        <span class="s2">&quot;List all output files for which the defined input files have changed &quot;</span>
        <span class="s2">&quot;in the Snakefile (e.g. new input files were added in the rule &quot;</span>
        <span class="s2">&quot;definition or files were renamed). For listing input file &quot;</span>
        <span class="s2">&quot;modification in the filesystem, use --summary.&quot;</span><span class="p">)</span>
    <span class="n">group_utils</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--list-params-changes&quot;</span><span class="p">,</span> <span class="s2">&quot;--lp&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;List all output files for which the defined params have changed &quot;</span>
        <span class="s2">&quot;in the Snakefile.&quot;</span><span class="p">)</span>
    <span class="n">group_utils</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--list-untracked&quot;</span><span class="p">,</span> <span class="s2">&quot;--lu&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;List all files in the working directory that are not used in the  &quot;</span>
        <span class="s2">&quot;workflow. This can be used e.g. for identifying leftover files. Hidden files &quot;</span>
        <span class="s2">&quot;and directories are ignored.&quot;</span><span class="p">)</span>
    <span class="n">group_utils</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--delete-all-output&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Remove all files generated by the workflow. Use together with --dry-run &quot;</span>
        <span class="s2">&quot;to list files without actually deleting anything. Note that this will &quot;</span>
        <span class="s2">&quot;not recurse into subworkflows. Write-protected files are not removed. &quot;</span>
        <span class="s2">&quot;Nevertheless, use with care!&quot;</span>
    <span class="p">)</span>
    <span class="n">group_utils</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--delete-temp-output&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Remove all temporary files generated by the workflow. Use together &quot;</span>
        <span class="s2">&quot;with --dry-run to list files without actually deleting anything. Note &quot;</span>
        <span class="s2">&quot;that this will not recurse into subworkflows.&quot;</span>
    <span class="p">)</span>
    <span class="n">group_utils</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--bash-completion&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output code to register bash completion for snakemake. Put the &quot;</span>
        <span class="s2">&quot;following in your .bashrc (including the accents): &quot;</span>
        <span class="s2">&quot;`snakemake --bash-completion` or issue it in an open terminal &quot;</span>
        <span class="s2">&quot;session.&quot;</span><span class="p">)</span>
    <span class="n">group_utils</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--version&quot;</span><span class="p">,</span> <span class="s2">&quot;-v&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;version&quot;</span><span class="p">,</span>
                        <span class="n">version</span><span class="o">=</span><span class="n">__version__</span><span class="p">)</span>

    <span class="n">group_output</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s2">&quot;OUTPUT&quot;</span><span class="p">)</span>
    <span class="n">group_output</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--reason&quot;</span><span class="p">,</span> <span class="s2">&quot;-r&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print the reason for each executed rule.&quot;</span><span class="p">)</span>
    <span class="n">group_output</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--gui&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;?&quot;</span><span class="p">,</span>
        <span class="n">const</span><span class="o">=</span><span class="s2">&quot;8000&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;PORT&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Serve an HTML based user interface to the given network and &quot;</span>
        <span class="s2">&quot;port e.g. 168.129.10.15:8000. By default Snakemake is only &quot;</span>
        <span class="s2">&quot;available in the local network (default port: 8000). To make &quot;</span>
        <span class="s2">&quot;Snakemake listen to all ip addresses add the special host address &quot;</span>
        <span class="s2">&quot;0.0.0.0 to the url (0.0.0.0:8000). This is important if Snakemake &quot;</span>
        <span class="s2">&quot;is used in a virtualised environment like Docker. If possible, a &quot;</span>
        <span class="s2">&quot;browser window is opened.&quot;</span><span class="p">)</span>
    <span class="n">group_output</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--printshellcmds&quot;</span><span class="p">,</span> <span class="s2">&quot;-p&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print out the shell commands that will be executed.&quot;</span><span class="p">)</span>
    <span class="n">group_output</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--debug-dag&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print candidate and selected jobs (including their wildcards) while &quot;</span>
        <span class="s2">&quot;inferring DAG. This can help to debug unexpected DAG topology or errors.&quot;</span><span class="p">)</span>
    <span class="n">group_output</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--stats&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;FILE&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span>
        <span class="s2">&quot;Write stats about Snakefile execution in JSON format to the given file.&quot;</span><span class="p">)</span>
    <span class="n">group_output</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--nocolor&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Do not use a colored output.&quot;</span><span class="p">)</span>
    <span class="n">group_output</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--quiet&quot;</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Do not output any progress or rule information.&quot;</span><span class="p">)</span>
    <span class="n">group_output</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--print-compilation&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print the python representation of the workflow.&quot;</span><span class="p">)</span>

    <span class="n">group_output</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--verbose&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print debugging output.&quot;</span><span class="p">)</span>

    <span class="n">group_behavior</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s2">&quot;BEHAVIOR&quot;</span><span class="p">)</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--force-use-threads&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;force_use_threads&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Force threads rather than processes. Helpful if shared memory (/dev/shm) is full or unavailable.&quot;</span><span class="p">)</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--allow-ambiguity&quot;</span><span class="p">,</span> <span class="s2">&quot;-a&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Don&#39;t check for ambiguous rules and simply use the first if &quot;</span>
              <span class="s2">&quot;several can produce the same file. This allows the user to &quot;</span>
              <span class="s2">&quot;prioritize rules by their order in the snakefile.&quot;</span><span class="p">))</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--nolock&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Do not lock the working directory&quot;</span><span class="p">)</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--ignore-incomplete&quot;</span><span class="p">,</span> <span class="s2">&quot;--ii&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Do not check for incomplete output files.&quot;</span><span class="p">)</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--latency-wait&quot;</span><span class="p">,</span> <span class="s2">&quot;--output-wait&quot;</span><span class="p">,</span> <span class="s2">&quot;-w&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;SECONDS&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span>
        <span class="s2">&quot;Wait given seconds if an output file of a job is not present after &quot;</span>
        <span class="s2">&quot;the job finished. This helps if your filesystem &quot;</span>
        <span class="s2">&quot;suffers from latency (default 5).&quot;</span><span class="p">)</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--wait-for-files&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;FILE&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Wait --latency-wait seconds for these &quot;</span>
        <span class="s2">&quot;files to be present before executing the workflow. &quot;</span>
        <span class="s2">&quot;This option is used internally to handle filesystem latency in cluster &quot;</span>
        <span class="s2">&quot;environments.&quot;</span><span class="p">)</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--notemp&quot;</span><span class="p">,</span> <span class="s2">&quot;--nt&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Ignore temp() declarations. This is useful when running only &quot;</span>
        <span class="s2">&quot;a part of the workflow, since temp() would lead to deletion of &quot;</span>
        <span class="s2">&quot;probably needed files by other parts of the workflow.&quot;</span><span class="p">)</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--keep-remote&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Keep local copies of remote input files.&quot;</span><span class="p">)</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--keep-target-files&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span>
        <span class="s2">&quot;Do not adjust the paths of given target files relative to the working directory.&quot;</span><span class="p">)</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--allowed-rules&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span>
        <span class="s2">&quot;Only consider given rules. If omitted, all rules in Snakefile are &quot;</span>
        <span class="s2">&quot;used. Note that this is intended primarily for internal use and may &quot;</span>
        <span class="s2">&quot;lead to unexpected results otherwise.&quot;</span><span class="p">)</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--max-jobs-per-second&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span>
        <span class="s2">&quot;Maximal number of cluster/drmaa jobs per second, default is 10, &quot;</span>
        <span class="s2">&quot;fractions allowed.&quot;</span><span class="p">)</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--max-status-checks-per-second&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span>
        <span class="s2">&quot;Maximal number of job status checks per second, default is 10, &quot;</span>
        <span class="s2">&quot;fractions allowed.&quot;</span><span class="p">)</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--restart-times&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span>
        <span class="s2">&quot;Number of times to restart failing jobs (defaults to 0).&quot;</span><span class="p">)</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--attempt&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Internal use only: define the initial value of the attempt &quot;</span>
        <span class="s2">&quot;parameter (default: 1).&quot;</span><span class="p">)</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--wrapper-prefix&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;https://bitbucket.org/snakemake/snakemake-wrappers/raw/&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Prefix for URL created from wrapper directive (default: &quot;</span>
        <span class="s2">&quot;https://bitbucket.org/snakemake/snakemake-wrappers/raw/). Set this to &quot;</span>
        <span class="s2">&quot;a different URL to use your fork or a local clone of the repository, &quot;</span>
        <span class="s2">&quot;e.g., use a git URL like &#39;git+file://path/to/your/local/clone@&#39;.&quot;</span>
    <span class="p">)</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--default-remote-provider&quot;</span><span class="p">,</span>
                        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;S3&quot;</span><span class="p">,</span> <span class="s2">&quot;GS&quot;</span><span class="p">,</span> <span class="s2">&quot;FTP&quot;</span><span class="p">,</span> <span class="s2">&quot;SFTP&quot;</span><span class="p">,</span> <span class="s2">&quot;S3Mocked&quot;</span><span class="p">,</span> <span class="s2">&quot;gfal&quot;</span><span class="p">,</span> <span class="s2">&quot;gridftp&quot;</span><span class="p">,</span> <span class="s2">&quot;iRODS&quot;</span><span class="p">],</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Specify default remote provider to be used for &quot;</span>
                        <span class="s2">&quot;all input and output files that don&#39;t yet specify &quot;</span>
                        <span class="s2">&quot;one.&quot;</span><span class="p">)</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--default-remote-prefix&quot;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Specify prefix for default remote provider. E.g. &quot;</span>
                        <span class="s2">&quot;a bucket name.&quot;</span><span class="p">)</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--no-shared-fs&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Do not assume that jobs share a common file &quot;</span>
                        <span class="s2">&quot;system. When this flag is activated, Snakemake will &quot;</span>
                        <span class="s2">&quot;assume that the filesystem on a cluster node is not &quot;</span>
                        <span class="s2">&quot;shared with other nodes. For example, this will lead &quot;</span>
                        <span class="s2">&quot;to downloading remote files on each cluster node &quot;</span>
                        <span class="s2">&quot;separately. Further, it won&#39;t take special measures &quot;</span>
                        <span class="s2">&quot;to deal with filesystem latency issues. This option &quot;</span>
                        <span class="s2">&quot;will in most cases only make sense in combination with &quot;</span>
                        <span class="s2">&quot;--default-remote-provider. Further, when using --cluster &quot;</span>
                        <span class="s2">&quot;you will have to also provide --cluster-status. &quot;</span>
                        <span class="s2">&quot;Only activate this if you &quot;</span>
                        <span class="s2">&quot;know what you are doing.&quot;</span><span class="p">)</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--greediness&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Set the greediness of scheduling. This value between 0 and 1 &quot;</span>
        <span class="s2">&quot;determines how careful jobs are selected for execution. The default &quot;</span>
        <span class="s2">&quot;value (1.0) provides the best speed and still acceptable scheduling &quot;</span>
        <span class="s2">&quot;quality.&quot;</span><span class="p">)</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--no-hooks&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Do not invoke onstart, onsuccess or onerror hooks after execution.&quot;</span><span class="p">)</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--overwrite-shellcmd&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Provide a shell command that shall be executed instead of those &quot;</span>
        <span class="s2">&quot;given in the workflow. &quot;</span>
        <span class="s2">&quot;This is for debugging purposes only.&quot;</span><span class="p">)</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--debug&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Allow to debug rules with e.g. PDB. This flag &quot;</span>
                        <span class="s2">&quot;allows to set breakpoints in run blocks.&quot;</span><span class="p">)</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--runtime-profile&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;FILE&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span>
        <span class="s2">&quot;Profile Snakemake and write the output to FILE. This requires yappi &quot;</span>
        <span class="s2">&quot;to be installed.&quot;</span><span class="p">)</span>
    <span class="n">group_behavior</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--mode&quot;</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="n">Mode</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="n">Mode</span><span class="o">.</span><span class="n">subprocess</span><span class="p">,</span> <span class="n">Mode</span><span class="o">.</span><span class="n">cluster</span><span class="p">],</span>
        <span class="n">default</span><span class="o">=</span><span class="n">Mode</span><span class="o">.</span><span class="n">default</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Set execution mode of Snakemake (internal use only).&quot;</span>
    <span class="p">)</span>

    <span class="n">group_cluster</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s2">&quot;CLUSTER&quot;</span><span class="p">)</span>

    <span class="c1"># TODO extend below description to explain the wildcards that can be used</span>
    <span class="n">cluster_mode_group</span> <span class="o">=</span> <span class="n">group_cluster</span><span class="o">.</span><span class="n">add_mutually_exclusive_group</span><span class="p">()</span>
    <span class="n">cluster_mode_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--cluster&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;CMD&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span>
        <span class="p">(</span><span class="s2">&quot;Execute snakemake rules with the given submit command, &quot;</span>
         <span class="s2">&quot;e.g. qsub. Snakemake compiles jobs into scripts that are &quot;</span>
         <span class="s2">&quot;submitted to the cluster with the given command, once all input &quot;</span>
         <span class="s2">&quot;files for a particular job are present.</span><span class="se">\n</span><span class="s2">&quot;</span>
         <span class="s2">&quot;The submit command can be decorated to make it aware of certain &quot;</span>
         <span class="s2">&quot;job properties (name, rulename, input, output, params, wildcards, log, threads &quot;</span>
         <span class="s2">&quot;and dependencies (see the argument below)), e.g.:</span><span class="se">\n</span><span class="s2">&quot;</span>
         <span class="s2">&quot;$ snakemake --cluster &#39;qsub -pe threaded </span><span class="si">{threads}</span><span class="s2">&#39;.&quot;</span><span class="p">)),</span>
    <span class="n">cluster_mode_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--cluster-sync&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;CMD&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span>
        <span class="p">(</span><span class="s2">&quot;cluster submission command will block, returning the remote exit&quot;</span>
         <span class="s2">&quot;status upon remote termination (for example, this should be used&quot;</span>
         <span class="s2">&quot;if the cluster command is &#39;qsub -sync y&#39; (SGE)&quot;</span><span class="p">)),</span>
    <span class="n">cluster_mode_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--drmaa&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;?&quot;</span><span class="p">,</span>
        <span class="n">const</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;ARGS&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Execute snakemake on a cluster accessed via DRMAA, &quot;</span>
        <span class="s2">&quot;Snakemake compiles jobs into scripts that are &quot;</span>
        <span class="s2">&quot;submitted to the cluster with the given command, once all input &quot;</span>
        <span class="s2">&quot;files for a particular job are present. ARGS can be used to &quot;</span>
        <span class="s2">&quot;specify options of the underlying cluster system, &quot;</span>
        <span class="s2">&quot;thereby using the job properties name, rulename, input, output, params, wildcards, log, &quot;</span>
        <span class="s2">&quot;threads and dependencies, e.g.: &quot;</span>
        <span class="s2">&quot;--drmaa &#39; -pe threaded </span><span class="si">{threads}</span><span class="s2">&#39;. Note that ARGS must be given in quotes and &quot;</span>
        <span class="s2">&quot;with a leading whitespace.&quot;</span><span class="p">)</span>

    <span class="n">group_cluster</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--cluster-config&quot;</span><span class="p">,</span> <span class="s2">&quot;-u&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;FILE&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span>
        <span class="p">(</span><span class="s2">&quot;A JSON or YAML file that defines the wildcards used in &#39;cluster&#39;&quot;</span>
         <span class="s2">&quot;for specific rules, instead of having them specified in the Snakefile. &quot;</span>
         <span class="s2">&quot;For example, for rule &#39;job&#39; you may define: &quot;</span>
         <span class="s2">&quot;{ &#39;job&#39; : { &#39;time&#39; : &#39;24:00:00&#39; } } to specify the time for rule &#39;job&#39;. &quot;</span>
         <span class="s2">&quot;You can specify more than one file.  The configuration files are merged &quot;</span>
         <span class="s2">&quot;with later values overriding earlier ones.&quot;</span><span class="p">)),</span>
    <span class="n">group_cluster</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--immediate-submit&quot;</span><span class="p">,</span> <span class="s2">&quot;--is&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Immediately submit all jobs to the cluster instead of waiting &quot;</span>
        <span class="s2">&quot;for present input files. This will fail, unless you make &quot;</span>
        <span class="s2">&quot;the cluster aware of job dependencies, e.g. via:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;$ snakemake --cluster &#39;sbatch --dependency </span><span class="si">{dependencies}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Assuming that your submit script (here sbatch) outputs the &quot;</span>
        <span class="s2">&quot;generated job id to the first stdout line, </span><span class="si">{dependencies}</span><span class="s2"> will &quot;</span>
        <span class="s2">&quot;be filled with space separated job ids this job depends on.&quot;</span><span class="p">)</span>
    <span class="n">group_cluster</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--jobscript&quot;</span><span class="p">,</span> <span class="s2">&quot;--js&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;SCRIPT&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Provide a custom job script for submission to the cluster. &quot;</span>
        <span class="s2">&quot;The default script resides as &#39;jobscript.sh&#39; in the &quot;</span>
        <span class="s2">&quot;installation directory.&quot;</span><span class="p">)</span>
    <span class="n">group_cluster</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--jobname&quot;</span><span class="p">,</span> <span class="s2">&quot;--jn&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;snakejob.</span><span class="si">{name}</span><span class="s2">.</span><span class="si">{jobid}</span><span class="s2">.sh&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;NAME&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Provide a custom name for the jobscript that is submitted to the &quot;</span>
        <span class="s2">&quot;cluster (see --cluster). NAME is </span><span class="se">\&quot;</span><span class="s2">snakejob.</span><span class="si">{name}</span><span class="s2">.</span><span class="si">{jobid}</span><span class="s2">.sh</span><span class="se">\&quot;</span><span class="s2"> &quot;</span>
        <span class="s2">&quot;per default. The wildcard </span><span class="si">{jobid}</span><span class="s2"> has to be present in the name.&quot;</span><span class="p">)</span>
    <span class="n">group_cluster</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--cluster-status&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Status command for cluster execution. This is only considered &quot;</span>
        <span class="s2">&quot;in combination with the --cluster flag. If provided, Snakemake will &quot;</span>
        <span class="s2">&quot;use the status command to determine if a job has finished successfully &quot;</span>
        <span class="s2">&quot;or failed. For this it is necessary that the submit command provided &quot;</span>
        <span class="s2">&quot;to --cluster returns the cluster job id. Then, the status command &quot;</span>
        <span class="s2">&quot;will be invoked with the job id. Snakemake expects it to return &quot;</span>
        <span class="s2">&quot;&#39;success&#39; if the job was successfull, &#39;failed&#39; if the job failed and &quot;</span>
        <span class="s2">&quot;&#39;running&#39; if the job still runs.&quot;</span>
    <span class="p">)</span>
    <span class="n">group_cluster</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--drmaa-log-dir&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;DIR&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Specify a directory in which stdout and stderr files of DRMAA&quot;</span>
        <span class="s2">&quot; jobs will be written. The value may be given as a relative path,&quot;</span>
        <span class="s2">&quot; in which case Snakemake will use the current invocation directory&quot;</span>
        <span class="s2">&quot; as the origin. If given, this will override any given &#39;-o&#39; and/or&quot;</span>
        <span class="s2">&quot; &#39;-e&#39; native specification. If not given, all DRMAA stdout and&quot;</span>
        <span class="s2">&quot; stderr files are written to the current working directory.&quot;</span><span class="p">)</span>

    <span class="n">group_cloud</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s2">&quot;CLOUD&quot;</span><span class="p">)</span>

    <span class="n">group_cloud</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--kubernetes&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;NAMESPACE&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="n">const</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Execute workflow in a kubernetes cluster (in the cloud). &quot;</span>
        <span class="s2">&quot;NAMESPACE is the namespace you want to use for your job (if nothing &quot;</span>
        <span class="s2">&quot;specified: &#39;default&#39;). &quot;</span>
        <span class="s2">&quot;Usually, this requires --default-remote-provider and &quot;</span>
        <span class="s2">&quot;--default-remote-prefix to be set to a S3 or GS bucket where your . &quot;</span>
        <span class="s2">&quot;data shall be stored. It is further advisable to activate conda &quot;</span>
        <span class="s2">&quot;integration via --use-conda.&quot;</span><span class="p">)</span>
    <span class="n">group_cloud</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--kubernetes-env&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;ENVVAR&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Specify environment variables to pass to the kubernetes job.&quot;</span><span class="p">)</span>
    <span class="n">group_cloud</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--container-image&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;IMAGE&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span>
        <span class="s2">&quot;Docker image to use, e.g., when submitting jobs to kubernetes. &quot;</span>
        <span class="s2">&quot;By default, this is &#39;quay.io/snakemake/snakemake&#39;, tagged with &quot;</span>
        <span class="s2">&quot;the same version as the currently running Snakemake instance. &quot;</span>
        <span class="s2">&quot;Note that overwriting this value is up to your responsibility. &quot;</span>
        <span class="s2">&quot;Any used image has to contain a working snakemake installation &quot;</span>
        <span class="s2">&quot;that is compatible with (or ideally the same as) the currently &quot;</span>
        <span class="s2">&quot;running version.&quot;</span><span class="p">)</span>

    <span class="n">group_conda</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s2">&quot;CONDA&quot;</span><span class="p">)</span>

    <span class="n">group_conda</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--use-conda&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;If defined in the rule, run job in a conda environment. &quot;</span>
        <span class="s2">&quot;If this flag is not set, the conda directive is ignored.&quot;</span><span class="p">)</span>
    <span class="n">group_conda</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--list-conda-envs&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;List all conda environments and their location on &quot;</span>
                        <span class="s2">&quot;disk.&quot;</span><span class="p">)</span>
    <span class="n">group_conda</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--cleanup-conda&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Cleanup unused conda environments.&quot;</span><span class="p">)</span>
    <span class="n">group_conda</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--conda-prefix&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;DIR&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Specify a directory in which the &#39;conda&#39; and &#39;conda-archive&#39; &quot;</span>
        <span class="s2">&quot;directories are created. These are used to store conda environments &quot;</span>
        <span class="s2">&quot;and their archives, respectively. If not supplied, the value is set &quot;</span>
        <span class="s2">&quot;to the &#39;.snakemake&#39; directory relative to the invocation directory. &quot;</span>
        <span class="s2">&quot;If supplied, the `--use-conda` flag must also be set. The value may &quot;</span>
        <span class="s2">&quot;be given as a relative path, which will be extrapolated to the &quot;</span>
        <span class="s2">&quot;invocation directory, or as an absolute path.&quot;</span><span class="p">)</span>
    <span class="n">group_conda</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--create-envs-only&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;If specified, only creates the job-specific &quot;</span>
                        <span class="s2">&quot;conda environments then exits. The `--use-conda` &quot;</span>
                        <span class="s2">&quot;flag must also be set.&quot;</span><span class="p">)</span>

    <span class="n">group_singularity</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s2">&quot;SINGULARITY&quot;</span><span class="p">)</span>

    <span class="n">group_singularity</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--use-singularity&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;If defined in the rule, run job within a singularity container. &quot;</span>
        <span class="s2">&quot;If this flag is not set, the singularity directive is ignored.&quot;</span>
    <span class="p">)</span>
    <span class="n">group_singularity</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--singularity-prefix&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;DIR&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Specify a directory in which singularity images will be stored.&quot;</span>
        <span class="s2">&quot;If not supplied, the value is set &quot;</span>
        <span class="s2">&quot;to the &#39;.snakemake&#39; directory relative to the invocation directory. &quot;</span>
        <span class="s2">&quot;If supplied, the `--use-singularity` flag must also be set. The value &quot;</span>
        <span class="s2">&quot;may be given as a relative path, which will be extrapolated to the &quot;</span>
        <span class="s2">&quot;invocation directory, or as an absolute path.&quot;</span><span class="p">)</span>
    <span class="n">group_singularity</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--singularity-args&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;ARGS&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Pass additional args to singularity.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parser</span></div>


<div class="viewcode-block" id="main"><a class="viewcode-back" href="../api_reference/internal/snakemake.html#snakemake.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Main entry point.&quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">get_argument_parser</span><span class="p">()</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">profile</span><span class="p">:</span>
        <span class="c1"># reparse args while inferring config file from profile</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">get_argument_parser</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">profile</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">adjust_path</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">f</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">get_profile_file</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">return_default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># update file paths to be relative to the profile</span>
        <span class="c1"># (if they do not exist relative to CWD)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">jobscript</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">jobscript</span> <span class="o">=</span> <span class="n">adjust_path</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">jobscript</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">cluster</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">cluster</span> <span class="o">=</span> <span class="n">adjust_path</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">cluster</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">cluster_sync</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">cluster_sync</span> <span class="o">=</span> <span class="n">adjust_path</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">cluster_sync</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">cluster_status</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">cluster_status</span> <span class="o">=</span> <span class="n">adjust_path</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">cluster_status</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">bash_completion</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;complete -o bashdefault -C snakemake-bash-completion snakemake&quot;</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">resources</span> <span class="o">=</span> <span class="n">parse_resources</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">resources</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">parse_config</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">default_resources</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">default_resources</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">default_resources</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mem_mb=max(2*input.size, 1000)&quot;</span><span class="p">,</span> <span class="s2">&quot;disk_mb=max(2*input.size, 1000)&quot;</span><span class="p">]</span>
        <span class="n">default_resources</span> <span class="o">=</span> <span class="n">DefaultResources</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">default_resources</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">cluster</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">cluster_sync</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">drmaa</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">cores</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">dryrun</span><span class="p">:</span>
                <span class="n">args</span><span class="o">.</span><span class="n">cores</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;Error: you need to specify the maximum number of jobs to &quot;</span>
                    <span class="s2">&quot;be queued or executed at the same time with --jobs.&quot;</span><span class="p">,</span>
                    <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">cores</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">cores</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">drmaa_log_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">drmaa_log_dir</span><span class="p">):</span>
            <span class="n">args</span><span class="o">.</span><span class="n">drmaa_log_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">drmaa_log_dir</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">runtime_profile</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">yappi</span>
        <span class="n">yappi</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">immediate_submit</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">notemp</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Error: --immediate-submit has to be combined with --notemp, &quot;</span>
            <span class="s2">&quot;because temp file handling is not supported in this mode.&quot;</span><span class="p">,</span>
            <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">conda_prefix</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">create_envs_only</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">use_conda</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Error: --use-conda must be set if --conda-prefix or &quot;</span>
            <span class="s2">&quot;--create-envs-only is set.&quot;</span><span class="p">,</span>
            <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">singularity_prefix</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">use_singularity</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: --use_singularity must be set if --singularity-prefix &quot;</span>
              <span class="s2">&quot;is set.&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">kubernetes</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">default_remote_provider</span> <span class="ow">or</span>
                            <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">default_remote_prefix</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: --kubernetes must be combined with &quot;</span>
              <span class="s2">&quot;--default-remote-provider and --default-remote-prefix, see &quot;</span>
              <span class="s2">&quot;https://snakemake.readthedocs.io/en/stable/executable.html&quot;</span>
              <span class="s2">&quot;#executing-a-snakemake-workflow-via-kubernetes&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">delete_all_output</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">delete_temp_output</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: --delete-all-output and --delete-temp-output are mutually exclusive.&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">snakefile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">SNAKEFILE_CHOICES</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="n">args</span><span class="o">.</span><span class="n">snakefile</span> <span class="o">=</span> <span class="n">p</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">snakefile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: no Snakefile found, tried </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SNAKEFILE_CHOICES</span><span class="p">),</span>
                <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
            <span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">gui</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">snakemake.gui</span> <span class="k">as</span> <span class="nn">gui</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: GUI needs Flask to be installed. Install &quot;</span>
                  <span class="s2">&quot;with easy_install or contact your administrator.&quot;</span><span class="p">,</span>
                  <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">_logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;werkzeug&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">_logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>

        <span class="n">_snakemake</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">snakemake</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">snakefile</span><span class="p">))</span>
        <span class="n">gui</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">_snakemake</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
            <span class="n">host</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">port</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">gui</span>
            <span class="n">host</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span>

        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Listening on </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">open_browser</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Open this address in your browser to access the GUI.&quot;</span><span class="p">,</span>
              <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">open_browser</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">gui</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">),</span> <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">)</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyboardInterrupt</span><span class="p">,</span> <span class="ne">SystemExit</span><span class="p">):</span>
            <span class="c1"># silently close</span>
            <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">success</span> <span class="o">=</span> <span class="n">snakemake</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">snakefile</span><span class="p">,</span>
                            <span class="n">report</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">report</span><span class="p">,</span>
                            <span class="n">listrules</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">list</span><span class="p">,</span>
                            <span class="n">list_target_rules</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">list_target_rules</span><span class="p">,</span>
                            <span class="n">cores</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">cores</span><span class="p">,</span>
                            <span class="n">local_cores</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">local_cores</span><span class="p">,</span>
                            <span class="n">nodes</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">cores</span><span class="p">,</span>
                            <span class="n">resources</span><span class="o">=</span><span class="n">resources</span><span class="p">,</span>
                            <span class="n">default_resources</span><span class="o">=</span><span class="n">default_resources</span><span class="p">,</span>
                            <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
                            <span class="n">configfile</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">configfile</span><span class="p">,</span>
                            <span class="n">config_args</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
                            <span class="n">workdir</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
                            <span class="n">targets</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">target</span><span class="p">,</span>
                            <span class="n">dryrun</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">dryrun</span><span class="p">,</span>
                            <span class="n">printshellcmds</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">printshellcmds</span><span class="p">,</span>
                            <span class="n">printreason</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">reason</span><span class="p">,</span>
                            <span class="n">debug_dag</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">debug_dag</span><span class="p">,</span>
                            <span class="n">printdag</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">dag</span><span class="p">,</span>
                            <span class="n">printrulegraph</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">rulegraph</span><span class="p">,</span>
                            <span class="n">printd3dag</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">d3dag</span><span class="p">,</span>
                            <span class="n">touch</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">touch</span><span class="p">,</span>
                            <span class="n">forcetargets</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">force</span><span class="p">,</span>
                            <span class="n">forceall</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">forceall</span><span class="p">,</span>
                            <span class="n">forcerun</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">forcerun</span><span class="p">,</span>
                            <span class="n">prioritytargets</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">prioritize</span><span class="p">,</span>
                            <span class="n">until</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">until</span><span class="p">,</span>
                            <span class="n">omit_from</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">omit_from</span><span class="p">,</span>
                            <span class="n">stats</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span>
                            <span class="n">nocolor</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">nocolor</span><span class="p">,</span>
                            <span class="n">quiet</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">quiet</span><span class="p">,</span>
                            <span class="n">keepgoing</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">keep_going</span><span class="p">,</span>
                            <span class="n">cluster</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">cluster</span><span class="p">,</span>
                            <span class="n">cluster_config</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">cluster_config</span><span class="p">,</span>
                            <span class="n">cluster_sync</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">cluster_sync</span><span class="p">,</span>
                            <span class="n">drmaa</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">drmaa</span><span class="p">,</span>
                            <span class="n">drmaa_log_dir</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">drmaa_log_dir</span><span class="p">,</span>
                            <span class="n">kubernetes</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">kubernetes</span><span class="p">,</span>
                            <span class="n">kubernetes_envvars</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">kubernetes_env</span><span class="p">,</span>
                            <span class="n">container_image</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">container_image</span><span class="p">,</span>
                            <span class="n">jobname</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">jobname</span><span class="p">,</span>
                            <span class="n">immediate_submit</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">immediate_submit</span><span class="p">,</span>
                            <span class="n">standalone</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">ignore_ambiguity</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">allow_ambiguity</span><span class="p">,</span>
                            <span class="n">lock</span><span class="o">=</span><span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">nolock</span><span class="p">,</span>
                            <span class="n">unlock</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">unlock</span><span class="p">,</span>
                            <span class="n">cleanup_metadata</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">cleanup_metadata</span><span class="p">,</span>
                            <span class="n">cleanup_conda</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">cleanup_conda</span><span class="p">,</span>
                            <span class="n">cleanup_shadow</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">cleanup_shadow</span><span class="p">,</span>
                            <span class="n">force_incomplete</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">rerun_incomplete</span><span class="p">,</span>
                            <span class="n">ignore_incomplete</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">ignore_incomplete</span><span class="p">,</span>
                            <span class="n">list_version_changes</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">list_version_changes</span><span class="p">,</span>
                            <span class="n">list_code_changes</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">list_code_changes</span><span class="p">,</span>
                            <span class="n">list_input_changes</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">list_input_changes</span><span class="p">,</span>
                            <span class="n">list_params_changes</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">list_params_changes</span><span class="p">,</span>
                            <span class="n">list_untracked</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">list_untracked</span><span class="p">,</span>
                            <span class="n">summary</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span>
                            <span class="n">detailed_summary</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">detailed_summary</span><span class="p">,</span>
                            <span class="n">archive</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">archive</span><span class="p">,</span>
                            <span class="n">delete_all_output</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">delete_all_output</span><span class="p">,</span>
                            <span class="n">delete_temp_output</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">delete_temp_output</span><span class="p">,</span>
                            <span class="n">print_compilation</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">print_compilation</span><span class="p">,</span>
                            <span class="n">verbose</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
                            <span class="n">debug</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
                            <span class="n">jobscript</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">jobscript</span><span class="p">,</span>
                            <span class="n">notemp</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">notemp</span><span class="p">,</span>
                            <span class="n">keep_remote_local</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">keep_remote</span><span class="p">,</span>
                            <span class="n">greediness</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">greediness</span><span class="p">,</span>
                            <span class="n">no_hooks</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">no_hooks</span><span class="p">,</span>
                            <span class="n">overwrite_shellcmd</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">overwrite_shellcmd</span><span class="p">,</span>
                            <span class="n">latency_wait</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">latency_wait</span><span class="p">,</span>
                            <span class="n">wait_for_files</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">wait_for_files</span><span class="p">,</span>
                            <span class="n">keep_target_files</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">keep_target_files</span><span class="p">,</span>
                            <span class="n">allowed_rules</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">allowed_rules</span><span class="p">,</span>
                            <span class="n">max_jobs_per_second</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">max_jobs_per_second</span><span class="p">,</span>
                            <span class="n">max_status_checks_per_second</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">max_status_checks_per_second</span><span class="p">,</span>
                            <span class="n">restart_times</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">restart_times</span><span class="p">,</span>
                            <span class="n">attempt</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">attempt</span><span class="p">,</span>
                            <span class="n">force_use_threads</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">force_use_threads</span><span class="p">,</span>
                            <span class="n">use_conda</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">use_conda</span><span class="p">,</span>
                            <span class="n">conda_prefix</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">conda_prefix</span><span class="p">,</span>
                            <span class="n">list_conda_envs</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">list_conda_envs</span><span class="p">,</span>
                            <span class="n">use_singularity</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">use_singularity</span><span class="p">,</span>
                            <span class="n">singularity_prefix</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">singularity_prefix</span><span class="p">,</span>
                            <span class="n">shadow_prefix</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">shadow_prefix</span><span class="p">,</span>
                            <span class="n">singularity_args</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">singularity_args</span><span class="p">,</span>
                            <span class="n">create_envs_only</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">create_envs_only</span><span class="p">,</span>
                            <span class="n">mode</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
                            <span class="n">wrapper_prefix</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">wrapper_prefix</span><span class="p">,</span>
                            <span class="n">default_remote_provider</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">default_remote_provider</span><span class="p">,</span>
                            <span class="n">default_remote_prefix</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">default_remote_prefix</span><span class="p">,</span>
                            <span class="n">assume_shared_fs</span><span class="o">=</span><span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">no_shared_fs</span><span class="p">,</span>
                            <span class="n">cluster_status</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">cluster_status</span><span class="p">,</span>
                            <span class="n">export_cwl</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">export_cwl</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">runtime_profile</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">runtime_profile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">profile</span> <span class="o">=</span> <span class="n">yappi</span><span class="o">.</span><span class="n">get_func_stats</span><span class="p">()</span>
            <span class="n">profile</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;totaltime&quot;</span><span class="p">)</span>
            <span class="n">profile</span><span class="o">.</span><span class="n">print_all</span><span class="p">(</span><span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">success</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="bash_completion"><a class="viewcode-back" href="../api_reference/internal/snakemake.html#snakemake.bash_completion">[docs]</a><span class="k">def</span> <span class="nf">bash_completion</span><span class="p">(</span><span class="n">snakefile</span><span class="o">=</span><span class="s2">&quot;Snakefile&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Entry point for bash completion.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Calculate bash completion for snakemake. This tool shall not be invoked by hand.&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">print_candidates</span><span class="p">(</span><span class="n">candidates</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">candidates</span><span class="p">:</span>
            <span class="n">candidates</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">candidates</span><span class="p">))</span>
            <span class="c1">## Use bytes for avoiding &#39;^M&#39; under Windows.</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">))</span>

    <span class="n">prefix</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">prefix</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">):</span>
        <span class="n">print_candidates</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                         <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">get_argument_parser</span><span class="p">()</span><span class="o">.</span><span class="n">_actions</span>
                         <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span> <span class="ow">and</span>
                         <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">*&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">print_candidates</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">snakefile</span><span class="p">):</span>
            <span class="n">workflow</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">snakefile</span><span class="o">=</span><span class="n">snakefile</span><span class="p">)</span>
            <span class="n">workflow</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="n">snakefile</span><span class="p">)</span>

            <span class="n">print_candidates</span><span class="p">([</span><span class="n">file</span>
                              <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">workflow</span><span class="o">.</span><span class="n">concrete_files</span>
                              <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">)]</span> <span class="o">+</span>
                             <span class="p">[</span><span class="n">rule</span><span class="o">.</span><span class="n">name</span>
                              <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">workflow</span><span class="o">.</span><span class="n">rules</span>
                              <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">)])</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014-2016, Johannes Koester

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>