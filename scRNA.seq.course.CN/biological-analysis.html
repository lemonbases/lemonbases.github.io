<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 生物学分析 | scRNA-seq数据分析</title>
  <meta name="description" content="8 生物学分析 | scRNA-seq数据分析" />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="8 生物学分析 | scRNA-seq数据分析" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 生物学分析 | scRNA-seq数据分析" />
  
  
  

<meta name="author" content="碱基吃柠檬" />


<meta name="date" content="2019-07-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="cleaning-the-expression-matrix.html">
<link rel="next" href="references.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.46.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.46.1/plotly-latest.min.js"></script>
<!-- for Facebook -->  
<meta property="og:url" content="https://github.com/sdbiodog" />
<meta property="og:description" content="本项目是将github上经典的scRNA-seq分析教程进行汉化，源项目参见hemberg-lab/scRNA.seq.course" />
<meta property="og:image" content="http://hemberg-lab.github.io/scRNA.seq.course/figures/RNA-Seq_workflow-5.pdf.jpg" />

<!-- for Twitter -->          
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="8 生物学分析 | scRNA-seq数据分析" />
<meta name="twitter:description" content="本项目是将github上经典的scRNA-seq分析教程进行汉化，源项目参见hemberg-lab/scRNA.seq.course" />
<meta name="twitter:image" content="http://hemberg-lab.github.io/scRNA.seq.course/figures/RNA-Seq_workflow-5.pdf.jpg" />

<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-71525309-1', 'auto');
  ga('send', 'pageview');

</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="index.html">Table of Contents</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> 说在前面的话</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#section-1"><i class="fa fa-check"></i><b>1.1</b> 关于本项目</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#section-2"><i class="fa fa-check"></i><b>1.2</b> 视频</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#github"><i class="fa fa-check"></i><b>1.3</b> GitHub</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#docker-"><i class="fa fa-check"></i><b>1.4</b> Docker 镜像</a><ul>
<li class="chapter" data-level="1.4.1" data-path="index.html"><a href="index.html#section-3"><i class="fa fa-check"></i><b>1.4.1</b> 运行镜像</a></li>
<li class="chapter" data-level="1.4.2" data-path="index.html"><a href="index.html#section-4"><i class="fa fa-check"></i><b>1.4.2</b> 下载数据或其它文件</a></li>
<li class="chapter" data-level="1.4.3" data-path="index.html"><a href="index.html#rstudio"><i class="fa fa-check"></i><b>1.4.3</b> RStudio</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#section-5"><i class="fa fa-check"></i><b>1.5</b> 手动安装</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#section-6"><i class="fa fa-check"></i><b>1.6</b> 许可</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#section-7"><i class="fa fa-check"></i><b>1.7</b> 准备知识</a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#section-8"><i class="fa fa-check"></i><b>1.8</b> 联系我们</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-single-cell-rna-seq.html"><a href="introduction-to-single-cell-rna-seq.html"><i class="fa fa-check"></i><b>2</b> scRNA-seq介绍</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-single-cell-rna-seq.html"><a href="introduction-to-single-cell-rna-seq.html#bulk-rna-seq"><i class="fa fa-check"></i><b>2.1</b> Bulk RNA-seq</a></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-single-cell-rna-seq.html"><a href="introduction-to-single-cell-rna-seq.html#scrna-seq"><i class="fa fa-check"></i><b>2.2</b> scRNA-seq</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-single-cell-rna-seq.html"><a href="introduction-to-single-cell-rna-seq.html#section-9"><i class="fa fa-check"></i><b>2.3</b> 工作流程</a></li>
<li class="chapter" data-level="2.4" data-path="introduction-to-single-cell-rna-seq.html"><a href="introduction-to-single-cell-rna-seq.html#section-10"><i class="fa fa-check"></i><b>2.4</b> 计算分析</a></li>
<li class="chapter" data-level="2.5" data-path="introduction-to-single-cell-rna-seq.html"><a href="introduction-to-single-cell-rna-seq.html#section-11"><i class="fa fa-check"></i><b>2.5</b> 挑战</a></li>
<li class="chapter" data-level="2.6" data-path="introduction-to-single-cell-rna-seq.html"><a href="introduction-to-single-cell-rna-seq.html#section-12"><i class="fa fa-check"></i><b>2.6</b> 实验方法</a></li>
<li class="chapter" data-level="2.7" data-path="introduction-to-single-cell-rna-seq.html"><a href="introduction-to-single-cell-rna-seq.html#section-13"><i class="fa fa-check"></i><b>2.7</b> 如何选择合适的平台</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html"><i class="fa fa-check"></i><b>3</b> scRNA-seq原始数据处理</a><ul>
<li class="chapter" data-level="3.1" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#fastqc"><i class="fa fa-check"></i><b>3.1</b> FastQC</a><ul>
<li class="chapter" data-level="3.1.1" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#section-14"><i class="fa fa-check"></i><b>3.1.1</b> 解决方案并下载报告</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#section-15"><i class="fa fa-check"></i><b>3.2</b> 移除接头和低质量碱基</a><ul>
<li class="chapter" data-level="3.2.1" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#solution"><i class="fa fa-check"></i><b>3.2.1</b> Solution</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#section-16"><i class="fa fa-check"></i><b>3.3</b> 文件格式</a><ul>
<li class="chapter" data-level="3.3.1" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#fastq"><i class="fa fa-check"></i><b>3.3.1</b> FastQ</a></li>
<li class="chapter" data-level="3.3.2" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#bam"><i class="fa fa-check"></i><b>3.3.2</b> BAM</a></li>
<li class="chapter" data-level="3.3.3" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#cram"><i class="fa fa-check"></i><b>3.3.3</b> CRAM</a></li>
<li class="chapter" data-level="3.3.4" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#section-17"><i class="fa fa-check"></i><b>3.3.4</b> 手动查看文件</a></li>
<li class="chapter" data-level="3.3.5" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#genome-fasta-gtf"><i class="fa fa-check"></i><b>3.3.5</b> Genome (FASTA, GTF)</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#section-18"><i class="fa fa-check"></i><b>3.4</b> 测序文库拆分</a><ul>
<li class="chapter" data-level="3.4.1" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#section-19"><i class="fa fa-check"></i><b>3.4.1</b> 鉴定含有细胞的液滴/微孔</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#starread"><i class="fa fa-check"></i><b>3.5</b> 使用STAR比对read</a><ul>
<li class="chapter" data-level="3.5.1" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#star"><i class="fa fa-check"></i><b>3.5.1</b> STAR比对命令</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#kallistopseudo-alignment"><i class="fa fa-check"></i><b>3.6</b> Kallisto和Pseudo-Alignment</a><ul>
<li class="chapter" data-level="3.6.1" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#k-mer"><i class="fa fa-check"></i><b>3.6.1</b> k-mer是什么?</a></li>
<li class="chapter" data-level="3.6.2" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#k-merreads"><i class="fa fa-check"></i><b>3.6.2</b> 为什么比对k-mer而不是reads?</a></li>
<li class="chapter" data-level="3.6.3" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#kallisto"><i class="fa fa-check"></i><b>3.6.3</b> Kallisto伪比对模式</a></li>
<li class="chapter" data-level="3.6.4" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#kallisto-pseudo-alignment"><i class="fa fa-check"></i><b>3.6.4</b> Kallisto Pseudo-Alignment命令</a></li>
<li class="chapter" data-level="3.6.5" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#kallisto-1"><i class="fa fa-check"></i><b>3.6.5</b> 理解Kallisto输出结果</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html"><i class="fa fa-check"></i><b>4</b> 构建表达矩阵</a><ul>
<li class="chapter" data-level="4.1" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html#section-20"><i class="fa fa-check"></i><b>4.1</b> 质量控制</a></li>
<li class="chapter" data-level="4.2" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html#reads-"><i class="fa fa-check"></i><b>4.2</b> Reads 比对</a></li>
<li class="chapter" data-level="4.3" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html#section-21"><i class="fa fa-check"></i><b>4.3</b> 比对示例</a></li>
<li class="chapter" data-level="4.4" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html#mapping-qc"><i class="fa fa-check"></i><b>4.4</b> Mapping QC</a></li>
<li class="chapter" data-level="4.5" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html#reads"><i class="fa fa-check"></i><b>4.5</b> Reads定量</a></li>
<li class="chapter" data-level="4.6" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html#umichapter"><i class="fa fa-check"></i><b>4.6</b> 唯一分子标识符</a><ul>
<li class="chapter" data-level="4.6.1" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html#umi"><i class="fa fa-check"></i><b>4.6.1</b> UMI介绍</a></li>
<li class="chapter" data-level="4.6.2" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html#section-22"><i class="fa fa-check"></i><b>4.6.2</b> 比对条形码序列</a></li>
<li class="chapter" data-level="4.6.3" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html#barcodes"><i class="fa fa-check"></i><b>4.6.3</b> Barcodes计数</a></li>
<li class="chapter" data-level="4.6.4" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html#section-23"><i class="fa fa-check"></i><b>4.6.4</b> 错误校正</a></li>
<li class="chapter" data-level="4.6.5" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html#section-24"><i class="fa fa-check"></i><b>4.6.5</b> 下游分析</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html"><i class="fa fa-check"></i><b>5</b> R/Bioconductor介绍</a><ul>
<li class="chapter" data-level="5.1" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#r"><i class="fa fa-check"></i><b>5.1</b> 安装R包</a><ul>
<li class="chapter" data-level="5.1.1" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#cran"><i class="fa fa-check"></i><b>5.1.1</b> CRAN</a></li>
<li class="chapter" data-level="5.1.2" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#github-1"><i class="fa fa-check"></i><b>5.1.2</b> Github</a></li>
<li class="chapter" data-level="5.1.3" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#bioconductor"><i class="fa fa-check"></i><b>5.1.3</b> Bioconductor</a></li>
<li class="chapter" data-level="5.1.4" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#section-25"><i class="fa fa-check"></i><b>5.1.4</b> 源码安装</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#section-26"><i class="fa fa-check"></i><b>5.2</b> 安装说明:</a></li>
<li class="chapter" data-level="5.3" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#section-27"><i class="fa fa-check"></i><b>5.3</b> 数据类型/类</a><ul>
<li class="chapter" data-level="5.3.1" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#section-28"><i class="fa fa-check"></i><b>5.3.1</b> 数值</a></li>
<li class="chapter" data-level="5.3.2" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#section-29"><i class="fa fa-check"></i><b>5.3.2</b> 字符/字符串</a></li>
<li class="chapter" data-level="5.3.3" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#section-30"><i class="fa fa-check"></i><b>5.3.3</b> 逻辑值</a></li>
<li class="chapter" data-level="5.3.4" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#section-31"><i class="fa fa-check"></i><b>5.3.4</b> 因子</a></li>
<li class="chapter" data-level="5.3.5" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#section-32"><i class="fa fa-check"></i><b>5.3.5</b> 检查数据类型</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#section-33"><i class="fa fa-check"></i><b>5.4</b> 基本数据结构</a></li>
<li class="chapter" data-level="5.5" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#section-34"><i class="fa fa-check"></i><b>5.5</b> 更多信息</a></li>
<li class="chapter" data-level="5.6" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#section-35"><i class="fa fa-check"></i><b>5.6</b> 数据类型</a><ul>
<li class="chapter" data-level="5.6.1" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#section-36"><i class="fa fa-check"></i><b>5.6.1</b> 什么是整洁的数据</a></li>
<li class="chapter" data-level="5.6.2" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#rich-data"><i class="fa fa-check"></i><b>5.6.2</b> 什么是Rich data?</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#bioconductor-singlecellexperiment--scater"><i class="fa fa-check"></i><b>5.7</b> Bioconductor, <code>SingleCellExperiment</code> 和 <code>scater</code></a><ul>
<li class="chapter" data-level="5.7.1" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#bioconductor-1"><i class="fa fa-check"></i><b>5.7.1</b> Bioconductor</a></li>
<li class="chapter" data-level="5.7.2" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#singlecellexperiment-"><i class="fa fa-check"></i><b>5.7.2</b> <code>SingleCellExperiment</code> 类</a></li>
<li class="chapter" data-level="5.7.3" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#scater-"><i class="fa fa-check"></i><b>5.7.3</b> <code>scater</code> 包</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#ggplot2"><i class="fa fa-check"></i><b>5.8</b> ggplot2介绍</a><ul>
<li class="chapter" data-level="5.8.1" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#ggplot2-1"><i class="fa fa-check"></i><b>5.8.1</b> ggplot2是什么?</a></li>
<li class="chapter" data-level="5.8.2" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#ggplot2j"><i class="fa fa-check"></i><b>5.8.2</b> ggplot2j原则</a></li>
<li class="chapter" data-level="5.8.3" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#aes"><i class="fa fa-check"></i><b>5.8.3</b> 使用<code>aes</code>映射函数</a></li>
<li class="chapter" data-level="5.8.4" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#geoms"><i class="fa fa-check"></i><b>5.8.4</b> Geoms</a></li>
<li class="chapter" data-level="5.8.5" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#section-37"><i class="fa fa-check"></i><b>5.8.5</b> 绘制2个以上细胞的数据</a></li>
<li class="chapter" data-level="5.8.6" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#section-38"><i class="fa fa-check"></i><b>5.8.6</b> 绘制热图</a></li>
<li class="chapter" data-level="5.8.7" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#section-39"><i class="fa fa-check"></i><b>5.8.7</b> 主成分分析</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="tabula-muris.html"><a href="tabula-muris.html"><i class="fa fa-check"></i><b>6</b> Tabula Muris</a><ul>
<li class="chapter" data-level="6.1" data-path="tabula-muris.html"><a href="tabula-muris.html#section-40"><i class="fa fa-check"></i><b>6.1</b> 介绍</a></li>
<li class="chapter" data-level="6.2" data-path="tabula-muris.html"><a href="tabula-muris.html#section-41"><i class="fa fa-check"></i><b>6.2</b> 下载数据</a></li>
<li class="chapter" data-level="6.3" data-path="tabula-muris.html"><a href="tabula-muris.html#smartseq2"><i class="fa fa-check"></i><b>6.3</b> 读取Smartseq2数据</a></li>
<li class="chapter" data-level="6.4" data-path="tabula-muris.html"><a href="tabula-muris.html#scater"><i class="fa fa-check"></i><b>6.4</b> 构建scater对象</a></li>
<li class="chapter" data-level="6.5" data-path="tabula-muris.html"><a href="tabula-muris.html#x"><i class="fa fa-check"></i><b>6.5</b> 读取10X数据</a></li>
<li class="chapter" data-level="6.6" data-path="tabula-muris.html"><a href="tabula-muris.html#scater-1"><i class="fa fa-check"></i><b>6.6</b> 创建scater对象</a></li>
<li class="chapter" data-level="6.7" data-path="tabula-muris.html"><a href="tabula-muris.html#section-42"><i class="fa fa-check"></i><b>6.7</b> 进阶练习</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html"><i class="fa fa-check"></i><b>7</b> 表达矩阵质控</a><ul>
<li class="chapter" data-level="7.1" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#exprs-qc"><i class="fa fa-check"></i><b>7.1</b> UMI表达质控</a><ul>
<li class="chapter" data-level="7.1.1" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-43"><i class="fa fa-check"></i><b>7.1.1</b> 介绍</a></li>
<li class="chapter" data-level="7.1.2" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#tung"><i class="fa fa-check"></i><b>7.1.2</b> Tung数据集</a></li>
<li class="chapter" data-level="7.1.3" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-44"><i class="fa fa-check"></i><b>7.1.3</b> 细胞质控</a></li>
<li class="chapter" data-level="7.1.4" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-47"><i class="fa fa-check"></i><b>7.1.4</b> 细胞过滤</a></li>
<li class="chapter" data-level="7.1.5" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-50"><i class="fa fa-check"></i><b>7.1.5</b> 手工过滤和自动过滤比较</a></li>
<li class="chapter" data-level="7.1.6" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-51"><i class="fa fa-check"></i><b>7.1.6</b> 基因分析</a></li>
<li class="chapter" data-level="7.1.7" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-54"><i class="fa fa-check"></i><b>7.1.7</b> 保存数据</a></li>
<li class="chapter" data-level="7.1.8" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-55"><i class="fa fa-check"></i><b>7.1.8</b> 大作业</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#reads-1"><i class="fa fa-check"></i><b>7.2</b> Reads表达质控</a></li>
<li class="chapter" data-level="7.3" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-56"><i class="fa fa-check"></i><b>7.3</b> 数据可视化</a><ul>
<li class="chapter" data-level="7.3.1" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-57"><i class="fa fa-check"></i><b>7.3.1</b> 介绍</a></li>
<li class="chapter" data-level="7.3.2" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#visual-pca"><i class="fa fa-check"></i><b>7.3.2</b> PCA plot</a></li>
<li class="chapter" data-level="7.3.3" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#visual-tsne"><i class="fa fa-check"></i><b>7.3.3</b> tSNE可视化</a></li>
<li class="chapter" data-level="7.3.4" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-61"><i class="fa fa-check"></i><b>7.3.4</b> 大作业</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#reads-2"><i class="fa fa-check"></i><b>7.4</b> Reads数据可视化</a></li>
<li class="chapter" data-level="7.5" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-62"><i class="fa fa-check"></i><b>7.5</b> 识别混淆因子</a><ul>
<li class="chapter" data-level="7.5.1" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-63"><i class="fa fa-check"></i><b>7.5.1</b> 介绍</a></li>
<li class="chapter" data-level="7.5.2" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-64"><i class="fa fa-check"></i><b>7.5.2</b> 和组成分的相关性</a></li>
<li class="chapter" data-level="7.5.3" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-66"><i class="fa fa-check"></i><b>7.5.3</b> 解释变量</a></li>
<li class="chapter" data-level="7.5.4" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-67"><i class="fa fa-check"></i><b>7.5.4</b> 其它混淆因子</a></li>
<li class="chapter" data-level="7.5.5" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-68"><i class="fa fa-check"></i><b>7.5.5</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#reads-3"><i class="fa fa-check"></i><b>7.6</b> 识别READS中混淆因子</a></li>
<li class="chapter" data-level="7.7" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-69"><i class="fa fa-check"></i><b>7.7</b> 标准化理论</a><ul>
<li class="chapter" data-level="7.7.1" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-70"><i class="fa fa-check"></i><b>7.7.1</b> 介绍</a></li>
<li class="chapter" data-level="7.7.2" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-71"><i class="fa fa-check"></i><b>7.7.2</b> 文库大小</a></li>
<li class="chapter" data-level="7.7.3" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-72"><i class="fa fa-check"></i><b>7.7.3</b> 标准化</a></li>
<li class="chapter" data-level="7.7.4" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#effectiveness"><i class="fa fa-check"></i><b>7.7.4</b> Effectiveness</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#umi-1"><i class="fa fa-check"></i><b>7.8</b> UMI标准化练习</a><ul>
<li class="chapter" data-level="7.8.1" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#raw"><i class="fa fa-check"></i><b>7.8.1</b> Raw</a></li>
<li class="chapter" data-level="7.8.2" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#cpm-1"><i class="fa fa-check"></i><b>7.8.2</b> CPM</a></li>
<li class="chapter" data-level="7.8.3" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#scran-1"><i class="fa fa-check"></i><b>7.8.3</b> scran</a></li>
<li class="chapter" data-level="7.8.4" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-73"><i class="fa fa-check"></i><b>7.8.4</b> 下采样</a></li>
<li class="chapter" data-level="7.8.5" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-74"><i class="fa fa-check"></i><b>7.8.5</b> 基因/转录本长度标准化</a></li>
<li class="chapter" data-level="7.8.6" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-75"><i class="fa fa-check"></i><b>7.8.6</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#reads-4"><i class="fa fa-check"></i><b>7.9</b> Reads标准化练习</a></li>
<li class="chapter" data-level="7.10" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#dealing-with-confounders"><i class="fa fa-check"></i><b>7.10</b> 处理混淆因子</a><ul>
<li class="chapter" data-level="7.10.1" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-76"><i class="fa fa-check"></i><b>7.10.1</b> 介绍</a></li>
<li class="chapter" data-level="7.10.2" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-77"><i class="fa fa-check"></i><b>7.10.2</b> 移除不需要的变异</a></li>
<li class="chapter" data-level="7.10.3" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#combat"><i class="fa fa-check"></i><b>7.10.3</b> Combat</a></li>
<li class="chapter" data-level="7.10.4" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#mnncorrect"><i class="fa fa-check"></i><b>7.10.4</b> mnnCorrect</a></li>
<li class="chapter" data-level="7.10.5" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#glm"><i class="fa fa-check"></i><b>7.10.5</b> GLM</a></li>
<li class="chapter" data-level="7.10.6" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#harmony"><i class="fa fa-check"></i><b>7.10.6</b> Harmony</a></li>
<li class="chapter" data-level="7.10.7" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-78"><i class="fa fa-check"></i><b>7.10.7</b> 评价和比较混淆因子去除策略</a></li>
<li class="chapter" data-level="7.10.8" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#section-82"><i class="fa fa-check"></i><b>7.10.8</b> 大作业</a></li>
</ul></li>
<li class="chapter" data-level="7.11" data-path="cleaning-the-expression-matrix.html"><a href="cleaning-the-expression-matrix.html#reads-5"><i class="fa fa-check"></i><b>7.11</b> 处理Reads中混淆因子</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="biological-analysis.html"><a href="biological-analysis.html"><i class="fa fa-check"></i><b>8</b> 生物学分析</a><ul>
<li class="chapter" data-level="8.1" data-path="biological-analysis.html"><a href="biological-analysis.html#section-83"><i class="fa fa-check"></i><b>8.1</b> 聚类介绍</a><ul>
<li class="chapter" data-level="8.1.1" data-path="biological-analysis.html"><a href="biological-analysis.html#section-84"><i class="fa fa-check"></i><b>8.1.1</b> 介绍</a></li>
<li class="chapter" data-level="8.1.2" data-path="biological-analysis.html"><a href="biological-analysis.html#section-85"><i class="fa fa-check"></i><b>8.1.2</b> 降维</a></li>
<li class="chapter" data-level="8.1.3" data-path="biological-analysis.html"><a href="biological-analysis.html#section-86"><i class="fa fa-check"></i><b>8.1.3</b> 聚类方法</a></li>
<li class="chapter" data-level="8.1.4" data-path="biological-analysis.html"><a href="biological-analysis.html#section-89"><i class="fa fa-check"></i><b>8.1.4</b> 聚类的挑战</a></li>
<li class="chapter" data-level="8.1.5" data-path="biological-analysis.html"><a href="biological-analysis.html#tools-for-scrna-seq-data"><i class="fa fa-check"></i><b>8.1.5</b> Tools for scRNA-seq data</a></li>
<li class="chapter" data-level="8.1.6" data-path="biological-analysis.html"><a href="biological-analysis.html#comparing-clustering"><i class="fa fa-check"></i><b>8.1.6</b> Comparing clustering</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="biological-analysis.html"><a href="biological-analysis.html#clust-methods"><i class="fa fa-check"></i><b>8.2</b> Clustering example</a><ul>
<li class="chapter" data-level="8.2.1" data-path="biological-analysis.html"><a href="biological-analysis.html#deng-dataset"><i class="fa fa-check"></i><b>8.2.1</b> Deng dataset</a></li>
<li class="chapter" data-level="8.2.2" data-path="biological-analysis.html"><a href="biological-analysis.html#sc3-1"><i class="fa fa-check"></i><b>8.2.2</b> SC3</a></li>
<li class="chapter" data-level="8.2.3" data-path="biological-analysis.html"><a href="biological-analysis.html#tsne-kmeans"><i class="fa fa-check"></i><b>8.2.3</b> tSNE + kmeans</a></li>
<li class="chapter" data-level="8.2.4" data-path="biological-analysis.html"><a href="biological-analysis.html#sincera-1"><i class="fa fa-check"></i><b>8.2.4</b> SINCERA</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="biological-analysis.html"><a href="biological-analysis.html#feature-selection"><i class="fa fa-check"></i><b>8.3</b> Feature Selection</a><ul>
<li class="chapter" data-level="8.3.1" data-path="biological-analysis.html"><a href="biological-analysis.html#identifying-genes-vs-a-null-model"><i class="fa fa-check"></i><b>8.3.1</b> Identifying Genes vs a Null Model</a></li>
<li class="chapter" data-level="8.3.2" data-path="biological-analysis.html"><a href="biological-analysis.html#correlated-expression"><i class="fa fa-check"></i><b>8.3.2</b> Correlated Expression</a></li>
<li class="chapter" data-level="8.3.3" data-path="biological-analysis.html"><a href="biological-analysis.html#comparing-methods"><i class="fa fa-check"></i><b>8.3.3</b> Comparing Methods</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="biological-analysis.html"><a href="biological-analysis.html#pseudotime-analysis"><i class="fa fa-check"></i><b>8.4</b> Pseudotime analysis</a><ul>
<li class="chapter" data-level="8.4.1" data-path="biological-analysis.html"><a href="biological-analysis.html#first-look-at-deng-data"><i class="fa fa-check"></i><b>8.4.1</b> First look at Deng data</a></li>
<li class="chapter" data-level="8.4.2" data-path="biological-analysis.html"><a href="biological-analysis.html#tscan"><i class="fa fa-check"></i><b>8.4.2</b> TSCAN</a></li>
<li class="chapter" data-level="8.4.3" data-path="biological-analysis.html"><a href="biological-analysis.html#monocle"><i class="fa fa-check"></i><b>8.4.3</b> monocle</a></li>
<li class="chapter" data-level="8.4.4" data-path="biological-analysis.html"><a href="biological-analysis.html#diffusion-maps"><i class="fa fa-check"></i><b>8.4.4</b> Diffusion maps</a></li>
<li class="chapter" data-level="8.4.5" data-path="biological-analysis.html"><a href="biological-analysis.html#slicer"><i class="fa fa-check"></i><b>8.4.5</b> SLICER</a></li>
<li class="chapter" data-level="8.4.6" data-path="biological-analysis.html"><a href="biological-analysis.html#ouija"><i class="fa fa-check"></i><b>8.4.6</b> Ouija</a></li>
<li class="chapter" data-level="8.4.7" data-path="biological-analysis.html"><a href="biological-analysis.html#comparison-of-the-methods"><i class="fa fa-check"></i><b>8.4.7</b> Comparison of the methods</a></li>
<li class="chapter" data-level="8.4.8" data-path="biological-analysis.html"><a href="biological-analysis.html#expression-of-genes-through-time"><i class="fa fa-check"></i><b>8.4.8</b> Expression of genes through time</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="biological-analysis.html"><a href="biological-analysis.html#imputation"><i class="fa fa-check"></i><b>8.5</b> Imputation</a><ul>
<li class="chapter" data-level="8.5.1" data-path="biological-analysis.html"><a href="biological-analysis.html#scimpute"><i class="fa fa-check"></i><b>8.5.1</b> scImpute</a></li>
<li class="chapter" data-level="8.5.2" data-path="biological-analysis.html"><a href="biological-analysis.html#drimpute"><i class="fa fa-check"></i><b>8.5.2</b> DrImpute</a></li>
<li class="chapter" data-level="8.5.3" data-path="biological-analysis.html"><a href="biological-analysis.html#magic"><i class="fa fa-check"></i><b>8.5.3</b> MAGIC</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="biological-analysis.html"><a href="biological-analysis.html#dechapter"><i class="fa fa-check"></i><b>8.6</b> Differential Expression (DE) analysis</a><ul>
<li class="chapter" data-level="8.6.1" data-path="biological-analysis.html"><a href="biological-analysis.html#bulk-rna-seq-1"><i class="fa fa-check"></i><b>8.6.1</b> Bulk RNA-seq</a></li>
<li class="chapter" data-level="8.6.2" data-path="biological-analysis.html"><a href="biological-analysis.html#single-cell-rna-seq"><i class="fa fa-check"></i><b>8.6.2</b> Single cell RNA-seq</a></li>
<li class="chapter" data-level="8.6.3" data-path="biological-analysis.html"><a href="biological-analysis.html#differences-in-distribution"><i class="fa fa-check"></i><b>8.6.3</b> Differences in Distribution</a></li>
<li class="chapter" data-level="8.6.4" data-path="biological-analysis.html"><a href="biological-analysis.html#models-of-single-cell-rnaseq-data"><i class="fa fa-check"></i><b>8.6.4</b> Models of single-cell RNASeq data</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="biological-analysis.html"><a href="biological-analysis.html#de-in-a-real-dataset"><i class="fa fa-check"></i><b>8.7</b> DE in a real dataset</a><ul>
<li class="chapter" data-level="8.7.1" data-path="biological-analysis.html"><a href="biological-analysis.html#introduction"><i class="fa fa-check"></i><b>8.7.1</b> Introduction</a></li>
<li class="chapter" data-level="8.7.2" data-path="biological-analysis.html"><a href="biological-analysis.html#kolmogorov-smirnov-test"><i class="fa fa-check"></i><b>8.7.2</b> Kolmogorov-Smirnov test</a></li>
<li class="chapter" data-level="8.7.3" data-path="biological-analysis.html"><a href="biological-analysis.html#wilcoxmann-whitney-u-test"><i class="fa fa-check"></i><b>8.7.3</b> Wilcox/Mann-Whitney-U Test</a></li>
<li class="chapter" data-level="8.7.4" data-path="biological-analysis.html"><a href="biological-analysis.html#edger"><i class="fa fa-check"></i><b>8.7.4</b> edgeR</a></li>
<li class="chapter" data-level="8.7.5" data-path="biological-analysis.html"><a href="biological-analysis.html#monocle-1"><i class="fa fa-check"></i><b>8.7.5</b> Monocle</a></li>
<li class="chapter" data-level="8.7.6" data-path="biological-analysis.html"><a href="biological-analysis.html#mast"><i class="fa fa-check"></i><b>8.7.6</b> MAST</a></li>
<li class="chapter" data-level="8.7.7" data-path="biological-analysis.html"><a href="biological-analysis.html#slow-methods-1h-to-run"><i class="fa fa-check"></i><b>8.7.7</b> Slow Methods (&gt;1h to run)</a></li>
<li class="chapter" data-level="8.7.8" data-path="biological-analysis.html"><a href="biological-analysis.html#bpsc"><i class="fa fa-check"></i><b>8.7.8</b> BPSC</a></li>
<li class="chapter" data-level="8.7.9" data-path="biological-analysis.html"><a href="biological-analysis.html#scde"><i class="fa fa-check"></i><b>8.7.9</b> SCDE</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="biological-analysis.html"><a href="biological-analysis.html#comparingcombining-scrnaseq-datasets"><i class="fa fa-check"></i><b>8.8</b> Comparing/Combining scRNASeq datasets</a><ul>
<li class="chapter" data-level="8.8.1" data-path="biological-analysis.html"><a href="biological-analysis.html#introduction-1"><i class="fa fa-check"></i><b>8.8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.8.2" data-path="biological-analysis.html"><a href="biological-analysis.html#datasets"><i class="fa fa-check"></i><b>8.8.2</b> Datasets</a></li>
<li class="chapter" data-level="8.8.3" data-path="biological-analysis.html"><a href="biological-analysis.html#projecting-cells-onto-annotated-cell-types-scmap"><i class="fa fa-check"></i><b>8.8.3</b> Projecting cells onto annotated cell-types (scmap)</a></li>
<li class="chapter" data-level="8.8.4" data-path="biological-analysis.html"><a href="biological-analysis.html#cell-to-cell-mapping"><i class="fa fa-check"></i><b>8.8.4</b> Cell-to-Cell mapping</a></li>
<li class="chapter" data-level="8.8.5" data-path="biological-analysis.html"><a href="biological-analysis.html#metaneighbour"><i class="fa fa-check"></i><b>8.8.5</b> Metaneighbour</a></li>
<li class="chapter" data-level="8.8.6" data-path="biological-analysis.html"><a href="biological-analysis.html#mnncorrect-1"><i class="fa fa-check"></i><b>8.8.6</b> mnnCorrect</a></li>
<li class="chapter" data-level="8.8.7" data-path="biological-analysis.html"><a href="biological-analysis.html#cannonical-correlation-analysis-seurat"><i class="fa fa-check"></i><b>8.8.7</b> Cannonical Correlation Analysis (Seurat)</a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="biological-analysis.html"><a href="biological-analysis.html#search-scrna-seq-data"><i class="fa fa-check"></i><b>8.9</b> Search scRNA-Seq data</a><ul>
<li class="chapter" data-level="8.9.1" data-path="biological-analysis.html"><a href="biological-analysis.html#about"><i class="fa fa-check"></i><b>8.9.1</b> About</a></li>
<li class="chapter" data-level="8.9.2" data-path="biological-analysis.html"><a href="biological-analysis.html#dataset"><i class="fa fa-check"></i><b>8.9.2</b> Dataset</a></li>
<li class="chapter" data-level="8.9.3" data-path="biological-analysis.html"><a href="biological-analysis.html#gene-index"><i class="fa fa-check"></i><b>8.9.3</b> Gene Index</a></li>
<li class="chapter" data-level="8.9.4" data-path="biological-analysis.html"><a href="biological-analysis.html#marker-genes"><i class="fa fa-check"></i><b>8.9.4</b> Marker genes</a></li>
<li class="chapter" data-level="8.9.5" data-path="biological-analysis.html"><a href="biological-analysis.html#search-cells-by-a-gene-list"><i class="fa fa-check"></i><b>8.9.5</b> Search cells by a gene list</a></li>
<li class="chapter" data-level="8.9.6" data-path="biological-analysis.html"><a href="biological-analysis.html#in-silico-gating"><i class="fa fa-check"></i><b>8.9.6</b> In-silico gating</a></li>
<li class="chapter" data-level="8.9.7" data-path="biological-analysis.html"><a href="biological-analysis.html#sessioninfo"><i class="fa fa-check"></i><b>8.9.7</b> sessionInfo()</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>9</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/lemonbases/scRNA.seq.course.CN" target="blank">碱基吃柠檬</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">scRNA-seq数据分析</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="biological-analysis" class="section level1">
<h1><span class="header-section-number">8</span> 生物学分析</h1>
<div id="section-83" class="section level2">
<h2><span class="header-section-number">8.1</span> 聚类介绍</h2>
<p>对数据进行了标准化并移除了混淆因子后，就可以进行与手头的生物学问题相关的分析。分析的性质取决于数据集。 然而，一些方面在广泛的背景下有用，我们将在接下来的几章中讨论其中的一些方面。从scRNA-seq数据的聚类开始。</p>
<div id="section-84" class="section level3">
<h3><span class="header-section-number">8.1.1</span> 介绍</h3>
<p>scRNA-seq最有希望的应用之一是基于转录谱的<em>de novo</em>发现和注释细胞类型。在计算上，这是一个难题，因为它相当于<strong>非监督聚类</strong>。 也就是说，我们需要根据转录组的相似性识别细胞群，不需要对细胞类型的任何先验知识。 此外，在大多数情况下，我们甚至不知道<em>先验</em>集群的数量。由于噪音（技术和生物）和高维度（比如基因），问题变得更具挑战性。</p>
</div>
<div id="section-85" class="section level3">
<h3><span class="header-section-number">8.1.2</span> 降维</h3>
<p>在处理大型数据集时，应用某种降维方法是有帮助的。将数据投影到较低维度的子空间上，能够显著减少噪声。另一个好处是，在2维或3维子空间中可视化数据要容易得多。我们已经讨论了PCA(章节 <a href="cleaning-the-expression-matrix.html#visual-pca">7.3.2</a>)和t-SNE(章节 <a href="cleaning-the-expression-matrix.html#visual-pca">7.3.2</a>)。</p>
</div>
<div id="section-86" class="section level3">
<h3><span class="header-section-number">8.1.3</span> 聚类方法</h3>
<p><strong>非监督聚类</strong> 在机器学习中广泛研究并应用于不同领域。常用的流行方法是：<strong>层次聚类</strong>，<strong>k-means聚类</strong>，<strong>基于的图聚类</strong>。</p>
<div id="section-87" class="section level4">
<h4><span class="header-section-number">8.1.3.1</span> 层次聚类</h4>
<p><a href="https://en.wikipedia.org/wiki/Hierarchical_clustering">层次聚类</a>可以使用自下而上或自上而下的方法。自下而上策略中，每个细胞最初单独为一类，随后将类进行合并形成hieararchy：</p>
<div class="figure" style="text-align: center"><span id="fig:clust-hierarch-raw"></span>
<img src="figures/hierarchical_clustering1.png" alt="原始数据" width="30%" />
<p class="caption">
Figure 8.1: 原始数据
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:clust-hierarch-dendr"></span>
<img src="figures/hierarchical_clustering2.png" alt="层次聚类树状图" width="50%" />
<p class="caption">
Figure 8.2: 层次聚类树状图
</p>
</div>
<p>使用自上而下策略，最初所有观测点为一类，递归拆分每个类形成hierarchy。该策略的一个优点是该方法是确定性的。</p>
</div>
<div id="k-means" class="section level4">
<h4><span class="header-section-number">8.1.3.2</span> k-means</h4>
<p><a href="https://en.wikipedia.org/wiki/K-means_clustering"><em>k</em>-means聚类</a>,将 _N_个细胞划分成 _k_个不同的类。以迭代的方式，分配类中心并将每个细胞分配个最近的类。</p>
<div class="figure" style="text-align: center"><span id="fig:clust-k-means"></span>
<img src="figures/k-means.png" alt="Schematic representation of the k-means clustering" width="100%" />
<p class="caption">
Figure 8.3: Schematic representation of the k-means clustering
</p>
</div>
<p>scRNA-seq分析的大多数方法在某些步骤都包括 <em>k</em>-means环节。</p>
</div>
<div id="section-88" class="section level4">
<h4><span class="header-section-number">8.1.3.3</span> 基于图的方法</h4>
<p>在过去的二十年中，人们对分析各个领域的网络产生了很大的兴趣。 一个目标是识别网络中节点的群体或模块。</p>
<div class="figure" style="text-align: center"><span id="fig:clust-graph"></span>
<img src="figures/graph_network.jpg" alt="Schematic representation of the graph network" width="100%" />
<p class="caption">
Figure 8.4: Schematic representation of the graph network
</p>
</div>
<p>通过构建图，其中每个节点代表一个细胞,一些方法可以应用于scRNA-seq数据。 然而，构建图并为边指定权重并非易事。 基于图的方法的一个优点是其中一些方法非常有效，可以应用于包含数百万节点的网络。</p>
</div>
</div>
<div id="section-89" class="section level3">
<h3><span class="header-section-number">8.1.4</span> 聚类的挑战</h3>
<ul>
<li>类个数 _k_的确定？</li>
<li>What is a cell type?</li>
<li><strong>Scalability</strong>: in the last few years the number of cells in scRNA-seq experiments has grown by several orders of magnitude from ~<span class="math inline">\(10^2\)</span> to ~<span class="math inline">\(10^6\)</span></li>
<li>Tools are not user-friendly</li>
</ul>
</div>
<div id="tools-for-scrna-seq-data" class="section level3">
<h3><span class="header-section-number">8.1.5</span> Tools for scRNA-seq data</h3>
<div id="sincera" class="section level4">
<h4><span class="header-section-number">8.1.5.1</span> <a href="https://research.cchmc.org/pbge/sincera.html">SINCERA</a></h4>
<ul>
<li>SINCERA <span class="citation">(Guo et al. <a href="#ref-Guo2015-ok">2015</a>)</span> is based on hierarchical clustering</li>
<li>Data is converted to <em>z</em>-scores before clustering</li>
<li>Identify <em>k</em> by finding the first singleton cluster in the hierarchy</li>
</ul>
</div>
<div id="sc3" class="section level4">
<h4><span class="header-section-number">8.1.5.2</span> <a href="http://bioconductor.org/packages/SC3/">SC3</a></h4>
<div class="figure" style="text-align: center"><span id="fig:clust-sc3"></span>
<img src="figures/sc3.png" alt="SC3 pipeline" width="100%" />
<p class="caption">
Figure 8.5: SC3 pipeline
</p>
</div>
<ul>
<li>SC3 <span class="citation">(Kiselev et al. <a href="#ref-Kiselev2016-bq">2017</a>)</span> is based on PCA and spectral dimensionality reductions</li>
<li>Utilises <em>k</em>-means</li>
<li>Additionally performs the consensus clustering</li>
</ul>
</div>
<div id="tsne-k-means" class="section level4">
<h4><span class="header-section-number">8.1.5.3</span> tSNE + k-means</h4>
<ul>
<li>Based on <strong>tSNE</strong> maps</li>
<li>Utilises <em>k</em>-means</li>
</ul>
</div>
<div id="seurat-clustering" class="section level4">
<h4><span class="header-section-number">8.1.5.4</span> Seurat clustering</h4>
<p><a href="https://github.com/satijalab/seurat"><code>Seurat</code></a> clustering is based on a <em>community detection</em> approach similar to <code>SNN-Cliq</code> and to one previously proposed for analyzing CyTOF data <span class="citation">(Levine et al. <a href="#ref-Levine2015-fk">2015</a>)</span>. Since <code>Seurat</code> has become more like an all-in-one tool for scRNA-seq data analysis we dedicate a separate chapter to discuss it in more details (chapter <a href="#seurat-chapter"><strong>??</strong></a>).</p>
</div>
</div>
<div id="comparing-clustering" class="section level3">
<h3><span class="header-section-number">8.1.6</span> Comparing clustering</h3>
<p>To compare two sets of clustering labels we can use <a href="https://en.wikipedia.org/wiki/Rand_index">adjusted Rand index</a>. The index is a measure of the similarity between two data clusterings. Values of the adjusted Rand index lie in <span class="math inline">\([0;1]\)</span> interval, where <span class="math inline">\(1\)</span> means that two clusterings are identical and <span class="math inline">\(0\)</span> means the level of similarity expected by chance.</p>
</div>
</div>
<div id="clust-methods" class="section level2">
<h2><span class="header-section-number">8.2</span> Clustering example</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(pcaMethods)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(SC3)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">library</span>(scater)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">library</span>(SingleCellExperiment)</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw">library</span>(pheatmap)</a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw">library</span>(mclust)</a>
<a class="sourceLine" id="cb1-7" title="7"><span class="kw">set.seed</span>(<span class="dv">1234567</span>)</a></code></pre></div>
<p>To illustrate clustering of scRNA-seq data, we consider the <code>Deng</code> dataset of cells from developing mouse embryo <span class="citation">(Deng et al. <a href="#ref-Deng2014-mx">2014</a>)</span>. We have preprocessed the dataset and created a <code>SingleCellExperiment</code> object in advance. We have also annotated the cells with the cell types identified in the original publication (it is the <code>cell_type2</code> column in the <code>colData</code> slot).</p>
<div id="deng-dataset" class="section level3">
<h3><span class="header-section-number">8.2.1</span> Deng dataset</h3>
<p>Let’s load the data and look at it:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">deng &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;data/deng/deng-reads.rds&quot;</span>)</a>
<a class="sourceLine" id="cb2-2" title="2">deng</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="co">## class: SingleCellExperiment </span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">## dim: 22431 268 </span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co">## metadata(0):</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="co">## assays(2): counts logcounts</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co">## rownames(22431): Hvcn1 Gbp7 ... Sox5 Alg11</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co">## rowData names(10): feature_symbol is_feature_control ...</span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co">##   total_counts log10_total_counts</span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="co">## colnames(268): 16cell 16cell.1 ... zy.2 zy.3</span></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="co">## colData names(30): cell_type2 cell_type1 ... pct_counts_ERCC</span></a>
<a class="sourceLine" id="cb2-12" title="12"><span class="co">##   is_cell_control</span></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="co">## reducedDimNames(0):</span></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="co">## spikeNames(1): ERCC</span></a></code></pre></div>
<p>Let’s look at the cell type annotation:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">table</span>(<span class="kw">colData</span>(deng)<span class="op">$</span>cell_type2)</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="co">## </span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="co">##     16cell      4cell      8cell early2cell earlyblast  late2cell </span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co">##         50         14         37          8         43         10 </span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="co">##  lateblast   mid2cell   midblast         zy </span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="co">##         30         12         60          4</span></a></code></pre></div>
<p>A simple PCA analysis already separates some strong cell types and provides some insights in the data structure:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">plotPCA</span>(deng, <span class="dt">colour_by =</span> <span class="st">&quot;cell_type2&quot;</span>)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/clustering_files/figure-html/unnamed-chunk-5-1.png" style="display: block; margin: auto;" />
As you can see, the early cell types separate quite well, but the three blastocyst timepoints are more difficult to distinguish.</p>
</div>
<div id="sc3-1" class="section level3">
<h3><span class="header-section-number">8.2.2</span> SC3</h3>
<p>Let’s run <code>SC3</code> clustering on the Deng data. The advantage of the <code>SC3</code> is that it can directly ingest a <code>SingleCellExperiment</code> object.</p>
<p>Now let’s image we do not know the number of clusters <em>k</em> (cell types). <code>SC3</code> can estimate a number of clusters for you:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">deng &lt;-<span class="st"> </span><span class="kw">sc3_estimate_k</span>(deng)</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">metadata</span>(deng)<span class="op">$</span>sc3<span class="op">$</span>k_estimation</a></code></pre></div>
<p>Interestingly, the number of cell types predicted by <code>SC3</code> is smaller than in the original data annotation. However, early, mid and late stages of different cell types together, we will have exactly 6 cell types. We store the merged cell types in <code>cell_type1</code> column of the <code>colData</code> slot:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">plotPCA</span>(deng, <span class="dt">colour_by =</span> <span class="st">&quot;cell_type1&quot;</span>)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/clustering_files/figure-html/unnamed-chunk-7-1.png" style="display: block; margin: auto;" /></p>
<p>Now we are ready to run <code>SC3</code> (we also ask it to calculate biological properties of the clusters):</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">deng &lt;-<span class="st"> </span><span class="kw">sc3</span>(deng, <span class="dt">ks =</span> <span class="dv">10</span>, <span class="dt">biology =</span> <span class="ot">TRUE</span>, <span class="dt">n_cores =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><code>SC3</code> result consists of several different outputs (please look in <span class="citation">(Kiselev et al. <a href="#ref-Kiselev2016-bq">2017</a>)</span> and <a href="http://bioconductor.org/packages/release/bioc/vignettes/SC3/inst/doc/my-vignette.html">SC3 vignette</a> for more details). Here we show some of them:</p>
<p>Consensus matrix:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">sc3_plot_consensus</span>(deng, <span class="dt">k =</span> <span class="dv">10</span>, <span class="dt">show_pdata =</span> <span class="st">&quot;cell_type2&quot;</span>)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/clustering_files/figure-html/unnamed-chunk-9-1.png" style="display: block; margin: auto;" />
Silhouette plot:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">sc3_plot_silhouette</span>(deng, <span class="dt">k =</span> <span class="dv">10</span>)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/clustering_files/figure-html/unnamed-chunk-10-1.png" style="display: block; margin: auto;" />
Heatmap of the expression matrix:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">sc3_plot_expression</span>(deng, <span class="dt">k =</span> <span class="dv">10</span>, <span class="dt">show_pdata =</span> <span class="st">&quot;cell_type2&quot;</span>)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/clustering_files/figure-html/unnamed-chunk-11-1.png" style="display: block; margin: auto;" />
Identified marker genes:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">sc3_plot_markers</span>(deng, <span class="dt">k =</span> <span class="dv">10</span>, <span class="dt">show_pdata =</span> <span class="st">&quot;cell_type2&quot;</span>)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/clustering_files/figure-html/unnamed-chunk-12-1.png" style="display: block; margin: auto;" />
PCA plot with highlighted <code>SC3</code> clusters:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">plotPCA</span>(deng, <span class="dt">colour_by =</span> <span class="st">&quot;sc3_10_clusters&quot;</span>)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/clustering_files/figure-html/unnamed-chunk-13-1.png" style="display: block; margin: auto;" />
Compare the results of <code>SC3</code> clustering with the original publication cell type labels:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">adjustedRandIndex</span>(<span class="kw">colData</span>(deng)<span class="op">$</span>cell_type2, <span class="kw">colData</span>(deng)<span class="op">$</span>sc3_<span class="dv">10</span>_clusters)</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="co">## [1] 0.7721292</span></a></code></pre></div>
<p><strong>Note</strong> <code>SC3</code> can also be run in an interactive <code>Shiny</code> session:</p>
<p>This command will open <code>SC3</code> in a web browser.</p>
<p><strong>Note</strong> Due to direct calculation of distances <code>SC3</code> becomes very slow when the number of cells is <span class="math inline">\(&gt;5000\)</span>. For large datasets containing up to <span class="math inline">\(10^5\)</span> cells we recomment using <code>Seurat</code> (see chapter <a href="#seurat-chapter"><strong>??</strong></a>).</p>
<ul>
<li><p><strong>Exercise 1</strong>: Run <code>SC3</code> for <span class="math inline">\(k\)</span> from 8 to 12 and explore different clustering solutions in your web browser.</p></li>
<li><p><strong>Exercise 2</strong>: Which clusters are the most stable when <span class="math inline">\(k\)</span> is changed from 8 to 12? (Look at the “Stability” tab)</p></li>
<li><p><strong>Exercise 3</strong>: Check out differentially expressed genes and marker genes for the obtained clusterings. Please use <span class="math inline">\(k=10\)</span>.</p></li>
<li><p><strong>Exercise 4</strong>: Change the marker genes threshold (the default is 0.85). Does <strong>SC3</strong> find more marker genes?</p></li>
</ul>
</div>
<div id="tsne-kmeans" class="section level3">
<h3><span class="header-section-number">8.2.3</span> tSNE + kmeans</h3>
<p><a href="https://lvdmaaten.github.io/tsne/">tSNE</a> plots that we saw before (<a href="cleaning-the-expression-matrix.html#visual-tsne">7.3.3</a>) when used the <strong>scater</strong> package are made by using the <a href="https://cran.r-project.org/web/packages/Rtsne/index.html">Rtsne</a> and <a href="https://cran.r-project.org/web/packages/ggplot2/index.html">ggplot2</a> packages. Here we will do the same:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">deng &lt;-<span class="st"> </span><span class="kw">runTSNE</span>(deng, <span class="dt">rand_seed =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb14-2" title="2"><span class="kw">plotTSNE</span>(deng)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:clust-tsne"></span>
<img src="https://scrnaseq-course.cog.sanger.ac.uk/website/clustering_files/figure-html/clust-tsne-1.png" alt="tSNE map of the patient data"  />
<p class="caption">
Figure 8.6: tSNE map of the patient data
</p>
</div>
<p>Note that all points on the plot above are black. This is different from what we saw before, when the cells were coloured based on the annotation. Here we do not have any annotation and all cells come from the same batch, therefore all dots are black.</p>
<p>Now we are going to apply <em>k</em>-means clustering algorithm to the cloud of points on the tSNE map. How many groups do you see in the cloud?</p>
<p>We will start with <span class="math inline">\(k=8\)</span>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">colData</span>(deng)<span class="op">$</span>tSNE_kmeans &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">kmeans</span>(deng<span class="op">@</span>reducedDims<span class="op">$</span>TSNE, <span class="dt">centers =</span> <span class="dv">8</span>)<span class="op">$</span>clust)</a>
<a class="sourceLine" id="cb15-2" title="2"><span class="kw">plotTSNE</span>(deng, <span class="dt">colour_by =</span> <span class="st">&quot;tSNE_kmeans&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:clust-tsne-kmeans2"></span>
<img src="https://scrnaseq-course.cog.sanger.ac.uk/website/clustering_files/figure-html/clust-tsne-kmeans2-1.png" alt="tSNE map of the patient data with 8 colored clusters, identified by the k-means clustering algorithm"  />
<p class="caption">
Figure 8.7: tSNE map of the patient data with 8 colored clusters, identified by the k-means clustering algorithm
</p>
</div>
<p><strong>Exercise 7</strong>: Make the same plot for <span class="math inline">\(k=10\)</span>.</p>
<p><strong>Exercise 8</strong>: Compare the results between <code>tSNE+kmeans</code> and the original publication cell types. Can the results be improved by changing the <code>perplexity</code> parameter?</p>
<p><strong>Our solution</strong>:</p>
<p>As you may have noticed, <code>tSNE+kmeans</code> is stochastic
and gives different results every time they are run. To get a better
overview of the solutions, we need to run the methods multiple times. <code>SC3</code> is also stochastic, but thanks to the consensus step, it is more robust and less likely to produce different outcomes.</p>
</div>
<div id="sincera-1" class="section level3">
<h3><span class="header-section-number">8.2.4</span> SINCERA</h3>
<p>As mentioned in the previous chapter <a href="https://research.cchmc.org/pbge/sincera.html">SINCERA</a> is based on hierarchical clustering. One important thing to keep in mind is that it performs a gene-level z-score transformation before doing clustering:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="co"># use the same gene filter as in SC3</span></a>
<a class="sourceLine" id="cb16-2" title="2">input &lt;-<span class="st"> </span><span class="kw">logcounts</span>(deng[<span class="kw">rowData</span>(deng)<span class="op">$</span>sc3_gene_filter, ])</a></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="co"># perform gene-by-gene per-sample z-score transformation</span></a>
<a class="sourceLine" id="cb17-2" title="2">dat &lt;-<span class="st"> </span><span class="kw">apply</span>(input, <span class="dv">1</span>, <span class="cf">function</span>(y) scRNA.seq.funcs<span class="op">::</span><span class="kw">z.transform.helper</span>(y))</a>
<a class="sourceLine" id="cb17-3" title="3"><span class="co"># hierarchical clustering</span></a>
<a class="sourceLine" id="cb17-4" title="4">dd &lt;-<span class="st"> </span><span class="kw">as.dist</span>((<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">cor</span>(<span class="kw">t</span>(dat), <span class="dt">method =</span> <span class="st">&quot;pearson&quot;</span>))<span class="op">/</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb17-5" title="5">hc &lt;-<span class="st"> </span><span class="kw">hclust</span>(dd, <span class="dt">method =</span> <span class="st">&quot;average&quot;</span>)</a></code></pre></div>
<p>If the number of cluster is not known <a href="https://research.cchmc.org/pbge/sincera.html">SINCERA</a> can identify <strong>k</strong> as the minimum height of the hierarchical tree that generates no more than a specified number of singleton clusters (clusters containing only 1 cell)</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">num.singleton &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb18-2" title="2">kk &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb18-3" title="3"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="kw">dim</span>(dat)[<span class="dv">2</span>]) {</a>
<a class="sourceLine" id="cb18-4" title="4">    clusters &lt;-<span class="st"> </span><span class="kw">cutree</span>(hc, <span class="dt">k =</span> i)</a>
<a class="sourceLine" id="cb18-5" title="5">    clustersizes &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">table</span>(clusters))</a>
<a class="sourceLine" id="cb18-6" title="6">    singleton.clusters &lt;-<span class="st"> </span><span class="kw">which</span>(clustersizes<span class="op">$</span>Freq <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb18-7" title="7">    <span class="cf">if</span> (<span class="kw">length</span>(singleton.clusters) <span class="op">&lt;=</span><span class="st"> </span>num.singleton) {</a>
<a class="sourceLine" id="cb18-8" title="8">        kk &lt;-<span class="st"> </span>i</a>
<a class="sourceLine" id="cb18-9" title="9">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb18-10" title="10">        <span class="cf">break</span>;</a>
<a class="sourceLine" id="cb18-11" title="11">    }</a>
<a class="sourceLine" id="cb18-12" title="12">}</a>
<a class="sourceLine" id="cb18-13" title="13"><span class="kw">cat</span>(kk)</a>
<a class="sourceLine" id="cb18-14" title="14"><span class="co">## 6</span></a></code></pre></div>
<p>Let’s now visualize the SINCERA results as a heatmap:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="kw">pheatmap</span>(</a>
<a class="sourceLine" id="cb19-2" title="2">    <span class="kw">t</span>(dat),</a>
<a class="sourceLine" id="cb19-3" title="3">    <span class="dt">cluster_cols =</span> hc,</a>
<a class="sourceLine" id="cb19-4" title="4">    <span class="dt">cutree_cols =</span> kk,</a>
<a class="sourceLine" id="cb19-5" title="5">    <span class="dt">kmeans_k =</span> <span class="dv">100</span>,</a>
<a class="sourceLine" id="cb19-6" title="6">    <span class="dt">show_rownames =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb19-7" title="7">)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:clust-sincera"></span>
<img src="https://scrnaseq-course.cog.sanger.ac.uk/website/clustering_files/figure-html/clust-sincera-1.png" alt="Clustering solutions of SINCERA method using found $k$"  />
<p class="caption">
Figure 8.8: Clustering solutions of SINCERA method using found <span class="math inline">\(k\)</span>
</p>
</div>
<p><strong>Exercise 10</strong>: Compare the results between <code>SINCERA</code> and the original publication cell types.</p>
<p><strong>Our solution</strong>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="kw">colData</span>(deng)<span class="op">$</span>SINCERA &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">cutree</span>(hc, <span class="dt">k =</span> kk))</a>
<a class="sourceLine" id="cb20-2" title="2"><span class="kw">adjustedRandIndex</span>(<span class="kw">colData</span>(deng)<span class="op">$</span>cell_type2, <span class="kw">colData</span>(deng)<span class="op">$</span>SINCERA)</a></code></pre></div>
<p><strong>Exercise 11</strong>: Is using the singleton cluster criteria for finding <strong>k</strong> a good idea?</p>
</div>
</div>
<div id="feature-selection" class="section level2">
<h2><span class="header-section-number">8.3</span> Feature Selection</h2>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1"><span class="kw">library</span>(scRNA.seq.funcs)</a>
<a class="sourceLine" id="cb21-2" title="2"><span class="kw">library</span>(matrixStats)</a>
<a class="sourceLine" id="cb21-3" title="3"><span class="kw">library</span>(M3Drop)</a>
<a class="sourceLine" id="cb21-4" title="4"><span class="kw">library</span>(RColorBrewer)</a>
<a class="sourceLine" id="cb21-5" title="5"><span class="kw">library</span>(SingleCellExperiment)</a>
<a class="sourceLine" id="cb21-6" title="6"><span class="kw">set.seed</span>(<span class="dv">1</span>)</a></code></pre></div>
<p>Single-cell RNASeq is capable of measuring the expression of many
thousands of genes in every cell. However, in most situations only a
portion of those will show a response to the biological condition of
interest, e.g. differences in cell-type, drivers of differentiation,
respond to an environmental stimulus. Most genes detected in a scRNASeq
experiment will only be detected at different levels due to technical
noise. One consequence of this is that technical noise and batch
effects can obscure the biological signal of interest.</p>
<p>Thus, it is often advantageous to perform feature selection to remove
those genes which only exhibit technical noise from downstream analysis.
Not only does this generally increase the signal:noise ratio in the data;
it also reduces the computational complexity of analyses, by reducing
the total amount of data to be processed.</p>
<p>For scRNASeq data, we will be focusing on unsupervised methods of feature
selection which don’t require any a priori information, such as cell-type
labels or biological group, since they are not available, or may be unreliable,
for many experiments. In contrast, differential expression (chapter <a href="biological-analysis.html#dechapter">8.6</a>)
can be considered a form of supervised feature selection since it uses the
known biological label of each sample to identify features (i.e. genes) which
are expressed at different levels across groups.</p>
<p>For this section we will continue working with the Deng data.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1">deng &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;data/deng/deng-reads.rds&quot;</span>)</a>
<a class="sourceLine" id="cb22-2" title="2">celltype_labs &lt;-<span class="st"> </span><span class="kw">colData</span>(deng)<span class="op">$</span>cell_type2</a>
<a class="sourceLine" id="cb22-3" title="3">cell_colors &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="kw">max</span>(<span class="dv">3</span>,<span class="kw">length</span>(<span class="kw">unique</span>(celltype_labs))), <span class="st">&quot;Set3&quot;</span>)</a></code></pre></div>
<p>Feature selection is performed after QC, however this data has already been QCed so
we can skip that step here. M3Drop contain two different feature selection methods
“M3DropFeatureSelection” which is based on a Michaelis-Menten curve and is designed
for full-transcript single-cell RNA-seq data (such as Smartseq2) and
“NBumiFeatureSelectionCombinedDrop” which is based on a negative binomial model and
is designed for UMI count data. We will demonstrate both on the Deng Smartseq2 data.</p>
<p>M3Drop feature selection is runs direction on a normalized (but not log-transformed)
expression matrix. This can be extracted from our SingleCellExperiment object using the
command below.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1">expr_matrix &lt;-<span class="st"> </span>M3Drop<span class="op">::</span><span class="kw">M3DropConvertData</span>(deng)</a></code></pre></div>
<p>This function is compatible with most single-cell RNA-seq analysis packages including:
scater, SingleCellExperiment, monocle, and Seurat. It can also convert an existing
expression matrix to the correct form (removing undetected genes &amp; normalizing/delogging)
if you specify whether the matrix is raw counts, or log transformed. Check the manual for details:</p>
<p><strong>Exercise 1</strong>: Confirm that the conversion function has removed undetected genes:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1"><span class="kw">nrow</span>(<span class="kw">counts</span>(deng)) <span class="op">-</span><span class="st"> </span><span class="kw">nrow</span>(expr_matrix)</a>
<a class="sourceLine" id="cb24-2" title="2"><span class="kw">summary</span>( <span class="kw">rowSums</span>(<span class="kw">counts</span>(deng))[<span class="op">!</span><span class="st"> </span><span class="kw">rownames</span>(<span class="kw">counts</span>(deng)) <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(expr_matrix) ] )</a></code></pre></div>
<div id="identifying-genes-vs-a-null-model" class="section level3">
<h3><span class="header-section-number">8.3.1</span> Identifying Genes vs a Null Model</h3>
<p>There are two main approaches to unsupervised feature selection. The
first is to identify genes which behave differently from a null model
describing just the technical noise expected in the dataset.</p>
<p>If the dataset contains spike-in RNAs they can be used to directly model
technical noise. However, measurements of spike-ins may not experience
the same technical noise as endogenous transcripts <a href="https://www.nature.com/nmeth/journal/v14/n4/full/nmeth.4220.html">(Svensson et al., 2017)</a>.
In addition, scRNASeq experiments often contain only a small number of
spike-ins which reduces our confidence in fitted model parameters.</p>
<div id="highly-variable-genes" class="section level4">
<h4><span class="header-section-number">8.3.1.1</span> Highly Variable Genes</h4>
<p>The first method proposed to identify features in scRNASeq datasets
was to identify highly variable genes (HVG). HVG assumes that if genes
have large differences in expression across cells some of those differences
are due to biological difference between the cells rather than technical noise.
However, because of the nature of count data, there is a positive relationship
between the mean expression of a gene and the variance in the read counts across
cells. This relationship must be corrected for to properly identify HVGs.</p>
<p><strong>Exercise 2</strong>
Using the functions rowMeans and rowVars to plot the relationship between mean expression
and variance for all genes in this dataset. (Hint: use log=“xy” to plot on a log-scale).</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1"><span class="kw">plot</span>(</a>
<a class="sourceLine" id="cb25-2" title="2">    <span class="kw">rowMeans</span>(expr_matrix), </a>
<a class="sourceLine" id="cb25-3" title="3">    <span class="kw">rowVars</span>(expr_matrix), </a>
<a class="sourceLine" id="cb25-4" title="4">    <span class="dt">log=</span><span class="st">&quot;xy&quot;</span>, </a>
<a class="sourceLine" id="cb25-5" title="5">    <span class="dt">pch=</span><span class="dv">16</span>,</a>
<a class="sourceLine" id="cb25-6" title="6">    <span class="dt">xlab=</span><span class="st">&quot;Mean Expression&quot;</span>, </a>
<a class="sourceLine" id="cb25-7" title="7">    <span class="dt">ylab=</span><span class="st">&quot;Variance&quot;</span>, </a>
<a class="sourceLine" id="cb25-8" title="8">    <span class="dt">main=</span><span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb25-9" title="9">)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/dropouts_files/figure-html/unnamed-chunk-7-1.png" style="display: block; margin: auto;" />
A popular method to correct for the relationship between variance and mean expression
was proposed by <a href="http://www.nature.com/nmeth/journal/v10/n11/full/nmeth.2645.html">Brennecke et al.</a>.
To use the Brennecke method, we first normalize for library size then calculate
the mean and the square coefficient of variation (variation divided by
the squared mean expression). A quadratic curve is fit to the relationship
between these two variables for the ERCC spike-in, and then a chi-square test is used to find genes
significantly above the curve. This method is included in the M3Drop package as the
Brennecke_getVariableGenes(counts, spikes) function. However, this dataset does not contain spike-ins
so we will use the entire dataset to estimate the technical noise.</p>
<p>In the figure below the red curve
is the fitted technical noise model and the dashed line is the 95%
CI. Pink dots are the genes with significant biological variability
after multiple-testing correction.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1">Brennecke_HVG &lt;-<span class="st"> </span><span class="kw">BrenneckeGetVariableGenes</span>(</a>
<a class="sourceLine" id="cb26-2" title="2">    expr_matrix,</a>
<a class="sourceLine" id="cb26-3" title="3">    <span class="dt">fdr =</span> <span class="fl">0.01</span>,</a>
<a class="sourceLine" id="cb26-4" title="4">    <span class="dt">minBiolDisp =</span> <span class="fl">0.5</span></a>
<a class="sourceLine" id="cb26-5" title="5">)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/dropouts_files/figure-html/unnamed-chunk-8-1.png" style="display: block; margin: auto;" /></p>
<p>This function returns a matrix of significant genes as well as their estimated effect size (difference
between observed and expected coefficient of variation), and their significance as raw p.values and
FDR corrected q.values. For now we will just keep the names of the significant HVG genes.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1">HVG_genes &lt;-<span class="st"> </span>Brennecke_HVG<span class="op">$</span>Gene</a></code></pre></div>
<p><strong>Exercise 3</strong>
How many genes were signifcant using BrenneckeGetVariableGenes?</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1"><span class="kw">length</span>(HVG_genes)</a></code></pre></div>
</div>
<div id="high-dropout-genes" class="section level4">
<h4><span class="header-section-number">8.3.1.2</span> High Dropout Genes</h4>
<p>An alternative to finding HVGs is to identify genes with unexpectedly high numbers of zeros.
The frequency of zeros, known as the “dropout rate”, is very closely related to expression level
in scRNASeq data. Zeros are the dominant feature of single-cell RNASeq data, typically accounting
for over half of the entries in the final expression matrix. These zeros predominantly result
from the failure of mRNAs failing to be reversed transcribed <a href="http://www.biorxiv.org/content/early/2017/05/25/065094">(Andrews and Hemberg, 2016)</a>. Reverse transcription
is an enzyme reaction thus can be modelled using the Michaelis-Menten equation:</p>
<p><span class="math display">\[P_{dropout} = 1 - S/(K + S)\]</span></p>
<p>where <span class="math inline">\(S\)</span> is the mRNA concentration in the cell (we will estimate this as average expression)
and <span class="math inline">\(K\)</span> is the Michaelis-Menten constant.</p>
<p>Because the Michaelis-Menten equation is a convex non-linear function, genes which are
differentially expression across two or more populations of cells in our dataset will
be shifted up/right of the Michaelis-Menten model (see Figure below).</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1">K &lt;-<span class="st"> </span><span class="dv">49</span></a>
<a class="sourceLine" id="cb29-2" title="2">S_sim &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">-3</span>, <span class="dt">to =</span> <span class="dv">4</span>, <span class="dt">by =</span> <span class="fl">0.05</span>) <span class="co"># range of expression values</span></a>
<a class="sourceLine" id="cb29-3" title="3">MM &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>S_sim <span class="op">/</span><span class="st"> </span>(K <span class="op">+</span><span class="st"> </span>S_sim)</a>
<a class="sourceLine" id="cb29-4" title="4"><span class="kw">plot</span>(</a>
<a class="sourceLine" id="cb29-5" title="5">    S_sim, </a>
<a class="sourceLine" id="cb29-6" title="6">    MM, </a>
<a class="sourceLine" id="cb29-7" title="7">    <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, </a>
<a class="sourceLine" id="cb29-8" title="8">    <span class="dt">lwd =</span> <span class="dv">3</span>, </a>
<a class="sourceLine" id="cb29-9" title="9">    <span class="dt">xlab =</span> <span class="st">&quot;Expression&quot;</span>, </a>
<a class="sourceLine" id="cb29-10" title="10">    <span class="dt">ylab =</span> <span class="st">&quot;Dropout Rate&quot;</span>, </a>
<a class="sourceLine" id="cb29-11" title="11">    <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb29-12" title="12">)</a>
<a class="sourceLine" id="cb29-13" title="13">S1 &lt;-<span class="st"> </span><span class="dv">10</span> <span class="co"># Mean expression in population 1</span></a>
<a class="sourceLine" id="cb29-14" title="14">P1 &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>S1 <span class="op">/</span><span class="st"> </span>(K <span class="op">+</span><span class="st"> </span>S1) <span class="co"># Dropouts for cells in condition 1</span></a>
<a class="sourceLine" id="cb29-15" title="15">S2 &lt;-<span class="st"> </span><span class="dv">750</span> <span class="co"># Mean expression in population 2</span></a>
<a class="sourceLine" id="cb29-16" title="16">P2 &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>S2 <span class="op">/</span><span class="st"> </span>(K <span class="op">+</span><span class="st"> </span>S2) <span class="co"># Dropouts for cells in condition 2</span></a>
<a class="sourceLine" id="cb29-17" title="17"><span class="kw">points</span>(</a>
<a class="sourceLine" id="cb29-18" title="18">    <span class="kw">c</span>(S1, S2),</a>
<a class="sourceLine" id="cb29-19" title="19">    <span class="kw">c</span>(P1, P2), </a>
<a class="sourceLine" id="cb29-20" title="20">    <span class="dt">pch =</span> <span class="dv">16</span>, </a>
<a class="sourceLine" id="cb29-21" title="21">    <span class="dt">col =</span> <span class="st">&quot;grey85&quot;</span>, </a>
<a class="sourceLine" id="cb29-22" title="22">    <span class="dt">cex =</span> <span class="dv">3</span></a>
<a class="sourceLine" id="cb29-23" title="23">)</a>
<a class="sourceLine" id="cb29-24" title="24">mix &lt;-<span class="st"> </span><span class="fl">0.5</span> <span class="co"># proportion of cells in condition 1</span></a>
<a class="sourceLine" id="cb29-25" title="25"><span class="kw">points</span>(</a>
<a class="sourceLine" id="cb29-26" title="26">    S1 <span class="op">*</span><span class="st"> </span>mix <span class="op">+</span><span class="st"> </span>S2 <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>mix), </a>
<a class="sourceLine" id="cb29-27" title="27">    P1 <span class="op">*</span><span class="st"> </span>mix <span class="op">+</span><span class="st"> </span>P2 <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>mix), </a>
<a class="sourceLine" id="cb29-28" title="28">    <span class="dt">pch =</span> <span class="dv">16</span>, </a>
<a class="sourceLine" id="cb29-29" title="29">    <span class="dt">col =</span> <span class="st">&quot;grey35&quot;</span>, </a>
<a class="sourceLine" id="cb29-30" title="30">    <span class="dt">cex =</span> <span class="dv">3</span></a>
<a class="sourceLine" id="cb29-31" title="31">)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/dropouts_files/figure-html/unnamed-chunk-11-1.png" style="display: block; margin: auto;" />
<strong>Note</strong>: add <code>log="x"</code> to the <code>plot</code> call above to see how this looks on the log scale, which is used in M3Drop figures.</p>
<p><strong>Exercise 4</strong>: Produce the same plot as above with different expression levels (S1 &amp; S2) and/or mixtures (mix).</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1"><span class="kw">plot</span>(</a>
<a class="sourceLine" id="cb30-2" title="2">    S_sim, </a>
<a class="sourceLine" id="cb30-3" title="3">    MM, </a>
<a class="sourceLine" id="cb30-4" title="4">    <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, </a>
<a class="sourceLine" id="cb30-5" title="5">    <span class="dt">lwd =</span> <span class="dv">3</span>, </a>
<a class="sourceLine" id="cb30-6" title="6">    <span class="dt">xlab =</span> <span class="st">&quot;Expression&quot;</span>, </a>
<a class="sourceLine" id="cb30-7" title="7">    <span class="dt">ylab =</span> <span class="st">&quot;Dropout Rate&quot;</span>, </a>
<a class="sourceLine" id="cb30-8" title="8">    <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1000</span>), </a>
<a class="sourceLine" id="cb30-9" title="9">    <span class="dt">log =</span> <span class="st">&quot;x&quot;</span></a>
<a class="sourceLine" id="cb30-10" title="10">)</a>
<a class="sourceLine" id="cb30-11" title="11">S1 &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb30-12" title="12">P1 &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>S1 <span class="op">/</span><span class="st"> </span>(K <span class="op">+</span><span class="st"> </span>S1) <span class="co"># Expression &amp; dropouts for cells in condition 1</span></a>
<a class="sourceLine" id="cb30-13" title="13">S2 &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb30-14" title="14">P2 &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>S2 <span class="op">/</span><span class="st"> </span>(K <span class="op">+</span><span class="st"> </span>S2) <span class="co"># Expression &amp; dropouts for cells in condition 2</span></a>
<a class="sourceLine" id="cb30-15" title="15"><span class="kw">points</span>(</a>
<a class="sourceLine" id="cb30-16" title="16">    <span class="kw">c</span>(S1, S2),</a>
<a class="sourceLine" id="cb30-17" title="17">    <span class="kw">c</span>(P1, P2), </a>
<a class="sourceLine" id="cb30-18" title="18">    <span class="dt">pch =</span> <span class="dv">16</span>, </a>
<a class="sourceLine" id="cb30-19" title="19">    <span class="dt">col =</span> <span class="st">&quot;grey85&quot;</span>, </a>
<a class="sourceLine" id="cb30-20" title="20">    <span class="dt">cex =</span> <span class="dv">3</span></a>
<a class="sourceLine" id="cb30-21" title="21">)</a>
<a class="sourceLine" id="cb30-22" title="22">mix &lt;-<span class="st"> </span><span class="fl">0.75</span> <span class="co"># proportion of cells in condition 1</span></a>
<a class="sourceLine" id="cb30-23" title="23"><span class="kw">points</span>(</a>
<a class="sourceLine" id="cb30-24" title="24">    S1 <span class="op">*</span><span class="st"> </span>mix <span class="op">+</span><span class="st"> </span>S2 <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>mix), </a>
<a class="sourceLine" id="cb30-25" title="25">    P1 <span class="op">*</span><span class="st"> </span>mix <span class="op">+</span><span class="st"> </span>P2 <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>mix), </a>
<a class="sourceLine" id="cb30-26" title="26">    <span class="dt">pch =</span> <span class="dv">16</span>, </a>
<a class="sourceLine" id="cb30-27" title="27">    <span class="dt">col =</span> <span class="st">&quot;grey35&quot;</span>, </a>
<a class="sourceLine" id="cb30-28" title="28">    <span class="dt">cex =</span> <span class="dv">3</span></a>
<a class="sourceLine" id="cb30-29" title="29">)</a></code></pre></div>
<p>We use M3Drop to identify significant outliers to the right of the MM
curve. We also apply 1% FDR multiple testing correction:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1">M3Drop_genes &lt;-<span class="st"> </span><span class="kw">M3DropFeatureSelection</span>(</a>
<a class="sourceLine" id="cb31-2" title="2">    expr_matrix,</a>
<a class="sourceLine" id="cb31-3" title="3">    <span class="dt">mt_method =</span> <span class="st">&quot;fdr&quot;</span>,</a>
<a class="sourceLine" id="cb31-4" title="4">    <span class="dt">mt_threshold =</span> <span class="fl">0.01</span></a>
<a class="sourceLine" id="cb31-5" title="5">)</a>
<a class="sourceLine" id="cb31-6" title="6">M3Drop_genes &lt;-<span class="st"> </span>M3Drop_genes<span class="op">$</span>Gene</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/dropouts_files/figure-html/unnamed-chunk-13-1.png" style="display: block; margin: auto;" /></p>
<p>An alternative method is contained in the M3Drop package that is tailored specifically for
UMI-tagged data which generally contains many zeros resulting from low sequencing coverage
in addition to those resulting from insufficient reverse-transcription. This model is the
Depth-Adjusted Negative Binomial (DANB). This method describes each expression observation
as a negative binomial model with a mean related to both the mean expression of the
respective gene and the sequencing depth of the respective cell, and a variance related to
the mean-expression of the gene.</p>
<p>This method is designed to model the raw counts in a dataset directly, and we can extract
the appropriate matrix using the “NBumiConvertData” function similar to M3Drop. However,
we have an extra step for fitting the model since that is the slowest step of the method
and we are currently working on additional methods that can use this model information
for other things (such as normalization, co-expression testing, highly variable gene
detection).</p>
<p>This method includes a binomial test of the significance of each feature, but since
the Deng data is not UMI counts the model does not fit the noise sufficiently and
far too many genes will be called as significant. Thus we will take the top 1500
by effect size.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1">deng_int &lt;-<span class="st"> </span><span class="kw">NBumiConvertData</span>(deng)</a>
<a class="sourceLine" id="cb32-2" title="2">DANB_fit &lt;-<span class="st"> </span><span class="kw">NBumiFitModel</span>(deng_int) <span class="co"># DANB is fit to the raw count matrix</span></a>
<a class="sourceLine" id="cb32-3" title="3"><span class="co"># Perform DANB feature selection</span></a>
<a class="sourceLine" id="cb32-4" title="4">DropFS &lt;-<span class="st"> </span><span class="kw">NBumiFeatureSelectionCombinedDrop</span>(DANB_fit, <span class="dt">method=</span><span class="st">&quot;fdr&quot;</span>, <span class="dt">qval.thresh=</span><span class="fl">0.01</span>, <span class="dt">suppress.plot=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb32-5" title="5">DANB_genes &lt;-<span class="st"> </span>DropFS[<span class="dv">1</span><span class="op">:</span><span class="dv">1500</span>,]<span class="op">$</span>Gene</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/dropouts_files/figure-html/unnamed-chunk-14-1.png" style="display: block; margin: auto;" />
<strong>Exercise 5</strong>
How many genes were signifcant using NBumiFeatureSelectionCombinedDrop?</p>
</div>
</div>
<div id="correlated-expression" class="section level3">
<h3><span class="header-section-number">8.3.2</span> Correlated Expression</h3>
<p>A completely different approach to feature selection is to use gene-gene correlations. This method
is based on the idea that multiple genes will be differentially expressed between different cell-types
or cell-states. Genes which are expressed in the same cell-population will be positively correlated
with each other where as genes expressed in different cell-populations will be negatively correated with
each other. Thus important genes can be identified by the magnitude of their correlation
with other genes.</p>
<p>The limitation of this method is that it assumes technical noise is random and independent for each cell,
thus shouldn’t produce gene-gene correlations, but this assumption is violated by batch effects which are
generally systematic between different experimental batches and will produce gene-gene correlations. As a
result it is more appropriate to take the top few thousand genes as ranked by gene-gene correlation than
consider the significance of the correlations.</p>
<p>Lastly, another common method for feature selection in scRNASeq data is to use PCA loadings. Genes with
high PCA loadings are likely to be highly variable and correlated with many other variable genes, thus
may be relevant to the underlying biology. However, as with gene-gene correlations PCA loadings tend to
be susceptible to detecting systematic variation due to batch effects; thus it is recommended to plot the PCA
results to determine those components corresponding to the biological variation rather than batch effects.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1"><span class="co"># PCA is typically performed on log-transformed expression data</span></a>
<a class="sourceLine" id="cb33-2" title="2">pca &lt;-<span class="st"> </span><span class="kw">prcomp</span>(<span class="kw">log</span>(expr_matrix <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span><span class="kw">log</span>(<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb33-3" title="3"></a>
<a class="sourceLine" id="cb33-4" title="4"><span class="co"># plot projection</span></a>
<a class="sourceLine" id="cb33-5" title="5"><span class="kw">plot</span>(</a>
<a class="sourceLine" id="cb33-6" title="6">    pca<span class="op">$</span>rotation[,<span class="dv">1</span>], </a>
<a class="sourceLine" id="cb33-7" title="7">    pca<span class="op">$</span>rotation[,<span class="dv">2</span>], </a>
<a class="sourceLine" id="cb33-8" title="8">    <span class="dt">pch =</span> <span class="dv">16</span>, </a>
<a class="sourceLine" id="cb33-9" title="9">    <span class="dt">col =</span> cell_colors[<span class="kw">as.factor</span>(celltype_labs)]</a>
<a class="sourceLine" id="cb33-10" title="10">) </a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/dropouts_files/figure-html/unnamed-chunk-17-1.png" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1"><span class="co"># calculate loadings for components 1 and 2</span></a>
<a class="sourceLine" id="cb34-2" title="2">score &lt;-<span class="st"> </span><span class="kw">rowSums</span>(<span class="kw">abs</span>(pca<span class="op">$</span>x[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)])) </a>
<a class="sourceLine" id="cb34-3" title="3"><span class="kw">names</span>(score) &lt;-<span class="st"> </span><span class="kw">rownames</span>(expr_matrix)</a>
<a class="sourceLine" id="cb34-4" title="4">score &lt;-<span class="st"> </span>score[<span class="kw">order</span>(<span class="op">-</span>score)]</a>
<a class="sourceLine" id="cb34-5" title="5">PCA_genes &lt;-<span class="st"> </span><span class="kw">names</span>(score[<span class="dv">1</span><span class="op">:</span><span class="dv">1500</span>])</a></code></pre></div>
<p><strong>Exercise 6</strong>
Consider the top 5 principal components. Which appear to be most biologically relevant? How does the top 1,500
features change if you consider the loadings for those components?</p>
</div>
<div id="comparing-methods" class="section level3">
<h3><span class="header-section-number">8.3.3</span> Comparing Methods</h3>
<p>We can check whether the identified features really do represent genes differentially expressed between
cell-types in this dataset.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1"><span class="kw">M3DropExpressionHeatmap</span>(</a>
<a class="sourceLine" id="cb35-2" title="2">    M3Drop_genes,</a>
<a class="sourceLine" id="cb35-3" title="3">    expr_matrix,</a>
<a class="sourceLine" id="cb35-4" title="4">    <span class="dt">cell_labels =</span> celltype_labs</a>
<a class="sourceLine" id="cb35-5" title="5">)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/dropouts_files/figure-html/unnamed-chunk-19-1.png" style="display: block; margin: auto;" />
We can also consider how consistent each feature selection method is with the others using the Jaccard Index:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1">J &lt;-<span class="st"> </span><span class="kw">sum</span>(M3Drop_genes <span class="op">%in%</span><span class="st"> </span>HVG_genes)<span class="op">/</span><span class="kw">length</span>(<span class="kw">unique</span>(<span class="kw">c</span>(M3Drop_genes, HVG_genes)))</a></code></pre></div>
<p><strong>Exercise 7</strong></p>
<p>Plot the expression of the features for each of the other methods. Which appear to be differentially expressed? How consistent are the different methods for this dataset?</p>
</div>
</div>
<div id="pseudotime-analysis" class="section level2">
<h2><span class="header-section-number">8.4</span> Pseudotime analysis</h2>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1"><span class="kw">library</span>(SingleCellExperiment)</a>
<a class="sourceLine" id="cb37-2" title="2"><span class="kw">library</span>(TSCAN)</a>
<a class="sourceLine" id="cb37-3" title="3"><span class="kw">library</span>(M3Drop)</a>
<a class="sourceLine" id="cb37-4" title="4"><span class="kw">library</span>(monocle)</a>
<a class="sourceLine" id="cb37-5" title="5"><span class="kw">library</span>(destiny)</a>
<a class="sourceLine" id="cb37-6" title="6"><span class="kw">library</span>(SLICER)</a>
<a class="sourceLine" id="cb37-7" title="7"><span class="kw">library</span>(ouija)</a>
<a class="sourceLine" id="cb37-8" title="8"><span class="kw">library</span>(scater)</a>
<a class="sourceLine" id="cb37-9" title="9"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb37-10" title="10"><span class="kw">library</span>(ggthemes)</a>
<a class="sourceLine" id="cb37-11" title="11"><span class="kw">library</span>(ggbeeswarm)</a>
<a class="sourceLine" id="cb37-12" title="12"><span class="kw">library</span>(corrplot)</a>
<a class="sourceLine" id="cb37-13" title="13"><span class="kw">set.seed</span>(<span class="dv">1</span>)</a></code></pre></div>
<p>In many situations, one is studying a process where cells change
continuously. This includes, for example, many differentiation processes
taking place during development: following a stimulus, cells
will change from one cell-type to another. Ideally, we would like to
monitor the expression levels of an individual cell over
time. Unfortunately, such monitoring is not possible with scRNA-seq
since the cell is lysed (destroyed) when the RNA is extracted.</p>
<p>Instead, we must sample at multiple time-points and obtain snapshots
of the gene expression profiles. Since some of the cells will proceed
faster along the differentiation than others, each snapshot may
contain cells at varying points along the developmental
progression. We use statistical methods to order the cells along one
or more trajectories which represent the underlying developmental
trajectories, this ordering is referred to as “pseudotime”.</p>
<p>In this chapter we will consider five different tools: Monocle, TSCAN,
destiny, SLICER and ouija for ordering cells according to their pseudotime
development. To illustrate the methods we will be using a dataset on
mouse embryonic development <span class="citation">(Deng et al. <a href="#ref-Deng2014-mx">2014</a>)</span>. The dataset consists of
268 cells from 10 different time-points of early mouse development. In this case, there is no need for pseudotime alignment since the cell labels provide information about the development trajectory. Thus, the labels allow us to establish a ground truth so that we can evaluate and compare the different methods.</p>
<p>A recent review by Cannoodt et al provides a detailed summary of the
various computational methods for trajectory inference from
single-cell transcriptomics <span class="citation">(Cannoodt, Saelens, and Saeys <a href="#ref-Cannoodt2016-uj">2016</a>)</span>. They discuss several
tools, but unfortunately for our purposes many of these tools do not
have complete or well-maintained implementations, and/or are not
implemented in R.</p>
<p>Cannoodt et al cover:</p>
<ul>
<li>SCUBA - Matlab implementation</li>
<li>Wanderlust - Matlab (and requires registration to even download)</li>
<li>Wishbone - Python</li>
<li>SLICER - R, but package only available on Github</li>
<li>SCOUP - C++ command line tool</li>
<li>Waterfall - R, but one R script in supplement</li>
<li>Mpath - R pkg, but available as tar.gz on Github; function
documentation but no vignette/workflow</li>
<li>Monocle - Bioconductor package</li>
<li>TSCAN - Bioconductor package</li>
</ul>
<p>Unfortunately only two tools discussed (Monocle and TSCAN) meet the
gold standard of open-source software hosted in a reputable repository.</p>
<p>The following figures from the paper summarise some of the features of
the various tools.</p>
<div class="figure" style="text-align: center"><span id="fig:pseudotime-methods-description"></span>
<img src="figures/cannoodt_pseudotime_properties.png" alt="Descriptions of trajectory inference methods for single-cell transcriptomics data (Fig. 2 from Cannoodt et al, 2016)." width="90%" />
<p class="caption">
Figure 8.9: Descriptions of trajectory inference methods for single-cell transcriptomics data (Fig. 2 from Cannoodt et al, 2016).
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:pseudotime-methods"></span>
<img src="figures/cannoodt_pseudotime_methods.png" alt="Characterization of trajectory inference methods for single-cell transcriptomics data (Fig. 3 from Cannoodt et al, 2016)." width="90%" />
<p class="caption">
Figure 8.10: Characterization of trajectory inference methods for single-cell transcriptomics data (Fig. 3 from Cannoodt et al, 2016).
</p>
</div>
<div id="first-look-at-deng-data" class="section level3">
<h3><span class="header-section-number">8.4.1</span> First look at Deng data</h3>
<p>Let us take a first look at the Deng data, without yet applying sophisticated pseudotime methods. As the plot below shows, simple PCA does a very good job of displaying the structure in these data. It is only once we reach the blast cell types (“earlyblast”, “midblast”, “lateblast”) that PCA struggles to separate the distinct cell types.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1">deng_SCE &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;data/deng/deng-reads.rds&quot;</span>)</a>
<a class="sourceLine" id="cb38-2" title="2">deng_SCE<span class="op">$</span>cell_type2 &lt;-<span class="st"> </span><span class="kw">factor</span>(</a>
<a class="sourceLine" id="cb38-3" title="3">    deng_SCE<span class="op">$</span>cell_type2,</a>
<a class="sourceLine" id="cb38-4" title="4">    <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;zy&quot;</span>, <span class="st">&quot;early2cell&quot;</span>, <span class="st">&quot;mid2cell&quot;</span>, <span class="st">&quot;late2cell&quot;</span>,</a>
<a class="sourceLine" id="cb38-5" title="5">                        <span class="st">&quot;4cell&quot;</span>, <span class="st">&quot;8cell&quot;</span>, <span class="st">&quot;16cell&quot;</span>, <span class="st">&quot;earlyblast&quot;</span>,</a>
<a class="sourceLine" id="cb38-6" title="6">                        <span class="st">&quot;midblast&quot;</span>, <span class="st">&quot;lateblast&quot;</span>)</a>
<a class="sourceLine" id="cb38-7" title="7">)</a>
<a class="sourceLine" id="cb38-8" title="8">cellLabels &lt;-<span class="st"> </span>deng_SCE<span class="op">$</span>cell_type2</a>
<a class="sourceLine" id="cb38-9" title="9">deng &lt;-<span class="st"> </span><span class="kw">counts</span>(deng_SCE)</a>
<a class="sourceLine" id="cb38-10" title="10"><span class="kw">colnames</span>(deng) &lt;-<span class="st"> </span>cellLabels</a>
<a class="sourceLine" id="cb38-11" title="11">deng_SCE &lt;-<span class="st"> </span><span class="kw">runPCA</span>(deng_SCE)</a>
<a class="sourceLine" id="cb38-12" title="12"><span class="kw">plotPCA</span>(deng_SCE, <span class="dt">colour_by =</span> <span class="st">&quot;cell_type2&quot;</span>)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/data-overview-1.png" style="display: block; margin: auto;" />
PCA, here, provides a useful baseline for assessing different pseudotime methods. For a very naive pseudotime we can just take the co-ordinates of the first principal component.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1">deng_SCE<span class="op">$</span>PC1 &lt;-<span class="st"> </span><span class="kw">reducedDim</span>(deng_SCE, <span class="st">&quot;PCA&quot;</span>)[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb39-2" title="2"><span class="kw">ggplot</span>(<span class="kw">as.data.frame</span>(<span class="kw">colData</span>(deng_SCE)), <span class="kw">aes</span>(<span class="dt">x =</span> PC1, <span class="dt">y =</span> cell_type2, </a>
<a class="sourceLine" id="cb39-3" title="3">                              <span class="dt">colour =</span> cell_type2)) <span class="op">+</span></a>
<a class="sourceLine" id="cb39-4" title="4"><span class="st">    </span><span class="kw">geom_quasirandom</span>(<span class="dt">groupOnX =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb39-5" title="5"><span class="st">    </span><span class="kw">scale_color_tableau</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb39-6" title="6"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;First principal component&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Timepoint&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb39-7" title="7"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Cells ordered by first principal component&quot;</span>)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/pca-pseudotime-1.png" style="display: block; margin: auto;" /></p>
<p>As the plot above shows, PC1 struggles to correctly order cells early and late in the developmental timecourse, but overall does a relatively good job of ordering cells by developmental time.</p>
<p>Can bespoke pseudotime methods do better than naive application of PCA?</p>
</div>
<div id="tscan" class="section level3">
<h3><span class="header-section-number">8.4.2</span> TSCAN</h3>
<p>TSCAN combines clustering with pseudotime analysis. First it clusters the cells using <code>mclust</code>, which is based on a mixture of normal distributions. Then it builds a minimum spanning tree to connect the clusters. The branch of this tree that connects the largest number of clusters is the main branch which is used to determine pseudotime.</p>
<p>First we will try to use all genes to order the cells.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" title="1">procdeng &lt;-<span class="st"> </span>TSCAN<span class="op">::</span><span class="kw">preprocess</span>(deng)</a>
<a class="sourceLine" id="cb40-2" title="2"><span class="kw">colnames</span>(procdeng) &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(deng)</a>
<a class="sourceLine" id="cb40-3" title="3">dengclust &lt;-<span class="st"> </span>TSCAN<span class="op">::</span><span class="kw">exprmclust</span>(procdeng, <span class="dt">clusternum =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb40-4" title="4">TSCAN<span class="op">::</span><span class="kw">plotmclust</span>(dengclust)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/tscan-all-genes-1.png" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1">dengorderTSCAN &lt;-<span class="st"> </span>TSCAN<span class="op">::</span><span class="kw">TSCANorder</span>(dengclust, <span class="dt">orderonly =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb41-2" title="2">pseudotime_order_tscan &lt;-<span class="st"> </span><span class="kw">as.character</span>(dengorderTSCAN<span class="op">$</span>sample_name)</a>
<a class="sourceLine" id="cb41-3" title="3">deng_SCE<span class="op">$</span>pseudotime_order_tscan &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb41-4" title="4">deng_SCE<span class="op">$</span>pseudotime_order_tscan[<span class="kw">as.numeric</span>(dengorderTSCAN<span class="op">$</span>sample_name)] &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb41-5" title="5"><span class="st">    </span>dengorderTSCAN<span class="op">$</span>Pseudotime</a></code></pre></div>
<p>Frustratingly, TSCAN only provides pseudotime values for 221 of 268 cells, silently returning missing values for non-assigned cells.</p>
<p>Again, we examine which timepoints have been assigned to each state:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" title="1">cellLabels[dengclust<span class="op">$</span>clusterid <span class="op">==</span><span class="st"> </span><span class="dv">10</span>]</a>
<a class="sourceLine" id="cb42-2" title="2"><span class="kw">ggplot</span>(<span class="kw">as.data.frame</span>(<span class="kw">colData</span>(deng_SCE)), </a>
<a class="sourceLine" id="cb42-3" title="3">       <span class="kw">aes</span>(<span class="dt">x =</span> pseudotime_order_tscan, </a>
<a class="sourceLine" id="cb42-4" title="4">           <span class="dt">y =</span> cell_type2, <span class="dt">colour =</span> cell_type2)) <span class="op">+</span></a>
<a class="sourceLine" id="cb42-5" title="5"><span class="st">    </span><span class="kw">geom_quasirandom</span>(<span class="dt">groupOnX =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb42-6" title="6"><span class="st">    </span><span class="kw">scale_color_tableau</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb42-7" title="7"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;TSCAN pseudotime&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Timepoint&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb42-8" title="8"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Cells ordered by TSCAN pseudotime&quot;</span>)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/tscan-vs-truth-1.png" style="display: block; margin: auto;" /></p>
<p>TSCAN gets the development trajectory the “wrong way around”, in the sense that later pseudotime values correspond to early timepoints and vice versa. This is not inherently a problem (it is easy enough to reverse the ordering to get the intuitive interpretation of pseudotime), but overall it would be a stretch to suggest that TSCAN performs better than PCA on this dataset. (As it is a PCA-based method, perhaps this is not entirely surprising.)</p>
<p><strong>Exercise 1</strong> Compare results for different numbers of clusters (<code>clusternum</code>).</p>
</div>
<div id="monocle" class="section level3">
<h3><span class="header-section-number">8.4.3</span> monocle</h3>
<p>Monocle skips the clustering stage of TSCAN and directly builds a
minimum spanning tree on a reduced dimension representation of the
cells to connect all cells. Monocle then identifies the longest path
in this tree to determine pseudotime. If the data contains diverging
trajectories (i.e. one cell type differentiates into two different
cell-types), monocle can identify these. Each of the resulting forked paths is
defined as a separate cell state.</p>
<p>Unfortunately, Monocle does not work when all the genes are used, so
we must carry out feature selection. First, we use M3Drop:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" title="1">m3dGenes &lt;-<span class="st"> </span><span class="kw">as.character</span>(</a>
<a class="sourceLine" id="cb43-2" title="2">    <span class="kw">M3DropFeatureSelection</span>(deng)<span class="op">$</span>Gene</a>
<a class="sourceLine" id="cb43-3" title="3">)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/m3d-select-genes-1.png" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" title="1">d &lt;-<span class="st"> </span>deng[<span class="kw">which</span>(<span class="kw">rownames</span>(deng) <span class="op">%in%</span><span class="st"> </span>m3dGenes), ]</a>
<a class="sourceLine" id="cb44-2" title="2">d &lt;-<span class="st"> </span>d[<span class="op">!</span><span class="kw">duplicated</span>(<span class="kw">rownames</span>(d)), ]</a></code></pre></div>
<p>Now run monocle:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" title="1"><span class="kw">colnames</span>(d) &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(d)</a>
<a class="sourceLine" id="cb45-2" title="2">geneNames &lt;-<span class="st"> </span><span class="kw">rownames</span>(d)</a>
<a class="sourceLine" id="cb45-3" title="3"><span class="kw">rownames</span>(d) &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(d)</a>
<a class="sourceLine" id="cb45-4" title="4">pd &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">timepoint =</span> cellLabels)</a>
<a class="sourceLine" id="cb45-5" title="5">pd &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&quot;AnnotatedDataFrame&quot;</span>, <span class="dt">data=</span>pd)</a>
<a class="sourceLine" id="cb45-6" title="6">fd &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">gene_short_name =</span> geneNames)</a>
<a class="sourceLine" id="cb45-7" title="7">fd &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&quot;AnnotatedDataFrame&quot;</span>, <span class="dt">data=</span>fd)</a>
<a class="sourceLine" id="cb45-8" title="8"></a>
<a class="sourceLine" id="cb45-9" title="9">dCellData &lt;-<span class="st"> </span><span class="kw">newCellDataSet</span>(d, <span class="dt">phenoData =</span> pd, <span class="dt">featureData =</span> fd, <span class="dt">expressionFamily =</span> <span class="kw">tobit</span>())</a>
<a class="sourceLine" id="cb45-10" title="10">dCellData &lt;-<span class="st"> </span><span class="kw">setOrderingFilter</span>(dCellData, <span class="kw">which</span>(geneNames <span class="op">%in%</span><span class="st"> </span>m3dGenes))</a>
<a class="sourceLine" id="cb45-11" title="11">dCellData &lt;-<span class="st"> </span><span class="kw">estimateSizeFactors</span>(dCellData)</a>
<a class="sourceLine" id="cb45-12" title="12">dCellDataSet &lt;-<span class="st"> </span><span class="kw">reduceDimension</span>(dCellData, <span class="dt">pseudo_expr =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb45-13" title="13">dCellDataSet &lt;-<span class="st"> </span><span class="kw">orderCells</span>(dCellDataSet, <span class="dt">reverse =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb45-14" title="14"><span class="kw">plot_cell_trajectory</span>(dCellDataSet)</a>
<a class="sourceLine" id="cb45-15" title="15"><span class="co"># Store the ordering</span></a>
<a class="sourceLine" id="cb45-16" title="16">pseudotime_monocle &lt;-</a>
<a class="sourceLine" id="cb45-17" title="17"><span class="st">    </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb45-18" title="18">        <span class="dt">Timepoint =</span> <span class="kw">phenoData</span>(dCellDataSet)<span class="op">$</span>timepoint,</a>
<a class="sourceLine" id="cb45-19" title="19">        <span class="dt">pseudotime =</span> <span class="kw">phenoData</span>(dCellDataSet)<span class="op">$</span>Pseudotime,</a>
<a class="sourceLine" id="cb45-20" title="20">        <span class="dt">State =</span> <span class="kw">phenoData</span>(dCellDataSet)<span class="op">$</span>State</a>
<a class="sourceLine" id="cb45-21" title="21">    )</a>
<a class="sourceLine" id="cb45-22" title="22"><span class="kw">rownames</span>(pseudotime_monocle) &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(d)</a>
<a class="sourceLine" id="cb45-23" title="23">pseudotime_order_monocle &lt;-</a>
<a class="sourceLine" id="cb45-24" title="24"><span class="st">    </span><span class="kw">rownames</span>(pseudotime_monocle[<span class="kw">order</span>(pseudotime_monocle<span class="op">$</span>pseudotime), ])</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/monocle-all-genes-1.png" style="display: block; margin: auto;" />
We can again compare the inferred pseudotime to the known sampling timepoints.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" title="1">deng_SCE<span class="op">$</span>pseudotime_monocle &lt;-<span class="st"> </span>pseudotime_monocle<span class="op">$</span>pseudotime</a>
<a class="sourceLine" id="cb46-2" title="2"><span class="kw">ggplot</span>(<span class="kw">as.data.frame</span>(<span class="kw">colData</span>(deng_SCE)), </a>
<a class="sourceLine" id="cb46-3" title="3">       <span class="kw">aes</span>(<span class="dt">x =</span> pseudotime_monocle, </a>
<a class="sourceLine" id="cb46-4" title="4">           <span class="dt">y =</span> cell_type2, <span class="dt">colour =</span> cell_type2)) <span class="op">+</span></a>
<a class="sourceLine" id="cb46-5" title="5"><span class="st">    </span><span class="kw">geom_quasirandom</span>(<span class="dt">groupOnX =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb46-6" title="6"><span class="st">    </span><span class="kw">scale_color_tableau</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb46-7" title="7"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;monocle pseudotime&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Timepoint&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb46-8" title="8"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Cells ordered by monocle pseudotime&quot;</span>)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/monocle-vs-truth-1.png" style="display: block; margin: auto;" /></p>
<p>Monocle - at least with its default settings - performs poorly on these data. The “late2cell” group is completely separated from the “zy”, “early2cell” and “mid2cell” cells (though these are correctly ordered), and there is no separation at all of “4cell”, “8cell”, “16cell” or any blast cell groups.</p>
</div>
<div id="diffusion-maps" class="section level3">
<h3><span class="header-section-number">8.4.4</span> Diffusion maps</h3>
<p><a href="https://en.wikipedia.org/wiki/Diffusion_map">Diffusion maps</a> were introduced by <a href="http://www.sciencedirect.com/science/article/pii/S1063520306000546">Ronald Coifman and Stephane Lafon</a>, and the underlying idea is to assume that the data are samples from a diffusion process. The method infers the low-dimensional manifold by estimating the eigenvalues and eigenvectors for the diffusion operator related to the data.</p>
<p><a href="https://academic.oup.com/bioinformatics/article/32/8/1241/1744143">Angerer et al</a> have applied the diffusion maps concept to the analysis of single-cell RNA-seq data to create an R package called <a href="http://bioconductor.org/packages/destiny">destiny</a>.</p>
<p>We will take the ranko prder of cells in the first diffusion map component as “diffusion map pseudotime” here.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" title="1">deng &lt;-<span class="st"> </span><span class="kw">logcounts</span>(deng_SCE)</a>
<a class="sourceLine" id="cb47-2" title="2"><span class="kw">colnames</span>(deng) &lt;-<span class="st"> </span>cellLabels</a>
<a class="sourceLine" id="cb47-3" title="3">dm &lt;-<span class="st"> </span><span class="kw">DiffusionMap</span>(<span class="kw">t</span>(deng))</a>
<a class="sourceLine" id="cb47-4" title="4"></a>
<a class="sourceLine" id="cb47-5" title="5">tmp &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">DC1 =</span> <span class="kw">eigenvectors</span>(dm)[,<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb47-6" title="6">                  <span class="dt">DC2 =</span> <span class="kw">eigenvectors</span>(dm)[,<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb47-7" title="7">                  <span class="dt">Timepoint =</span> deng_SCE<span class="op">$</span>cell_type2)</a>
<a class="sourceLine" id="cb47-8" title="8"><span class="kw">ggplot</span>(tmp, <span class="kw">aes</span>(<span class="dt">x =</span> DC1, <span class="dt">y =</span> DC2, <span class="dt">colour =</span> Timepoint)) <span class="op">+</span></a>
<a class="sourceLine" id="cb47-9" title="9"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_color_tableau</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb47-10" title="10"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Diffusion component 1&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb47-11" title="11"><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Diffusion component 2&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb47-12" title="12"><span class="st">    </span><span class="kw">theme_classic</span>()</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/destiny-deng-1.png" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" title="1">deng_SCE<span class="op">$</span>pseudotime_diffusionmap &lt;-<span class="st"> </span><span class="kw">rank</span>(<span class="kw">eigenvectors</span>(dm)[,<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb48-2" title="2"><span class="kw">ggplot</span>(<span class="kw">as.data.frame</span>(<span class="kw">colData</span>(deng_SCE)), </a>
<a class="sourceLine" id="cb48-3" title="3">       <span class="kw">aes</span>(<span class="dt">x =</span> pseudotime_diffusionmap, </a>
<a class="sourceLine" id="cb48-4" title="4">           <span class="dt">y =</span> cell_type2, <span class="dt">colour =</span> cell_type2)) <span class="op">+</span></a>
<a class="sourceLine" id="cb48-5" title="5"><span class="st">    </span><span class="kw">geom_quasirandom</span>(<span class="dt">groupOnX =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb48-6" title="6"><span class="st">    </span><span class="kw">scale_color_tableau</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb48-7" title="7"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Diffusion map pseudotime (first diffusion map component)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb48-8" title="8"><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Timepoint&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb48-9" title="9"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Cells ordered by diffusion map pseudotime&quot;</span>)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/destiny-deng-2.png" style="display: block; margin: auto;" /></p>
<p>Like the other methods, using the first diffusion map component from destiny as pseudotime does a good job at ordering the early time-points (if we take high values as “earlier” in developement), but it is unable to distinguish the later ones.</p>
<p><strong>Exercise 2</strong> Do you get a better resolution between the later time points by considering additional eigenvectors?</p>
<p><strong>Exercise 3</strong> How does the ordering change if you only use the genes identified by M3Drop?</p>
</div>
<div id="slicer" class="section level3">
<h3><span class="header-section-number">8.4.5</span> SLICER</h3>
<p>The SLICER method is an algorithm for constructing trajectories that
describe gene expression changes during a sequential biological
process, just as Monocle and TSCAN are. SLICER is designed to capture
highly nonlinear gene expression changes, automatically select genes
related to the process, and detect multiple branch and loop features
in the trajectory <span class="citation">(Welch, Hartemink, and Prins <a href="#ref-Welch2016-jr">2016</a>)</span>. The SLICER R package is available
from its <a href="https://github.com/jw156605/SLICER">GitHub repository</a> and
can be installed from there using the <code>devtools</code> package.</p>
<p>We use the <code>select_genes</code> function in SLICER to automatically select
the genes to use in builing the cell trajectory. The function uses
“neighbourhood variance” to identify genes that vary smoothly, rather
than fluctuating randomly, across the set of cells. Following this, we
determine which value of “k” (number of nearest neighbours) yields an embedding that
most resembles a trajectory. Then we estimate the <a href="https://en.wikipedia.org/wiki/Nonlinear_dimensionality_reduction">locally linear
embedding</a> of the cells.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" title="1"><span class="kw">library</span>(<span class="st">&quot;lle&quot;</span>)</a>
<a class="sourceLine" id="cb49-2" title="2">slicer_genes &lt;-<span class="st"> </span><span class="kw">select_genes</span>(<span class="kw">t</span>(deng))</a>
<a class="sourceLine" id="cb49-3" title="3">k &lt;-<span class="st"> </span><span class="kw">select_k</span>(<span class="kw">t</span>(deng[slicer_genes,]), <span class="dt">kmin =</span> <span class="dv">30</span>, <span class="dt">kmax=</span><span class="dv">60</span>)</a>
<a class="sourceLine" id="cb49-4" title="4">slicer_traj_lle &lt;-<span class="st"> </span><span class="kw">lle</span>(<span class="kw">t</span>(deng[slicer_genes,]), <span class="dt">m =</span> <span class="dv">2</span>, k)<span class="op">$</span>Y</a>
<a class="sourceLine" id="cb49-5" title="5"><span class="kw">reducedDim</span>(deng_SCE, <span class="st">&quot;LLE&quot;</span>) &lt;-<span class="st"> </span>slicer_traj_lle</a>
<a class="sourceLine" id="cb49-6" title="6"><span class="kw">plotReducedDim</span>(deng_SCE, <span class="dt">use_dimred =</span> <span class="st">&quot;LLE&quot;</span>, <span class="dt">colour_by =</span> <span class="st">&quot;cell_type2&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb49-7" title="7"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;LLE component 1&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;LLE component 2&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb49-8" title="8"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Locally linear embedding of cells from SLICER&quot;</span>)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/slicer-analyis-1.png" style="display: block; margin: auto;" /></p>
<p>With the locally linear embedding computed we can construct a
k-nearest neighbour graph that is fully connected. This plot displays
a (yellow) circle for each cell, with the cell ID number overlaid in
blue. Here we show the graph computed using 10 nearest
neighbours. Here, SLICER appears to detect one major trajectory with
one branch.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" title="1">slicer_traj_graph &lt;-<span class="st"> </span><span class="kw">conn_knn_graph</span>(slicer_traj_lle, <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb50-2" title="2"><span class="kw">plot</span>(slicer_traj_graph, <span class="dt">main =</span> <span class="st">&quot;Fully connected kNN graph from SLICER&quot;</span>)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/slicer-build-graph-1.png" style="display: block; margin: auto;" /></p>
<p>From this graph we can identify “extreme” cells that are candidates
for start/end cells in the trajectory.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" title="1">ends &lt;-<span class="st"> </span><span class="kw">find_extreme_cells</span>(slicer_traj_graph, slicer_traj_lle)</a>
<a class="sourceLine" id="cb51-2" title="2">start &lt;-<span class="st"> </span>ends[<span class="dv">1</span>]</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/slicer-1.png" style="display: block; margin: auto;" /></p>
<p>Having defined a start cell we can order the cells in the estimated pseudotime.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" title="1">pseudotime_order_slicer &lt;-<span class="st"> </span><span class="kw">cell_order</span>(slicer_traj_graph, start)</a>
<a class="sourceLine" id="cb52-2" title="2">branches &lt;-<span class="st"> </span><span class="kw">assign_branches</span>(slicer_traj_graph, start)</a>
<a class="sourceLine" id="cb52-3" title="3"></a>
<a class="sourceLine" id="cb52-4" title="4">pseudotime_slicer &lt;-</a>
<a class="sourceLine" id="cb52-5" title="5"><span class="st">    </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb52-6" title="6">        <span class="dt">Timepoint =</span> cellLabels,</a>
<a class="sourceLine" id="cb52-7" title="7">        <span class="dt">pseudotime =</span> <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb52-8" title="8">        <span class="dt">State =</span> branches</a>
<a class="sourceLine" id="cb52-9" title="9">    )</a>
<a class="sourceLine" id="cb52-10" title="10">pseudotime_slicer<span class="op">$</span>pseudotime[pseudotime_order_slicer] &lt;-</a>
<a class="sourceLine" id="cb52-11" title="11"><span class="st">    </span><span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(pseudotime_order_slicer)</a>
<a class="sourceLine" id="cb52-12" title="12">deng_SCE<span class="op">$</span>pseudotime_slicer &lt;-<span class="st"> </span>pseudotime_slicer<span class="op">$</span>pseudotime</a></code></pre></div>
<p>We can again compare the inferred pseudotime to the known sampling
timepoints. SLICER does not provide a pseudotime value per se, just an
ordering of cells.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" title="1"><span class="kw">ggplot</span>(<span class="kw">as.data.frame</span>(<span class="kw">colData</span>(deng_SCE)), </a>
<a class="sourceLine" id="cb53-2" title="2">       <span class="kw">aes</span>(<span class="dt">x =</span> pseudotime_slicer, </a>
<a class="sourceLine" id="cb53-3" title="3">           <span class="dt">y =</span> cell_type2, <span class="dt">colour =</span> cell_type2)) <span class="op">+</span></a>
<a class="sourceLine" id="cb53-4" title="4"><span class="st">    </span><span class="kw">geom_quasirandom</span>(<span class="dt">groupOnX =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb53-5" title="5"><span class="st">    </span><span class="kw">scale_color_tableau</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb53-6" title="6"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;SLICER pseudotime (cell ordering)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb53-7" title="7"><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Timepoint&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb53-8" title="8"><span class="st">    </span><span class="kw">theme_classic</span>()</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/slicer-vs-truth-1.png" style="display: block; margin: auto;" />
Like the previous method, SLICER here provides a good ordering for the
early time points. It places “16cell” cells before “8cell” cells, but provides better ordering for blast cells than many of the earlier methods.</p>
<p><strong>Exercise 4</strong> How do the results change for different k? (e.g. k = 5) What about changing the number of nearest neighbours in
the call to <code>conn_knn_graph</code>?</p>
<p><strong>Exercise 5</strong> How does the ordering change if you use a different set
of genes from those chosen by SLICER (e.g. the genes identified by M3Drop)?</p>
</div>
<div id="ouija" class="section level3">
<h3><span class="header-section-number">8.4.6</span> Ouija</h3>
<p>Ouija (<a href="http://kieranrcampbell.github.io/ouija/" class="uri">http://kieranrcampbell.github.io/ouija/</a>) takes a different approach from the pseudotime estimation methods we have looked at so far. Earlier methods have all been “unsupervised”, which is to say that apart from perhaps selecting informative genes we do not supply the method with any prior information about how we expect certain genes or the trajectory as a whole to behave.</p>
<p>Ouija, in contrast, is a probabilistic framework that allows for interpretable learning of single-cell pseudotimes using only small panels of marker genes. This method:</p>
<ul>
<li>infers pseudotimes from a small number of marker genes letting you understand why the pseudotimes have been learned in terms of those genes;</li>
<li>provides parameter estimates (with uncertainty) for interpretable gene regulation behaviour (such as the peak time or the upregulation time);</li>
<li>has a Bayesian hypothesis test to find genes regulated before others along the trajectory;</li>
<li>identifies metastable states, ie discrete cell types along the continuous trajectory.</li>
</ul>
<p>We will supply the following marker genes to Ouija (with timepoints where they are expected to be highly expressed):</p>
<ul>
<li>Early timepoints: Dazl, Rnf17, Sycp3, Nanog, Pou5f1, Fgf8, Egfr, Bmp5, Bmp15</li>
<li>Mid timepoints: Zscan4b, Foxa1, Prdm14, Sox21</li>
<li>Late timepoints: Creb3, Gpx4, Krt8, Elf5, Eomes, Cdx2, Tdgf1, Gdf3</li>
</ul>
<p>With Ouija we can model genes as either exhibiting monotonic up or down regulation (known as switch-like behaviour), or transient behaviour where the gene briefly peaks. By default, Ouija assumes all genes exhibit switch-like behaviour (the authors assure us not to worry if we get it wrong - the noise model means incorrectly specifying a transient gene as switch-like has minimal effect).</p>
<p>Here we can “cheat” a little and check that our selected marker genes do actually identify different timepoints of the differentiation process.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" title="1">ouija_markers_down &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Dazl&quot;</span>, <span class="st">&quot;Rnf17&quot;</span>, <span class="st">&quot;Sycp3&quot;</span>, <span class="st">&quot;Fgf8&quot;</span>, </a>
<a class="sourceLine" id="cb54-2" title="2">                        <span class="st">&quot;Egfr&quot;</span>, <span class="st">&quot;Bmp5&quot;</span>, <span class="st">&quot;Bmp15&quot;</span>, <span class="st">&quot;Pou5f1&quot;</span>)</a>
<a class="sourceLine" id="cb54-3" title="3">ouija_markers_up &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Creb3&quot;</span>, <span class="st">&quot;Gpx4&quot;</span>, <span class="st">&quot;Krt8&quot;</span>, <span class="st">&quot;Elf5&quot;</span>, <span class="st">&quot;Cdx2&quot;</span>, </a>
<a class="sourceLine" id="cb54-4" title="4">                      <span class="st">&quot;Tdgf1&quot;</span>, <span class="st">&quot;Gdf3&quot;</span>, <span class="st">&quot;Eomes&quot;</span>)</a>
<a class="sourceLine" id="cb54-5" title="5">ouija_markers_transient &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Zscan4b&quot;</span>, <span class="st">&quot;Foxa1&quot;</span>, <span class="st">&quot;Prdm14&quot;</span>, <span class="st">&quot;Sox21&quot;</span>)</a>
<a class="sourceLine" id="cb54-6" title="6">ouija_markers &lt;-<span class="st"> </span><span class="kw">c</span>(ouija_markers_down, ouija_markers_up, </a>
<a class="sourceLine" id="cb54-7" title="7">                   ouija_markers_transient)</a>
<a class="sourceLine" id="cb54-8" title="8"><span class="kw">plotExpression</span>(deng_SCE, ouija_markers, <span class="dt">x =</span> <span class="st">&quot;cell_type2&quot;</span>, <span class="dt">colour_by =</span> <span class="st">&quot;cell_type2&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb54-9" title="9"><span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">60</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/ouija-response-type-1.png" style="display: block; margin: auto;" />
In order to fit the pseudotimes wesimply call <code>ouija</code>, passing in the expected response types. Note that if no response types are provided then they are all assumed to be switch-like by default, which we will do here. The input to Ouija can be a cell-by-gene matrix of non-negative expression values, or an ExpressionSet object, or, happily, by selecting the <code>logcounts</code> values from a SingleCellExperiment object.</p>
<p>We can apply prior information about whether genes are up- or down-regulated across the differentiation process, and also provide prior information about when the switch in expression or a peak in expression is likely to occur.</p>
<p>We can fit the Ouija model using either:</p>
<ul>
<li>Hamiltonian Monte Carlo (HMC) - full MCMC inference where gradient information of the log-posterior is used to “guide” the random walk through the parameter space, or</li>
<li>Automatic Differentiation Variational Bayes (ADVI or simply VI) - approximate inference where the KL divergence to an approximate distribution is minimised.</li>
</ul>
<p>In general, HMC will provide more accurate inference with approximately correct posterior variance for all parameters. However, VB is orders of magnitude quicker than HMC and while it may underestimate posterior variance, the Ouija authors suggest that anecdotally it often performs as well as HMC for discovering posterior pseudotimes.</p>
<p>To help the Ouija model, we provide it with prior information about the strength of switches for up- and down-regulated genes. By setting switch strength to -10 for down-regulated genes and 10 for up-regulated genes with a prior strength standard deviation of 0.5 we are telling the model that we are confident about the expected behaviour of these genes across the differentiation process.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" title="1"><span class="kw">options</span>(<span class="dt">mc.cores =</span> parallel<span class="op">::</span><span class="kw">detectCores</span>())</a>
<a class="sourceLine" id="cb55-2" title="2">response_type &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;switch&quot;</span>, <span class="kw">length</span>(ouija_markers_down) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb55-3" title="3"><span class="st">                           </span><span class="kw">length</span>(ouija_markers_up)), </a>
<a class="sourceLine" id="cb55-4" title="4">                   <span class="kw">rep</span>(<span class="st">&quot;transient&quot;</span>, <span class="kw">length</span>(ouija_markers_transient)))</a>
<a class="sourceLine" id="cb55-5" title="5">switch_strengths &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="op">-</span><span class="dv">10</span>, <span class="kw">length</span>(ouija_markers_down)),</a>
<a class="sourceLine" id="cb55-6" title="6">                      <span class="kw">rep</span>(<span class="dv">10</span>, <span class="kw">length</span>(ouija_markers_up)))</a>
<a class="sourceLine" id="cb55-7" title="7">switch_strength_sd &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="fl">0.5</span>, <span class="kw">length</span>(ouija_markers_down)),</a>
<a class="sourceLine" id="cb55-8" title="8">                      <span class="kw">rep</span>(<span class="fl">0.5</span>, <span class="kw">length</span>(ouija_markers_up)))</a>
<a class="sourceLine" id="cb55-9" title="9">garbage &lt;-<span class="st"> </span><span class="kw">capture.output</span>(</a>
<a class="sourceLine" id="cb55-10" title="10">    oui_vb &lt;-<span class="st"> </span><span class="kw">ouija</span>(deng_SCE[ouija_markers,],</a>
<a class="sourceLine" id="cb55-11" title="11">                    <span class="dt">single_cell_experiment_assay =</span> <span class="st">&quot;logcounts&quot;</span>, </a>
<a class="sourceLine" id="cb55-12" title="12">                    <span class="dt">response_type =</span> response_type,</a>
<a class="sourceLine" id="cb55-13" title="13">                    <span class="dt">switch_strengths =</span> switch_strengths,</a>
<a class="sourceLine" id="cb55-14" title="14">                    <span class="dt">switch_strength_sd =</span> switch_strength_sd,</a>
<a class="sourceLine" id="cb55-15" title="15">                    <span class="dt">inference_type =</span> <span class="st">&quot;vb&quot;</span>)</a>
<a class="sourceLine" id="cb55-16" title="16">)</a>
<a class="sourceLine" id="cb55-17" title="17"></a>
<a class="sourceLine" id="cb55-18" title="18"><span class="kw">print</span>(oui_vb)</a></code></pre></div>
<p>We can plot the gene expression over pseudotime along with the maximum a posteriori (MAP) estimates of the mean function (the sigmoid or Gaussian transient function) using the plot_expression function.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" title="1"><span class="kw">plot_expression</span>(oui_vb)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/ouija-plot-exprs-1.png" style="display: block; margin: auto;" /></p>
<p>We can also visualise when in the trajectory gene regulation behaviour occurs, either in the form of the switch time or the peak time (for switch-like or transient genes) using the plot_switch_times and plot_transient_times functions:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" title="1"><span class="kw">plot_switch_times</span>(oui_vb)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/ouija-plot-switch-times-1.png" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" title="1"><span class="kw">plot_peak_times</span>(oui_vb)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/ouija-plot-switch-times-2.png" style="display: block; margin: auto;" />
Identify metastable states using consistency matrices.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" title="1">cmo &lt;-<span class="st"> </span><span class="kw">consistency_matrix</span>(oui_vb)</a>
<a class="sourceLine" id="cb59-2" title="2"><span class="kw">plot_consistency</span>(oui_vb)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/ouija-consistency-1.png" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" title="1">cell_classifications &lt;-<span class="st"> </span><span class="kw">cluster_consistency</span>(cmo)</a></code></pre></div>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" title="1">map_pst &lt;-<span class="st"> </span><span class="kw">map_pseudotime</span>(oui_vb)</a>
<a class="sourceLine" id="cb61-2" title="2">ouija_pseudotime &lt;-<span class="st"> </span><span class="kw">data.frame</span>(map_pst, cell_classifications)</a>
<a class="sourceLine" id="cb61-3" title="3"></a>
<a class="sourceLine" id="cb61-4" title="4"><span class="kw">ggplot</span>(ouija_pseudotime, <span class="kw">aes</span>(<span class="dt">x =</span> map_pst, <span class="dt">y =</span> cell_classifications)) <span class="op">+</span></a>
<a class="sourceLine" id="cb61-5" title="5"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb61-6" title="6"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;MAP pseudotime&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb61-7" title="7"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Cell classification&quot;</span>)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/ouija-pseudotime-1.png" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" title="1">deng_SCE<span class="op">$</span>pseudotime_ouija &lt;-<span class="st"> </span>ouija_pseudotime<span class="op">$</span>map_pst</a>
<a class="sourceLine" id="cb62-2" title="2">deng_SCE<span class="op">$</span>ouija_cell_class &lt;-<span class="st"> </span>ouija_pseudotime<span class="op">$</span>cell_classifications</a>
<a class="sourceLine" id="cb62-3" title="3"></a>
<a class="sourceLine" id="cb62-4" title="4"><span class="kw">ggplot</span>(<span class="kw">as.data.frame</span>(<span class="kw">colData</span>(deng_SCE)), </a>
<a class="sourceLine" id="cb62-5" title="5">       <span class="kw">aes</span>(<span class="dt">x =</span> pseudotime_ouija, </a>
<a class="sourceLine" id="cb62-6" title="6">           <span class="dt">y =</span> cell_type2, <span class="dt">colour =</span> cell_type2)) <span class="op">+</span></a>
<a class="sourceLine" id="cb62-7" title="7"><span class="st">    </span><span class="kw">geom_quasirandom</span>(<span class="dt">groupOnX =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb62-8" title="8"><span class="st">    </span><span class="kw">scale_color_tableau</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb62-9" title="9"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Ouija pseudotime&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb62-10" title="10"><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Timepoint&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb62-11" title="11"><span class="st">    </span><span class="kw">theme_classic</span>()</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/ouija-pseudotime-2.png" style="display: block; margin: auto;" /></p>
<p>Ouija does quite well in the ordering of the cells here, although it can be sensitive to the choice of marker genes and prior information supplied. How do the results change if you select different marker genes or change the priors?</p>
<p>Ouija identifies four metastable states here, which we might annotate as “zygote/2cell”, “4/8/16 cell”, “blast1” and “blast2”.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" title="1"><span class="kw">ggplot</span>(<span class="kw">as.data.frame</span>(<span class="kw">colData</span>(deng_SCE)), </a>
<a class="sourceLine" id="cb63-2" title="2">       <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.factor</span>(ouija_cell_class), </a>
<a class="sourceLine" id="cb63-3" title="3">           <span class="dt">y =</span> pseudotime_ouija, <span class="dt">colour =</span> cell_type2)) <span class="op">+</span></a>
<a class="sourceLine" id="cb63-4" title="4"><span class="st">    </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb63-5" title="5"><span class="st">    </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb63-6" title="6"><span class="st">    </span><span class="kw">scale_color_tableau</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb63-7" title="7"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Ouija cell classification&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb63-8" title="8"><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Ouija pseudotime&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb63-9" title="9"><span class="st">    </span><span class="kw">theme_classic</span>()</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/ouija-states-1.png" style="display: block; margin: auto;" />
A common analysis is to work out the regulation orderings of genes. For example, is gene A upregulated before gene B? Does gene C peak before the downregulation of gene D? Ouija answers these questions in terms of a Bayesian hypothesis test of whether the difference in regulation timing (either switch time or peak time) is significantly different to 0. This is collated using the gene_regulation function.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" title="1">gene_regs &lt;-<span class="st"> </span><span class="kw">gene_regulation</span>(oui_vb)</a>
<a class="sourceLine" id="cb64-2" title="2"><span class="kw">head</span>(gene_regs)</a></code></pre></div>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" title="1"><span class="co">## # A tibble: 6 x 7</span></a>
<a class="sourceLine" id="cb65-2" title="2"><span class="co">## # Groups:   label, gene_A [6]</span></a>
<a class="sourceLine" id="cb65-3" title="3"><span class="co">##   label         gene_A gene_B mean_difference lower_95 upper_95 significant</span></a>
<a class="sourceLine" id="cb65-4" title="4"><span class="co">##   &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;            &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;lgl&gt;      </span></a>
<a class="sourceLine" id="cb65-5" title="5"><span class="co">## 1 Bmp15 - Cdx2  Bmp15  Cdx2           -0.0658 -1.17e-1  -0.0136 TRUE       </span></a>
<a class="sourceLine" id="cb65-6" title="6"><span class="co">## 2 Bmp15 - Creb3 Bmp15  Creb3           0.266   1.96e-1   0.321  TRUE       </span></a>
<a class="sourceLine" id="cb65-7" title="7"><span class="co">## 3 Bmp15 - Elf5  Bmp15  Elf5           -0.665  -7.03e-1  -0.622  TRUE       </span></a>
<a class="sourceLine" id="cb65-8" title="8"><span class="co">## 4 Bmp15 - Eomes Bmp15  Eomes           0.0765 -1.30e-2   0.150  FALSE      </span></a>
<a class="sourceLine" id="cb65-9" title="9"><span class="co">## 5 Bmp15 - Foxa1 Bmp15  Foxa1          -0.0157 -4.95e-2   0.0128 FALSE      </span></a>
<a class="sourceLine" id="cb65-10" title="10"><span class="co">## 6 Bmp15 - Gdf3  Bmp15  Gdf3            0.0592  2.06e-4   0.114  TRUE</span></a></code></pre></div>
<p>What conclusions can you draw from the gene regulation output from Ouija?</p>
<p>If you have time, you might try the HMC inference method and see if that changes the Ouija results in any way.</p>
</div>
<div id="comparison-of-the-methods" class="section level3">
<h3><span class="header-section-number">8.4.7</span> Comparison of the methods</h3>
<p>How do the trajectories inferred by TSCAN, Monocle, Diffusion Map, SLICER and Ouija compare?</p>
<p>TSCAN and Diffusion Map methods get the trajectory the “wrong way round”, so we’ll adjust that for these comparisons.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" title="1">df_pseudotime &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(</a>
<a class="sourceLine" id="cb66-2" title="2">    <span class="kw">colData</span>(deng_SCE)[, <span class="kw">grep</span>(<span class="st">&quot;pseudotime&quot;</span>, <span class="kw">colnames</span>(<span class="kw">colData</span>(deng_SCE)))]</a>
<a class="sourceLine" id="cb66-3" title="3">)</a>
<a class="sourceLine" id="cb66-4" title="4"><span class="kw">colnames</span>(df_pseudotime) &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;pseudotime_&quot;</span>, <span class="st">&quot;&quot;</span>, </a>
<a class="sourceLine" id="cb66-5" title="5">                                <span class="kw">colnames</span>(df_pseudotime))</a>
<a class="sourceLine" id="cb66-6" title="6">df_pseudotime<span class="op">$</span>PC1 &lt;-<span class="st"> </span>deng_SCE<span class="op">$</span>PC1</a>
<a class="sourceLine" id="cb66-7" title="7">df_pseudotime<span class="op">$</span>order_tscan &lt;-<span class="st"> </span><span class="op">-</span>df_pseudotime<span class="op">$</span>order_tscan</a>
<a class="sourceLine" id="cb66-8" title="8">df_pseudotime<span class="op">$</span>diffusionmap &lt;-<span class="st"> </span><span class="op">-</span>df_pseudotime<span class="op">$</span>diffusionmap</a>
<a class="sourceLine" id="cb66-9" title="9"></a>
<a class="sourceLine" id="cb66-10" title="10"><span class="kw">corrplot.mixed</span>(<span class="kw">cor</span>(df_pseudotime, <span class="dt">use =</span> <span class="st">&quot;na.or.complete&quot;</span>), </a>
<a class="sourceLine" id="cb66-11" title="11">               <span class="dt">order =</span> <span class="st">&quot;hclust&quot;</span>, <span class="dt">tl.col =</span> <span class="st">&quot;black&quot;</span>,</a>
<a class="sourceLine" id="cb66-12" title="12">               <span class="dt">main =</span> <span class="st">&quot;Correlation matrix for pseudotime results&quot;</span>,</a>
<a class="sourceLine" id="cb66-13" title="13">               <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">3.1</span>, <span class="dv">0</span>))</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/compare-results-1.png" style="display: block; margin: auto;" />
We see here that Ouija, TSCAN and SLICER all give trajectories that are similar and strongly correlated with PC1. Diffusion Map is less strongly correlated with these methods, and Monocle gives very different results.</p>
<p><strong>Exercise 6</strong>: Compare destiny and SLICER to TSCAN, Monocle and Ouija in more depth. Where and how do they differ?</p>
</div>
<div id="expression-of-genes-through-time" class="section level3">
<h3><span class="header-section-number">8.4.8</span> Expression of genes through time</h3>
<p>Each package also enables the visualization of expression through pseudotime. Following individual genes is very helpful for identifying genes that play an important role in the differentiation process. We illustrate the procedure using the <code>Rhoa</code> gene.</p>
<p>We have added the pseudotime values computed with all methods here to
the <code>colData</code> slot of an <code>SCE</code> object. Having done that, the full
plotting capabilities of the <code>scater</code> package can be used to
investigate relationships between gene expression, cell populations
and pseudotime. This is particularly useful for the packages such as
SLICER that do not provide plotting functions.</p>
<p><strong>Principal components</strong></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" title="1"><span class="kw">plotExpression</span>(deng_SCE, <span class="st">&quot;Rhoa&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;PC1&quot;</span>, </a>
<a class="sourceLine" id="cb67-2" title="2">               <span class="dt">colour_by =</span> <span class="st">&quot;cell_type2&quot;</span>, <span class="dt">show_violin =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb67-3" title="3">               <span class="dt">show_smooth =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/Rhoa-pc1-1.png" style="display: block; margin: auto;" />
<strong>TSCAN</strong></p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" title="1"><span class="kw">plotExpression</span>(deng_SCE, <span class="st">&quot;Rhoa&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;pseudotime_order_tscan&quot;</span>, </a>
<a class="sourceLine" id="cb68-2" title="2">               <span class="dt">colour_by =</span> <span class="st">&quot;cell_type2&quot;</span>, <span class="dt">show_violin =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb68-3" title="3">               <span class="dt">show_smooth =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/Rhoa-tscan-1.png" style="display: block; margin: auto;" />
<strong>Monocle</strong></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" title="1"><span class="kw">plotExpression</span>(deng_SCE, <span class="st">&quot;Rhoa&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;pseudotime_monocle&quot;</span>, </a>
<a class="sourceLine" id="cb69-2" title="2">               <span class="dt">colour_by =</span> <span class="st">&quot;cell_type2&quot;</span>, <span class="dt">show_violin =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb69-3" title="3">               <span class="dt">show_smooth =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/Rhoa-monocle-1.png" style="display: block; margin: auto;" />
<strong>Diffusion Map</strong></p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" title="1"><span class="kw">plotExpression</span>(deng_SCE, <span class="st">&quot;Rhoa&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;pseudotime_diffusionmap&quot;</span>, </a>
<a class="sourceLine" id="cb70-2" title="2">               <span class="dt">colour_by =</span> <span class="st">&quot;cell_type2&quot;</span>, <span class="dt">show_violin =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb70-3" title="3">               <span class="dt">show_smooth =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/Rhoa-diff-map-1.png" style="display: block; margin: auto;" /></p>
<p><strong>SLICER</strong></p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" title="1"><span class="kw">plotExpression</span>(deng_SCE, <span class="st">&quot;Rhoa&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;pseudotime_slicer&quot;</span>, </a>
<a class="sourceLine" id="cb71-2" title="2">               <span class="dt">colour_by =</span> <span class="st">&quot;cell_type2&quot;</span>, <span class="dt">show_violin =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb71-3" title="3">               <span class="dt">show_smooth =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/Rhoa-slicer-1.png" style="display: block; margin: auto;" />
<strong>Ouija</strong></p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" title="1"><span class="kw">plotExpression</span>(deng_SCE, <span class="st">&quot;Rhoa&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;pseudotime_ouija&quot;</span>, </a>
<a class="sourceLine" id="cb72-2" title="2">               <span class="dt">colour_by =</span> <span class="st">&quot;cell_type2&quot;</span>, <span class="dt">show_violin =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb72-3" title="3">               <span class="dt">show_smooth =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/pseudotime_files/figure-html/Rhoa-ouija-1.png" style="display: block; margin: auto;" />
How many of these methods outperform the naive approach of using the first principal component to represent pseudotime for these data?</p>
<p><strong>Exercise 7</strong>: Repeat the exercise using a subset of the genes, e.g. the set of highly variable genes that can be obtained using <code>Brennecke_getVariableGenes()</code></p>
</div>
</div>
<div id="imputation" class="section level2">
<h2><span class="header-section-number">8.5</span> Imputation</h2>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" title="1"><span class="kw">library</span>(scImpute)</a>
<a class="sourceLine" id="cb73-2" title="2"><span class="kw">library</span>(SC3)</a>
<a class="sourceLine" id="cb73-3" title="3"><span class="kw">library</span>(scater)</a>
<a class="sourceLine" id="cb73-4" title="4"><span class="kw">library</span>(SingleCellExperiment)</a>
<a class="sourceLine" id="cb73-5" title="5"><span class="kw">library</span>(mclust)</a>
<a class="sourceLine" id="cb73-6" title="6"><span class="kw">library</span>(DrImpute)</a>
<a class="sourceLine" id="cb73-7" title="7"><span class="kw">library</span>(Rmagic)</a>
<a class="sourceLine" id="cb73-8" title="8"><span class="kw">set.seed</span>(<span class="dv">1234567</span>)</a></code></pre></div>
<p>As discussed previously, one of the main challenges when analyzing scRNA-seq
data is the presence of zeros, or dropouts. The dropouts are assumed to have
arisen for three possible reasons:</p>
<ul>
<li>The gene was not expressed in the cell and hence there are no transcripts to sequence</li>
<li>The gene was expressed, but for some reason the transcripts were lost somewhere prior to sequencing</li>
<li>The gene was expressed and transcripts were captured and turned into cDNA, but the sequencing depth was not sufficient to produce any reads.</li>
</ul>
<p>Thus, dropouts could be result of experimental shortcomings, and if this is
the case then we would like to provide computational corrections. One possible
solution is to impute the dropouts in the expression matrix. To be able to
impute gene expression values, one must have an underlying model. However,
since we do not know which dropout events are technical artefacts and which
correspond to the transcript being truly absent, imputation is a difficult
challenge and prone to creating <a href="https://f1000research.com/articles/7-1740/v2">false-positive results in downstream analysis</a>.</p>
<p>There are many different imputation methods available we will consider three
fast, published methods:
<a href="https://github.com/pkathail/magic">MAGIC</a> <span class="citation">(Dijk et al. <a href="#ref-Van_Dijk2017-bh">2017</a>)</span>,
<a href="https://github.com/gongx030/DrImpute">DrImpute</a> and
<a href="https://github.com/Vivianstats/scImpute">scImpute</a> <span class="citation">(Li and Li <a href="#ref-Li2017-tz">2017</a>)</span>.</p>
<p>DrImpute and scImpute both use a model to determine which zeros are technical
and impute only those values. Both use clustering to identify a group of cells
that are assumed to have homogenous expression. DrImpute imputes all values that
are not consistently zero in all cells of a cluster. Whereas, scImpute uses a
zero-inflated normal distribution fit to log-normalized expression values and
imputed all inflated zeros.</p>
<div id="scimpute" class="section level3">
<h3><span class="header-section-number">8.5.1</span> scImpute</h3>
<p>To test <code>scImpute</code>, we use the default parameters and we apply it to the Deng dataset that we have worked with before. scImpute takes a .csv or .txt file as an input:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" title="1">deng &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;data/deng/deng-reads.rds&quot;</span>)</a>
<a class="sourceLine" id="cb74-2" title="2"><span class="kw">write.csv</span>(<span class="kw">counts</span>(deng), <span class="st">&quot;deng.csv&quot;</span>)</a>
<a class="sourceLine" id="cb74-3" title="3"><span class="kw">scimpute</span>(</a>
<a class="sourceLine" id="cb74-4" title="4">    <span class="dt">count_path =</span> <span class="st">&quot;deng.csv&quot;</span>,</a>
<a class="sourceLine" id="cb74-5" title="5">    <span class="dt">infile =</span> <span class="st">&quot;csv&quot;</span>,</a>
<a class="sourceLine" id="cb74-6" title="6">    <span class="dt">outfile =</span> <span class="st">&quot;txt&quot;</span>, </a>
<a class="sourceLine" id="cb74-7" title="7">    <span class="dt">out_dir =</span> <span class="st">&quot;./&quot;</span>,</a>
<a class="sourceLine" id="cb74-8" title="8">    <span class="dt">Kcluster =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb74-9" title="9">    <span class="dt">ncores =</span> <span class="dv">2</span></a>
<a class="sourceLine" id="cb74-10" title="10">)</a></code></pre></div>
<p>Now we can compare the results with original data by considering a PCA plot</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" title="1">res &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;scimpute_count.txt&quot;</span>)</a>
<a class="sourceLine" id="cb75-2" title="2"><span class="kw">colnames</span>(res) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb75-3" title="3">res &lt;-<span class="st"> </span><span class="kw">SingleCellExperiment</span>(</a>
<a class="sourceLine" id="cb75-4" title="4">    <span class="dt">assays =</span> <span class="kw">list</span>(<span class="dt">logcounts =</span> <span class="kw">log2</span>(<span class="kw">as.matrix</span>(res) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)), </a>
<a class="sourceLine" id="cb75-5" title="5">    <span class="dt">colData =</span> <span class="kw">colData</span>(deng)</a>
<a class="sourceLine" id="cb75-6" title="6">)</a>
<a class="sourceLine" id="cb75-7" title="7"><span class="kw">rowData</span>(res)<span class="op">$</span>feature_symbol &lt;-<span class="st"> </span><span class="kw">rowData</span>(deng)<span class="op">$</span>feature_symbol</a>
<a class="sourceLine" id="cb75-8" title="8"><span class="kw">plotPCA</span>(</a>
<a class="sourceLine" id="cb75-9" title="9">    res, </a>
<a class="sourceLine" id="cb75-10" title="10">    <span class="dt">colour_by =</span> <span class="st">&quot;cell_type2&quot;</span></a>
<a class="sourceLine" id="cb75-11" title="11">)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/imputation_files/figure-html/unnamed-chunk-4-1.png" style="display: block; margin: auto;" /></p>
<p>Compare this result to the original data in Chapter <a href="biological-analysis.html#clust-methods">8.2</a>. What are the most significant differences?</p>
<p>We can examine the expression of specific genes to directly see the effect of
imputation on the expression distribution.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" title="1"><span class="kw">plotExpression</span>(res, <span class="kw">c</span>(<span class="st">&quot;Sox2&quot;</span>, <span class="st">&quot;Eomes&quot;</span>, <span class="st">&quot;Zscan4d&quot;</span>, <span class="st">&quot;Fgf4&quot;</span>))</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/imputation_files/figure-html/unnamed-chunk-5-1.png" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" title="1"><span class="kw">plotExpression</span>(deng, <span class="kw">c</span>(<span class="st">&quot;Sox2&quot;</span>, <span class="st">&quot;Eomes&quot;</span>, <span class="st">&quot;Zscan4d&quot;</span>, <span class="st">&quot;Fgf4&quot;</span>))</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/imputation_files/figure-html/unnamed-chunk-5-2.png" style="display: block; margin: auto;" /></p>
<p>To evaluate the impact of the imputation, we use <code>SC3</code> to cluster the imputed matrix</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" title="1">res &lt;-<span class="st"> </span><span class="kw">sc3_estimate_k</span>(res)</a>
<a class="sourceLine" id="cb78-2" title="2"><span class="kw">metadata</span>(res)<span class="op">$</span>sc3<span class="op">$</span>k_estimation</a>
<a class="sourceLine" id="cb78-3" title="3">res &lt;-<span class="st"> </span><span class="kw">sc3</span>(res, <span class="dt">ks =</span> <span class="dv">10</span>, <span class="dt">n_cores =</span> <span class="dv">1</span>, <span class="dt">gene_filter =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb78-4" title="4"><span class="kw">adjustedRandIndex</span>(<span class="kw">colData</span>(deng)<span class="op">$</span>cell_type2, <span class="kw">colData</span>(res)<span class="op">$</span>sc3_<span class="dv">10</span>_clusters)</a>
<a class="sourceLine" id="cb78-5" title="5"><span class="kw">plotPCA</span>(</a>
<a class="sourceLine" id="cb78-6" title="6">    res, </a>
<a class="sourceLine" id="cb78-7" title="7">    <span class="dt">colour_by =</span> <span class="st">&quot;sc3_10_clusters&quot;</span></a>
<a class="sourceLine" id="cb78-8" title="8">)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/imputation_files/figure-html/unnamed-chunk-6-1.png" style="display: block; margin: auto;" /></p>
<p><strong>Exercise:</strong> Based on the PCA and the clustering results, do you think that imputation using <code>scImpute</code> is a good idea for the Deng dataset?</p>
</div>
<div id="drimpute" class="section level3">
<h3><span class="header-section-number">8.5.2</span> DrImpute</h3>
<p>We can do the same for DrImpute. DrImpute runs on a log-normalized expression matrix directly in R, we generate this matrix using scater, then run DrImpute. Unlike scImpute, DrImpute considers the consensus imputation across a range of ks using two differ correlation distances:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" title="1">deng &lt;-<span class="st"> </span><span class="kw">normalize</span>(deng)</a>
<a class="sourceLine" id="cb79-2" title="2">res &lt;-<span class="st"> </span><span class="kw">DrImpute</span>(deng<span class="op">@</span>assays[[<span class="st">&quot;logcounts&quot;</span>]], <span class="dt">ks=</span><span class="dv">8</span><span class="op">:</span><span class="dv">12</span>)</a>
<a class="sourceLine" id="cb79-3" title="3"><span class="kw">colnames</span>(res) &lt;-<span class="st"> </span><span class="kw">colnames</span>(deng)</a>
<a class="sourceLine" id="cb79-4" title="4"><span class="kw">rownames</span>(res) &lt;-<span class="st"> </span><span class="kw">rownames</span>(deng)</a>
<a class="sourceLine" id="cb79-5" title="5">res &lt;-<span class="st"> </span><span class="kw">SingleCellExperiment</span>(</a>
<a class="sourceLine" id="cb79-6" title="6">    <span class="dt">assays =</span> <span class="kw">list</span>(<span class="dt">logcounts =</span> <span class="kw">as.matrix</span>(res)), </a>
<a class="sourceLine" id="cb79-7" title="7">    <span class="dt">colData =</span> <span class="kw">colData</span>(deng)</a>
<a class="sourceLine" id="cb79-8" title="8">)</a>
<a class="sourceLine" id="cb79-9" title="9"><span class="kw">rowData</span>(res)<span class="op">$</span>feature_symbol &lt;-<span class="st"> </span><span class="kw">rowData</span>(deng)<span class="op">$</span>feature_symbol</a>
<a class="sourceLine" id="cb79-10" title="10"><span class="kw">plotPCA</span>(</a>
<a class="sourceLine" id="cb79-11" title="11">    res, </a>
<a class="sourceLine" id="cb79-12" title="12">    <span class="dt">colour_by =</span> <span class="st">&quot;cell_type2&quot;</span></a>
<a class="sourceLine" id="cb79-13" title="13">)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/imputation_files/figure-html/unnamed-chunk-7-1.png" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" title="1"><span class="kw">plotExpression</span>(res, <span class="kw">c</span>(<span class="st">&quot;Sox2&quot;</span>, <span class="st">&quot;Eomes&quot;</span>, <span class="st">&quot;Zscan4d&quot;</span>, <span class="st">&quot;Fgf4&quot;</span>))</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/imputation_files/figure-html/unnamed-chunk-7-2.png" style="display: block; margin: auto;" />
<strong>Exercise:</strong> Check the sc3 clustering of the DrImpute matrix, do you think that imputation using <code>DrImpute</code> is a good idea for the Deng dataset?</p>
</div>
<div id="magic" class="section level3">
<h3><span class="header-section-number">8.5.3</span> MAGIC</h3>
<p><strong>(due to technical issues please run this chapter as an exercise)</strong></p>
<p>MAGIC is a python package but the authors have provided an R package wrapper,
so it can be run seemlessly from R.</p>
<p>Unlike scImpute and DrImpute, MAGIC smoothes the entire dataset. It imputes
zeros but also smoothes non-zero values to further exaggerate any structure
within the dataset. Since it is based on a diffusion process, it specifically
enhances trajectory-like structure in a dataset, in contrast to scImpute and
DrImpute which assume a cluster-like structure to the underlying data.</p>
<p>Compare this result to the original data in Chapter <a href="biological-analysis.html#clust-methods">8.2</a>. What are the most significant differences?</p>
<p>To evaluate the impact of the imputation, we use <code>SC3</code> to cluster the imputed matrix</p>
<p><strong>Exercise:</strong> MAGIC contains two parameters which affect the degree of imputation: <code>t</code> and <code>k</code>, what is the effect of increase/decreasing these parameters? (Hint: try t=1, t=10, k=2, k=50)</p>
<p><strong>Exercise:</strong> What is the difference between <code>scImpute</code> and <code>MAGIC</code> based on the PCA and clustering analysis? Which one do you think is best to use?</p>
</div>
</div>
<div id="dechapter" class="section level2">
<h2><span class="header-section-number">8.6</span> Differential Expression (DE) analysis</h2>
<div id="bulk-rna-seq-1" class="section level3">
<h3><span class="header-section-number">8.6.1</span> Bulk RNA-seq</h3>
<p>One of the most common types of analyses when working with bulk RNA-seq
data is to identify differentially expressed genes. By comparing the
genes that change between two conditions, e.g. mutant and wild-type or
stimulated and unstimulated, it is possible to characterize the
molecular mechanisms underlying the change.</p>
<p>Several different methods,
e.g. <a href="https://bioconductor.org/packages/DESeq2">DESeq2</a> and
<a href="https://bioconductor.org/packages/release/bioc/html/edgeR.html">edgeR</a>,
have been developed for bulk RNA-seq. Moreover, there are also
extensive
<a href="http://genomebiology.biomedcentral.com/articles/10.1186/gb-2013-14-9-r95">datasets</a>
available where the RNA-seq data has been validated using
RT-qPCR. These data can be used to benchmark DE finding algorithms and the available evidence suggests that the algorithms are performing quite well.</p>
</div>
<div id="single-cell-rna-seq" class="section level3">
<h3><span class="header-section-number">8.6.2</span> Single cell RNA-seq</h3>
<p>In contrast to bulk RNA-seq, in scRNA-seq we usually do not have a defined
set of experimental conditions. Instead, as was shown in a previous chapter
(<a href="biological-analysis.html#clust-methods">8.2</a>) we can identify the cell groups by using an unsupervised
clustering approach. Once the groups have been identified one can find differentially
expressed genes either by comparing the differences in variance between the groups (like the Kruskal-Wallis test implemented in SC3), or by comparing gene expression between clusters in a pairwise manner. In the following chapter we will mainly consider tools developed for pairwise comparisons.</p>
</div>
<div id="differences-in-distribution" class="section level3">
<h3><span class="header-section-number">8.6.3</span> Differences in Distribution</h3>
<p>Unlike bulk RNA-seq, we generally have a large number of samples (i.e. cells) for each group we are comparing in single-cell experiments. Thus we can take advantage of the whole distribution of expression values in each group to identify differences between groups rather than only comparing estimates of mean-expression as is standard for bulk RNASeq.</p>
<p>There are two main approaches to comparing distributions. Firstly, we can use existing statistical models/distributions and fit the same type of model to the expression in each group then test for differences in the parameters for each model, or test whether the model fits better if a particular paramter is allowed to be different according to group. For instance in Chapter <a href="cleaning-the-expression-matrix.html#dealing-with-confounders">7.10</a> we used edgeR to test whether allowing mean expression to be different in different batches significantly improved the fit of a negative binomial model of the data.</p>
<p>Alternatively, we can use a non-parametric test which does not assume that expression values follow any particular distribution, e.g. the <a href="https://en.wikipedia.org/wiki/Kolmogorov%E2%80%93Smirnov_test">Kolmogorov-Smirnov test (KS-test)</a>. Non-parametric tests generally convert observed expression values to ranks and test whether the distribution of ranks for one group are signficantly different from the distribution of ranks for the other group. However, some non-parametric methods fail in the presence of a large number of tied values, such as the case for dropouts (zeros) in single-cell RNA-seq expression data. Moreover, if the conditions for a parametric test hold, then it will typically be more powerful than a non-parametric test.</p>
</div>
<div id="models-of-single-cell-rnaseq-data" class="section level3">
<h3><span class="header-section-number">8.6.4</span> Models of single-cell RNASeq data</h3>
<p>The most common model of RNASeq data is the negative binomial model:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" title="1"><span class="kw">set.seed</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb81-2" title="2"><span class="kw">hist</span>(</a>
<a class="sourceLine" id="cb81-3" title="3">    <span class="kw">rnbinom</span>(</a>
<a class="sourceLine" id="cb81-4" title="4">        <span class="dv">1000</span>, </a>
<a class="sourceLine" id="cb81-5" title="5">        <span class="dt">mu =</span> <span class="dv">10</span>, </a>
<a class="sourceLine" id="cb81-6" title="6">        <span class="dt">size =</span> <span class="dv">100</span>), </a>
<a class="sourceLine" id="cb81-7" title="7">    <span class="dt">col =</span> <span class="st">&quot;grey50&quot;</span>, </a>
<a class="sourceLine" id="cb81-8" title="8">    <span class="dt">xlab =</span> <span class="st">&quot;Read Counts&quot;</span>, </a>
<a class="sourceLine" id="cb81-9" title="9">    <span class="dt">main =</span> <span class="st">&quot;Negative Binomial&quot;</span></a>
<a class="sourceLine" id="cb81-10" title="10">)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:nb-plot"></span>
<img src="https://scrnaseq-course.cog.sanger.ac.uk/website/de-intro_files/figure-html/nb-plot-1.png" alt="Negative Binomial distribution of read counts for a single gene across 1000 cells"  />
<p class="caption">
Figure 8.11: Negative Binomial distribution of read counts for a single gene across 1000 cells
</p>
</div>
<p>Mean:
<span class="math inline">\(\mu = mu\)</span></p>
<p>Variance:
<span class="math inline">\(\sigma^2 = mu + mu^2/size\)</span></p>
<p>It is parameterized by the mean expression (mu) and the dispersion (size), which is inversely related to the variance. The negative binomial model fits bulk RNA-seq data very well and it is used for most statistical methods designed for such data. In addition, it has been show to fit the distribution of molecule counts obtained from data tagged by unique molecular identifiers (UMIs) quite well (<a href="http://www.nature.com/nmeth/journal/v11/n6/full/nmeth.2930.html">Grun et al. 2014</a>, <a href="http://genome.cshlp.org/content/21/7/1160">Islam et al. 2011</a>).</p>
<p>However, a raw negative binomial model does not fit full-length transcript data as well due to the high dropout rates relative to the non-zero read counts. For this type of data a variety of zero-inflated negative binomial models have been proposed (e.g. <a href="https://bioconductor.org/packages/release/bioc/html/MAST.html">MAST</a>, <a href="https://bioconductor.org/packages/release/bioc/html/scde.html">SCDE</a>).</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" title="1">d &lt;-<span class="st"> </span><span class="fl">0.5</span>;</a>
<a class="sourceLine" id="cb82-2" title="2">counts &lt;-<span class="st"> </span><span class="kw">rnbinom</span>(</a>
<a class="sourceLine" id="cb82-3" title="3">    <span class="dv">1000</span>, </a>
<a class="sourceLine" id="cb82-4" title="4">    <span class="dt">mu =</span> <span class="dv">10</span>, </a>
<a class="sourceLine" id="cb82-5" title="5">    <span class="dt">size =</span> <span class="dv">100</span></a>
<a class="sourceLine" id="cb82-6" title="6">)</a>
<a class="sourceLine" id="cb82-7" title="7">counts[<span class="kw">runif</span>(<span class="dv">1000</span>) <span class="op">&lt;</span><span class="st"> </span>d] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb82-8" title="8"><span class="kw">hist</span>(</a>
<a class="sourceLine" id="cb82-9" title="9">    counts, </a>
<a class="sourceLine" id="cb82-10" title="10">    <span class="dt">col =</span> <span class="st">&quot;grey50&quot;</span>, </a>
<a class="sourceLine" id="cb82-11" title="11">    <span class="dt">xlab =</span> <span class="st">&quot;Read Counts&quot;</span>, </a>
<a class="sourceLine" id="cb82-12" title="12">    <span class="dt">main =</span> <span class="st">&quot;Zero-inflated NB&quot;</span></a>
<a class="sourceLine" id="cb82-13" title="13">)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:zero-inflation-plot"></span>
<img src="https://scrnaseq-course.cog.sanger.ac.uk/website/de-intro_files/figure-html/zero-inflation-plot-1.png" alt="Zero-inflated Negative Binomial distribution"  />
<p class="caption">
Figure 8.12: Zero-inflated Negative Binomial distribution
</p>
</div>
<p>Mean:
<span class="math inline">\(\mu = mu \cdot (1 - d)\)</span></p>
<p>Variance:
<span class="math inline">\(\sigma^2 = \mu \cdot (1-d) \cdot (1 + d \cdot \mu + \mu / size)\)</span></p>
<p>These models introduce a new parameter <span class="math inline">\(d\)</span>, for the dropout rate, to the negative binomial model. As we saw in Chapter 19, the dropout rate of a gene is strongly correlated with the mean expression of the gene. Different zero-inflated negative binomial models use different relationships between mu and d and some may fit <span class="math inline">\(\mu\)</span> and <span class="math inline">\(d\)</span> to the expression of each gene independently.</p>
<p>Finally, several methods use a Poisson-Beta distribution which is based on a mechanistic model of transcriptional bursting. There is strong experimental support for this model (<a href="https://genomebiology.biomedcentral.com/articles/10.1186/gb-2013-14-1-r7">Kim and Marioni, 2013</a>) and it provides a good fit to scRNA-seq data but it is less easy to use than the negative-binomial models and much less existing methods upon which to build than the negative binomial model.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" title="1">a &lt;-<span class="st"> </span><span class="fl">0.1</span></a>
<a class="sourceLine" id="cb83-2" title="2">b &lt;-<span class="st"> </span><span class="fl">0.1</span></a>
<a class="sourceLine" id="cb83-3" title="3">g &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb83-4" title="4">lambdas &lt;-<span class="st"> </span><span class="kw">rbeta</span>(<span class="dv">1000</span>, a, b)</a>
<a class="sourceLine" id="cb83-5" title="5">counts &lt;-<span class="st"> </span><span class="kw">sapply</span>(g<span class="op">*</span>lambdas, <span class="cf">function</span>(l) {<span class="kw">rpois</span>(<span class="dv">1</span>, <span class="dt">lambda =</span> l)})</a>
<a class="sourceLine" id="cb83-6" title="6"><span class="kw">hist</span>(</a>
<a class="sourceLine" id="cb83-7" title="7">    counts, </a>
<a class="sourceLine" id="cb83-8" title="8">    <span class="dt">col =</span> <span class="st">&quot;grey50&quot;</span>, </a>
<a class="sourceLine" id="cb83-9" title="9">    <span class="dt">xlab =</span> <span class="st">&quot;Read Counts&quot;</span>, </a>
<a class="sourceLine" id="cb83-10" title="10">    <span class="dt">main =</span> <span class="st">&quot;Poisson-Beta&quot;</span></a>
<a class="sourceLine" id="cb83-11" title="11">)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/de-intro_files/figure-html/pois-beta-plot-1.png" style="display: block; margin: auto;" />
Mean:
<span class="math inline">\(\mu = g \cdot a / (a + b)\)</span></p>
<p>Variance:
<span class="math inline">\(\sigma^2 = g^2 \cdot a \cdot b/((a + b + 1) \cdot (a + b)^2)\)</span></p>
<p>This model uses three parameters: <span class="math inline">\(a\)</span> the rate of activation of transcription; <span class="math inline">\(b\)</span> the rate of inhibition of transcription; and <span class="math inline">\(g\)</span> the rate of transcript production while transcription is active at the locus. Differential expression methods may test each of the parameters for differences across groups or only one (often <span class="math inline">\(g\)</span>).</p>
<p>All of these models may be further expanded to explicitly account for other sources of gene expression differences such as batch-effect or library depth depending on the particular DE algorithm.</p>
<p><strong>Exercise</strong>: Vary the parameters of each distribution to explore how they affect the distribution of gene expression. How similar are the Poisson-Beta and Negative Binomial models?</p>
</div>
</div>
<div id="de-in-a-real-dataset" class="section level2">
<h2><span class="header-section-number">8.7</span> DE in a real dataset</h2>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" title="1"><span class="kw">library</span>(scRNA.seq.funcs)</a>
<a class="sourceLine" id="cb84-2" title="2"><span class="kw">library</span>(edgeR)</a>
<a class="sourceLine" id="cb84-3" title="3"><span class="kw">library</span>(monocle)</a>
<a class="sourceLine" id="cb84-4" title="4"><span class="kw">library</span>(MAST)</a>
<a class="sourceLine" id="cb84-5" title="5"><span class="kw">library</span>(ROCR)</a>
<a class="sourceLine" id="cb84-6" title="6"><span class="kw">set.seed</span>(<span class="dv">1</span>)</a></code></pre></div>
<div id="introduction" class="section level3">
<h3><span class="header-section-number">8.7.1</span> Introduction</h3>
<p>To test different single-cell differential expression methods we will be using the Blischak dataset from Chapters 7-17.
For this experiment bulk RNA-seq data for each cell-line was generated in addition to single-cell data. We will use the
differentially expressed genes identified using standard methods on the respective bulk data as the ground truth for evaluating the
accuracy of each single-cell method. To save time we have pre-computed these for you. You can run the commands below to load these data.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" title="1">DE &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;data/tung/TPs.txt&quot;</span>)</a>
<a class="sourceLine" id="cb85-2" title="2">notDE &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;data/tung/TNs.txt&quot;</span>)</a>
<a class="sourceLine" id="cb85-3" title="3">GroundTruth &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb85-4" title="4">    <span class="dt">DE =</span> <span class="kw">as.character</span>(<span class="kw">unlist</span>(DE)), </a>
<a class="sourceLine" id="cb85-5" title="5">    <span class="dt">notDE =</span> <span class="kw">as.character</span>(<span class="kw">unlist</span>(notDE))</a>
<a class="sourceLine" id="cb85-6" title="6">)</a></code></pre></div>
<p>This ground truth has been produce for the comparison of individual NA19101 to NA19239. Now load the respective single-cell data:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" title="1">molecules &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;data/tung/molecules.txt&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb86-2" title="2">anno &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;data/tung/annotation.txt&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb86-3" title="3">keep &lt;-<span class="st"> </span>anno[,<span class="dv">1</span>] <span class="op">==</span><span class="st"> &quot;NA19101&quot;</span> <span class="op">|</span><span class="st"> </span>anno[,<span class="dv">1</span>] <span class="op">==</span><span class="st"> &quot;NA19239&quot;</span></a>
<a class="sourceLine" id="cb86-4" title="4">data &lt;-<span class="st"> </span>molecules[,keep]</a>
<a class="sourceLine" id="cb86-5" title="5">group &lt;-<span class="st"> </span>anno[keep,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb86-6" title="6">batch &lt;-<span class="st"> </span>anno[keep,<span class="dv">4</span>]</a>
<a class="sourceLine" id="cb86-7" title="7"><span class="co"># remove genes that aren&#39;t expressed in at least 6 cells</span></a>
<a class="sourceLine" id="cb86-8" title="8">gkeep &lt;-<span class="st"> </span><span class="kw">rowSums</span>(data <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>;</a>
<a class="sourceLine" id="cb86-9" title="9">counts &lt;-<span class="st"> </span>data[gkeep,]</a>
<a class="sourceLine" id="cb86-10" title="10"><span class="co"># Library size normalization</span></a>
<a class="sourceLine" id="cb86-11" title="11">lib_size =<span class="st"> </span><span class="kw">colSums</span>(counts)</a>
<a class="sourceLine" id="cb86-12" title="12">norm &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">t</span>(counts)<span class="op">/</span>lib_size <span class="op">*</span><span class="st"> </span><span class="kw">median</span>(lib_size)) </a>
<a class="sourceLine" id="cb86-13" title="13"><span class="co"># Variant of CPM for datasets with library sizes of fewer than 1 mil molecules</span></a></code></pre></div>
<p>Now we will compare various single-cell DE methods. Note that we will only be running methods which are available as R-packages and run relatively quickly.</p>
</div>
<div id="kolmogorov-smirnov-test" class="section level3">
<h3><span class="header-section-number">8.7.2</span> Kolmogorov-Smirnov test</h3>
<p>The types of test that are easiest to work with are non-parametric
ones. The most commonly used non-parametric test is the
<a href="https://en.wikipedia.org/wiki/Kolmogorov%E2%80%93Smirnov_test">Kolmogorov-Smirnov test</a> (KS-test) and we can use it to compare the distributions for each gene in the two individuals.</p>
<p>The KS-test quantifies the distance between the empirical cummulative distributions of the expression of each gene in each of the two populations. It is sensitive to changes in mean experession and changes in variability. However it assumes data is continuous and may perform poorly when data contains a large number of identical values (eg. zeros). Another issue with the KS-test is that it can be very sensitive for large sample sizes and thus it may end up as significant even though the magnitude of the difference is very small.</p>
<div class="figure" style="text-align: center"><span id="fig:ks-statistic"></span>
<img src="figures/KS2_Example.png" alt="Illustration of the two-sample Kolmogorov–Smirnov statistic. Red and blue lines each correspond to an empirical distribution function, and the black arrow is the two-sample KS statistic. (taken from [here](https://en.wikipedia.org/wiki/Kolmogorov%E2%80%93Smirnov_test))" width="60%" />
<p class="caption">
Figure 8.13: Illustration of the two-sample Kolmogorov–Smirnov statistic. Red and blue lines each correspond to an empirical distribution function, and the black arrow is the two-sample KS statistic. (taken from <a href="https://en.wikipedia.org/wiki/Kolmogorov%E2%80%93Smirnov_test">here</a>)
</p>
</div>
<p>Now run the test:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" title="1">pVals &lt;-<span class="st"> </span><span class="kw">apply</span>(</a>
<a class="sourceLine" id="cb87-2" title="2">    norm, <span class="dv">1</span>, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb87-3" title="3">        <span class="kw">ks.test</span>(</a>
<a class="sourceLine" id="cb87-4" title="4">            x[group <span class="op">==</span><span class="st"> &quot;NA19101&quot;</span>], </a>
<a class="sourceLine" id="cb87-5" title="5">            x[group <span class="op">==</span><span class="st"> &quot;NA19239&quot;</span>]</a>
<a class="sourceLine" id="cb87-6" title="6">        )<span class="op">$</span>p.value</a>
<a class="sourceLine" id="cb87-7" title="7">    }</a>
<a class="sourceLine" id="cb87-8" title="8">)</a>
<a class="sourceLine" id="cb87-9" title="9"><span class="co"># multiple testing correction</span></a>
<a class="sourceLine" id="cb87-10" title="10">pVals &lt;-<span class="st"> </span><span class="kw">p.adjust</span>(pVals, <span class="dt">method =</span> <span class="st">&quot;fdr&quot;</span>)</a></code></pre></div>
<p>This code “applies” the function to each row (specified by 1) of the expression matrix, data. In the function we are returning just the p.value from the ks.test output. We can now consider how many of the ground truth positive and negative DE genes are detected by the KS-test:</p>
<div id="evaluating-accuracy" class="section level4">
<h4><span class="header-section-number">8.7.2.1</span> Evaluating Accuracy</h4>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" title="1">sigDE &lt;-<span class="st"> </span><span class="kw">names</span>(pVals)[pVals <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>]</a>
<a class="sourceLine" id="cb88-2" title="2"><span class="kw">length</span>(sigDE) </a>
<a class="sourceLine" id="cb88-3" title="3"><span class="co"># Number of KS-DE genes</span></a>
<a class="sourceLine" id="cb88-4" title="4"><span class="kw">sum</span>(GroundTruth<span class="op">$</span>DE <span class="op">%in%</span><span class="st"> </span>sigDE) </a>
<a class="sourceLine" id="cb88-5" title="5"><span class="co"># Number of KS-DE genes that are true DE genes</span></a>
<a class="sourceLine" id="cb88-6" title="6"><span class="kw">sum</span>(GroundTruth<span class="op">$</span>notDE <span class="op">%in%</span><span class="st"> </span>sigDE)</a>
<a class="sourceLine" id="cb88-7" title="7"><span class="co"># Number of KS-DE genes that are truly not-DE</span></a></code></pre></div>
<p>As you can see many more of our ground truth negative genes were identified as DE by the KS-test (false positives) than ground truth positive genes (true positives), however this may be due to the larger number of notDE genes thus we typically normalize these counts as the True positive rate (TPR), TP/(TP + FN), and False positive rate (FPR), FP/(FP+TP).</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" title="1">tp &lt;-<span class="st"> </span><span class="kw">sum</span>(GroundTruth<span class="op">$</span>DE <span class="op">%in%</span><span class="st"> </span>sigDE)</a>
<a class="sourceLine" id="cb89-2" title="2">fp &lt;-<span class="st"> </span><span class="kw">sum</span>(GroundTruth<span class="op">$</span>notDE <span class="op">%in%</span><span class="st"> </span>sigDE)</a>
<a class="sourceLine" id="cb89-3" title="3">tn &lt;-<span class="st"> </span><span class="kw">sum</span>(GroundTruth<span class="op">$</span>notDE <span class="op">%in%</span><span class="st"> </span><span class="kw">names</span>(pVals)[pVals <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.05</span>])</a>
<a class="sourceLine" id="cb89-4" title="4">fn &lt;-<span class="st"> </span><span class="kw">sum</span>(GroundTruth<span class="op">$</span>DE <span class="op">%in%</span><span class="st"> </span><span class="kw">names</span>(pVals)[pVals <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.05</span>])</a>
<a class="sourceLine" id="cb89-5" title="5">tpr &lt;-<span class="st"> </span>tp<span class="op">/</span>(tp <span class="op">+</span><span class="st"> </span>fn)</a>
<a class="sourceLine" id="cb89-6" title="6">fpr &lt;-<span class="st"> </span>fp<span class="op">/</span>(fp <span class="op">+</span><span class="st"> </span>tn)</a>
<a class="sourceLine" id="cb89-7" title="7"><span class="kw">cat</span>(<span class="kw">c</span>(tpr, fpr))</a></code></pre></div>
<p>Now we can see the TPR is much higher than the FPR indicating the KS test is identifying DE genes.</p>
<p>So far we’ve only evaluated the performance at a single significance threshold. Often it is informative to vary the threshold and evaluate performance across a range of values. This is then plotted as a receiver-operating-characteristic curve (ROC) and a general accuracy statistic can be calculated as the area under this curve (AUC). We will use the ROCR package to facilitate this plotting.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" title="1"><span class="co"># Only consider genes for which we know the ground truth</span></a>
<a class="sourceLine" id="cb90-2" title="2">pVals &lt;-<span class="st"> </span>pVals[<span class="kw">names</span>(pVals) <span class="op">%in%</span><span class="st"> </span>GroundTruth<span class="op">$</span>DE <span class="op">|</span><span class="st"> </span></a>
<a class="sourceLine" id="cb90-3" title="3"><span class="st">               </span><span class="kw">names</span>(pVals) <span class="op">%in%</span><span class="st"> </span>GroundTruth<span class="op">$</span>notDE] </a>
<a class="sourceLine" id="cb90-4" title="4">truth &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>, <span class="dt">times =</span> <span class="kw">length</span>(pVals));</a>
<a class="sourceLine" id="cb90-5" title="5">truth[<span class="kw">names</span>(pVals) <span class="op">%in%</span><span class="st"> </span>GroundTruth<span class="op">$</span>DE] =<span class="st"> </span><span class="dv">0</span>;</a>
<a class="sourceLine" id="cb90-6" title="6">pred &lt;-<span class="st"> </span>ROCR<span class="op">::</span><span class="kw">prediction</span>(pVals, truth)</a>
<a class="sourceLine" id="cb90-7" title="7">perf &lt;-<span class="st"> </span>ROCR<span class="op">::</span><span class="kw">performance</span>(pred, <span class="st">&quot;tpr&quot;</span>, <span class="st">&quot;fpr&quot;</span>)</a>
<a class="sourceLine" id="cb90-8" title="8">ROCR<span class="op">::</span><span class="kw">plot</span>(perf)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:ks-roc-plot"></span>
<img src="https://scrnaseq-course.cog.sanger.ac.uk/website/de-real_files/figure-html/ks-roc-plot-1.png" alt="ROC curve for KS-test."  />
<p class="caption">
Figure 8.14: ROC curve for KS-test.
</p>
</div>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" title="1">aucObj &lt;-<span class="st"> </span>ROCR<span class="op">::</span><span class="kw">performance</span>(pred, <span class="st">&quot;auc&quot;</span>)</a>
<a class="sourceLine" id="cb91-2" title="2">aucObj<span class="op">@</span>y.values[[<span class="dv">1</span>]] <span class="co"># AUC</span></a></code></pre></div>
<p>Finally to facilitate the comparisons of other DE methods let’s put this code into a function so we don’t need to repeat it:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" title="1">DE_Quality_AUC &lt;-<span class="st"> </span><span class="cf">function</span>(pVals) {</a>
<a class="sourceLine" id="cb92-2" title="2">    pVals &lt;-<span class="st"> </span>pVals[<span class="kw">names</span>(pVals) <span class="op">%in%</span><span class="st"> </span>GroundTruth<span class="op">$</span>DE <span class="op">|</span><span class="st"> </span></a>
<a class="sourceLine" id="cb92-3" title="3"><span class="st">                   </span><span class="kw">names</span>(pVals) <span class="op">%in%</span><span class="st"> </span>GroundTruth<span class="op">$</span>notDE]</a>
<a class="sourceLine" id="cb92-4" title="4">    truth &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>, <span class="dt">times =</span> <span class="kw">length</span>(pVals));</a>
<a class="sourceLine" id="cb92-5" title="5">    truth[<span class="kw">names</span>(pVals) <span class="op">%in%</span><span class="st"> </span>GroundTruth<span class="op">$</span>DE] =<span class="st"> </span><span class="dv">0</span>;</a>
<a class="sourceLine" id="cb92-6" title="6">    pred &lt;-<span class="st"> </span>ROCR<span class="op">::</span><span class="kw">prediction</span>(pVals, truth)</a>
<a class="sourceLine" id="cb92-7" title="7">    perf &lt;-<span class="st"> </span>ROCR<span class="op">::</span><span class="kw">performance</span>(pred, <span class="st">&quot;tpr&quot;</span>, <span class="st">&quot;fpr&quot;</span>)</a>
<a class="sourceLine" id="cb92-8" title="8">    ROCR<span class="op">::</span><span class="kw">plot</span>(perf)</a>
<a class="sourceLine" id="cb92-9" title="9">    aucObj &lt;-<span class="st"> </span>ROCR<span class="op">::</span><span class="kw">performance</span>(pred, <span class="st">&quot;auc&quot;</span>)</a>
<a class="sourceLine" id="cb92-10" title="10">    <span class="kw">return</span>(aucObj<span class="op">@</span>y.values[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb92-11" title="11">}</a></code></pre></div>
</div>
</div>
<div id="wilcoxmann-whitney-u-test" class="section level3">
<h3><span class="header-section-number">8.7.3</span> Wilcox/Mann-Whitney-U Test</h3>
<p>The Wilcox-rank-sum test is another non-parametric test, but tests specifically if values in one group are greater/less than the values in the other group. Thus it is often considered a test for difference in median expression between two groups; whereas the KS-test is sensitive to any change in distribution of expression values.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" title="1">pVals &lt;-<span class="st"> </span><span class="kw">apply</span>(</a>
<a class="sourceLine" id="cb93-2" title="2">    norm, <span class="dv">1</span>, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb93-3" title="3">        <span class="kw">wilcox.test</span>(</a>
<a class="sourceLine" id="cb93-4" title="4">            x[group <span class="op">==</span><span class="st"> &quot;NA19101&quot;</span>], </a>
<a class="sourceLine" id="cb93-5" title="5">            x[group <span class="op">==</span><span class="st"> &quot;NA19239&quot;</span>]</a>
<a class="sourceLine" id="cb93-6" title="6">        )<span class="op">$</span>p.value</a>
<a class="sourceLine" id="cb93-7" title="7">    }</a>
<a class="sourceLine" id="cb93-8" title="8">)</a>
<a class="sourceLine" id="cb93-9" title="9"><span class="co"># multiple testing correction</span></a>
<a class="sourceLine" id="cb93-10" title="10">pVals &lt;-<span class="st"> </span><span class="kw">p.adjust</span>(pVals, <span class="dt">method =</span> <span class="st">&quot;fdr&quot;</span>)</a>
<a class="sourceLine" id="cb93-11" title="11"><span class="kw">DE_Quality_AUC</span>(pVals)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:wilcox-plot"></span>
<img src="https://scrnaseq-course.cog.sanger.ac.uk/website/de-real_files/figure-html/wilcox-plot-1.png" alt="ROC curve for Wilcox test."  />
<p class="caption">
Figure 8.15: ROC curve for Wilcox test.
</p>
</div>
</div>
<div id="edger" class="section level3">
<h3><span class="header-section-number">8.7.4</span> edgeR</h3>
<p>We’ve already used edgeR for differential expression in Chapter <a href="cleaning-the-expression-matrix.html#dealing-with-confounders">7.10</a>. edgeR is based on a negative binomial model of gene expression and uses a generalized linear model (GLM) framework, the enables us to include other factors such as batch to the model.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" title="1">dge &lt;-<span class="st"> </span><span class="kw">DGEList</span>(</a>
<a class="sourceLine" id="cb94-2" title="2">    <span class="dt">counts =</span> counts, </a>
<a class="sourceLine" id="cb94-3" title="3">    <span class="dt">norm.factors =</span> <span class="kw">rep</span>(<span class="dv">1</span>, <span class="kw">length</span>(counts[<span class="dv">1</span>,])), </a>
<a class="sourceLine" id="cb94-4" title="4">    <span class="dt">group =</span> group</a>
<a class="sourceLine" id="cb94-5" title="5">)</a>
<a class="sourceLine" id="cb94-6" title="6">group_edgeR &lt;-<span class="st"> </span><span class="kw">factor</span>(group)</a>
<a class="sourceLine" id="cb94-7" title="7">design &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(<span class="op">~</span><span class="st"> </span>group_edgeR)</a>
<a class="sourceLine" id="cb94-8" title="8">dge &lt;-<span class="st"> </span><span class="kw">estimateDisp</span>(dge, <span class="dt">design =</span> design, <span class="dt">trend.method =</span> <span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb94-9" title="9">fit &lt;-<span class="st"> </span><span class="kw">glmFit</span>(dge, design)</a>
<a class="sourceLine" id="cb94-10" title="10">res &lt;-<span class="st"> </span><span class="kw">glmLRT</span>(fit)</a>
<a class="sourceLine" id="cb94-11" title="11">pVals &lt;-<span class="st"> </span>res<span class="op">$</span>table[,<span class="dv">4</span>]</a>
<a class="sourceLine" id="cb94-12" title="12"><span class="kw">names</span>(pVals) &lt;-<span class="st"> </span><span class="kw">rownames</span>(res<span class="op">$</span>table)</a>
<a class="sourceLine" id="cb94-13" title="13"></a>
<a class="sourceLine" id="cb94-14" title="14">pVals &lt;-<span class="st"> </span><span class="kw">p.adjust</span>(pVals, <span class="dt">method =</span> <span class="st">&quot;fdr&quot;</span>)</a>
<a class="sourceLine" id="cb94-15" title="15"><span class="kw">DE_Quality_AUC</span>(pVals)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:edger-plot"></span>
<img src="https://scrnaseq-course.cog.sanger.ac.uk/website/de-real_files/figure-html/edger-plot-1.png" alt="ROC curve for edgeR."  />
<p class="caption">
Figure 8.16: ROC curve for edgeR.
</p>
</div>
</div>
<div id="monocle-1" class="section level3">
<h3><span class="header-section-number">8.7.5</span> Monocle</h3>
<p><a href="https://bioconductor.org/packages/release/bioc/html/monocle.html">Monocle</a> can use several different models for DE. For count data it recommends the Negative Binomial model (negbinomial.size). For normalized data it recommends log-transforming it then using a normal distribution (gaussianff). Similar to edgeR this method uses a GLM framework so in theory can account for batches, however in practice the model fails for this dataset if batches are included.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" title="1">pd &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">group =</span> group, <span class="dt">batch =</span> batch)</a>
<a class="sourceLine" id="cb95-2" title="2"><span class="kw">rownames</span>(pd) &lt;-<span class="st"> </span><span class="kw">colnames</span>(counts)</a>
<a class="sourceLine" id="cb95-3" title="3">pd &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&quot;AnnotatedDataFrame&quot;</span>, <span class="dt">data =</span> pd)</a>
<a class="sourceLine" id="cb95-4" title="4"></a>
<a class="sourceLine" id="cb95-5" title="5">Obj &lt;-<span class="st"> </span><span class="kw">newCellDataSet</span>(</a>
<a class="sourceLine" id="cb95-6" title="6">    <span class="kw">as.matrix</span>(counts), </a>
<a class="sourceLine" id="cb95-7" title="7">    <span class="dt">phenoData =</span> pd, </a>
<a class="sourceLine" id="cb95-8" title="8">    <span class="dt">expressionFamily =</span> <span class="kw">negbinomial.size</span>()</a>
<a class="sourceLine" id="cb95-9" title="9">)</a>
<a class="sourceLine" id="cb95-10" title="10">Obj &lt;-<span class="st"> </span><span class="kw">estimateSizeFactors</span>(Obj)</a>
<a class="sourceLine" id="cb95-11" title="11">Obj &lt;-<span class="st"> </span><span class="kw">estimateDispersions</span>(Obj)</a>
<a class="sourceLine" id="cb95-12" title="12">res &lt;-<span class="st"> </span><span class="kw">differentialGeneTest</span>(Obj, <span class="dt">fullModelFormulaStr =</span> <span class="st">&quot;~group&quot;</span>)</a>
<a class="sourceLine" id="cb95-13" title="13"></a>
<a class="sourceLine" id="cb95-14" title="14">pVals &lt;-<span class="st"> </span>res[,<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb95-15" title="15"><span class="kw">names</span>(pVals) &lt;-<span class="st"> </span><span class="kw">rownames</span>(res)</a>
<a class="sourceLine" id="cb95-16" title="16">pVals &lt;-<span class="st"> </span><span class="kw">p.adjust</span>(pVals, <span class="dt">method =</span> <span class="st">&quot;fdr&quot;</span>)</a>
<a class="sourceLine" id="cb95-17" title="17"><span class="kw">DE_Quality_AUC</span>(pVals)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:Monocle-plot"></span>
<img src="https://scrnaseq-course.cog.sanger.ac.uk/website/de-real_files/figure-html/Monocle-plot-1.png" alt="ROC curve for Monocle."  />
<p class="caption">
Figure 8.17: ROC curve for Monocle.
</p>
</div>
<p><strong>Exercise</strong>: Compare the results using the negative binomial model on counts and those from using the normal/gaussian model (<code>gaussianff()</code>) on log-transformed normalized counts.</p>
<p><strong>Answer</strong>:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" title="1">pd &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">group =</span> group, <span class="dt">batch =</span> batch)</a>
<a class="sourceLine" id="cb96-2" title="2"><span class="kw">rownames</span>(pd) &lt;-<span class="st"> </span><span class="kw">colnames</span>(norm)</a>
<a class="sourceLine" id="cb96-3" title="3">pd &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&quot;AnnotatedDataFrame&quot;</span>, <span class="dt">data =</span> pd)</a>
<a class="sourceLine" id="cb96-4" title="4"></a>
<a class="sourceLine" id="cb96-5" title="5">Obj_log &lt;-<span class="st"> </span><span class="kw">newCellDataSet</span>(</a>
<a class="sourceLine" id="cb96-6" title="6">    <span class="kw">as.matrix</span>(<span class="kw">log</span>(norm <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span><span class="kw">log</span>(<span class="dv">2</span>)), </a>
<a class="sourceLine" id="cb96-7" title="7">    <span class="dt">phenoData =</span> pd, </a>
<a class="sourceLine" id="cb96-8" title="8">    <span class="dt">expressionFamily =</span> <span class="kw">gaussianff</span>()</a>
<a class="sourceLine" id="cb96-9" title="9">)</a>
<a class="sourceLine" id="cb96-10" title="10">Obj_log &lt;-<span class="st"> </span><span class="kw">estimateSizeFactors</span>(Obj_log)</a>
<a class="sourceLine" id="cb96-11" title="11"><span class="co"># Obj_log &lt;- estimateDispersions(Obj_log)</span></a>
<a class="sourceLine" id="cb96-12" title="12">res &lt;-<span class="st"> </span><span class="kw">differentialGeneTest</span>(Obj_log, <span class="dt">fullModelFormulaStr =</span> <span class="st">&quot;~group&quot;</span>)</a>
<a class="sourceLine" id="cb96-13" title="13"></a>
<a class="sourceLine" id="cb96-14" title="14">pVals &lt;-<span class="st"> </span>res[,<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb96-15" title="15"><span class="kw">names</span>(pVals) &lt;-<span class="st"> </span><span class="kw">rownames</span>(res)</a>
<a class="sourceLine" id="cb96-16" title="16">pVals &lt;-<span class="st"> </span><span class="kw">p.adjust</span>(pVals, <span class="dt">method =</span> <span class="st">&quot;fdr&quot;</span>)</a>
<a class="sourceLine" id="cb96-17" title="17"><span class="kw">DE_Quality_AUC</span>(pVals)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:Monocle-plot2"></span>
<img src="https://scrnaseq-course.cog.sanger.ac.uk/website/de-real_files/figure-html/Monocle-plot2-1.png" alt="ROC curve for Monocle-gaussian."  />
<p class="caption">
Figure 8.18: ROC curve for Monocle-gaussian.
</p>
</div>
</div>
<div id="mast" class="section level3">
<h3><span class="header-section-number">8.7.6</span> MAST</h3>
<p><a href="https://bioconductor.org/packages/release/bioc/html/MAST.html">MAST</a> is based on a zero-inflated negative binomial model. It tests for differential expression using a hurdle model to combine tests of discrete (0 vs not zero) and continuous (non-zero values) aspects of gene expression. Again this uses a linear modelling framework to enable complex models to be considered.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" title="1">log_counts &lt;-<span class="st"> </span><span class="kw">log</span>(counts <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span><span class="kw">log</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb97-2" title="2">fData &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">names =</span> <span class="kw">rownames</span>(log_counts))</a>
<a class="sourceLine" id="cb97-3" title="3"><span class="kw">rownames</span>(fData) &lt;-<span class="st"> </span><span class="kw">rownames</span>(log_counts);</a>
<a class="sourceLine" id="cb97-4" title="4">cData &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">cond =</span> group)</a>
<a class="sourceLine" id="cb97-5" title="5"><span class="kw">rownames</span>(cData) &lt;-<span class="st"> </span><span class="kw">colnames</span>(log_counts)</a>
<a class="sourceLine" id="cb97-6" title="6"></a>
<a class="sourceLine" id="cb97-7" title="7">obj &lt;-<span class="st"> </span><span class="kw">FromMatrix</span>(<span class="kw">as.matrix</span>(log_counts), cData, fData)</a>
<a class="sourceLine" id="cb97-8" title="8"><span class="kw">colData</span>(obj)<span class="op">$</span>cngeneson &lt;-<span class="st"> </span><span class="kw">scale</span>(<span class="kw">colSums</span>(<span class="kw">assay</span>(obj) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>))</a>
<a class="sourceLine" id="cb97-9" title="9">cond &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">colData</span>(obj)<span class="op">$</span>cond)</a>
<a class="sourceLine" id="cb97-10" title="10"></a>
<a class="sourceLine" id="cb97-11" title="11"><span class="co"># Model expression as function of condition &amp; number of detected genes</span></a>
<a class="sourceLine" id="cb97-12" title="12">zlmCond &lt;-<span class="st"> </span><span class="kw">zlm.SingleCellAssay</span>(<span class="op">~</span><span class="st"> </span>cond <span class="op">+</span><span class="st"> </span>cngeneson, obj) </a>
<a class="sourceLine" id="cb97-13" title="13"></a>
<a class="sourceLine" id="cb97-14" title="14">summaryCond &lt;-<span class="st"> </span><span class="kw">summary</span>(zlmCond, <span class="dt">doLRT =</span> <span class="st">&quot;condNA19101&quot;</span>)</a>
<a class="sourceLine" id="cb97-15" title="15">summaryDt &lt;-<span class="st"> </span>summaryCond<span class="op">$</span>datatable</a>
<a class="sourceLine" id="cb97-16" title="16"></a>
<a class="sourceLine" id="cb97-17" title="17">summaryDt &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(summaryDt)</a>
<a class="sourceLine" id="cb97-18" title="18">pVals &lt;-<span class="st"> </span><span class="kw">unlist</span>(summaryDt[summaryDt<span class="op">$</span>component <span class="op">==</span><span class="st"> &quot;H&quot;</span>,<span class="dv">4</span>]) <span class="co"># H = hurdle model</span></a>
<a class="sourceLine" id="cb97-19" title="19"><span class="kw">names</span>(pVals) &lt;-<span class="st"> </span><span class="kw">unlist</span>(summaryDt[summaryDt<span class="op">$</span>component <span class="op">==</span><span class="st"> &quot;H&quot;</span>,<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb97-20" title="20">pVals &lt;-<span class="st"> </span><span class="kw">p.adjust</span>(pVals, <span class="dt">method =</span> <span class="st">&quot;fdr&quot;</span>)</a>
<a class="sourceLine" id="cb97-21" title="21"><span class="kw">DE_Quality_AUC</span>(pVals)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:MAST-plot"></span>
<img src="https://scrnaseq-course.cog.sanger.ac.uk/website/de-real_files/figure-html/MAST-plot-1.png" alt="ROC curve for MAST."  />
<p class="caption">
Figure 8.19: ROC curve for MAST.
</p>
</div>
</div>
<div id="slow-methods-1h-to-run" class="section level3">
<h3><span class="header-section-number">8.7.7</span> Slow Methods (&gt;1h to run)</h3>
<p>These methods are too slow to run today but we encourage you to try them out on your own:</p>
</div>
<div id="bpsc" class="section level3">
<h3><span class="header-section-number">8.7.8</span> BPSC</h3>
<p><a href="https://academic.oup.com/bioinformatics/article/32/14/2128/2288270/Beta-Poisson-model-for-single-cell-RNA-seq-data">BPSC</a> uses the Poisson-Beta model of single-cell gene expression, which we discussed in the previous chapter, and combines it with generalized linear models which we’ve already encountered when using edgeR. BPSC performs comparisons of one or more groups to a reference group (“control”) and can include other factors such as batches in the model.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" title="1"><span class="kw">library</span>(BPSC)</a>
<a class="sourceLine" id="cb98-2" title="2">bpsc_data &lt;-<span class="st"> </span>norm[,batch<span class="op">==</span><span class="st">&quot;NA19101.r1&quot;</span> <span class="op">|</span><span class="st"> </span>batch<span class="op">==</span><span class="st">&quot;NA19239.r1&quot;</span>]</a>
<a class="sourceLine" id="cb98-3" title="3">bpsc_group =<span class="st"> </span>group[batch<span class="op">==</span><span class="st">&quot;NA19101.r1&quot;</span> <span class="op">|</span><span class="st"> </span>batch<span class="op">==</span><span class="st">&quot;NA19239.r1&quot;</span>]</a>
<a class="sourceLine" id="cb98-4" title="4"></a>
<a class="sourceLine" id="cb98-5" title="5">control_cells &lt;-<span class="st"> </span><span class="kw">which</span>(bpsc_group <span class="op">==</span><span class="st"> &quot;NA19101&quot;</span>)</a>
<a class="sourceLine" id="cb98-6" title="6">design &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(<span class="op">~</span>bpsc_group)</a>
<a class="sourceLine" id="cb98-7" title="7">coef=<span class="dv">2</span> <span class="co"># group label</span></a>
<a class="sourceLine" id="cb98-8" title="8">res=<span class="kw">BPglm</span>(<span class="dt">data=</span>bpsc_data, <span class="dt">controlIds=</span>control_cells, <span class="dt">design=</span>design, <span class="dt">coef=</span>coef, </a>
<a class="sourceLine" id="cb98-9" title="9">                <span class="dt">estIntPar=</span><span class="ot">FALSE</span>, <span class="dt">useParallel =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb98-10" title="10">pVals =<span class="st"> </span>res<span class="op">$</span>PVAL</a>
<a class="sourceLine" id="cb98-11" title="11">pVals &lt;-<span class="st"> </span><span class="kw">p.adjust</span>(pVals, <span class="dt">method =</span> <span class="st">&quot;fdr&quot;</span>)</a>
<a class="sourceLine" id="cb98-12" title="12"><span class="kw">DE_Quality_AUC</span>(pVals)</a></code></pre></div>
</div>
<div id="scde" class="section level3">
<h3><span class="header-section-number">8.7.9</span> SCDE</h3>
<p><a href="http://hms-dbmi.github.io/scde/">SCDE</a> is the first single-cell specific DE method. It fits a zero-inflated negative binomial model to expression data using Bayesian statistics. The usage below tests for differences in mean expression of individual genes across groups but recent versions include methods to test for differences in mean expression or dispersion of groups of genes, usually representing a pathway.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" title="1"><span class="kw">library</span>(scde)</a>
<a class="sourceLine" id="cb99-2" title="2">cnts &lt;-<span class="st"> </span><span class="kw">apply</span>(</a>
<a class="sourceLine" id="cb99-3" title="3">    counts,</a>
<a class="sourceLine" id="cb99-4" title="4">    <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb99-5" title="5">    <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb99-6" title="6">        <span class="kw">storage.mode</span>(x) &lt;-<span class="st"> &#39;integer&#39;</span></a>
<a class="sourceLine" id="cb99-7" title="7">        <span class="kw">return</span>(x)</a>
<a class="sourceLine" id="cb99-8" title="8">    }</a>
<a class="sourceLine" id="cb99-9" title="9">)</a>
<a class="sourceLine" id="cb99-10" title="10"><span class="kw">names</span>(group) &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(group)</a>
<a class="sourceLine" id="cb99-11" title="11"><span class="kw">colnames</span>(cnts) &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(group)</a>
<a class="sourceLine" id="cb99-12" title="12">o.ifm &lt;-<span class="st"> </span>scde<span class="op">::</span><span class="kw">scde.error.models</span>(</a>
<a class="sourceLine" id="cb99-13" title="13">    <span class="dt">counts =</span> cnts,</a>
<a class="sourceLine" id="cb99-14" title="14">    <span class="dt">groups =</span> group,</a>
<a class="sourceLine" id="cb99-15" title="15">    <span class="dt">n.cores =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb99-16" title="16">    <span class="dt">threshold.segmentation =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb99-17" title="17">    <span class="dt">save.crossfit.plots =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb99-18" title="18">    <span class="dt">save.model.plots =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb99-19" title="19">    <span class="dt">verbose =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb99-20" title="20">    <span class="dt">min.size.entries =</span> <span class="dv">2</span></a>
<a class="sourceLine" id="cb99-21" title="21">)</a>
<a class="sourceLine" id="cb99-22" title="22">priors &lt;-<span class="st"> </span>scde<span class="op">::</span><span class="kw">scde.expression.prior</span>(</a>
<a class="sourceLine" id="cb99-23" title="23">    <span class="dt">models =</span> o.ifm,</a>
<a class="sourceLine" id="cb99-24" title="24">    <span class="dt">counts =</span> cnts,</a>
<a class="sourceLine" id="cb99-25" title="25">    <span class="dt">length.out =</span> <span class="dv">400</span>,</a>
<a class="sourceLine" id="cb99-26" title="26">    <span class="dt">show.plot =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb99-27" title="27">)</a>
<a class="sourceLine" id="cb99-28" title="28">resSCDE &lt;-<span class="st"> </span>scde<span class="op">::</span><span class="kw">scde.expression.difference</span>(</a>
<a class="sourceLine" id="cb99-29" title="29">    o.ifm,</a>
<a class="sourceLine" id="cb99-30" title="30">    cnts,</a>
<a class="sourceLine" id="cb99-31" title="31">    priors,</a>
<a class="sourceLine" id="cb99-32" title="32">    <span class="dt">groups =</span> group,</a>
<a class="sourceLine" id="cb99-33" title="33">    <span class="dt">n.randomizations =</span> <span class="dv">100</span>,</a>
<a class="sourceLine" id="cb99-34" title="34">    <span class="dt">n.cores =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb99-35" title="35">    <span class="dt">verbose =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb99-36" title="36">)</a>
<a class="sourceLine" id="cb99-37" title="37"><span class="co"># Convert Z-scores into 2-tailed p-values</span></a>
<a class="sourceLine" id="cb99-38" title="38">pVals &lt;-<span class="st"> </span><span class="kw">pnorm</span>(<span class="kw">abs</span>(resSCDE<span class="op">$</span>cZ), <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>) <span class="op">*</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb99-39" title="39"><span class="kw">DE_Quality_AUC</span>(pVals)</a></code></pre></div>
</div>
</div>
<div id="comparingcombining-scrnaseq-datasets" class="section level2">
<h2><span class="header-section-number">8.8</span> Comparing/Combining scRNASeq datasets</h2>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" title="1"><span class="kw">library</span>(scater)</a>
<a class="sourceLine" id="cb100-2" title="2"><span class="kw">library</span>(SingleCellExperiment)</a></code></pre></div>
<div id="introduction-1" class="section level3">
<h3><span class="header-section-number">8.8.1</span> Introduction</h3>
<p>As more and more scRNA-seq datasets become available, carrying merged_seurat comparisons between them is key. There are two main
approaches to comparing scRNASeq datasets. The first approach is “label-centric” which is focused on trying
to identify equivalent cell-types/states across datasets by comparing individual cells or groups of cells. The other approach
is “cross-dataset normalization” which attempts to computationally remove experiment-specific technical/biological effects
so that data from multiple experiments can be combined and jointly analyzed.</p>
<p>The label-centric approach can be used with dataset with high-confidence cell-annotations, e.g. the Human Cell Atlas (HCA)
<span class="citation">(Regev et al. <a href="#ref-Regev2017-mw">2017</a>)</span> or the Tabula Muris <span class="citation">(Consortium and others <a href="#ref-tabula2018single">2018</a>)</span> once they are completed, to project cells or clusters from a new sample onto
this reference to consider tissue composition and/or identify cells with novel/unknown identity. Conceptually, such
projections are similar to the popular BLAST method <span class="citation">(Altschul et al. <a href="#ref-Altschul1990-ts">1990</a>)</span>, which makes it possible to quickly find the closest
match in a database for a newly identified nucleotide or amino acid sequence. The label-centric approach can also be used to
compare datasets of similar biological origin collected by different labs to ensure that the annotation and the analysis is
consistent.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-138"></span>
<img src="figures/CourseCompareTypes.png" alt="Label-centric dataset comparison can be used to compare the annotations of two different samples." width="950" />
<p class="caption">
Figure 8.20: Label-centric dataset comparison can be used to compare the annotations of two different samples.
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-139"></span>
<img src="figures/CourseAtlasAssignment.png" alt="Label-centric dataset comparison can project cells from a new experiment onto an annotated reference." width="871" />
<p class="caption">
Figure 8.21: Label-centric dataset comparison can project cells from a new experiment onto an annotated reference.
</p>
</div>
<p>The cross-dataset normalization approach can also be used to compare datasets of similar biological origin, unlike the label-centric approach it enables the join analysis of multiple datasets to facilitate the identification of rare cell-types which may to too sparsely sampled in each individual dataset to be reliably detected. However, cross-dataset normalization is not applicable to very large and diverse references since it assumes a significant portion of the biological variablility in each of the datasets overlaps with others.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-140"></span>
<img src="figures/CourseCrossNorm.png" alt="Cross-dataset normalization enables joint-analysis of 2+ scRNASeq datasets." width="822" />
<p class="caption">
Figure 8.22: Cross-dataset normalization enables joint-analysis of 2+ scRNASeq datasets.
</p>
</div>
</div>
<div id="datasets" class="section level3">
<h3><span class="header-section-number">8.8.2</span> Datasets</h3>
<p>We will running these methods on two human pancreas datasets: <span class="citation">(Muraro et al. <a href="#ref-Muraro2016-yk">2016</a>)</span> and <span class="citation">(Segerstolpe et al. <a href="#ref-Segerstolpe2016-wc">2016</a>)</span>. Since the pancreas has been widely studied, these datasets are well annotated.</p>
<p>This data has already been formatted for scmap. Cell type labels must be stored in the <code>cell_type1</code> column of the <code>colData</code> slots, and gene ids that are consistent across both datasets must be stored in the <code>feature_symbol</code> column of the <code>rowData</code> slots.</p>
<p>First, lets check our gene-ids match across both datasets:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" title="1"><span class="kw">sum</span>(<span class="kw">rowData</span>(muraro)<span class="op">$</span>feature_symbol <span class="op">%in%</span><span class="st"> </span><span class="kw">rowData</span>(segerstolpe)<span class="op">$</span>feature_symbol)<span class="op">/</span><span class="kw">nrow</span>(muraro)</a>
<a class="sourceLine" id="cb101-2" title="2"><span class="co">## [1] 0.9599519</span></a>
<a class="sourceLine" id="cb101-3" title="3"><span class="kw">sum</span>(<span class="kw">rowData</span>(segerstolpe)<span class="op">$</span>feature_symbol <span class="op">%in%</span><span class="st"> </span><span class="kw">rowData</span>(muraro)<span class="op">$</span>feature_symbol)<span class="op">/</span><span class="kw">nrow</span>(segerstolpe)</a>
<a class="sourceLine" id="cb101-4" title="4"><span class="co">## [1] 0.719334</span></a></code></pre></div>
<p>Here we can see that 96% of the genes present in muraro match genes in segerstople and 72% of genes in segerstolpe are match
genes in muraro. This is as expected because the segerstolpe dataset was more deeply sequenced than the muraro dataset.
However, it highlights some of the difficulties in comparing scRNASeq datasets.</p>
<p>We can confirm this by checking the overall size of these two datasets.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" title="1"><span class="kw">dim</span>(muraro)</a>
<a class="sourceLine" id="cb102-2" title="2"><span class="co">## [1] 19127  2126</span></a>
<a class="sourceLine" id="cb102-3" title="3"><span class="kw">dim</span>(segerstolpe)</a>
<a class="sourceLine" id="cb102-4" title="4"><span class="co">## [1] 25525  3514</span></a></code></pre></div>
<p>In addition, we can check the cell-type annotations for each of these dataset using the command below:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" title="1"><span class="kw">summary</span>(<span class="kw">factor</span>(<span class="kw">colData</span>(muraro)<span class="op">$</span>cell_type1))</a>
<a class="sourceLine" id="cb103-2" title="2"><span class="co">##      acinar       alpha        beta       delta      ductal endothelial </span></a>
<a class="sourceLine" id="cb103-3" title="3"><span class="co">##         219         812         448         193         245          21 </span></a>
<a class="sourceLine" id="cb103-4" title="4"><span class="co">##     epsilon       gamma mesenchymal     unclear </span></a>
<a class="sourceLine" id="cb103-5" title="5"><span class="co">##           3         101          80           4</span></a>
<a class="sourceLine" id="cb103-6" title="6"><span class="kw">summary</span>(<span class="kw">factor</span>(<span class="kw">colData</span>(segerstolpe)<span class="op">$</span>cell_type1))</a>
<a class="sourceLine" id="cb103-7" title="7"><span class="co">##                 acinar                  alpha                   beta </span></a>
<a class="sourceLine" id="cb103-8" title="8"><span class="co">##                    185                    886                    270 </span></a>
<a class="sourceLine" id="cb103-9" title="9"><span class="co">##          co-expression                  delta                 ductal </span></a>
<a class="sourceLine" id="cb103-10" title="10"><span class="co">##                     39                    114                    386 </span></a>
<a class="sourceLine" id="cb103-11" title="11"><span class="co">##            endothelial                epsilon                  gamma </span></a>
<a class="sourceLine" id="cb103-12" title="12"><span class="co">##                     16                      7                    197 </span></a>
<a class="sourceLine" id="cb103-13" title="13"><span class="co">##                   mast           MHC class II         not applicable </span></a>
<a class="sourceLine" id="cb103-14" title="14"><span class="co">##                      7                      5                   1305 </span></a>
<a class="sourceLine" id="cb103-15" title="15"><span class="co">##                    PSC           unclassified unclassified endocrine </span></a>
<a class="sourceLine" id="cb103-16" title="16"><span class="co">##                     54                      2                     41</span></a></code></pre></div>
<p>Here we can see that even though both datasets considered the same biological tissue the two datasets, they have been
annotated with slightly different sets of cell-types. If you are familiar withpancreas biology you might recognize
that the pancreatic stellate cells (PSCs) in segerstolpe are a type of mesenchymal stem cell which would fall under
the “mesenchymal” type in muraro. However, it isn’t clear whether these two annotations should be considered synonymous
or not. We can use label-centric comparison methods to determine if these two cell-type annotations are indeed equivalent.</p>
<p>Alternatively, we might be interested in understanding the function of those cells that were “unclassified endocrine” or were deemed
too poor quality (“not applicable”) for the original clustering in each dataset by leveraging in formation across datasets. Either
we could attempt to infer which of the existing annotations they most likely belong to using label-centric approaches or we could try
to uncover a novel cell-type among them (or a sub-type within the existing annotations) using cross-dataset normalization.</p>
<p>To simplify our demonstration analyses we will remove the small classes of unassigned cells, and the poor quality cells. We will retain the “unclassified endocrine” to
see if any of these methods can elucidate what cell-type they belong to.</p>
</div>
<div id="projecting-cells-onto-annotated-cell-types-scmap" class="section level3">
<h3><span class="header-section-number">8.8.3</span> Projecting cells onto annotated cell-types (scmap)</h3>
<p>We recently developed <code>scmap</code> <span class="citation">(Kiselev and Hemberg <a href="#ref-Kiselev2017-nb">2017</a>)</span> - a method for projecting cells from a scRNA-seq experiment onto the cell-types identified in other experiments. Additionally, a cloud version of <code>scmap</code> can be run for free, withmerged_seurat restrictions, from <a href="http://www.hemberg-lab.cloud/scmap">http://www.hemberg-lab.cloud/scmap</a>.</p>
<div id="feature-selection-1" class="section level4">
<h4><span class="header-section-number">8.8.3.1</span> Feature Selection</h4>
<p>Once we have a <code>SingleCellExperiment</code> object we can run <code>scmap</code>. First we have to build the “index” of our reference
clusters. Since we want to know whether PSCs and mesenchymal cells are synonymous we will project each dataset to the
other so we will build an index for each dataset. This requires first selecting the most informative features for the
reference dataset.</p>
<pre><code>## Warning in linearModel(object, n_features): Your object does not contain
## counts() slot. Dropouts were calculated using logcounts() slot...</code></pre>
<p><img src="08biological-analysis_files/figure-html/unnamed-chunk-147-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Genes highlighted with the red colour will be used in the futher analysis (projection).</p>
<p><img src="08biological-analysis_files/figure-html/unnamed-chunk-149-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>From the y-axis of these plots we can see that scmap uses a dropmerged_seurat-based feature selection method.</p>
<p>Now calculate the cell-type index:</p>
<p>We can also visualize the index:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" title="1"><span class="kw">heatmap</span>(<span class="kw">as.matrix</span>(<span class="kw">metadata</span>(muraro)<span class="op">$</span>scmap_cluster_index))</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/projection_files/figure-html/unnamed-chunk-15-1.png" style="display: block; margin: auto;" /></p>
<p>You may want to adjust your features using the <code>setFeatures</code> function if features are too heavily concentrated in only a few cell-types. In this case the dropmerged_seurat-based features look good so we will just them.</p>
<p><strong>Exercise</strong>
Using the rowData of each dataset how many genes were selected as features in both datasets? What does this tell you abmerged_seurat these datasets?</p>
<p><strong>Answer</strong></p>
</div>
<div id="projecting" class="section level4">
<h4><span class="header-section-number">8.8.3.2</span> Projecting</h4>
<p>scmap computes the distance from each cell to each cell-type in the reference index, then applies an empirically derived threshold to determine which cells are assigned to the closest reference cell-type and which are unassigned. To account for differences in sequencing depth distance is calculated using the spearman correlation and cosine distance and only cells with a consistent assignment with both distances are returned as assigned.</p>
<p>We will project the <code>segerstolpe</code> dataset to <code>muraro</code> dataset:</p>
<p>and <code>muraro</code> onto <code>segerstolpe</code></p>
<p>Note that in each case we are projecting to a single dataset but that this could be extended to any number of datasets for which we have computed indices.</p>
<p>Now lets compare the original cell-type labels with the projected labels:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" title="1"><span class="kw">table</span>(<span class="kw">colData</span>(muraro)<span class="op">$</span>cell_type1, muraro_to_seger<span class="op">$</span>scmap_cluster_labs)</a>
<a class="sourceLine" id="cb106-2" title="2"><span class="co">##              </span></a>
<a class="sourceLine" id="cb106-3" title="3"><span class="co">##               acinar alpha beta co-expression delta ductal endothelial</span></a>
<a class="sourceLine" id="cb106-4" title="4"><span class="co">##   acinar         211     0    0             0     0      0           0</span></a>
<a class="sourceLine" id="cb106-5" title="5"><span class="co">##   alpha            1   763    0            18     0      2           0</span></a>
<a class="sourceLine" id="cb106-6" title="6"><span class="co">##   beta             2     1  397             7     2      2           0</span></a>
<a class="sourceLine" id="cb106-7" title="7"><span class="co">##   delta            0     0    2             1   173      0           0</span></a>
<a class="sourceLine" id="cb106-8" title="8"><span class="co">##   ductal           7     0    0             0     0    208           0</span></a>
<a class="sourceLine" id="cb106-9" title="9"><span class="co">##   endothelial      0     0    0             0     0      0          15</span></a>
<a class="sourceLine" id="cb106-10" title="10"><span class="co">##   epsilon          0     0    0             0     0      0           0</span></a>
<a class="sourceLine" id="cb106-11" title="11"><span class="co">##   gamma            2     0    0             0     0      0           0</span></a>
<a class="sourceLine" id="cb106-12" title="12"><span class="co">##   mesenchymal      0     0    0             0     0      1           0</span></a>
<a class="sourceLine" id="cb106-13" title="13"><span class="co">##              </span></a>
<a class="sourceLine" id="cb106-14" title="14"><span class="co">##               epsilon gamma MHC class II PSC unassigned</span></a>
<a class="sourceLine" id="cb106-15" title="15"><span class="co">##   acinar            0     0            0   0          8</span></a>
<a class="sourceLine" id="cb106-16" title="16"><span class="co">##   alpha             0     2            0   0         26</span></a>
<a class="sourceLine" id="cb106-17" title="17"><span class="co">##   beta              0     5            1   2         29</span></a>
<a class="sourceLine" id="cb106-18" title="18"><span class="co">##   delta             0     0            0   0         17</span></a>
<a class="sourceLine" id="cb106-19" title="19"><span class="co">##   ductal            0     0            5   3         22</span></a>
<a class="sourceLine" id="cb106-20" title="20"><span class="co">##   endothelial       0     0            0   1          5</span></a>
<a class="sourceLine" id="cb106-21" title="21"><span class="co">##   epsilon           3     0            0   0          0</span></a>
<a class="sourceLine" id="cb106-22" title="22"><span class="co">##   gamma             0    95            0   0          4</span></a>
<a class="sourceLine" id="cb106-23" title="23"><span class="co">##   mesenchymal       0     0            0  77          2</span></a></code></pre></div>
<p>Here we can see that cell-types do map to their equivalents in segerstolpe, and importantly we see that all but one of the “mesenchymal” cells were assigned to the “PSC” class.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" title="1"><span class="kw">table</span>(<span class="kw">colData</span>(segerstolpe)<span class="op">$</span>cell_type1, seger_to_muraro<span class="op">$</span>scmap_cluster_labs)</a>
<a class="sourceLine" id="cb107-2" title="2"><span class="co">##                         </span></a>
<a class="sourceLine" id="cb107-3" title="3"><span class="co">##                          acinar alpha beta delta ductal endothelial</span></a>
<a class="sourceLine" id="cb107-4" title="4"><span class="co">##   acinar                    181     0    0     0      4           0</span></a>
<a class="sourceLine" id="cb107-5" title="5"><span class="co">##   alpha                       0   869    1     0      0           0</span></a>
<a class="sourceLine" id="cb107-6" title="6"><span class="co">##   beta                        0     0  260     0      0           0</span></a>
<a class="sourceLine" id="cb107-7" title="7"><span class="co">##   co-expression               0     7   31     0      0           0</span></a>
<a class="sourceLine" id="cb107-8" title="8"><span class="co">##   delta                       0     0    1   111      0           0</span></a>
<a class="sourceLine" id="cb107-9" title="9"><span class="co">##   ductal                      0     0    0     0    383           0</span></a>
<a class="sourceLine" id="cb107-10" title="10"><span class="co">##   endothelial                 0     0    0     0      0          14</span></a>
<a class="sourceLine" id="cb107-11" title="11"><span class="co">##   epsilon                     0     0    0     0      0           0</span></a>
<a class="sourceLine" id="cb107-12" title="12"><span class="co">##   gamma                       0     2    0     0      0           0</span></a>
<a class="sourceLine" id="cb107-13" title="13"><span class="co">##   mast                        0     0    0     0      0           0</span></a>
<a class="sourceLine" id="cb107-14" title="14"><span class="co">##   MHC class II                0     0    0     0      0           0</span></a>
<a class="sourceLine" id="cb107-15" title="15"><span class="co">##   PSC                         0     0    1     0      0           0</span></a>
<a class="sourceLine" id="cb107-16" title="16"><span class="co">##   unclassified endocrine      0     0    0     0      0           0</span></a>
<a class="sourceLine" id="cb107-17" title="17"><span class="co">##                         </span></a>
<a class="sourceLine" id="cb107-18" title="18"><span class="co">##                          epsilon gamma mesenchymal unassigned</span></a>
<a class="sourceLine" id="cb107-19" title="19"><span class="co">##   acinar                       0     0           0          0</span></a>
<a class="sourceLine" id="cb107-20" title="20"><span class="co">##   alpha                        0     0           0         16</span></a>
<a class="sourceLine" id="cb107-21" title="21"><span class="co">##   beta                         0     0           0         10</span></a>
<a class="sourceLine" id="cb107-22" title="22"><span class="co">##   co-expression                0     0           0          1</span></a>
<a class="sourceLine" id="cb107-23" title="23"><span class="co">##   delta                        0     0           0          2</span></a>
<a class="sourceLine" id="cb107-24" title="24"><span class="co">##   ductal                       0     0           0          3</span></a>
<a class="sourceLine" id="cb107-25" title="25"><span class="co">##   endothelial                  0     0           0          2</span></a>
<a class="sourceLine" id="cb107-26" title="26"><span class="co">##   epsilon                      6     0           0          1</span></a>
<a class="sourceLine" id="cb107-27" title="27"><span class="co">##   gamma                        0   192           0          3</span></a>
<a class="sourceLine" id="cb107-28" title="28"><span class="co">##   mast                         0     0           0          7</span></a>
<a class="sourceLine" id="cb107-29" title="29"><span class="co">##   MHC class II                 0     0           0          5</span></a>
<a class="sourceLine" id="cb107-30" title="30"><span class="co">##   PSC                          0     0          53          0</span></a>
<a class="sourceLine" id="cb107-31" title="31"><span class="co">##   unclassified endocrine       0     0           0         41</span></a></code></pre></div>
<p>Again we see cell-types match each other and that all but one of the “PSCs” match the “mesenchymal” cells providing strong evidence that these two annotations should be considered synonymous.</p>
<p>We can also visualize these tables using a <a href="https://developers.google.com/chart/interactive/docs/gallery/sankey">Sankey diagram</a>:
<!-- Sankey generated in R 3.6.0 by googleVis 0.6.4 package -->
<!-- Sat Jul 13 16:17:03 2019 --></p>
<!-- jsHeader -->
<script type="text/javascript">
 
// jsData 
function gvisDataSankeyID27c84fd33e3a () {
var data = new google.visualization.DataTable();
var datajson =
[
 [
"alpha ",
" alpha",
763
],
[
"beta ",
" beta",
397
],
[
"acinar ",
" acinar",
211
],
[
"ductal ",
" ductal",
208
],
[
"delta ",
" delta",
173
],
[
"gamma ",
" gamma",
95
],
[
"mesenchymal ",
" PSC",
77
],
[
"endothelial ",
" endothelial",
15
],
[
"epsilon ",
" epsilon",
3
],
[
"acinar ",
" unassigned",
8
],
[
"alpha ",
" ductal",
2
],
[
"alpha ",
" unassigned",
26
],
[
"alpha ",
" acinar",
1
],
[
"alpha ",
" co-expression",
18
],
[
"alpha ",
" gamma",
2
],
[
"beta ",
" unassigned",
29
],
[
"beta ",
" gamma",
5
],
[
"beta ",
" MHC class II",
1
],
[
"beta ",
" alpha",
1
],
[
"beta ",
" co-expression",
7
],
[
"beta ",
" acinar",
2
],
[
"beta ",
" PSC",
2
],
[
"beta ",
" ductal",
2
],
[
"beta ",
" delta",
2
],
[
"delta ",
" beta",
2
],
[
"delta ",
" unassigned",
17
],
[
"delta ",
" co-expression",
1
],
[
"ductal ",
" acinar",
7
],
[
"ductal ",
" PSC",
3
],
[
"ductal ",
" MHC class II",
5
],
[
"ductal ",
" unassigned",
22
],
[
"endothelial ",
" PSC",
1
],
[
"endothelial ",
" unassigned",
5
],
[
"gamma ",
" acinar",
2
],
[
"gamma ",
" unassigned",
4
],
[
"mesenchymal ",
" ductal",
1
],
[
"mesenchymal ",
" unassigned",
2
] 
];
data.addColumn('string','From');
data.addColumn('string','To');
data.addColumn('number','# of cells');
data.addRows(datajson);
return(data);
}
 
// jsDrawChart
function drawChartSankeyID27c84fd33e3a() {
var data = gvisDataSankeyID27c84fd33e3a();
var options = {};
options["width"] = 400;
options["height"] = 400;
options["sankey"] = {
                node:{
                    label:{
                        fontName:'Arial',
                        fontSize:11,color:
                        '#000000',
                        bold:true,
                        italic:false
                    },
                    colors:'#FFFFFF',
                    nodePadding:12
                },iterations:0
            };

    var chart = new google.visualization.Sankey(
    document.getElementById('SankeyID27c84fd33e3a')
    );
    chart.draw(data,options);
    

}
  
 
// jsDisplayChart
(function() {
var pkgs = window.__gvisPackages = window.__gvisPackages || [];
var callbacks = window.__gvisCallbacks = window.__gvisCallbacks || [];
var chartid = "sankey";
  
// Manually see if chartid is in pkgs (not all browsers support Array.indexOf)
var i, newPackage = true;
for (i = 0; newPackage && i < pkgs.length; i++) {
if (pkgs[i] === chartid)
newPackage = false;
}
if (newPackage)
  pkgs.push(chartid);
  
// Add the drawChart function to the global list of callbacks
callbacks.push(drawChartSankeyID27c84fd33e3a);
})();
function displayChartSankeyID27c84fd33e3a() {
  var pkgs = window.__gvisPackages = window.__gvisPackages || [];
  var callbacks = window.__gvisCallbacks = window.__gvisCallbacks || [];
  window.clearTimeout(window.__gvisLoad);
  // The timeout is set to 100 because otherwise the container div we are
  // targeting might not be part of the document yet
  window.__gvisLoad = setTimeout(function() {
  var pkgCount = pkgs.length;
  google.load("visualization", "1", { packages:pkgs, callback: function() {
  if (pkgCount != pkgs.length) {
  // Race condition where another setTimeout call snuck in after us; if
  // that call added a package, we must not shift its callback
  return;
}
while (callbacks.length > 0)
callbacks.shift()();
} });
}, 100);
}
 
// jsFooter
</script>
<!-- jsChart -->
<script type="text/javascript" src="https://www.google.com/jsapi?callback=displayChartSankeyID27c84fd33e3a"></script>
<!-- divChart -->
<div id="SankeyID27c84fd33e3a" style="width: 400; height: 400;">

</div>
<p><strong>Exercise</strong>
How many of the previously unclassified cells would be be able to assign to cell-types using scmap?</p>
<p><strong>Answer</strong></p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" title="1">t2 &lt;-<span class="st"> </span><span class="kw">table</span>(<span class="kw">colData</span>(segerstolpe)<span class="op">$</span>cell_type1, seger_to_muraro<span class="op">$</span>scmap_cluster_labs)</a>
<a class="sourceLine" id="cb108-2" title="2">seger_assigned &lt;-<span class="st"> </span><span class="kw">sum</span>(t2[<span class="kw">c</span>(<span class="st">&quot;unclassified endocrine&quot;</span>), <span class="dv">1</span><span class="op">:</span><span class="dv">9</span>])</a></code></pre></div>
</div>
</div>
<div id="cell-to-cell-mapping" class="section level3">
<h3><span class="header-section-number">8.8.4</span> Cell-to-Cell mapping</h3>
<p>scmap can also project each cell in one dataset to its approximate closest neighbouring cell in the reference dataset. This
uses a highly optimized search algorithm allowing it to be scaled to very large references (in theory 100,000-millions of
cells). However, this process is stochastic so we must fix the random seed to ensure we can reproduce our results.</p>
<p>We have already performed feature selection for this dataset so we can go straight to building the index.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" title="1"><span class="kw">set.seed</span>(<span class="dv">193047</span>)</a>
<a class="sourceLine" id="cb109-2" title="2">segerstolpe &lt;-<span class="st"> </span><span class="kw">indexCell</span>(segerstolpe)</a>
<a class="sourceLine" id="cb109-3" title="3">muraro &lt;-<span class="st"> </span><span class="kw">indexCell</span>(muraro)</a></code></pre></div>
<p>In this case the index is a series of clusterings of each cell using different sets of features, parameters k and M are the
number of clusters and the number of features used in each of these subclusterings. New cells are assigned to the nearest
cluster in each subclustering to generate unique pattern of cluster assignments. We then find the cell in the reference
dataset with the same or most similar pattern of cluster assignments.</p>
<p>We can examine the cluster assignment patterns for the reference datasets using:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" title="1"><span class="kw">metadata</span>(muraro)<span class="op">$</span>scmap_cell_index<span class="op">$</span>subclusters[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb110-2" title="2"><span class="co">##      D28.1_1 D28.1_13 D28.1_15 D28.1_17 D28.1_2</span></a>
<a class="sourceLine" id="cb110-3" title="3"><span class="co">## [1,]       4        6        4       24      34</span></a>
<a class="sourceLine" id="cb110-4" title="4"><span class="co">## [2,]      16       27       14       11       3</span></a>
<a class="sourceLine" id="cb110-5" title="5"><span class="co">## [3,]      18       12       17       26      24</span></a>
<a class="sourceLine" id="cb110-6" title="6"><span class="co">## [4,]      44       33       41       44      12</span></a>
<a class="sourceLine" id="cb110-7" title="7"><span class="co">## [5,]      39       44       23       34      32</span></a></code></pre></div>
<p>To project and find the <code>w</code> nearest neighbours we use a similar command as before:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" title="1">muraro_to_seger &lt;-<span class="st"> </span><span class="kw">scmapCell</span>(</a>
<a class="sourceLine" id="cb111-2" title="2">  <span class="dt">projection =</span> muraro,</a>
<a class="sourceLine" id="cb111-3" title="3">  <span class="dt">index_list =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb111-4" title="4">    <span class="dt">seger =</span> <span class="kw">metadata</span>(segerstolpe)<span class="op">$</span>scmap_cell_index</a>
<a class="sourceLine" id="cb111-5" title="5">  ),</a>
<a class="sourceLine" id="cb111-6" title="6">  <span class="dt">w =</span> <span class="dv">5</span></a>
<a class="sourceLine" id="cb111-7" title="7">)</a></code></pre></div>
<p>We can again look at the results:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" title="1">muraro_to_seger<span class="op">$</span>seger[[<span class="dv">1</span>]][,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb112-2" title="2"><span class="co">##      D28.1_1 D28.1_13 D28.1_15 D28.1_17 D28.1_2</span></a>
<a class="sourceLine" id="cb112-3" title="3"><span class="co">## [1,]    1448     1381     1125     1834    1553</span></a>
<a class="sourceLine" id="cb112-4" title="4"><span class="co">## [2,]    1731      855     1081     1731    1437</span></a>
<a class="sourceLine" id="cb112-5" title="5"><span class="co">## [3,]    1229     2113     2104     1790    1890</span></a>
<a class="sourceLine" id="cb112-6" title="6"><span class="co">## [4,]    2015     1833     1153     1882    1593</span></a>
<a class="sourceLine" id="cb112-7" title="7"><span class="co">## [5,]    1159     1854     1731     1202    1078</span></a></code></pre></div>
<p>This shows the column number of the 5 nearest neighbours in segerstolpe to each of the cells in muraro. We could then calculate a pseudotime estimate, branch assignment, or other cell-level data by selecting the appropriate data from the colData of
the segerstolpe data set. As a demonstration we will find the cell-type of the nearest neighbour of each cell.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" title="1">cell_type_NN &lt;-<span class="st"> </span><span class="kw">colData</span>(segerstolpe)<span class="op">$</span>cell_type1[muraro_to_seger<span class="op">$</span>seger[[<span class="dv">1</span>]][<span class="dv">1</span>,]]</a>
<a class="sourceLine" id="cb113-2" title="2"><span class="kw">head</span>(cell_type_NN)</a>
<a class="sourceLine" id="cb113-3" title="3">cell_type_NN &lt;-<span class="st"> </span><span class="kw">colData</span>(segerstolpe)<span class="op">$</span>cell_type1[muraro_to_seger<span class="op">$</span>seger[[<span class="dv">1</span>]][<span class="dv">1</span>,]]</a>
<a class="sourceLine" id="cb113-4" title="4"><span class="kw">head</span>(cell_type_NN)</a></code></pre></div>
</div>
<div id="metaneighbour" class="section level3">
<h3><span class="header-section-number">8.8.5</span> Metaneighbour</h3>
<p><a href="https://www.biorxiv.org/content/early/2017/06/16/150524">Metaneighbour</a> is specifically designed to ask whether cell-type labels are consistent across datasets. It comes in two
versions. First is a fully supervised method which assumes cell-types are known in all datasets and calculates how “good” those cell-type labels are. (The precise meaning of “good” will be described below). Alternatively, metaneighbour can estimate how similar all cell-types are to each other both within and across datasets. We will only be using the unsupervised version as it has much more general applicability and is easier to interpret the results of.</p>
<p>Metaneighbour compares cell-types across datasets by building a cell-cell spearman correlation network. The method then tries to predict the label of each cell through weighted “votes” of its nearest-neighbours. Then scores the overall similarity between two clusters as the AUROC for assigning cells of typeA to typeB based on these weighted votes. AUROC of 1 would indicate all the cells of typeA were assigned to typeB before any other cells were, and an AUROC of 0.5 is what you would get if cells were being randomly assigned.</p>
<p>Metanighbour is just a couple of R functions not a complete package so we have to load them using <code>source</code></p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" title="1"><span class="kw">source</span>(<span class="st">&quot;utils/2017-08-28-runMN-US.R&quot;</span>)</a></code></pre></div>
<div id="prepare-data" class="section level4">
<h4><span class="header-section-number">8.8.5.1</span> Prepare Data</h4>
<p>Metaneighbour requires all datasets to be combined into a single expression matrix prior to running:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" title="1">is.common &lt;-<span class="st"> </span><span class="kw">rowData</span>(muraro)<span class="op">$</span>feature_symbol <span class="op">%in%</span><span class="st"> </span><span class="kw">rowData</span>(segerstolpe)<span class="op">$</span>feature_symbol</a>
<a class="sourceLine" id="cb115-2" title="2">muraro &lt;-<span class="st"> </span>muraro[is.common,]</a>
<a class="sourceLine" id="cb115-3" title="3">segerstolpe &lt;-<span class="st"> </span>segerstolpe[<span class="kw">match</span>(<span class="kw">rowData</span>(muraro)<span class="op">$</span>feature_symbol, <span class="kw">rowData</span>(segerstolpe)<span class="op">$</span>feature_symbol),]</a>
<a class="sourceLine" id="cb115-4" title="4"><span class="kw">rownames</span>(segerstolpe) &lt;-<span class="st"> </span><span class="kw">rowData</span>(segerstolpe)<span class="op">$</span>feature_symbol</a>
<a class="sourceLine" id="cb115-5" title="5"><span class="kw">rownames</span>(muraro) &lt;-<span class="st"> </span><span class="kw">rowData</span>(muraro)<span class="op">$</span>feature_symbol</a>
<a class="sourceLine" id="cb115-6" title="6"><span class="kw">identical</span>(<span class="kw">rownames</span>(segerstolpe), <span class="kw">rownames</span>(muraro))</a>
<a class="sourceLine" id="cb115-7" title="7"></a>
<a class="sourceLine" id="cb115-8" title="8">combined_logcounts &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">logcounts</span>(muraro), <span class="kw">logcounts</span>(segerstolpe))</a>
<a class="sourceLine" id="cb115-9" title="9">dataset_labels &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;m&quot;</span>, <span class="st">&quot;s&quot;</span>), <span class="dt">times=</span><span class="kw">c</span>(<span class="kw">ncol</span>(muraro), <span class="kw">ncol</span>(segerstolpe)))</a>
<a class="sourceLine" id="cb115-10" title="10">cell_type_labels &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">colData</span>(muraro)<span class="op">$</span>cell_type1, <span class="kw">colData</span>(segerstolpe)<span class="op">$</span>cell_type1)</a>
<a class="sourceLine" id="cb115-11" title="11"></a>
<a class="sourceLine" id="cb115-12" title="12">pheno &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Sample_ID =</span> <span class="kw">colnames</span>(combined_logcounts),</a>
<a class="sourceLine" id="cb115-13" title="13">                <span class="dt">Study_ID=</span>dataset_labels,</a>
<a class="sourceLine" id="cb115-14" title="14">                <span class="dt">Celltype=</span><span class="kw">paste</span>(cell_type_labels, dataset_labels, <span class="dt">sep=</span><span class="st">&quot;-&quot;</span>))</a>
<a class="sourceLine" id="cb115-15" title="15"><span class="kw">rownames</span>(pheno) &lt;-<span class="st"> </span><span class="kw">colnames</span>(combined_logcounts)</a></code></pre></div>
<p>Metaneighbor includes a feature selection method to identify highly variable genes.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" title="1">var.genes =<span class="st"> </span><span class="kw">get_variable_genes</span>(combined_logcounts, pheno)</a></code></pre></div>
<p>Since Metaneighbor is much slower than <code>scmap</code>, we will down sample these datasets.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" title="1">subset &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(pheno), <span class="dv">2000</span>)</a>
<a class="sourceLine" id="cb117-2" title="2">combined_logcounts &lt;-<span class="st"> </span>combined_logcounts[,subset]</a>
<a class="sourceLine" id="cb117-3" title="3">pheno &lt;-<span class="st"> </span>pheno[subset,]</a>
<a class="sourceLine" id="cb117-4" title="4">cell_type_labels &lt;-<span class="st"> </span>cell_type_labels[subset]</a>
<a class="sourceLine" id="cb117-5" title="5">dataset_labels &lt;-<span class="st"> </span>dataset_labels[subset]</a></code></pre></div>
<p>Now we are ready to run Metaneighbor. First we will run the unsupervised
version that will let us see which cell-types are most similar across the
two datasets.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" title="1">unsup &lt;-<span class="st"> </span><span class="kw">run_MetaNeighbor_US</span>(var.genes, combined_logcounts, <span class="kw">unique</span>(pheno<span class="op">$</span>Celltype), pheno)</a>
<a class="sourceLine" id="cb118-2" title="2"><span class="kw">heatmap</span>(unsup)</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/projection_files/figure-html/unnamed-chunk-32-1.png" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="mnncorrect-1" class="section level3">
<h3><span class="header-section-number">8.8.6</span> mnnCorrect</h3>
<p><a href="https://www.biorxiv.org/content/early/2017/07/18/165118">mnnCorrect</a> corrects datasets to facilitate joint analysis. It order to account for differences in composition between two replicates or two different experiments it first matches invidual cells across experiments to find the overlaping biologicial structure. Using that overlap it learns which dimensions of expression correspond to the biological state and which dimensions correspond to batch/experiment effect; mnnCorrect assumes these dimensions are orthologal to each other in high dimensional expression space. Finally it removes the batch/experiment effects from the entire expression matrix to return the corrected matrix.</p>
<p>To match individual cells to each other across datasets, mnnCorrect uses the cosine distance to avoid library-size effect then identifies mututal nearest neighbours (<code>k</code> determines to neighbourhood size) across datasets. Only overlaping biological groups should have mutual nearest neighbours (see panel b below). However, this assumes that k is set to approximately the size of the smallest biological group in the datasets, but a k that is too low will identify too few mutual nearest-neighbour pairs to get a good estimate of the batch effect we want to remove.</p>
<p>Learning the biological/techncial effects is done with either singular value decomposition, similar to RUV we encounters in the batch-correction section, or with principal component analysis with the opitimized irlba package, which should be faster than SVD. The parameter <code>svd.dim</code> specifies how many dimensions should be kept to summarize the biological structure of the data, we will set it to three as we found three major groups using Metaneighbor above. These estimates may be futher adjusted by smoothing (<code>sigma</code>) and/or variance adjustment (<code>var.adj</code>).</p>
<p>mnnCorrect also assumes you’ve already subset your expression matricies so that they contain identical genes in the same order, fortunately we have already done with for our datasets when we set up our data for Metaneighbor.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-172"></span>
<img src="figures/mnnCorrectDiagramCropped.png" alt="mnnCorrect batch/dataset effect correction. From Haghverdi et al. 2017" width="688" />
<p class="caption">
Figure 8.23: mnnCorrect batch/dataset effect correction. From Haghverdi et al. 2017
</p>
</div>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" title="1"><span class="kw">require</span>(<span class="st">&quot;scran&quot;</span>)</a>
<a class="sourceLine" id="cb119-2" title="2"><span class="co"># mnnCorrect will take several minutes to run</span></a>
<a class="sourceLine" id="cb119-3" title="3">corrected &lt;-<span class="st"> </span><span class="kw">mnnCorrect</span>(<span class="kw">logcounts</span>(muraro), <span class="kw">logcounts</span>(segerstolpe), <span class="dt">k=</span><span class="dv">20</span>, <span class="dt">sigma=</span><span class="dv">1</span>, <span class="dt">pc.approx=</span><span class="ot">TRUE</span>, <span class="dt">subset.row=</span>var.genes, <span class="dt">svd.dim=</span><span class="dv">3</span>)</a></code></pre></div>
<p>First let’s check that we found a sufficient number of mnn pairs, mnnCorrect returns a list of dataframe with the mnn pairs for each dataset.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" title="1"><span class="kw">dim</span>(corrected<span class="op">$</span>pairs[[<span class="dv">1</span>]]) <span class="co"># muraro -&gt; others</span></a>
<a class="sourceLine" id="cb120-2" title="2"><span class="co">## [1] 0 3</span></a>
<a class="sourceLine" id="cb120-3" title="3"><span class="kw">dim</span>(corrected<span class="op">$</span>pairs[[<span class="dv">2</span>]]) <span class="co"># seger -&gt; others</span></a>
<a class="sourceLine" id="cb120-4" title="4"><span class="co">## [1] 2533    3</span></a></code></pre></div>
<p>The first and second columns contain the cell column IDs and the third column contains a number indicating which dataset/batch the column 2 cell belongs to. In our case,
we are only comparing two datasets so all the mnn pairs have been assigned to the second table and the third column contains only ones</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" title="1"><span class="kw">head</span>(corrected<span class="op">$</span>pairs[[<span class="dv">2</span>]])</a>
<a class="sourceLine" id="cb121-2" title="2"><span class="co">## DataFrame with 6 rows and 3 columns</span></a>
<a class="sourceLine" id="cb121-3" title="3"><span class="co">##   current.cell other.cell other.batch</span></a>
<a class="sourceLine" id="cb121-4" title="4"><span class="co">##      &lt;integer&gt;      &lt;Rle&gt;       &lt;Rle&gt;</span></a>
<a class="sourceLine" id="cb121-5" title="5"><span class="co">## 1         1553          5           1</span></a>
<a class="sourceLine" id="cb121-6" title="6"><span class="co">## 2         1078          5           1</span></a>
<a class="sourceLine" id="cb121-7" title="7"><span class="co">## 3         1437          5           1</span></a>
<a class="sourceLine" id="cb121-8" title="8"><span class="co">## 4         1890          5           1</span></a>
<a class="sourceLine" id="cb121-9" title="9"><span class="co">## 5         1569          5           1</span></a>
<a class="sourceLine" id="cb121-10" title="10"><span class="co">## 6          373          5           1</span></a>
<a class="sourceLine" id="cb121-11" title="11">total_pairs &lt;-<span class="st"> </span><span class="kw">nrow</span>(corrected<span class="op">$</span>pairs[[<span class="dv">2</span>]])</a>
<a class="sourceLine" id="cb121-12" title="12">n_unique_seger &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>((corrected<span class="op">$</span>pairs[[<span class="dv">2</span>]][,<span class="dv">1</span>])))</a>
<a class="sourceLine" id="cb121-13" title="13">n_unique_muraro &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>((corrected<span class="op">$</span>pairs[[<span class="dv">2</span>]][,<span class="dv">2</span>])))</a></code></pre></div>
<p>mnnCorrect found <code>total_pairs</code> sets of mutual nearest-neighbours between <code>n_unique_seger</code> segerstolpe cells and <code>n_unique_muraro</code> muraro cells. This should be a sufficient number of pairs but the low number of unique cells in each dataset suggests we might not have captured the full biological signal in each dataset.</p>
<p><strong>Exercise</strong>
Which cell-types had mnns across these datasets? Should we increase/decrease k?</p>
<p><strong>Answer</strong></p>
<p>Now we could create a combined dataset to jointly analyse these data. However, the corrected data is no longer counts and usually will contain negative expression values thus some analysis tools may no longer be appropriate. For simplicity let’s just plot a joint TSNE.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" title="1"><span class="kw">require</span>(<span class="st">&quot;Rtsne&quot;</span>)</a>
<a class="sourceLine" id="cb122-2" title="2">joint_expression_matrix &lt;-<span class="st"> </span><span class="kw">cbind</span>(corrected<span class="op">$</span>corrected[[<span class="dv">1</span>]], corrected<span class="op">$</span>corrected[[<span class="dv">2</span>]])</a>
<a class="sourceLine" id="cb122-3" title="3"></a>
<a class="sourceLine" id="cb122-4" title="4"><span class="co"># Tsne will take some time to run on the full dataset</span></a>
<a class="sourceLine" id="cb122-5" title="5">joint_tsne &lt;-<span class="st"> </span><span class="kw">Rtsne</span>(<span class="kw">t</span>(joint_expression_matrix[<span class="kw">rownames</span>(joint_expression_matrix) <span class="op">%in%</span><span class="st"> </span>var.genes,]), <span class="dt">initial_dims=</span><span class="dv">10</span>, <span class="dt">theta=</span><span class="fl">0.75</span>,</a>
<a class="sourceLine" id="cb122-6" title="6">                        <span class="dt">check_duplicates=</span><span class="ot">FALSE</span>, <span class="dt">max_iter=</span><span class="dv">200</span>, <span class="dt">stop_lying_iter=</span><span class="dv">50</span>, <span class="dt">mom_switch_iter=</span><span class="dv">50</span>)</a>
<a class="sourceLine" id="cb122-7" title="7">dataset_labels &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;m&quot;</span>, <span class="st">&quot;s&quot;</span>), <span class="dt">times=</span><span class="kw">c</span>(<span class="kw">ncol</span>(muraro), <span class="kw">ncol</span>(segerstolpe))))</a>
<a class="sourceLine" id="cb122-8" title="8">cell_type_labels &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="kw">colData</span>(muraro)<span class="op">$</span>cell_type1, <span class="kw">colData</span>(segerstolpe)<span class="op">$</span>cell_type1))</a>
<a class="sourceLine" id="cb122-9" title="9"><span class="kw">plot</span>(joint_tsne<span class="op">$</span>Y[,<span class="dv">1</span>], joint_tsne<span class="op">$</span>Y[,<span class="dv">2</span>], <span class="dt">pch=</span><span class="kw">c</span>(<span class="dv">16</span>,<span class="dv">1</span>)[dataset_labels], <span class="dt">col=</span><span class="kw">rainbow</span>(<span class="kw">length</span>(<span class="kw">levels</span>(cell_type_labels)))[cell_type_labels])</a></code></pre></div>
<p><img src="https://scrnaseq-course.cog.sanger.ac.uk/website/projection_files/figure-html/unnamed-chunk-38-1.png" style="display: block; margin: auto;" /></p>
</div>
<div id="cannonical-correlation-analysis-seurat" class="section level3">
<h3><span class="header-section-number">8.8.7</span> Cannonical Correlation Analysis (Seurat)</h3>
<p>The Seurat package contains another correction method for combining multiple datasets, called <a href="https://www.biorxiv.org/content/early/2017/07/18/164889">CCA</a>. However, unlike mnnCorrect it doesn’t correct the expression matrix itself directly. Instead Seurat finds a lower dimensional subspace for each dataset then corrects these subspaces. Also different from mnnCorrect, Seurat only combines a single pair of datasets at a time.</p>
<p>Seurat uses gene-gene correlations to identify the biological structure in the dataset with a method called canonical correlation analysis (CCA). Seurat learns the shared structure to the gene-gene correlations and then evaluates how well each cell fits this structure. Cells which must better described by a data-specific dimensionality reduction method than by the shared correlation structure are assumed to represent dataset-specific cell-types/states and are discarded before aligning the two datasets. Finally the two datasets are aligned using ‘warping’ algorithms which normalize the low-dimensional representations of each dataset in a way that is robust to differences in population density.</p>
<p>Note because Seurat uses up a lot of library space you will have to restart your R-session to load it, and the plots/merged_seuratput won’t be automatically generated on this page.</p>
<p>Reload the data:</p>
<p>First we will reformat our data into Seurat objects:</p>
<p>Next we must normalize, scale and identify highly variable genes for each dataset:</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-182"></span>
<img src="figures/muraro_seurat_hvg.png" alt="muraro variable genes" width="1050" />
<p class="caption">
Figure 8.24: muraro variable genes
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-183"></span>
<img src="figures/seger_seurat_hvg.png" alt="segerstolpe variable genes" width="1050" />
<p class="caption">
Figure 8.25: segerstolpe variable genes
</p>
</div>
<p>Eventhough Seurat corrects for the relationship between dispersion and mean expression, it doesn’t use the corrected value when ranking features. Compare the results of the command below with the results in the plots above:</p>
<p>But we will follow their example and use the top 2000 most dispersed genes withmerged_seurat correcting for mean expression from each dataset anyway.</p>
<p><strong>Exercise</strong>
Find the features we would use if we selected the top 2000 most dispersed after scaling by mean. (Hint: consider the <code>order</code> function)</p>
<p><strong>Answer</strong></p>
<p>Now we will run CCA to find the shared correlation structure for these two datasets:</p>
<p>Note to speed up the calculations we will be using only the top 5 dimensions but ideally you would consider many more and then select the top most informative ones using <code>DimHeatmap</code>.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-188"></span>
<img src="figures/cca_before.png" alt="Before Aligning" width="1050" />
<p class="caption">
Figure 8.26: Before Aligning
</p>
</div>
<p>To identify dataset specific cell-types we compare how well cells are ‘explained’ by CCA vs dataset-specific principal component analysis.</p>
<p>Here we can see that despite both datasets containing endothelial cells, almost all of them have been discarded as “dataset-specific”. Now we can align the datasets:</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-191"></span>
<img src="figures/cca_after.png" alt="After Aligning" width="1050" />
<p class="caption">
Figure 8.27: After Aligning
</p>
</div>
<p><strong>Exercise</strong>
Compare the results for if you use the features after scaling dispersions.</p>
<p><strong>Answer</strong></p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-193"></span>
<img src="figures/cca_after2.png" alt="After Aligning" width="1050" />
<p class="caption">
Figure 8.28: After Aligning
</p>
</div>
<p><strong>Advanced Exercise</strong>
Use the clustering methods we previously covered on the combined datasets. Do you identify any novel cell-types?</p>
</div>
</div>
<div id="search-scrna-seq-data" class="section level2">
<h2><span class="header-section-number">8.9</span> Search scRNA-Seq data</h2>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" title="1"><span class="kw">library</span>(scfind)</a>
<a class="sourceLine" id="cb123-2" title="2"><span class="kw">library</span>(SingleCellExperiment)</a>
<a class="sourceLine" id="cb123-3" title="3"><span class="kw">library</span>(plotly)</a>
<a class="sourceLine" id="cb123-4" title="4"><span class="kw">set.seed</span>(<span class="dv">1234567</span>)</a></code></pre></div>
<div id="about" class="section level3">
<h3><span class="header-section-number">8.9.1</span> About</h3>
<p><code>scfind</code> is a tool that allows one to search single cell RNA-Seq collections (Atlas) using lists of genes, e.g. searching for cells and cell-types where a specific set of genes are expressed. <code>scfind</code> is a <a href="https://github.com/hemberg-lab/scfind">Github package</a>. Cloud implementation of <code>scfind</code> with a large collection of datasets is available on our <a href="https://scfind.sanger.ac.uk/">website</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-195"></span>
<img src="figures/scfind.png" alt="scfind can be used to search large collection of scRNA-seq data by a list of gene IDs." width="80%" />
<p class="caption">
Figure 8.29: scfind can be used to search large collection of scRNA-seq data by a list of gene IDs.
</p>
</div>
</div>
<div id="dataset" class="section level3">
<h3><span class="header-section-number">8.9.2</span> Dataset</h3>
<p>We will run <code>scfind</code> on the Tabula Muris 10X dataset. <code>scfind</code> also operates on <code>SingleCellExperiment</code> class:</p>
<pre><code>## class: SingleCellExperiment 
## dim: 23341 654 
## metadata(1): log.exprs.offset
## assays(3): counts normcounts logcounts
## rownames(23341): Xkr4 Rp1 ... Tdtom_transgene zsGreen_transgene
## rowData names(1): feature_symbol
## colnames(654): 10X_P7_4_AAACCTGCACGACGAA-1
##   10X_P7_4_AAACCTGGTTCCACGG-1 ... 10X_P7_4_TTTGTCAGTCGATTGT-1
##   10X_P7_4_TTTGTCAGTGCGCTTG-1
## colData names(5): mouse cell_type1 tissue subtissue sex
## reducedDimNames(3): UMAP PCA TSNE
## spikeNames(0):</code></pre>
<pre><code>## DataFrame with 654 rows and 5 columns
##                                mouse          cell_type1   tissue
##                             &lt;factor&gt;            &lt;factor&gt; &lt;factor&gt;
## 10X_P7_4_AAACCTGCACGACGAA-1   3-F-56    endothelial cell    Heart
## 10X_P7_4_AAACCTGGTTCCACGG-1   3-F-56          fibroblast    Heart
## 10X_P7_4_AAACCTGTCTCGATGA-1   3-F-56    endothelial cell    Heart
## 10X_P7_4_AAACGGGAGCGCTCCA-1   3-F-56 cardiac muscle cell    Heart
## 10X_P7_4_AAAGCAAAGTGAATTG-1   3-F-56          fibroblast    Heart
## ...                              ...                 ...      ...
## 10X_P7_4_TTTGGTTCAGACTCGC-1   3-F-56 cardiac muscle cell    Heart
## 10X_P7_4_TTTGTCAAGTGGAGAA-1   3-F-56 cardiac muscle cell    Heart
## 10X_P7_4_TTTGTCACAAGCCATT-1   3-F-56    endocardial cell    Heart
## 10X_P7_4_TTTGTCAGTCGATTGT-1   3-F-56    endothelial cell    Heart
## 10X_P7_4_TTTGTCAGTGCGCTTG-1   3-F-56          fibroblast    Heart
##                             subtissue      sex
##                              &lt;factor&gt; &lt;factor&gt;
## 10X_P7_4_AAACCTGCACGACGAA-1        NA        F
## 10X_P7_4_AAACCTGGTTCCACGG-1        NA        F
## 10X_P7_4_AAACCTGTCTCGATGA-1        NA        F
## 10X_P7_4_AAACGGGAGCGCTCCA-1        NA        F
## 10X_P7_4_AAAGCAAAGTGAATTG-1        NA        F
## ...                               ...      ...
## 10X_P7_4_TTTGGTTCAGACTCGC-1        NA        F
## 10X_P7_4_TTTGTCAAGTGGAGAA-1        NA        F
## 10X_P7_4_TTTGTCACAAGCCATT-1        NA        F
## 10X_P7_4_TTTGTCAGTCGATTGT-1        NA        F
## 10X_P7_4_TTTGTCAGTGCGCTTG-1        NA        F</code></pre>
</div>
<div id="gene-index" class="section level3">
<h3><span class="header-section-number">8.9.3</span> Gene Index</h3>
<p>Now we need to create a gene index using our dataset:</p>
<pre><code>## Generating index for Heart from &#39; counts &#39; assay</code></pre>
<pre><code>##  Indexing cardiac muscle cell as Heart.cardiac muscle cell  with  83  cells.</code></pre>
<pre><code>##  Indexing endocardial cell as Heart.endocardial cell  with  65  cells.</code></pre>
<pre><code>##  Indexing endothelial cell as Heart.endothelial cell  with  178  cells.</code></pre>
<pre><code>##  Indexing erythrocyte as Heart.erythrocyte  with  55  cells.</code></pre>
<pre><code>##  Indexing fibroblast as Heart.fibroblast  with  222  cells.</code></pre>
<pre><code>##  Indexing smooth muscle cell as Heart.smooth muscle cell  with  21  cells.</code></pre>
<p><code>scfind</code> adopts a two-step compression strategy which allows efficient compression of large cell-by-gene matrix and allows fast retrieval of data by gene query. We estimated that one can achieve 2 orders of magnitude compression with this method.</p>
<p>The input matrix for indexing is the raw count matrix of the <code>SingleCellExperiment</code> class. By default the <code>cell_type1</code> column of the <code>colData</code> slot of the <code>SingleCellExperiment</code> object is used to define cell types, however it can also be defined manually using the <code>cell.type.label</code> argument of the <code>buildCellTypeIndex</code>. For dataset with more than one tissue, you can also merge all tissues together to create a super index using the function <code>mergeDataset</code>.</p>
<p>The index can be saved in .rds format using <code>saveObject</code> function and loaded using <code>loadObject</code> function for future use.</p>
<pre><code>## Generating index for Thymus from &#39; counts &#39; assay</code></pre>
<pre><code>##  Indexing stromal cell as Thymus.stromal cell  with  112  cells.</code></pre>
<pre><code>##  Indexing T cell as Thymus.T cell  with  1317  cells.</code></pre>
<pre><code>## Merging Thymus</code></pre>
<pre><code>## [1] &quot;Heart&quot;  &quot;Thymus&quot;</code></pre>
<pre><code>## [1] &quot;Heart.cardiac muscle cell&quot; &quot;Heart.endocardial cell&quot;   
## [3] &quot;Heart.endothelial cell&quot;    &quot;Heart.erythrocyte&quot;        
## [5] &quot;Heart.fibroblast&quot;          &quot;Heart.smooth muscle cell&quot; 
## [7] &quot;Thymus.stromal cell&quot;       &quot;Thymus.T cell&quot;</code></pre>
<pre><code>##  [1] &quot;Cwc15&quot;         &quot;Ttc33&quot;         &quot;Plbd2&quot;         &quot;Arhgap12&quot;     
##  [5] &quot;AA465934&quot;      &quot;Ulk3&quot;          &quot;Foxa3&quot;         &quot;Htra3&quot;        
##  [9] &quot;Gpr84&quot;         &quot;Lcn8&quot;          &quot;Zfp498&quot;        &quot;Basp1&quot;        
## [13] &quot;A430105I19Rik&quot; &quot;Dhrs2&quot;         &quot;Zmym3&quot;         &quot;Rara&quot;         
## [17] &quot;Lrrc24&quot;        &quot;Rps8&quot;          &quot;Ttc14&quot;         &quot;Igsf5&quot;</code></pre>
<p>To quickly and easily find the enriched cell type using an interactive Shiny application use the following method:</p>
</div>
<div id="marker-genes" class="section level3">
<h3><span class="header-section-number">8.9.4</span> Marker genes</h3>
<p>Now let’s find the marker genes for Thymus T cell in the datasets</p>
<pre><code>## Considering the whole DB..</code></pre>
<pre><code>##           cellType genes   tp  fp fn precision    recall        f1
## 2628 Thymus.T cell  Cd3d 1311 108  6 0.9238901 0.9954442 0.9583333
## 6616 Thymus.T cell   Lck 1305 106 12 0.9248759 0.9908884 0.9567448
## 2631 Thymus.T cell  Cd3g 1304 108 13 0.9235128 0.9901291 0.9556614
## 2629 Thymus.T cell  Cd3e 1279  98 38 0.9288308 0.9711465 0.9495174
## 6603 Thymus.T cell   Lat 1280 109 37 0.9215263 0.9719059 0.9460459</code></pre>
<p>Next, you can evaluate the markers of Thymus T cell in Thymus stromal cell</p>
<pre><code>## Considering the whole DB..</code></pre>
<pre><code>##              cellType genes tp   fp fn  precision    recall        f1
## 2 Thymus.stromal cell  Cd3e 90 1287 22 0.06535947 0.8035714 0.1208865
## 3 Thymus.stromal cell  Cd3g 94 1318 18 0.06657224 0.8392857 0.1233596
## 5 Thymus.stromal cell   Lck 94 1317 18 0.06661942 0.8392857 0.1234406
## 1 Thymus.stromal cell  Cd3d 98 1321 14 0.06906272 0.8749999 0.1280209
## 4 Thymus.stromal cell   Lat 99 1290 13 0.07127430 0.8839286 0.1319121</code></pre>
<pre><code>## [1] &quot;Thymus.stromal cell&quot; &quot;Thymus.T cell&quot;</code></pre>
<pre><code>##              cellType genes tp   fp fn  precision    recall        f1
## 2 Thymus.stromal cell  Cd3e 90 1279 22 0.06574142 0.8035714 0.1215395
## 5 Thymus.stromal cell   Lck 94 1305 18 0.06719085 0.8392857 0.1244209
## 3 Thymus.stromal cell  Cd3g 94 1304 18 0.06723891 0.8392857 0.1245033
## 1 Thymus.stromal cell  Cd3d 98 1311 14 0.06955288 0.8749999 0.1288626
## 4 Thymus.stromal cell   Lat 99 1280 13 0.07179116 0.8839286 0.1327968</code></pre>
</div>
<div id="search-cells-by-a-gene-list" class="section level3">
<h3><span class="header-section-number">8.9.5</span> Search cells by a gene list</h3>
<p><code>scfind</code> can instantly identify the cell type that best represents the genes of interest from large single cell dataset. We will use the marker genes identified in an original publication <a href="https://www.nature.com/articles/cr201599">Yanbin et al. 2015</a>. Cardiomyocyte-specific markers used in immunostaining as shown in Figure 1.</p>
<pre><code>## Ignored Nkx2.5, Cx43. Not found in the index</code></pre>
<pre><code>## calculating tfidf for the reduced expression matrix...</code></pre>
<pre><code>##     Genes                                  Query      tfidf Cells
## 1       2                             Cdh2,Gata4   1.075548    27
## 2       3                        Cdh2,Gata4,Gja1   2.085320    18
## 3       4                  Cdh2,Gata4,Gja1,Mef2c   2.812912    11
## 4       5             Cdh2,Gata4,Gja1,Mef2c,Myh6   9.754036     8
## 5       6       Cdh2,Gata4,Gja1,Mef2c,Myh6,Tnni3  13.983566     8
## 6       7 Cdh2,Gata4,Gja1,Mef2c,Myh6,Tnni3,Tnnt2  18.241363     8
## 7       6       Cdh2,Gata4,Gja1,Mef2c,Myh6,Tnnt2  14.011833     8
## 8       5            Cdh2,Gata4,Gja1,Mef2c,Tnni3   7.042442     8
## 9       6      Cdh2,Gata4,Gja1,Mef2c,Tnni3,Tnnt2  11.300239     8
## 10      5            Cdh2,Gata4,Gja1,Mef2c,Tnnt2   7.070709     8
## 11      4                   Cdh2,Gata4,Gja1,Myh6   9.026444    14
## 12      5             Cdh2,Gata4,Gja1,Myh6,Tnni3  13.255974    14
## 13      6       Cdh2,Gata4,Gja1,Myh6,Tnni3,Tnnt2  17.513771    14
## 14      5             Cdh2,Gata4,Gja1,Myh6,Tnnt2  13.284241    14
## 15      4                  Cdh2,Gata4,Gja1,Tnni3   6.314850    14
## 16      5            Cdh2,Gata4,Gja1,Tnni3,Tnnt2  10.572647    14
## 17      4                  Cdh2,Gata4,Gja1,Tnnt2   6.343117    15
## 18      3                       Cdh2,Gata4,Mef2c   1.803140    14
## 19      4                  Cdh2,Gata4,Mef2c,Myh6   8.744264     8
## 20      5            Cdh2,Gata4,Mef2c,Myh6,Tnni3  12.973794     8
## 21      6      Cdh2,Gata4,Mef2c,Myh6,Tnni3,Tnnt2  17.231591     8
## 22      5            Cdh2,Gata4,Mef2c,Myh6,Tnnt2  13.002062     8
## 23      4                 Cdh2,Gata4,Mef2c,Tnni3   6.032670     9
## 24      5           Cdh2,Gata4,Mef2c,Tnni3,Tnnt2  10.290467     8
## 25      4                 Cdh2,Gata4,Mef2c,Tnnt2   6.060938     8
## 26      3                        Cdh2,Gata4,Myh6   8.016672    15
## 27      4                  Cdh2,Gata4,Myh6,Tnni3  12.246202    14
## 28      5            Cdh2,Gata4,Myh6,Tnni3,Tnnt2  16.503999    14
## 29      4                  Cdh2,Gata4,Myh6,Tnnt2  12.274470    14
## 30      3                       Cdh2,Gata4,Tnni3   5.305078    17
## 31      4                 Cdh2,Gata4,Tnni3,Tnnt2   9.562876    15
## 32      3                       Cdh2,Gata4,Tnnt2   5.333346    17
## 33      2                              Cdh2,Gja1   1.864063    39
## 34      3                        Cdh2,Gja1,Mef2c   2.716969    18
## 35      4                   Cdh2,Gja1,Mef2c,Myh6  10.853567    15
## 36      5             Cdh2,Gja1,Mef2c,Myh6,Tnni3  15.811551    15
## 37      6       Cdh2,Gja1,Mef2c,Myh6,Tnni3,Tnnt2  20.802671    15
## 38      5             Cdh2,Gja1,Mef2c,Myh6,Tnnt2  15.844687    15
## 39      4                  Cdh2,Gja1,Mef2c,Tnni3   7.674953    15
## 40      5            Cdh2,Gja1,Mef2c,Tnni3,Tnnt2  12.666073    15
## 41      4                  Cdh2,Gja1,Mef2c,Tnnt2   7.708089    15
## 42      3                         Cdh2,Gja1,Myh6  10.000661    32
## 43      4                   Cdh2,Gja1,Myh6,Tnni3  14.958645    32
## 44      5             Cdh2,Gja1,Myh6,Tnni3,Tnnt2  19.949766    32
## 45      4                   Cdh2,Gja1,Myh6,Tnnt2  14.991781    32
## 46      3                        Cdh2,Gja1,Tnni3   6.822047    33
## 47      4                  Cdh2,Gja1,Tnni3,Tnnt2  11.813168    33
## 48      3                        Cdh2,Gja1,Tnnt2   6.855183    34
## 49      2                             Cdh2,Mef2c   1.533283    27
## 50      3                        Cdh2,Mef2c,Myh6   9.669881    17
## 51      4                  Cdh2,Mef2c,Myh6,Tnni3  14.627866    15
## 52      5            Cdh2,Mef2c,Myh6,Tnni3,Tnnt2  19.618986    15
## 53      4                  Cdh2,Mef2c,Myh6,Tnnt2  14.661002    16
## 54      3                       Cdh2,Mef2c,Tnni3   6.491268    18
## 55      4                 Cdh2,Mef2c,Tnni3,Tnnt2  11.482388    16
## 56      3                       Cdh2,Mef2c,Tnnt2   6.524404    18
## 57      2                              Cdh2,Myh6   8.816976    36
## 58      3                        Cdh2,Myh6,Tnni3  13.774960    32
## 59      4                  Cdh2,Myh6,Tnni3,Tnnt2  18.766080    32
## 60      3                        Cdh2,Myh6,Tnnt2  13.808096    33
## 61      2                             Cdh2,Tnni3   5.638362    38
## 62      3                       Cdh2,Tnni3,Tnnt2  10.629482    35
## 63      2                             Cdh2,Tnnt2   5.671498    43
## 64      2                             Gata4,Gja1   1.504907    41
## 65      3                       Gata4,Gja1,Mef2c   2.232499    19
## 66      4                  Gata4,Gja1,Mef2c,Myh6   9.173623     9
## 67      5            Gata4,Gja1,Mef2c,Myh6,Tnni3  13.403153     8
## 68      6      Gata4,Gja1,Mef2c,Myh6,Tnni3,Tnnt2  17.660950     8
## 69      5            Gata4,Gja1,Mef2c,Myh6,Tnnt2  13.431420     8
## 70      4                 Gata4,Gja1,Mef2c,Tnni3   6.462029    11
## 71      5           Gata4,Gja1,Mef2c,Tnni3,Tnnt2  10.719826    10
## 72      4                 Gata4,Gja1,Mef2c,Tnnt2   6.490296    11
## 73      3                        Gata4,Gja1,Myh6   8.446031    22
## 74      4                  Gata4,Gja1,Myh6,Tnni3  12.675561    19
## 75      5            Gata4,Gja1,Myh6,Tnni3,Tnnt2  16.933358    19
## 76      4                  Gata4,Gja1,Myh6,Tnnt2  12.703828    19
## 77      3                       Gata4,Gja1,Tnni3   5.734437    22
## 78      4                 Gata4,Gja1,Tnni3,Tnnt2   9.992234    21
## 79      3                       Gata4,Gja1,Tnnt2   5.762704    26
## 80      2                            Gata4,Mef2c   1.222727    65
## 81      3                       Gata4,Mef2c,Myh6   8.163851    20
## 82      4                 Gata4,Mef2c,Myh6,Tnni3  12.393381    13
## 83      5           Gata4,Mef2c,Myh6,Tnni3,Tnnt2  16.651178     9
## 84      4                 Gata4,Mef2c,Myh6,Tnnt2  12.421649    10
## 85      3                      Gata4,Mef2c,Tnni3   5.452257    25
## 86      4                Gata4,Mef2c,Tnni3,Tnnt2   9.710054    14
## 87      3                      Gata4,Mef2c,Tnnt2   5.480525    21
## 88      2                             Gata4,Myh6   7.436259    46
## 89      3                       Gata4,Myh6,Tnni3  11.665789    30
## 90      4                 Gata4,Myh6,Tnni3,Tnnt2  15.923586    24
## 91      3                       Gata4,Myh6,Tnnt2  11.694057    25
## 92      2                            Gata4,Tnni3   4.724665    57
## 93      3                      Gata4,Tnni3,Tnnt2   8.982463    34
## 94      2                            Gata4,Tnnt2   4.752933    61
## 95      2                             Gja1,Mef2c   2.553022    91
## 96      3                        Gja1,Mef2c,Myh6  12.752868    35
## 97      4                  Gja1,Mef2c,Myh6,Tnni3  18.968080    31
## 98      5            Gja1,Mef2c,Myh6,Tnni3,Tnnt2  25.224830    26
## 99      4                  Gja1,Mef2c,Myh6,Tnnt2  19.009619    27
## 100     3                       Gja1,Mef2c,Tnni3   8.768234    43
## 101     4                 Gja1,Mef2c,Tnni3,Tnnt2  15.024984    34
## 102     3                       Gja1,Mef2c,Tnnt2   8.809772    44
## 103     2                              Gja1,Myh6  16.214932    71
## 104     3                        Gja1,Myh6,Tnni3  24.840569    61
## 105     4                  Gja1,Myh6,Tnni3,Tnnt2  33.523855    54
## 106     3                        Gja1,Myh6,Tnnt2  24.898218    57
## 107     2                             Gja1,Tnni3  10.684950    85
## 108     3                       Gja1,Tnni3,Tnnt2  19.368235    67
## 109     2                             Gja1,Tnnt2  10.742598    88
## 110     2                             Mef2c,Myh6  11.269029    71
## 111     3                       Mef2c,Myh6,Tnni3  17.484240    41
## 112     4                 Mef2c,Myh6,Tnni3,Tnnt2  23.740991    30
## 113     3                       Mef2c,Myh6,Tnnt2  17.525779    43
## 114     2                            Mef2c,Tnni3   7.284394   102
## 115     3                      Mef2c,Tnni3,Tnnt2  13.541144    60
## 116     2                            Mef2c,Tnnt2   7.325932   109
## 117     2                             Myh6,Tnni3  95.421586    91
## 118     3                       Myh6,Tnni3,Tnnt2 131.792399    72
## 119     2                             Myh6,Tnnt2  96.302401    94
## 120     2                            Tnni3,Tnnt2  72.500162   118
##     Cell.Types
## 1            0
## 2            0
## 3            0
## 4            0
## 5            0
## 6            0
## 7            0
## 8            0
## 9            0
## 10           0
## 11           0
## 12           0
## 13           0
## 14           0
## 15           0
## 16           0
## 17           0
## 18           0
## 19           0
## 20           0
## 21           0
## 22           0
## 23           0
## 24           0
## 25           0
## 26           0
## 27           0
## 28           0
## 29           0
## 30           0
## 31           0
## 32           0
## 33           0
## 34           0
## 35           0
## 36           0
## 37           0
## 38           0
## 39           0
## 40           0
## 41           0
## 42           0
## 43           0
## 44           0
## 45           0
## 46           0
## 47           0
## 48           0
## 49           0
## 50           0
## 51           0
## 52           0
## 53           0
## 54           0
## 55           0
## 56           0
## 57           0
## 58           0
## 59           0
## 60           0
## 61           0
## 62           0
## 63           0
## 64           0
## 65           0
## 66           0
## 67           0
## 68           0
## 69           0
## 70           0
## 71           0
## 72           0
## 73           0
## 74           0
## 75           0
## 76           0
## 77           0
## 78           0
## 79           0
## 80           0
## 81           0
## 82           0
## 83           0
## 84           0
## 85           0
## 86           0
## 87           0
## 88           0
## 89           0
## 90           0
## 91           0
## 92           0
## 93           0
## 94           0
## 95           0
## 96           0
## 97           0
## 98           0
## 99           0
## 100          0
## 101          0
## 102          0
## 103          0
## 104          0
## 105          0
## 106          0
## 107          0
## 108          0
## 109          0
## 110          0
## 111          0
## 112          0
## 113          0
## 114          0
## 115          0
## 116          0
## 117          0
## 118          0
## 119          0
## 120          0</code></pre>
<p>To allow search of enriched cell type from a long list of gene query, <code>scfind</code> features a query optimization routin. First, the function <code>markerGenes</code> will counter suggest subqueries that with the highest support in the dataset. The TF-IDF score for each gene set allows user to identify the best subquery for finding the most relevant cell type.</p>
<pre><code>##                   cell_type cell_hits total_cells pval
## 1 Heart.cardiac muscle cell        57          83    0
## 2    Heart.endocardial cell         3          65    1
## 3    Heart.endothelial cell         7         178    1
## 4          Heart.fibroblast         5         222    1</code></pre>
<p><code>hyperQueryCellTypes</code> function returns a list of p-values corresponding to all cell types in a given dataset. It also outputs a list of cells in which genes from the given gene list are co-expressed.</p>
<p><strong>Exercise 1</strong></p>
<p>Find the marker genes of all cell types in the Heart dataset</p>
<pre><code>##                        cellType genes tp fp fn precision    recall
## 11309 Heart.cardiac muscle cell Xirp2 51  4 32 0.9272727 0.6144578
## 6628  Heart.cardiac muscle cell Myom2 53  8 30 0.8688524 0.6385542
## 8925  Heart.cardiac muscle cell  Ryr2 51  8 32 0.8644068 0.6144578
## 5699  Heart.cardiac muscle cell  Ldb3 53 13 30 0.8030303 0.6385542
## 10657 Heart.cardiac muscle cell  Trdn 49  6 34 0.8909091 0.5903614
##              f1
## 11309 0.7391304
## 6628  0.7361111
## 8925  0.7183099
## 5699  0.7114094
## 10657 0.7101449
##                    cellType  genes tp fp fn precision    recall        f1
## 4581 Heart.endocardial cell  Gpm6a 50  5 15 0.9090909 0.7692308 0.8333333
## 1736 Heart.endocardial cell    Bmx 52 16 13 0.7647059 0.8000000 0.7819549
## 6851 Heart.endocardial cell   Npr3 61 32  4 0.6559140 0.9384615 0.7721519
## 7533 Heart.endocardial cell Plagl1 51 18 14 0.7391304 0.7846154 0.7611941
## 2552 Heart.endocardial cell   Comp 45 10 20 0.8181818 0.6923077 0.7500001
##                     cellType         genes  tp fp fn precision    recall
## 1951  Heart.endothelial cell       C1qtnf9 153 17 25 0.9000000 0.8595505
## 76    Heart.endothelial cell 1190002H23Rik 161 33 17 0.8298969 0.9044943
## 10534 Heart.endothelial cell         Tcf15 157 30 21 0.8395722 0.8820225
## 2274  Heart.endothelial cell       Cd300lg 163 50 15 0.7652582 0.9157303
## 4850  Heart.endothelial cell       Gpihbp1 168 58 10 0.7433628 0.9438202
##              f1
## 1951  0.8793103
## 76    0.8655914
## 10534 0.8602740
## 2274  0.8337595
## 4850  0.8316832
##               cellType   genes tp fp fn precision    recall        f1
## 2074 Heart.erythrocyte    Cd68 51  5  4 0.9107143 0.9272727 0.9189188
## 2346 Heart.erythrocyte Clec4a2 50  4  5 0.9259259 0.9090909 0.9174312
## 5623 Heart.erythrocyte    Lyz1 55 12  0 0.8208955 1.0000000 0.9016393
## 983  Heart.erythrocyte Alox5ap 55 13  0 0.8088235 1.0000000 0.8943089
## 3393 Heart.erythrocyte    Emr1 48  5  7 0.9056604 0.8727272 0.8888889
##               cellType         genes  tp fp fn precision    recall
## 3024  Heart.fibroblast        Col1a1 209 18 13 0.9207048 0.9414415
## 11653 Heart.fibroblast         Tcf21 193  6 29 0.9698492 0.8693694
## 8609  Heart.fibroblast        Pdgfra 194  8 28 0.9603961 0.8738739
## 3830  Heart.fibroblast           Dpt 215 40  7 0.8431373 0.9684685
## 683   Heart.fibroblast 6330406I15Rik 190 11 32 0.9452736 0.8558559
##              f1
## 3024  0.9309577
## 11653 0.9168646
## 8609  0.9150944
## 3830  0.9014676
## 683   0.8983452
##                      cellType   genes tp fp fn precision    recall
## 6968 Heart.smooth muscle cell    Rgs4 20  9  1 0.6896551 0.9523810
## 5662 Heart.smooth muscle cell   Nrip2 15  3  6 0.8333333 0.7142857
## 5779 Heart.smooth muscle cell Olfr558 16  6  5 0.7272727 0.7619048
## 890  Heart.smooth muscle cell    Ano1 15  5  6 0.7500000 0.7142857
## 3565 Heart.smooth muscle cell Gm13889 18 11  3 0.6206896 0.8571429
##             f1
## 6968 0.8000000
## 5662 0.7692308
## 5779 0.7441860
## 890  0.7317073
## 3565 0.7200000</code></pre>
<p><strong>Exercise 2</strong></p>
<p>Input the gene list relevant to “cardiac contractility” and find the best gene set with the highest support. Identify the enriched cell type for this query.</p>
<pre><code>## Ignored Gh, Nos1, Grk2, Ins2, Dnah8, Ren2, Kcnmb2. Not found in the index</code></pre>
<pre><code>## calculating tfidf for the reduced expression matrix...</code></pre>
<pre><code>##                   cell_type cell_hits total_cells pval
## 1 Heart.cardiac muscle cell        57          83    0
## 2    Heart.endocardial cell         3          65    1
## 3    Heart.endothelial cell         7         178    1
## 4          Heart.fibroblast         4         222    1</code></pre>
</div>
<div id="in-silico-gating" class="section level3">
<h3><span class="header-section-number">8.9.6</span> In-silico gating</h3>
<p>Using the <code>findCellTypes</code> function, you can perform in-silico gating to identify cell type subsets as if the way cell sorting works.
To do so, you can add logical operators including “-” and "*" for “no” and “intermediate” expression, respectively in front of the gene name. Here, we use operators to subset T cell of the Thymus dataset into effector T regulatory cells and effector memory T cell.</p>
<pre><code>## Found 41 cells co-expressing Ctla4 ∧ Ptprc</code></pre>
<pre><code>## Excluded 7 cells expressing Il7r</code></pre>
<pre><code>## Found 167 cells co-expressing Il7r ∧ Ptprc</code></pre>
<pre><code>## Excluded 13 cells expressing Il2ra</code></pre>
<pre><code>## $`Thymus.T cell`
##  [1]   28   54   80  121  125  144  161  165  166  180  229  235  251  320
## [15]  366  371  476  497  663  667  713  737  739  740  786  879  888  918
## [29]  928  953 1098 1225 1232 1277</code></pre>
<pre><code>## $`Thymus.T cell`
##   [1]    1   18   19   34   48   96  100  101  137  138  150  171  177  186
##  [15]  198  215  237  254  267  284  292  293  312  313  323  329  362  376
##  [29]  405  416  430  455  456  500  535  546  555  561  574  580  599  610
##  [43]  634  673  681  686  687  698  701  712  718  719  722  733  735  745
##  [57]  754  755  789  790  800  808  814  830  837  846  848  850  851  861
##  [71]  893  895  896  897  902  907  908  913  916  920  921  930  931  946
##  [85]  949  956  970  979  989  997 1020 1046 1047 1054 1055 1068 1076 1087
##  [99] 1115 1124 1128 1129 1130 1140 1148 1152 1159 1168 1170 1190 1206 1213
## [113] 1226 1227 1237 1240 1251 1255 1275 1282 1284 1290 1298 1305 1307 1312
## [127] 1315
## 
## $`Thymus.stromal cell`
##  [1]   6   7   9  12  17  18  20  25  27  34  50  52  59  63  65  68  69
## [18]  71  72  79  80  84  88  98 100 104 106</code></pre>
<p>Let’s use the TSNE plot information from the <code>SingleCellExperiment</code> of Thymus to illustrate the gating result</p>
<pre><code>## No scatter mode specifed:
##   Setting the mode to markers
##   Read more about this attribute -&gt; https://plot.ly/r/reference/#scatter-mode</code></pre>
<div id="htmlwidget-923b1f469b1d2b4d85c0" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-923b1f469b1d2b4d85c0">{"x":{"visdat":{"27c872fb5f07":["function () ","plotlyVisDat"]},"cur_data":"27c872fb5f07","attrs":{"27c872fb5f07":{"x":{},"y":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"X1"},"yaxis":{"domain":[0,1],"automargin":true,"title":"X2"},"hovermode":"closest","showlegend":false},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[-0.64700797896146,9.82891143936811,-3.00196647225079,-16.2636878973757,5.11026001190674,-7.96327259272952,9.8278810873859,8.23099598692419,-14.1328068830468,7.55202175312812,5.58212148331875,-0.968089213823785,-0.691558447469152,4.22047401496733,9.13347093938178,-13.2389163454206,12.7275993677326,10.9829194193465,-0.683169312033188,-13.385212780602,-11.6767711905462,3.90796220999321,-10.1058977187402,-15.4974877269412,-11.7262439499746,-8.96469744886844,-3.42860593124477,9.05700339075373,7.33006942842282,-11.7174038942314,3.93814303620079,7.46224187040622,-2.52271126038625,0.121598337692018,-15.9687795641159,-8.57235426903485,-9.21562151777873,-8.26416314323915,-4.84601253223187,11.3290849681427,1.95401739442417,-12.0106767257361,-6.99277813008846,10.1993777742303,-0.925864772883279,-0.0294976427393101,-1.62499371485408,2.38673232083063,-3.89113272565772,-3.37191805685573,-6.06683634915917,7.44489014696503,11.8506979167224,1.31582770457569,-16.1165585028952,7.75200687218933,9.13599607227886,-3.9052052980904,9.42711905621988,-11.5764456740183,-2.30986632161948,-2.80101344559873,-8.47418423574407,3.60594209112652,-12.818035489478,6.12061932001222,-4.93997138252942,-10.0709655747583,-11.3080798752615,-11.7615114398318,-9.6511354498064,7.87559868152668,-1.59995583539679,-12.1076158938546,10.6185783604724,-4.27072367504397,-6.6289221469232,-3.93109620627119,4.37209016342535,7.71129866826428,7.78196798797721,-11.9993497926742,-5.40163299673636,0.844356426968267,7.25149832125925,-14.549257814265,-2.84591581148156,7.75011498084225,-2.40760105455274,11.8563972429839,-6.89775579946556,-4.43890490045562,-10.4567779527525,4.1944754345686,-12.2686664262743,-11.2077529755415,-17.9774965905025,3.33098043326833,2.25920179307337,1.95983387495633,1.355658058858,-11.6729610313437,9.81837505506589,-4.51042888834907,-14.460521305944,9.719407141031,1.16614902939685,-2.20399706923565,-9.74109013296507,2.51685241926093,-5.74660583936413,6.03341468458895,-1.48333881074084,5.14639604945107,-12.0479781225904,9.44862150446,-3.02307650368023,9.51015296043139,1.76512017529795,-2.0101180061106,9.64284253210722,3.11848686773141,-5.17226368049842,3.4528729681505,-2.93054633868947,-11.2053652896679,-3.17230186705166,5.23743507166201,-10.557885415587,5.36297744476268,-2.52871812581956,2.20963427724461,0.312493109546483,6.59956451840895,7.46740832723688,1.91010262260896,2.28442859883303,3.16351677858245,-1.98629965354965,-12.9475085909362,-0.787555785873725,6.73115074510438,-2.27636621399645,8.01488449123776,2.97792546441982,0.960353809208676,8.1304638915541,8.4836950741601,-10.7166417232331,11.2807423417454,9.60213585682176,4.05664331570355,-12.7630804328154,-0.679192258286923,11.6507763440007,-1.16253798832006,4.43155910718925,-16.6155095179111,7.21174356368151,-2.08320304186372,1.73017234445989,-12.9901107730417,-3.2495720438173,6.69384435463233,8.8512205635191,-10.6085782363227,-5.06207605418766,0.749349394627608,-4.04566337259661,-0.809704681726989,5.52011162055027,-9.59505729460747,10.4501732061606,-16.305104514804,-11.6444120095217,8.81181963063932,11.4783367949828,-1.77739152145807,-12.6968328803359,3.00191378192751,-10.7049809306755,-12.4882943828428,10.2884510063357,0.371997644469344,-15.1391489673992,-1.09254313923237,8.81894416698965,-1.46010378954201,-10.1755845010003,-1.35850404432497,-5.14819950373142,-8.41251184644206,3.4914738601816,-9.9394576287063,3.64380835425618,-4.07982903761715,3.19201618620682,7.81987178814859,-13.0337361922979,7.70603774293683,-0.533564774166623,5.50025867192459,-15.5505999207836,-17.3404843193353,-1.28459518800085,-5.08459841534678,-0.889907541794594,2.89131505992518,9.83111307936576,-13.3934892257984,-8.18246290564943,1.05871145735768,-6.83681856140259,8.72685719935613,11.3704066013725,6.6019429208772,-3.93993006200646,-7.33109921881688,-13.8246756280819,-4.89727184809966,-16.8383949538528,10.7346360732132,5.18740054083238,4.78186902636418,-10.7771865434061,9.26369926671915,-11.1981176072996,-2.2351493628046,10.2663589499106,1.54855336118919,4.2102841265481,5.14763157067476,4.89652319571709,7.09691582977028,9.60754861635615,-7.0005755478137,8.49868714453964,2.92429166154218,5.75355179555096,-1.94018351402956,9.94334428389341,9.91861370883366,6.4350254255442,-8.31775825570102,-1.10999772469839,6.80639392821921,4.72908710375811,2.39648035112287,-6.47837473384119,8.11723377952883,6.36554730667016,9.01185872985275,-3.47195785338812,6.75622092439215,1.42258535179755,-12.8995307978385,12.928799632771,-3.85517979721668,-2.64739120566826,-3.15581452052875,-10.9004231645292,6.84044166266121,-8.60348685857969,1.89243982929869,1.16177013190608,5.16078907281793,-2.17811482875469,-3.34341606459096,7.67993241909487,-11.5993243747319,7.70232886715235,7.21905228203758,-10.8316024258295,1.98342671662567,-5.24395941561369,1.42276917088958,-3.46942869890395,-0.160396590088969,-0.52973552678463,5.67038227928319,7.11647437555116,-13.447417763681,-7.67537730573923,6.44083015176533,-10.2679583593352,-1.94807156536674,-13.9876122953144,-14.8087686026045,-1.95394043338005,-5.77755944378688,9.64487625869794,4.58506236787563,4.36284980705886,-15.0491119991027,-3.23870455928025,7.01981910268452,-15.5246449826532,6.2136957990831,-8.88722627972841,-4.25695055555794,-14.8940624230048,5.04888619943999,9.00091945343663,-0.419742225070688,-9.25907816321094,-0.0389637447942507,-1.35395065230248,9.20105750422091,7.46927957871424,-3.31507008261641,0.572508261887164,3.40514142870881,10.8994791252426,2.23124919368925,6.03360917359753,11.2146005924885,-4.66441568165984,-15.2736422733279,-9.15377752041512,2.78085260040477,5.12904382335145,4.0882266665905,3.34521572800305,0.461831314799731,3.97482665515735,10.8519664180908,12.3010948523928,-1.50861297602589,-0.264389549753781,9.40180723432858,-10.1267842781459,-14.3254330087046,-11.4493864145288,1.12529842400453,7.52782449746136,8.51973455277696,3.75371496161553,3.28753576627298,3.23157223048133,2.96246901198722,6.80137599040706,7.78501145263659,-12.6570833769504,-3.1063261082921,-11.4411946732459,-12.9362281851671,-12.3555114540239,-0.28333411748761,0.755350387541639,-3.9649969760844,3.76756782740247,6.77036626743522,-11.8324950698558,-8.37539909528126,0.679085042846249,-14.9601217324881,-5.1818116282347,-0.0942536726845936,3.56548195374302,-12.2926679294128,-6.12910432435701,-2.34287276102339,-9.918482383013,7.09903538302189,2.16008718644457,1.60518134357344,-8.10410403638876,-16.7532427217557,4.41264354137519,6.36600922795468,7.08497284512453,3.39611828225795,-11.7250008361746,-9.05975337407891,5.0792954776135,-8.59900198432096,-8.26470094678932,-12.3290026309716,-12.3810163075483,-2.37752360481419,-4.45136544309075,8.14355923049767,-10.189806344882,8.35094830303059,9.26690983712412,9.70043224865771,3.83264269064231,-13.6943386504416,5.63531880052481,8.0839711172369,-9.38215899273452,10.7606295555205,10.466995043177,-12.4160028951189,-1.00825621425155,6.55730973409536,11.8634528474964,-7.16235345508303,-9.87857700705185,-11.8643616669115,-0.0655645728983408,3.95909449379202,-6.66110477582011,3.6124314740147,10.9314522568183,6.06000611014882,-6.26920877808011,8.70414236241388,-12.3708513107692,-3.07606905859856,-11.0075685844169,4.0836704198752,-12.1123681950746,-3.88244070834873,-10.3426964760793,11.000742604909,-15.8829612504354,2.54520334250744,4.67677432635109,-3.56405154453272,0.565117438569289,11.9748153156141,-10.6201297025315,-11.5121392495465,9.56972139586113,9.38493519816435,0.0498449281812405,1.98049346977713,3.33354445117847,4.09323862442843,4.49402228006215,-7.96186224336824,-12.6564613966401,-11.2428640140026,10.71085448709,5.309910826302,-4.1912008612685,-6.00060207984623,11.2320287050076,11.4479800255823,7.90371451438669,1.07785797462281,2.50537639501785,0.72359120657806,-14.4541637533114,1.39585806479195,7.00338781258431,2.50753719573538,4.84587729618694,-3.73320579678222,6.97267260261632,-1.55629665582251,-3.37079325635419,7.27811566716854,0.00106162044567765,-1.15749993922686,-13.6135104878247,-3.4482749963,-2.01995382347535,-2.14611337848434,-4.09072615262254,-6.15456234787786,11.6116225418866,3.56318558404695,-0.327441989918096,-3.3290997782366,3.08861359082291,0.20021924189669,-3.55698669208339,2.0445313741246,4.85878957851101,-10.7368285093069,6.54247510900478,10.3738336790499,0.916300211224866,-9.93701471824346,4.45474755223373,-11.0742695809191,9.6909220236751,-5.14179262305946,-9.13925256040715,2.70019371264956,-13.8722650225966,-3.06348763310777,-2.27084700771599,-0.00480882368855796,2.95134655502424,8.89090405719254,-14.8214364838395,-7.21582354574512,-1.18710806271312,-4.64800975333439,-14.4103146911509,9.18076126642862,-2.38016115252994,-0.446759142144465,-3.73724777055028,-9.55133364613346,-0.0984271813938266,6.62847044191489,3.19063506532798,-14.3846558359694,3.11361846883912,-9.59222540963671,-14.6879580193745,5.14681015456595,2.85735569271041,-6.7935056372843,-2.40100686752974,3.99181744517366,7.20908365649441,9.65398552292046,0.335664680685584,-12.3288088475584,-13.1940751569452,8.92004905480146,-15.9497816728839,-10.1828289522161,4.89453888547524,-13.4531697559213,-9.80858728741571,8.44650653952169,-2.81820794831571,8.12187068293113,-11.5662906299865,4.7455467329387,7.86012121985834,10.2731104021915,-11.6384853997638,-3.61926738524991,8.75423568781965,8.73415503739917,1.77214723493637,-13.0747956341718,4.13166737628574,0.0970966036085597,-5.28553097863298,8.72958344929029,5.01480765578096,7.13305932617364,-6.90367885550704,-1.90166662639275,-0.0785130993241402,-2.51546247466487,-11.3664861845708,2.84976094903702,1.84139901284619,-3.25399720559288,-4.82246099656796,4.26384066272578,3.59839926693447,7.59098262208168,3.22524360992331,10.6337403406005,4.83917615535764,3.46964466644503,8.20869534662265,-1.85838165159572,-0.471454226324056,-3.56385103464068,12.187307821636,-15.6470803289408,5.04855201904907,6.79406144720244,-3.43959168860988,-6.96098368540143,7.04638677988106,-8.36890024646393,-9.94027992213227,-10.0738783419843,10.9618017977764,-11.5686983386592,10.2245565289438,11.8086040828073,-0.041511442884092,0.0171818410957833,-1.4877167314915,-17.4798777156874,2.5099724083714,6.55723374404436,0.223102107868022,7.67234711509862,-3.830453305316,-15.0906908203436,-11.0437018224022,8.85760497580631,-13.793000506398,-5.42770628760829,7.58952885387356,-3.68547193382706,-15.5563004823308,-11.221441402074,-7.03066717707251,-0.423337520241322,8.841301385236,-6.90208983428567,-11.3195604595538,7.06830473483865,7.0424681444496,-10.3539460145979,-11.4771218969258,11.2932943684557,-1.35557713695463,-4.18602739352296,-10.0751465490147,1.8788847399775,-4.10020933548653,8.26116887242672,1.87384805832659,7.65009438485869,-11.6643611778711,7.49096581669704,6.89886624881443,-14.0038814165246,-3.07178865739004,-7.53119984941236,-9.23371108437883,0.129995946427896,-11.5931867703794,2.48109859300615,0.72066770057411,-4.00261296836749,0.0565345794784102,-4.98689691880957,-1.0440663695784,1.06092720810148,-4.32537949856768,5.3075877512733,-11.4554704790414,7.87989838024182,-13.4777994123988,11.2946535504296,4.41543754996927,5.30907608211705,-3.48331152847722,-1.48866093092278,-1.3940242218004,11.2775353622639,3.33562273664726,6.30098588723641,8.70658523087676,-13.2705672696049,0.766327923268357,7.55707215819368,5.19587118321291,2.31800317440879,-1.29638517874767,-1.1266492514967,-11.4429159185132,1.06045938930989,-10.5373687527947,-12.4923984070613,11.8117442771488,-0.949649808405418,-3.14918213595859,7.47680074253922,9.47983136223432,-3.51315127892931,-4.61340504968856,-9.42293560363734,3.77537212102496,-10.2695216542302,-10.9464800679939,11.1821224324796,9.62687118450968,-1.17121668558615,5.83027605241538,-3.93403756478549,-5.06708348145476,-9.80520498638217,6.74911722868136,7.15162221475909,10.3024174940888,7.27480994335103,10.5147485288601,-12.6425818934727,6.74280671691854,0.831822765126827,8.08729861824141,-3.69389188826327,12.2124896762216,-12.6707253821162,-16.2972092291776,3.77439236409139,2.7236908730811,6.40845826135662,10.6968203170107,10.3593393560673,-12.3229140351064,-12.8855862343476,7.19395444800778,-9.37433759057026,-2.61246268326568,-4.32203717191813,-7.49633456691126,-0.339933868028644,1.18671238330189,10.9361793741712,-3.8372384469258,-2.16840907514794,4.75953339124891,-8.78464730418214,10.646569505448,6.23702262641971,-2.46278095277826,-3.32608342500181,-11.9994339708017,4.78595728883319,10.1004626161565,-14.0854228157649,7.11563097701212,6.57113355494872,9.74802910763305,-3.35268081168093,11.2651997047495,-5.11895583150842,-10.9498110847956,10.058247357314,10.9208742224803,-6.78685441429928,-13.9667144729033,4.71517557420859,3.19715576239278,7.66434786434726,-14.0155111023421,-6.23364047608626,-10.5932224233214,-13.2109844382228,7.7868944659012,-10.8365314353441,7.57081927345916,10.72335241332,6.78400552552356,-3.7232025873966,11.6657448844689,2.65036000281584,7.23375632097735,3.05988412708265,10.3147756943685,2.63537008716921,-3.41732955929093,9.62208983522594,2.4041545341629,-2.82137499922696,3.85762682711509,10.8093579261054,-6.06474366432108,7.62195715175079,7.59637948642491,6.1109066943915,-16.4797181727674,-7.01528517137479,-2.15360715931152,0.494066188198416,6.5801785461178,-11.7738516352146,-8.83953071922091,3.86737733893302,-1.20069981809382,-2.715492437111,-8.21232322755488,2.13932134820078,-8.76068582757213,2.17047392431433,10.4171908216825,5.40644041323777,10.2313878323923,-1.37376226948617,0.672197857752152,-12.5284917213217,-9.72213533062268,-15.0534595981337,-2.79203323676675,-0.795172957832658,6.22536395110988,-13.622218871723,-10.7960227323767,-10.1821594286835,0.130571295687463,1.21353874847712,4.65471198806589,-17.4813038107817,-8.03636110772787,7.00714741638335,2.61557346020311,9.87969503104111,-6.49582629789168,9.98447415557156,-0.688165968947004,11.2278961065549,-12.4319361717574,4.98994819641734,-10.2922069562845,4.15105991583381,-6.13060666993313,9.7459362422876,-1.50030216202154,10.112396741618,-6.60131977511768,11.0142674390149,0.152023997005444,-8.0878030317311,-14.5141855649691,9.3041642813024,-9.61653552327437,-15.4088469327069,-1.46647589381195,-2.10098875565224,-6.10026229643796,-10.7228584739178,3.35477992160217,-8.64448573233908,0.810216909208728,0.425374376100636,-8.18835435137973,1.47545522992215,8.17655875575261,6.94351802584242,4.99121655893888,-12.2001833095526,8.23983376841392,5.08508410049415,-0.19144892564878,-2.15080996698666,3.05305762261268,3.27855265597793,2.8255953921857,-0.199305439454856,3.07838114462375,11.1926430953936,-7.95372136419564,4.48744260557881,-3.00441739893663,-2.08236999039003,-7.41668049262339,4.10275902944458,-1.102078458571,-3.6697836394086,11.9901917760387,6.56274637827125,6.90033151976202,9.83015451386409,-9.68079557349856,7.4701131100295,-11.8108389200304,-1.45661849552363,-14.8622937010971,3.92410129409312,-11.0635992246399,2.07568337915508,9.29157384710789,8.07968803706528,-13.5747680802732,3.20612307421428,9.64472845844451,-3.35022835109835,9.32532694051381,-1.58215914467997,6.81347418097091,1.06436527474142,-1.91146276115677,3.17120508230376,-3.66711732098798,-2.98244750703895,-11.0645368570523,-9.40135268997227,5.55212476112239,-6.16560493452022,3.81873019124052,-1.27030861456813,-11.1959796197472,2.96144423219601,5.20116990332279,-5.22434283445764,6.83515194188371,-11.6664765045506,-1.78128658383716,6.27810516453127,2.9947648967973,5.6509142931066,2.78277732669555,7.70356117259486,-14.1027219497052,6.58500357982688,9.65950771855894,-14.5457196925591,-13.4435243927939,0.851096695143485,6.52260281146573,6.90576457774171,6.23752392817671,6.86910783375688,10.7020156677305,-14.4532693433643,0.812936146985994,3.24280819380646,11.6066917033058,7.42649178348599,-7.20622652350954,-0.550317965567239,-0.611697750365122,2.36136333003448,-8.13406693871669,1.325187784636,-9.54157969318261,-7.09189932007124,6.83611484977029,4.67244286208184,-1.23712731787688,9.18406881853282,-14.0227312612812,9.31155063438081,4.0697905092024,-13.0109435734237,6.5098992248851,-1.43511258056262,-16.6779390834791,2.95982330040759,-7.16494029513774,11.1920356560971,2.32879903511123,-5.08923495179521,1.5963118888362,-8.97359580462543,-3.60962659757962,-0.61744387483345,-2.85701156634217,5.5357724584898,2.56357794696911,-15.3017457132328,4.58491410596088,2.98747824076449,-12.896102287132,-13.9258736873381,2.98671548638628,8.49153238398527,7.08553815402189,-15.9867652858164,-13.6709538394743,-3.65088878315723,3.11953849342822,-13.1839496917453,8.75766847081078,-3.88420442655663,9.64350275686616,-1.37408953470131,-3.59943552623882,7.89382320624922,4.58295220662718,-14.9878224817506,-3.95301432540554,7.02835741300142,-4.36001595253798,-9.12678758665595,6.21723769253142,-0.105397174020197,4.08111628731198,10.9990127174105,2.01010014786725,-0.878415037347965,10.3845028865434,3.40155729752614,-12.1418086386029,-1.71673740896422,-2.65388907888998,10.4333713655889,10.1158335067172,3.20112670404568,-1.01033115770864,0.486357037986709,-3.1756773065346,4.22578116202339,-4.40176738214793,9.12595870466929,7.96244806136765,-12.4770167606737,2.87518122474179,-4.23078435556712,1.03991644902279,-12.5771694231855,8.37341467262872,5.75138764679351,0.660279006477143,7.3323395626482,6.06139339432244,4.13183137810494,2.19975638204812,-10.5504892958463,7.70220668792144,-2.82072296151232,-14.1858394386605,9.2789493402567,-16.5799941812136,-8.90464766502288,9.21875256640506,9.20421894411271,9.11570175777651,2.10932795320815,-3.9976735942059,2.10512781362829,9.33830611652755,2.50730663695904,4.58318311997114,6.80932128478773,3.92607583300854,-1.23540773182524,-7.51064271365029,10.5357372122005,-5.5218875911005,0.00976673020773924,-9.89805005605661,-2.23483889784124,-0.832349705887485,7.88706968943287,0.96543954928539,4.97476417641664,0.244998614532728,-9.10127472597457,4.28473610982041,-0.0934993254164325,5.22274727155551,-13.0070939544239,-11.8493001484245,1.42854381602167,-12.7399866144193,7.07007002175112,1.24385949720144,-13.4335350527399,7.35756042659514,-12.1372952236963,-14.2731920527005,-8.58410173741731,-7.35729850580197,-14.2132663520284,7.77145318355852,-2.01806303375981,2.11165533581418,3.0771901181428,-8.90779277253557,-16.9509982281864,-3.55023891533676,-14.0097814184945,7.32963773682705,9.118271566155,10.3223779667283,-0.785458781544937,1.39113719941521,11.9914218289086,-7.40357547883626,-3.21503236779638,-4.90486210994078,-13.6901823001047,1.40596362647126,5.11656436238653,10.8440180659292,6.42591343768377,1.98140451255794,-0.259143915494176,1.22751045600258,-12.5335842699494,-10.1679865991152,5.11157833173426,9.92632957743197,-9.70017982570916,3.22030478152524,6.43676328908583,-0.739480456406954,7.37021089235498,-0.976495840637493,-0.568353632806302,10.2018934153319,-4.22612674752566,-7.44511756534601,5.5549194184107,0.601330692589122,1.94484055193084,-0.620886096735016,7.99427464095841,-3.93334559288339,-10.8504684645923,2.84081317661909,6.83395463308155,-3.78073461754307,3.78409018387511,-1.30541425020812,-12.3357203394803,0.48410980485091,6.38971578616204,9.65684994542042,-2.75438339932516,-14.4803163665767,-2.15501430053395,0.465994702172914,3.2285167988725,4.8884276486059,-2.29902687961026,9.16434995883591,-4.5995400684101,9.40110109511421,1.1837201930044,10.4419501548189,-14.8429672895073,-0.564433723719789,-2.05830651686259,-4.35391670968321,11.414165116044,8.5939396898019,-3.7853091020217,-8.46395013637652,-8.06935307815328,8.8385487744995,3.84313804530459,-3.05304359390583,7.08273347127422,2.72718712194514,8.40531559988768,3.97870544551576,-16.4670822395134,-7.07753069567801,-14.2384247196042,-0.126657088594808,-5.28809161792464,-12.5874350120199,4.18832517656818,-10.5913232687267,-2.32011198439004,-10.4884599256429,10.9771942267818,6.92733062346478,8.22544958377789,-4.00501773898503,-1.66675170750261,-1.44492856125172,6.59171897248965,-13.7807630629173,-3.34071056786941,-9.92595191234454,-0.871271531215126,4.84447210190695,11.5338033754264,-7.1683656823241,0.220125787243174,4.18600892926953,-3.66702122765043,-5.8709026100168,-9.61498001990717,-11.1673490949517,12.1847838412572,-7.50753628267548,-4.18769204949873,-10.2328153946908,-15.2736902813511,-1.29671711423883,9.25233922256825,11.6739934569865,0.0996158734085468,3.96691514485562,-9.12681537118177,11.2687716473871,-2.81762341296063,-7.24269479141646,-12.8997467944318,1.26425093913796,-11.9080891106839,-9.60075867733841,4.57872269421269,10.100918332724,4.46726215723052,2.93114678782632,7.58436483303276,0.971223867035387,2.88436550294712,-12.8614336085156,-8.12749823276476,-13.75374088855,-12.3035540169631,2.32327514643619,7.46189835034588,4.33386843396052,-9.17945031266364,-5.55991360900063,-4.39404665637217,7.36862763331266,4.21658567315317,8.8030100448261,5.54592921961176,11.4502358224436,-4.94818308226012,10.8379170747792,10.8374117598183,-7.90282113886091,8.68292250505573,-2.51049372240199,-10.2590582809269,0.414952157253194,5.13842097257281,7.88167915832968,9.33209008128285,9.77688304066469,-3.09939171531768,6.96408772603081,4.3295620612701,-15.332191387827,3.46344178929219,2.33018685450472,3.08052478431283,4.29597182025093,-1.47876778696363,-13.0381138315334,-3.12570613346694,-2.73059870786524,-8.63795891628221,7.08924980892202,1.69157077101361,-12.1278478231357,8.80881877372487,4.53269780406071,-2.5785420050338,-3.02785550085931,9.03179903908925,-8.30283467289226,-3.84538757753671,10.4030243228389,-10.8869128348097,10.0048414242583,3.28560379927315,9.29156576981388,-11.0365835810929,-9.80976296813444,0.672843607644832,-11.1581879938641,10.2834341290521,3.52455081731651,1.24233166113872,-12.5760171546041,10.5665549718346,11.7863449304956,10.1568243344168,-2.36676340444677,11.0706423843404,0.86883969650285,-11.6771019361012,-5.67916944004976,-13.114908550882,-16.7699164496718,-4.26972676319082,3.46789248006443,-3.71584694999347,6.49582498715062,8.51423657394286,-1.71095371214338,10.5617539414593,11.7707552627807,-4.52441167404108,10.2917018827769,5.25270585839545,0.789519676614693,-6.46361634924249,-0.561773394102143,7.10202796386736,-15.165033503964,-3.14938720237319,-3.10205777486574,-12.3142986537011,3.92461712474966,-4.35439725062635,7.27740366109258,-2.66093884507689,-2.69122531011063,1.16265003024978,2.54606165930274,-5.33757755794002,10.4707150312347,5.30053421230119,10.3161270180132,-10.6125172138372,6.64017497081236,-8.29851165258077,6.6694061446567,-3.46212287384644,-10.8633090396677,9.25038427002594,-1.98841667427302,5.30844999186754,-7.84047504370984,0.934151589473817,-3.3548279262894,-11.8910231717265,4.87870037834936,9.56295717864335,7.64330829935797,3.29250827097822,-14.3121121453113,-2.45711302943458,-1.46618076547506,4.32191941222138,-2.36503119749703,4.45190660277448,-16.8222330026763,-1.51368749211814,-9.79123124114864,-9.51879561798784,-13.9987247818322,1.27830781675901,-1.48481746792535,2.48925240981731,-2.74809653318622,5.01034774217534,-8.3226926630704,9.65498894519923,-12.4866849083789,4.37324345918158,10.3136304346567,-4.30743442868922,11.1944363981471,-11.2332928482887,6.94753258461691],"y":[-15.9673377599113,5.66975964902548,-8.77818950821644,-2.13961178993674,-19.6984183705609,-0.196920975539678,-2.42580987010058,-19.2343069267998,-2.99109571081673,9.52752074000473,17.1364426797165,-15.6402161539033,9.78267413804593,9.43263556966627,5.06757808058878,-4.47926752294106,-17.3691746558434,8.48695469183638,-13.0574160987575,3.99760455244532,1.4151029400085,8.89224469808186,-2.83992481423707,-0.492336956733319,3.28290991087231,3.85990793553297,-8.90705092873849,9.42016369662749,-17.7902663841582,1.74661216774987,-19.6411813602325,19.3742870135737,18.9811333759661,-18.4203719385579,0.765645695938311,-4.73163549436878,-0.855021596928189,-2.48653374675299,-12.6792841846805,-17.4875155763953,17.1627125138593,-2.16264078943451,2.15754423793356,-2.80383147240977,-10.7142090887233,17.9389565154667,18.8395192760639,-19.803975252085,13.7658831814431,-11.1422906848907,7.91357465907774,5.02020416822446,12.3781104233532,16.2598662505788,1.20421776039783,7.84583189043147,6.3837089411763,13.8932999344707,-2.35928201920734,0.927266973523188,19.5254608802006,-13.198523180346,3.12796600297153,-20.5434998098939,3.52704695759401,10.3820067840877,-9.02868546572871,1.67331190700338,-0.228720331597061,-1.39100558198826,-0.122412142921674,16.5671611812012,-14.4204757055845,1.81665722687687,-16.8537163561203,-11.9264435258769,2.68955297255271,-13.817486831441,7.87312132250302,6.16073009561685,8.78501077174469,-2.41065861023483,7.74209477699574,-17.875029477808,-20.3382525365537,-0.156889809164829,-8.66988290236121,7.20077879554241,-16.5236246366409,-17.5383460930866,5.4825751966243,-13.2242586383442,2.04709014195926,-14.1287282778212,3.18596852675273,-4.92644528565067,-0.0870944565277938,-21.4542252074024,21.0191128581882,-13.4694097102671,-12.5317104441329,1.60385474551617,-16.964333485658,7.53925839322867,0.806244469881588,-2.8033779330827,-17.3861728309692,17.494924040051,-4.02931917499083,20.413866737375,6.68150994018296,-10.4460495406797,20.1855077863121,15.3628640532909,5.70775721881636,12.6828090398904,15.4353103914631,11.0990568738171,17.0636916704775,-10.3337881049011,-2.40995216662941,11.8316255098366,-6.68512894750448,9.20532089676397,17.0802490611973,1.18244122540038,15.3853592458602,-20.5062040646386,-3.85040652471447,17.5423193218868,17.8169330823617,15.8112019462963,21.3387802744448,15.8797497722738,5.41224439717998,20.6249474983657,-16.1928973513659,-17.7188971162668,-8.98080173055824,-0.903288417948641,19.6846563527395,19.7363430603188,-9.34848351542492,6.0884210026157,19.2118956522669,19.8645388208863,-17.7399069662793,13.7281148329862,-2.73031759082039,-17.3027700684193,-2.81041070006992,8.1957884771828,1.03636643502591,-12.2927630262754,12.4362631504786,-14.4579071556128,17.900888083007,-3.98292286863356,19.4754664953722,-14.5664465530997,13.0324851488086,2.31148961428687,16.6299468011584,6.27441369187808,9.63182608415293,-1.28370244684747,8.01395323549763,-12.6676261670212,8.19553323534016,-8.3074271563913,-18.3370279971478,3.84597510272244,11.6956907659842,-2.76544888628933,2.29912225727876,15.5046538207351,-16.8881379685924,17.1014019053288,-2.00312377145404,8.71977138971156,4.92284235823714,-0.695932334115392,7.76873083402207,9.75931456833239,0.953908160832141,-13.0262221327575,18.0787377677213,-12.1647309934251,-2.42537512431964,-8.10786758225995,9.38031138299535,5.42039734168583,18.89016137245,3.75812702143235,18.1215022624889,-12.4198631850512,-9.68705242633241,6.63700726756897,-0.462287420125959,16.5428625688585,17.2963388559552,19.5845643045607,1.99839679438684,1.05203043609798,-9.44022344452382,-12.5098966893475,19.9883653260893,-11.4668381940495,-2.51920279720007,-1.94362589422666,1.30041141159447,15.4712630727988,-7.97105542424684,9.0885550700181,-17.3789860517129,-16.0708143259203,13.651996886796,4.11706185657858,1.21517331414382,10.8910790040793,-2.59064794134656,11.5909231940057,17.6927126224925,19.7962819482183,1.31752426671125,-2.6266716631909,-2.9914589958855,-15.4066676597385,-16.2026383984467,21.2287038403327,9.17465382615656,6.0829249596365,-21.4100486909801,15.8998983618823,5.62077466672877,0.121534486468602,5.91677917150417,16.6542024316003,-18.7837797889461,18.2713082869209,15.7583643487246,-2.47482895690965,15.6281478652042,-4.89756518440682,-13.0722727188178,-9.24452462160515,-18.549461938582,14.5802721093655,4.04565429687868,7.79383009582645,6.37329153855569,5.46632268170458,-12.5048047973784,-9.05011487704128,-20.5155466098898,1.54284473769175,-17.8643543468521,14.9389946351783,17.8152148860166,15.0874650458087,4.12253813767634,6.79536626466934,-3.16933669862998,19.2736094883604,-21.2466435802668,7.69934125545749,-12.8488573059695,15.1299277220383,6.46163062266483,-0.515585277589916,7.22444121228801,15.6311472667667,1.57422509992914,15.5932848851086,7.82841272501197,20.4393105600063,14.7704126306148,10.0610786618068,-10.0934141484493,-19.3735458271777,13.3824888085295,-3.91201560727871,-6.17802969035687,-7.00944800627085,-3.0782854722129,18.5672730871287,-0.213116993316094,-3.92745993225775,-12.1339659087895,6.24338226102606,-2.81738502775102,-17.316741005132,-19.1028167013768,-2.08228378769089,17.8136610420233,13.3151896067032,-2.6487991668168,18.2526662464085,-3.2693215964209,8.72366486429651,2.70168099469592,13.2827947914069,16.572979953092,-14.3405385514874,2.70772730819146,-13.3323497518113,16.4590349549654,-2.24230932647231,17.1724444086406,-10.994384941468,-8.60463894901688,-18.8549436183589,-16.8913154882993,8.96317709717228,-19.3901642733629,14.5168847896221,8.69169027305702,-1.53771585385232,-0.984246464803202,-16.3254510507658,13.6827072255216,-17.9832895498747,-20.9232278108037,20.8282787744234,-17.9281699803905,13.8382915891702,13.9770802016478,19.9704223768714,-16.4891007910443,-3.34561909460168,3.34767777678513,4.43979394280692,-5.74764595566222,-14.2799481430226,8.26328633034095,12.8295408942651,-19.869082967735,-9.48802658676562,16.003876005742,16.0020751450403,16.5498827131526,10.3223313012824,0.207876009194289,7.66663009032203,-3.63817244182129,0.528683552321408,4.48202850203215,19.9210461358447,20.389113945851,14.7172745793256,-18.6724228331844,-20.5754501842944,-5.45855740488608,-6.57079439419139,16.2457160493122,-3.53396956780216,-13.2141498278453,10.3884748029506,8.72763756535123,1.38116179980807,3.52742574951163,-11.4932606569854,-2.04680639205122,-14.3704430620874,-14.7898605268285,16.1117903310734,2.07214115574314,-1.24163081787943,-20.1604873612004,6.41051763781159,13.2111800958681,-17.3849461031013,0.518411375416865,2.54199777444288,-10.402762631616,-4.41454406033073,3.16938865516432,2.92341685921823,-0.205227723697595,-17.9325411357957,17.5345607378754,9.89385110045275,-0.767757027691558,17.0659670848245,5.05277920748838,11.0046103480639,19.8772905951954,2.4920515631586,7.18944438465895,5.23412624050007,2.71874127630484,12.4916241216863,11.5684429432305,0.422853835792536,18.1503072466146,-7.44621265828443,14.5780235338787,5.58378617164743,1.20760050517734,3.84678867018867,-10.3670858521612,19.6165993844413,5.71517593971534,15.6485901211095,-17.242088178452,14.8901614364899,-7.82933930400907,14.2692900046865,-3.18561111362506,10.4087048554138,3.77554647180408,15.8170369844064,2.22511779786275,14.6738227638015,-0.901465467116397,-16.7604708621207,-0.651668428603639,14.4059680995789,9.2294033772844,-12.5101697823064,17.4184586800377,-17.426280146391,5.05283338120363,1.67258858208148,-2.2352070495508,-2.49439076976666,-17.9761502107718,16.7376775395646,8.79808686415993,-11.6127127205241,9.58896387521299,0.614259375566449,1.29394408542557,-1.32625445163692,12.4464633902524,16.048594334689,9.55711796359211,-1.24845211538619,14.2485122683077,14.1230741649444,8.83774829576955,15.8414998896177,18.1796254252336,-12.0142657680521,-5.85742795066542,19.8039687681025,14.2356381590713,-12.3597768573599,-19.5095828495316,11.370482328829,16.7097120707782,-10.3481467503858,17.5443569903107,16.7838508213956,-17.4979397322253,-16.2086696675427,-1.27673547941285,16.4034788498926,-9.71142959076393,-8.25137359370254,-14.8338455410491,8.4099998140794,14.9766472579633,-17.9690356760235,16.6089944916805,-15.1259477866307,-18.4553106420749,20.138651478641,15.8731321364437,-18.7289301428151,18.6225119994419,-1.60319356130381,19.0058014396552,12.6696519109037,-19.3353047884268,-5.28165490662122,7.90722260339127,-1.64623142233308,13.3162789105471,-11.5582763606447,-3.05660753524773,8.6383702549955,-3.19176762395208,-11.1129436308296,16.7462900604341,15.2031185312269,13.5354455967921,14.5437388126716,0.360911927572727,-1.38157104266409,18.392931863343,14.5735525859071,-1.01138202350945,5.13578129156389,15.7360762391944,17.267381228412,15.5273491786175,-3.17754490026488,-9.19494389485269,-9.03417421354525,8.40233366159696,-4.58927213645346,20.8856941629589,6.25946881583429,0.762827368134978,19.6809767643837,18.0899668568342,4.72906544750177,-10.993287349382,-13.9248106263865,6.96041971373793,15.1737701506904,-14.1175660737513,0.891720192916639,0.515578437033615,12.8907920132349,2.40182642167669,-4.26564994701717,13.5109105393715,1.68161762133074,-0.102606395166109,15.7416421600608,17.0735040655409,5.37112495912424,-2.06419947190856,9.50598069363063,7.8591359210575,8.16061450027677,2.5389377327347,10.0588314859113,16.3241975179064,14.1493181368791,8.9689187411779,4.84202946466112,-19.9869450071342,-8.99565672630343,6.64267618933627,11.305339668824,16.8164087320148,10.2335370628633,1.18051060483815,-8.91174989068111,9.279526665975,-14.9626391890019,-3.54743925160024,-14.4668476657397,-15.5825932740027,9.80249637160744,11.536734485222,-18.158195997143,8.65504572529829,14.5665427077952,16.9890147914619,14.7465324701929,-19.1289619938819,9.46403491185392,-18.6675922727859,-8.69350076898722,19.0108274353206,11.2801540572842,-17.3401808479988,-3.04146782020303,7.60749853195372,7.02783548494267,-11.8650018589081,1.10819839262213,13.1853502798213,-0.81137001408533,-0.666704095578504,-1.17910134422225,-16.5468362602718,3.60282661385323,14.2132971369446,-17.683520614018,-15.3978288470131,19.4702393886969,-10.4696816694967,1.13322845796472,15.0638196519836,-12.910607967393,15.3837084614033,9.11368801560278,10.9886534986002,3.66309055326045,-1.66960029582586,-2.29142586827462,-3.76804304592304,8.20451639434588,15.2264758981547,16.6244402265399,3.87545633225048,-1.10973349003385,5.39761494610955,17.1692346844561,-1.17549876120324,4.96799123093356,-2.22814040129757,-20.3913156583966,-9.46695192809555,-2.77443811816909,-3.97399573621483,15.4875875599323,19.5626047152569,-7.97550114439175,1.93839121081026,19.4011905787773,14.4293790519012,16.4376369157374,-13.7781594894936,6.53313772857693,-3.26005927841387,8.35391776239691,16.6080078493928,-2.28365750710105,-15.8687204609801,-3.00515673429595,-2.17465273551824,-13.0225396773461,2.29235424629154,15.8058080252767,19.9674226884741,-12.1839988688698,-17.1261885940117,8.82661517280576,-8.5550739907339,17.296493292508,-11.3559590810084,-20.7727192209101,-0.429788572160804,14.217692337805,-5.19240840581989,13.0449999445833,-18.8321260165657,-11.8762651921903,17.0389882456598,20.4094249330553,15.3371273469079,11.1986964073298,-17.2008678425196,19.0797795082565,10.8855094569571,2.40168209896513,19.9168014105335,17.2553117514865,17.8522171780002,-20.2222723962623,-9.53046464406806,-16.4295558483845,-1.15391471582,9.34542881783022,3.26312313326077,-2.63711089177538,14.5961155339532,-11.8841138816897,-9.90787752099693,15.3221247031161,7.31537632606183,10.2752625177923,-11.9159128882196,0.449192868289589,17.0352734523319,2.90349567418807,0.307001981217754,14.6684309469985,8.22109747786773,13.8811626967834,6.30616274348156,13.6188142248342,-11.7549944345284,4.41789300211265,16.1180147701378,14.1288159298647,7.69904059068943,14.3379385868962,11.4336450879225,-3.81625715860506,-9.12035471944441,8.84925969324289,18.2390604000628,15.1147434875783,-17.0456362432215,3.53066784936364,-2.55730794272695,19.3574124561834,8.69597319814983,-17.2702472951602,-16.0661283779956,15.8969573833719,-4.43751700619594,-3.49781214597606,7.13597358392323,4.17892692005263,-9.83006458092438,-14.236024260158,2.40572730383288,20.0030711636918,16.2443050712752,-15.7201539039815,13.5894964716118,-12.8385728515398,-18.3570873952702,-4.57778255173067,-18.2581302472305,-21.7217644117845,17.3272879784995,18.4834366614735,-4.5668838163869,18.9812725004085,16.5279336265263,3.1536463570625,7.27988690003319,-9.53824479915129,-2.41001757364162,-10.9992408413667,15.1156199886862,6.34218200942106,-1.74759771989044,7.68908871112614,-17.0672303327482,3.82200928693169,3.32164201229202,-13.1113079713175,-9.6629663018304,15.1507528644543,2.07699543867406,7.17151566870513,2.65972548383651,-2.55222020811325,18.2618196571966,-7.06106249781447,7.36671558412857,11.5612359416949,-9.21927654693501,-12.8941489491538,-17.0460962517196,-16.8951081129048,6.83076770789913,19.0252425970689,7.79857006571157,-20.8580407225331,13.3705204996846,-1.97990681578481,-21.4403644740376,-14.5115651918593,-19.2567620295311,-17.1829381801626,5.30579219982831,5.80812981762389,16.2899141269879,20.4593958498046,3.30394972968619,3.72562259841015,-8.33421125611347,-16.6507969656835,-19.4690256282487,0.424972557420911,1.85736699791352,-21.1430359438421,19.333101311897,15.7473602132762,3.29249246741572,17.8121463279215,0.900072044157013,-20.7552528920612,10.5209344628855,-21.5553368657892,14.2816457511048,-10.8321394728403,9.55760865254239,0.729087732189361,1.26883155784994,-0.59765103640581,-8.05603760278139,19.4229032231311,19.6025498787028,2.57474606672288,-4.53930499474173,0.388110576501327,20.6560793611693,-10.4353293429493,7.65317442890324,1.43240249699367,3.27336207931473,14.2276587589568,17.3190151236262,6.24823848686261,-2.07468389769746,6.60447381677595,-16.2719502000009,-18.0745780166978,2.16800203691403,18.8098324126826,-2.15843873761192,-22.2326126603977,0.174082379051333,-2.96894671984182,19.6535331394537,-2.42572579917431,-3.69369933084895,-15.9549500573829,15.2822632686775,2.19443563309576,-0.00916421248447897,15.0330020505199,-1.71532678013858,-1.7064764118561,-11.6270438601738,-16.9034282195424,-9.26454032177326,-0.480694220675785,8.23138940430177,-1.77228094960533,-19.8024799628438,-18.9372776792985,-2.23457686316135,-12.0589796861826,14.4567313462072,10.1100635264806,18.705083449952,-1.8053801197738,14.1580909399068,12.643752485126,19.9873244032206,-16.9324782556308,10.4545531705857,-17.9187179635911,-17.3454899940387,15.2696328957819,-19.5107780160869,11.8499872722199,0.0751085382410047,20.8623405564885,-14.621980999277,-13.5699642051154,1.96253890591315,15.8398235424118,-15.0255909763955,-9.10123590695494,-9.73111640168443,8.38491059501091,15.2469748983534,12.1729888611388,-2.19371414743663,5.938134576989,-0.796182141560785,-14.6205747758983,2.69190214953539,-20.0029949159605,-0.161806611707093,-18.2861464708817,-1.78372279938135,19.6900701487769,0.57290472349682,11.8143424471561,-2.7505665508003,-13.3960900834486,15.7170308985772,-13.6680830285086,16.506365408677,6.74678884926463,-16.2877508943129,20.4588207905883,9.87846066161024,9.96469233767841,-2.51598940114582,-0.979431479890049,19.2478578288578,-10.9087608052963,19.3903194869668,-9.63609447203665,2.09166768531411,19.8408129340323,9.69023832779171,7.05596320797161,13.8621824686197,-2.28899041931767,14.9904019068918,-19.3186243401973,-18.9733055199059,9.19114174801527,-20.1638671218294,13.9522958245874,-3.12013199725636,12.9979427134782,-2.55646438981654,1.5771938578123,1.92678821446162,-18.084864146926,-7.35741387977289,-9.33568939974354,19.6389851756646,18.4335016408565,-17.73814012697,-2.02843902686987,-20.09545798639,-18.9591752914419,-17.6651736210257,18.7170765163384,4.34718714154463,-14.565310362859,18.711219812327,-14.6443703013033,6.20476625038319,8.97853137326519,4.48777763912365,-1.75226295272448,-9.51722570815222,16.4318376558537,17.0472460909636,16.6180218811418,-1.10887933425826,14.5593694794081,-16.1134538800913,-0.352991532538151,17.4120864341467,-15.6098793958951,-0.041668469963273,-20.2878324195875,-0.621690368820052,-16.6772641362291,-17.7450575961841,8.12929424612562,-10.6215285316348,0.353813545611738,16.2256897254895,19.5961743419478,17.6263672434147,9.38916201681057,14.0128251449006,1.22949770587053,-18.9741262950951,8.70010978178972,-1.61829291509501,-0.988706838742032,-10.4673041301781,16.6716515651436,13.2365923454686,0.430013306399646,0.27495061153459,13.5491427369848,-9.40492819783824,3.03575397766656,8.1308741111949,17.9385420330635,13.3393570161314,-14.3683485880362,-13.5762293354778,9.89487617730381,-18.8756870182492,-0.153984270042586,-8.96438283106515,16.6675799038749,9.53774164368478,1.47270080371427,-20.9785748877748,-17.0350385879842,-17.5296719644304,15.2483850673073,19.9798562679143,-9.5237715986463,14.4700228293009,19.9161407097141,0.959397204237898,18.8625751413655,14.7695880933912,5.63845411616412,7.74390247570908,13.2540381426418,15.3659450420157,-12.9542861529085,9.4065629238653,19.7161887993213,11.6769491717758,-1.60534684618136,18.5505570505702,-1.93733020555345,11.8261834124673,14.9931209836848,-17.1106969499494,-1.45495527104816,9.93978974911447,14.9217098534065,-19.7394980397688,7.8549693892823,7.75663425744448,20.9422658748666,20.8019699424477,0.85893574860937,-17.8729513506339,10.3764259158204,-1.78500155199551,15.4485988274013,-3.97561722291679,-1.87500774338994,5.09878374110306,5.2179290157884,-2.09639029852204,-19.1254647914821,7.46864481741188,-11.1960305529515,8.4935616554094,-14.2523828714132,-19.9761762745815,-8.60175717835101,-17.1630731728224,-16.7201291384846,-6.91464845314963,10.9192029630302,8.72416905753062,-9.38851296960255,3.2192728128208,-12.3710648628355,-13.5123755779893,8.19577274135588,-10.1895330746395,18.5368910430836,18.4951535750688,-4.05391199324103,19.4818918813363,-12.4440204571499,-20.0692261361627,0.706705250713441,-0.704858315696957,-18.6350291618185,-5.54863086101619,13.8673574724741,15.0816942906005,1.23253475253951,13.3774146163719,-0.255135073963282,4.08779531461649,0.629557551379091,6.31263917320316,0.375907984189696,17.3177989775091,-9.39244761227013,19.5266656043227,-22.2877749722028,2.9931788056219,2.49161762964059,-12.5111852310286,1.42014864874895,9.02740869929596,14.3018852512707,7.87077030986005,-14.7496723691055,-12.1066821531919,10.9729051559684,5.86241827080051,-13.5215021294372,13.0355403767206,-3.80915641184492,18.0108214051236,-13.1375062122689,-17.4298983777903,18.9157277221578,13.6831366928957,20.7278460559288,-17.2361633156262,1.84826284862035,0.432035640654324,8.59737999131398,-18.1455846950282,2.45760126095541,-15.7674047738025,18.5702610298533,-15.9598464307772,7.35768775205052,-8.75022627142851,-18.1853231679671,7.88150534900053,-11.576337948329,3.40512300979407,18.5448930772796,-12.4866655906516,-18.9156175913494,-17.0130616029137,8.17315836275974,10.3860841964863,1.9142555341536,-19.4830231764535,18.0886180483037,15.2140264091526,-19.1755068282761,17.9325299986165,2.21423069629377,-12.5964368690418,-14.3491769022764,-2.47638031500891,-9.10398558954643,-5.95706679238743,-10.1744001789963,-15.4702347090409,-10.4323103092065,16.4843193962816,17.6047038748644,13.4644105585632,9.02122351543075,-2.19592475909374,-18.8947934457866,11.8381243113958,1.7151862558127,-8.67570683478086,-11.534044300752,9.08556760702293,14.9377623573207,18.4683314773426,9.63513491095147,1.31401915324597,-1.271225224239,15.397118521621,16.1527441846277,15.4629089159033,-10.0877367905372,-19.5328497348615,8.15232419539049,8.12238751713012,-0.205833274392683,-4.84138526244564,-2.77894224395762,-13.9448332729583,10.1871378895179,-5.61887869764122,-21.3542540641275,-4.8646317704411,10.0490569905279,-3.78895015051356,-17.1938085156693,-9.6329623717877,9.43974543889997,-10.4082211497873,16.1497195428697,-17.7882167027861,7.54066807039838,-0.408065406356117,-8.40547288859975,2.64177130706061,-7.97186409424854,13.359357562061,-17.9287331070032,-3.93616855691398,-15.8960856219169,20.577686134897,13.9427721977091,6.15354020451476,-5.09228915686128,1.16633154919136,-17.2201516170362,-2.74347047940198,11.0529867657383,0.803549222062129,-4.84176821865319,-13.6239142359406,13.8178430857289,-17.4693556163821,-9.03507213606613,-15.4892150185873,-6.53126428249449,-16.7953189616291,16.34413616629,-10.0671349499422,-5.87789549981324,9.02832461999755,5.64875186058826,-3.92103396030346,-19.9757099484824,11.5119662435307,-11.0827962482735,-20.4291824270241,6.13341827723552,16.5062183118915,-11.7302757271135,-0.578599471146989,-5.05305668594502,5.81965401449357,-2.67231847003062,-14.2825822772759,7.10698253044451,-17.8438621769918,0.247612054058772,-10.8695012639889,7.84571768660693,15.0760936521291,-20.9896925695329,11.8489908805816,-20.9762946461049,11.3572062431146,6.91518816788796,13.7032299605268,-17.5751442795026,-3.33281966814274,11.3488702383265,-12.1253005943129,-1.03986794129841,19.2839456431107,17.6928660283789,-14.1593242890703,-2.29093196191276,-2.93440806063435,-11.9658361061073,6.50239323778827,18.9046768716738,-0.105132073970499,18.7564823711172,13.9330544270098,-18.1707284336896,-14.8785073119708,17.987779310703,-2.69247151637152,-8.41990274471359,17.7478670478794,-0.72170821221358,-17.9125342962248,17.3930206723904,0.839712519444847,12.1770556828123,-14.5088592050095,-9.41808655186277,15.7704811143105,17.0577410238385,-4.31006002406029,11.3179990400539,15.0064872579722,-7.00072914645733,11.8694209390078,-19.9074083254161,-2.14150761576518,0.671524174425753,-5.62430408468967,15.8281324761621,-2.54609926546576,8.23792530574266,-18.9987209218952,17.559650939614,0.0391167638735266,-17.0451463956825,-18.7873616696664,7.17743331285697,18.7830821145138,-16.5348266863965,21.1871887619488,-1.37783388861623,4.39999947594913,-1.06905161418157,0.00537903355749417,9.83466669189674,19.7337454827457,8.78045774583373,-19.7092401521396,16.9509332803418,-14.767790923637,15.2192815999903,-16.116060876017,7.55614040969096,-17.5291587337506,13.5453902298381,15.4296801221977,4.55327606829284,17.1853626664548,-10.2110878965165,-1.1557859858247,-11.1687145813132,16.8557798760247,-1.1893675458757,-18.3156070345885,6.46004018607397,6.57408912951245,-8.63285797086896,16.6770500324721,-15.3413750858785,16.3645765587824,5.54272545528201,-17.1014383596195,20.5682045889648,8.00790936893595,3.50373413625571,6.67187709635809,5.15603422399348,-18.9273024416562,11.8649366522599,5.83506239276883,-16.2228319227006,-9.46712003146065,-20.175934174087,4.8708977670112,-13.3430000735059,-16.6237041717262,0.510803400526167,19.8292226059539,7.4804232904945,-21.9601089146488,-16.4192070967549,0.715291138696762,-9.26215837807002,-16.9938542258804,-17.1268705713455,15.6054871165768,-14.4620055879497,-0.986028339001036,10.0658485168423,-3.30425427896296,-3.80908961717448,-0.577962518282289,18.6995134848471,-16.113056527219,13.8014950290531,-13.6759044528117,-20.4561685707944,3.9512791602266,5.41351864330652,-3.47403412902778,13.2022293470373,-2.60907998598067,15.8630352320114,-17.6657982103591,3.06069548794654,-20.1797265139826],"type":"scatter","mode":"markers","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<pre><code>## No scatter mode specifed:
##   Setting the mode to markers
##   Read more about this attribute -&gt; https://plot.ly/r/reference/#scatter-mode</code></pre>
<div id="htmlwidget-678ea4eaf6ac0e87eab0" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-678ea4eaf6ac0e87eab0">{"x":{"visdat":{"27c830a55f7":["function () ","plotlyVisDat"]},"cur_data":"27c830a55f7","attrs":{"27c830a55f7":{"x":{},"y":{},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"X1"},"yaxis":{"domain":[0,1],"automargin":true,"title":"X2"},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[-0.64700797896146,10.9829194193465,-0.683169312033188,0.121598337692018,2.38673232083063,-11.2077529755415,1.95983387495633,1.355658058858,2.28442859883303,3.16351677858245,11.2807423417454,5.52011162055027,11.4783367949828,-1.09254313923237,7.81987178814859,11.3704066013725,8.49868714453964,6.75622092439215,-2.17811482875469,6.44083015176533,4.58506236787563,4.36284980705886,3.40514142870881,10.8994791252426,3.34521572800305,-0.264389549753781,-2.34287276102339,-8.59900198432096,10.9314522568183,11.000742604909,4.09323862442843,0.00106162044567765,-1.15749993922686,6.62847044191489,4.13166737628574,2.84976094903702,4.83917615535764,12.187307821636,11.8086040828073,6.55723374404436,7.0424681444496,7.65009438485869,5.30907608211705,10.3024174940888,12.2124896762216,6.40845826135662,10.6968203170107,10.9361793741712,4.75953339124891,6.57113355494872,10.058247357314,10.9208742224803,4.71517557420859,6.78400552552356,11.6657448844689,3.85762682711509,0.494066188198416,6.5801785461178,-0.688165968947004,11.2278961065549,11.0142674390149,-2.10098875565224,0.425374376100636,11.1926430953936,-1.102078458571,-1.45661849552363,3.92410129409312,2.07568337915508,9.29157384710789,-1.91146276115677,10.7020156677305,0.812936146985994,3.24280819380646,11.6066917033058,2.36136333003448,6.83611484977029,4.67244286208184,4.0697905092024,-1.43511258056262,11.1920356560971,2.32879903511123,-15.3017457132328,4.58491410596088,-1.37408953470131,4.58295220662718,-0.105397174020197,0.486357037986709,1.03991644902279,7.70220668792144,9.11570175777651,-0.0934993254164325,-0.785458781544937,1.39113719941521,5.11656436238653,10.8440180659292,7.37021089235498,1.94484055193084,0.48410980485091,2.72718712194514,4.18832517656818,10.9771942267818,6.92733062346478,8.22544958377789,11.5338033754264,12.1847838412572,-15.2736902813511,11.2687716473871,4.46726215723052,7.58436483303276,10.8374117598183,3.08052478431283,7.08924980892202,3.28560379927315,9.29156576981388,11.7863449304956,11.0706423843404,-1.71095371214338,10.2917018827769,10.3161270180132,9.25038427002594,5.30844999186754,9.56295717864335,4.45190660277448,-1.48481746792535,-2.74809653318622,4.37324345918158,11.1944363981471],"y":[-15.9673377599113,8.48695469183638,-13.0574160987575,-18.4203719385579,-19.803975252085,-4.92644528565067,-13.4694097102671,-12.5317104441329,-16.1928973513659,-17.7188971162668,-17.3027700684193,-18.3370279971478,-16.8881379685924,-13.0262221327575,6.63700726756897,-17.3789860517129,5.91677917150417,-9.05011487704128,-12.8488573059695,-7.00944800627085,-17.316741005132,-19.1028167013768,-18.8549436183589,-16.8913154882993,-20.9232278108037,-16.4891007910443,-11.4932606569854,-4.41454406033073,-17.242088178452,-16.7604708621207,-11.6127127205241,-17.4979397322253,-16.2086696675427,-9.03417421354525,-19.9869450071342,-14.4668476657397,-19.1289619938819,-17.3401808479988,-17.683520614018,-12.910607967393,-9.46695192809555,6.53313772857693,-11.8762651921903,7.69904059068943,-17.0456362432215,-17.2702472951602,-16.0661283779956,-15.7201539039815,-18.3570873952702,-9.53824479915129,7.68908871112614,-17.0672303327482,-13.1113079713175,-9.21927654693501,-17.0460962517196,-19.2567620295311,-16.6507969656835,-19.4690256282487,-16.2719502000009,-18.0745780166978,-15.9549500573829,-16.9034282195424,-18.9372776792985,11.8499872722199,-15.0255909763955,-14.6205747758983,-20.0029949159605,-18.2861464708817,-1.78372279938135,-16.2877508943129,-17.73814012697,-20.09545798639,-18.9591752914419,-17.6651736210257,-14.6443703013033,-9.51722570815222,16.4318376558537,-16.1134538800913,-15.6098793958951,-16.6772641362291,-17.7450575961841,1.22949770587053,-18.9741262950951,-14.3683485880362,-18.8756870182492,-17.0350385879842,-12.9542861529085,-17.1106969499494,-17.8729513506339,-2.09639029852204,-12.4440204571499,-14.7496723691055,-12.1066821531919,-13.1375062122689,-17.4298983777903,7.35768775205052,-18.9156175913494,-12.5964368690418,-19.5328497348615,-21.3542540641275,-17.1938085156693,-9.6329623717877,9.43974543889997,-17.9287331070032,-17.2201516170362,-4.84176821865319,-16.7953189616291,-11.0827962482735,6.13341827723552,-17.5751442795026,-18.1707284336896,-17.9125342962248,-19.9074083254161,-2.14150761576518,-18.7873616696664,-16.5348266863965,-14.767790923637,-17.5291587337506,8.00790936893595,-16.2228319227006,-20.175934174087,7.4804232904945,-14.4620055879497,-16.113056527219,-13.6759044528117,13.2022293470373,-17.6657982103591],"type":"scatter","mode":"markers","name":"Effector Memory T Cell","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"line":{"color":"rgba(102,194,165,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[9.05700339075373,1.31582770457569,7.71129866826428,9.64284253210722,-2.93054633868947,8.01488449123776,1.73017234445989,8.8512205635191,-10.6085782363227,3.00191378192751,10.2663589499106,9.60754861635615,6.36554730667016,2.78085260040477,1.60518134357344,7.08497284512453,-9.93701471824346,-3.73724777055028,-10.9464800679939,5.83027605241538,9.74802910763305,7.23375632097735,10.3147756943685,2.63537008716921,9.87969503104111,2.9947648967973,0.851096695143485,2.95982330040759,5.5357724584898,-4.36001595253798,-4.5995400684101,10.0048414242583,10.2834341290521,6.64017497081236],"y":[9.42016369662749,16.2598662505788,6.16073009561685,-2.40995216662941,17.0802490611973,6.0884210026157,13.0324851488086,9.63182608415293,-1.28370244684747,8.71977138971156,-16.2026383984467,5.62077466672877,6.37329153855569,-16.3254510507658,16.1117903310734,13.2111800958681,-5.28165490662122,15.5273491786175,0.307001981217754,6.30616274348156,-2.41001757364162,6.83076770789913,7.79857006571157,-20.8580407225331,6.24823848686261,-18.9733055199059,-18.084864146926,-20.2878324195875,9.38916201681057,9.53774164368478,9.02122351543075,11.8694209390078,8.23792530574266,6.67187709635809],"type":"scatter","mode":"markers","name":"Effector T Regulatory Cell","marker":{"color":"rgba(252,141,98,1)","line":{"color":"rgba(252,141,98,1)"}},"textfont":{"color":"rgba(252,141,98,1)"},"error_y":{"color":"rgba(252,141,98,1)"},"error_x":{"color":"rgba(252,141,98,1)"},"line":{"color":"rgba(252,141,98,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[9.82891143936811,-3.00196647225079,-16.2636878973757,5.11026001190674,-7.96327259272952,9.8278810873859,8.23099598692419,-14.1328068830468,7.55202175312812,5.58212148331875,-0.968089213823785,-0.691558447469152,4.22047401496733,9.13347093938178,-13.2389163454206,12.7275993677326,-13.385212780602,-11.6767711905462,3.90796220999321,-10.1058977187402,-15.4974877269412,-11.7262439499746,-8.96469744886844,-3.42860593124477,7.33006942842282,-11.7174038942314,3.93814303620079,7.46224187040622,-2.52271126038625,-15.9687795641159,-8.57235426903485,-9.21562151777873,-8.26416314323915,-4.84601253223187,11.3290849681427,1.95401739442417,-12.0106767257361,-6.99277813008846,10.1993777742303,-0.925864772883279,-0.0294976427393101,-1.62499371485408,-3.89113272565772,-3.37191805685573,-6.06683634915917,7.44489014696503,11.8506979167224,-16.1165585028952,7.75200687218933,9.13599607227886,-3.9052052980904,9.42711905621988,-11.5764456740183,-2.30986632161948,-2.80101344559873,-8.47418423574407,3.60594209112652,-12.818035489478,6.12061932001222,-4.93997138252942,-10.0709655747583,-11.3080798752615,-11.7615114398318,-9.6511354498064,7.87559868152668,-1.59995583539679,-12.1076158938546,10.6185783604724,-4.27072367504397,-6.6289221469232,-3.93109620627119,4.37209016342535,7.78196798797721,-11.9993497926742,-5.40163299673636,0.844356426968267,7.25149832125925,-14.549257814265,-2.84591581148156,7.75011498084225,-2.40760105455274,11.8563972429839,-6.89775579946556,-4.43890490045562,-10.4567779527525,4.1944754345686,-12.2686664262743,-17.9774965905025,3.33098043326833,2.25920179307337,-11.6729610313437,9.81837505506589,-4.51042888834907,-14.460521305944,9.719407141031,1.16614902939685,-2.20399706923565,-9.74109013296507,2.51685241926093,-5.74660583936413,6.03341468458895,-1.48333881074084,5.14639604945107,-12.0479781225904,9.44862150446,-3.02307650368023,9.51015296043139,1.76512017529795,-2.0101180061106,3.11848686773141,-5.17226368049842,3.4528729681505,-11.2053652896679,-3.17230186705166,5.23743507166201,-10.557885415587,5.36297744476268,-2.52871812581956,2.20963427724461,0.312493109546483,6.59956451840895,7.46740832723688,1.91010262260896,-1.98629965354965,-12.9475085909362,-0.787555785873725,6.73115074510438,-2.27636621399645,2.97792546441982,0.960353809208676,8.1304638915541,8.4836950741601,-10.7166417232331,9.60213585682176,4.05664331570355,-12.7630804328154,-0.679192258286923,11.6507763440007,-1.16253798832006,4.43155910718925,-16.6155095179111,7.21174356368151,-2.08320304186372,-12.9901107730417,-3.2495720438173,6.69384435463233,-5.06207605418766,0.749349394627608,-4.04566337259661,-0.809704681726989,-9.59505729460747,10.4501732061606,-16.305104514804,-11.6444120095217,8.81181963063932,-1.77739152145807,-12.6968328803359,-10.7049809306755,-12.4882943828428,10.2884510063357,0.371997644469344,-15.1391489673992,8.81894416698965,-1.46010378954201,-10.1755845010003,-1.35850404432497,-5.14819950373142,-8.41251184644206,3.4914738601816,-9.9394576287063,3.64380835425618,-4.07982903761715,3.19201618620682,-13.0337361922979,7.70603774293683,-0.533564774166623,5.50025867192459,-15.5505999207836,-17.3404843193353,-1.28459518800085,-5.08459841534678,-0.889907541794594,2.89131505992518,9.83111307936576,-13.3934892257984,-8.18246290564943,1.05871145735768,-6.83681856140259,8.72685719935613,6.6019429208772,-3.93993006200646,-7.33109921881688,-13.8246756280819,-4.89727184809966,-16.8383949538528,10.7346360732132,5.18740054083238,4.78186902636418,-10.7771865434061,9.26369926671915,-11.1981176072996,-2.2351493628046,1.54855336118919,4.2102841265481,5.14763157067476,4.89652319571709,7.09691582977028,-7.0005755478137,2.92429166154218,5.75355179555096,-1.94018351402956,9.94334428389341,9.91861370883366,6.4350254255442,-8.31775825570102,-1.10999772469839,6.80639392821921,4.72908710375811,2.39648035112287,-6.47837473384119,8.11723377952883,9.01185872985275,-3.47195785338812,1.42258535179755,-12.8995307978385,12.928799632771,-3.85517979721668,-2.64739120566826,-3.15581452052875,-10.9004231645292,6.84044166266121,-8.60348685857969,1.89243982929869,1.16177013190608,5.16078907281793,-3.34341606459096,7.67993241909487,-11.5993243747319,7.70232886715235,7.21905228203758,-10.8316024258295,1.98342671662567,-5.24395941561369,1.42276917088958,-3.46942869890395,-0.160396590088969,-0.52973552678463,5.67038227928319,7.11647437555116,-13.447417763681,-7.67537730573923,-10.2679583593352,-1.94807156536674,-13.9876122953144,-14.8087686026045,-1.95394043338005,-5.77755944378688,9.64487625869794,-15.0491119991027,-3.23870455928025,7.01981910268452,-15.5246449826532,6.2136957990831,-8.88722627972841,-4.25695055555794,-14.8940624230048,5.04888619943999,9.00091945343663,-0.419742225070688,-9.25907816321094,-0.0389637447942507,-1.35395065230248,9.20105750422091,7.46927957871424,-3.31507008261641,0.572508261887164,2.23124919368925,6.03360917359753,11.2146005924885,-4.66441568165984,-15.2736422733279,-9.15377752041512,5.12904382335145,4.0882266665905,0.461831314799731,3.97482665515735,10.8519664180908,12.3010948523928,-1.50861297602589,9.40180723432858,-10.1267842781459,-14.3254330087046,-11.4493864145288,1.12529842400453,7.52782449746136,8.51973455277696,3.75371496161553,3.28753576627298,3.23157223048133,2.96246901198722,6.80137599040706,7.78501145263659,-12.6570833769504,-3.1063261082921,-11.4411946732459,-12.9362281851671,-12.3555114540239,-0.28333411748761,0.755350387541639,-3.9649969760844,3.76756782740247,6.77036626743522,-11.8324950698558,-8.37539909528126,0.679085042846249,-14.9601217324881,-5.1818116282347,-0.0942536726845936,3.56548195374302,-12.2926679294128,-6.12910432435701,-9.918482383013,7.09903538302189,2.16008718644457,-8.10410403638876,-16.7532427217557,4.41264354137519,6.36600922795468,3.39611828225795,-11.7250008361746,-9.05975337407891,5.0792954776135,-8.26470094678932,-12.3290026309716,-12.3810163075483,-2.37752360481419,-4.45136544309075,8.14355923049767,-10.189806344882,8.35094830303059,9.26690983712412,9.70043224865771,3.83264269064231,-13.6943386504416,5.63531880052481,8.0839711172369,-9.38215899273452,10.7606295555205,10.466995043177,-12.4160028951189,-1.00825621425155,6.55730973409536,11.8634528474964,-7.16235345508303,-9.87857700705185,-11.8643616669115,-0.0655645728983408,3.95909449379202,-6.66110477582011,3.6124314740147,6.06000611014882,-6.26920877808011,8.70414236241388,-12.3708513107692,-3.07606905859856,-11.0075685844169,4.0836704198752,-12.1123681950746,-3.88244070834873,-10.3426964760793,-15.8829612504354,2.54520334250744,4.67677432635109,-3.56405154453272,0.565117438569289,11.9748153156141,-10.6201297025315,-11.5121392495465,9.56972139586113,9.38493519816435,0.0498449281812405,1.98049346977713,3.33354445117847,4.49402228006215,-7.96186224336824,-12.6564613966401,-11.2428640140026,10.71085448709,5.309910826302,-4.1912008612685,-6.00060207984623,11.2320287050076,11.4479800255823,7.90371451438669,1.07785797462281,2.50537639501785,0.72359120657806,-14.4541637533114,1.39585806479195,7.00338781258431,2.50753719573538,4.84587729618694,-3.73320579678222,6.97267260261632,-1.55629665582251,-3.37079325635419,7.27811566716854,-13.6135104878247,-3.4482749963,-2.01995382347535,-2.14611337848434,-4.09072615262254,-6.15456234787786,11.6116225418866,3.56318558404695,-0.327441989918096,-3.3290997782366,3.08861359082291,0.20021924189669,-3.55698669208339,2.0445313741246,4.85878957851101,-10.7368285093069,6.54247510900478,10.3738336790499,0.916300211224866,4.45474755223373,-11.0742695809191,9.6909220236751,-5.14179262305946,-9.13925256040715,2.70019371264956,-13.8722650225966,-3.06348763310777,-2.27084700771599,-0.00480882368855796,2.95134655502424,8.89090405719254,-14.8214364838395,-7.21582354574512,-1.18710806271312,-4.64800975333439,-14.4103146911509,9.18076126642862,-2.38016115252994,-0.446759142144465,-9.55133364613346,-0.0984271813938266,3.19063506532798,-14.3846558359694,3.11361846883912,-9.59222540963671,-14.6879580193745,5.14681015456595,2.85735569271041,-6.7935056372843,-2.40100686752974,3.99181744517366,7.20908365649441,9.65398552292046,0.335664680685584,-12.3288088475584,-13.1940751569452,8.92004905480146,-15.9497816728839,-10.1828289522161,4.89453888547524,-13.4531697559213,-9.80858728741571,8.44650653952169,-2.81820794831571,8.12187068293113,-11.5662906299865,4.7455467329387,7.86012121985834,10.2731104021915,-11.6384853997638,-3.61926738524991,8.75423568781965,8.73415503739917,1.77214723493637,-13.0747956341718,0.0970966036085597,-5.28553097863298,8.72958344929029,5.01480765578096,7.13305932617364,-6.90367885550704,-1.90166662639275,-0.0785130993241402,-2.51546247466487,-11.3664861845708,1.84139901284619,-3.25399720559288,-4.82246099656796,4.26384066272578,3.59839926693447,7.59098262208168,3.22524360992331,10.6337403406005,3.46964466644503,8.20869534662265,-1.85838165159572,-0.471454226324056,-3.56385103464068,-15.6470803289408,5.04855201904907,6.79406144720244,-3.43959168860988,-6.96098368540143,7.04638677988106,-8.36890024646393,-9.94027992213227,-10.0738783419843,10.9618017977764,-11.5686983386592,10.2245565289438,-0.041511442884092,0.0171818410957833,-1.4877167314915,-17.4798777156874,2.5099724083714,0.223102107868022,7.67234711509862,-3.830453305316,-15.0906908203436,-11.0437018224022,8.85760497580631,-13.793000506398,-5.42770628760829,7.58952885387356,-3.68547193382706,-15.5563004823308,-11.221441402074,-7.03066717707251,-0.423337520241322,8.841301385236,-6.90208983428567,-11.3195604595538,7.06830473483865,-10.3539460145979,-11.4771218969258,11.2932943684557,-1.35557713695463,-4.18602739352296,-10.0751465490147,1.8788847399775,-4.10020933548653,8.26116887242672,1.87384805832659,-11.6643611778711,7.49096581669704,6.89886624881443,-14.0038814165246,-3.07178865739004,-7.53119984941236,-9.23371108437883,0.129995946427896,-11.5931867703794,2.48109859300615,0.72066770057411,-4.00261296836749,0.0565345794784102,-4.98689691880957,-1.0440663695784,1.06092720810148,-4.32537949856768,5.3075877512733,-11.4554704790414,7.87989838024182,-13.4777994123988,11.2946535504296,4.41543754996927,-3.48331152847722,-1.48866093092278,-1.3940242218004,11.2775353622639,3.33562273664726,6.30098588723641,8.70658523087676,-13.2705672696049,0.766327923268357,7.55707215819368,5.19587118321291,2.31800317440879,-1.29638517874767,-1.1266492514967,-11.4429159185132,1.06045938930989,-10.5373687527947,-12.4923984070613,11.8117442771488,-0.949649808405418,-3.14918213595859,7.47680074253922,9.47983136223432,-3.51315127892931,-4.61340504968856,-9.42293560363734,3.77537212102496,-10.2695216542302,11.1821224324796,9.62687118450968,-1.17121668558615,-3.93403756478549,-5.06708348145476,-9.80520498638217,6.74911722868136,7.15162221475909,7.27480994335103,10.5147485288601,-12.6425818934727,6.74280671691854,0.831822765126827,8.08729861824141,-3.69389188826327,-12.6707253821162,-16.2972092291776,3.77439236409139,2.7236908730811,10.3593393560673,-12.3229140351064,-12.8855862343476,7.19395444800778,-9.37433759057026,-2.61246268326568,-4.32203717191813,-7.49633456691126,-0.339933868028644,1.18671238330189,-3.8372384469258,-2.16840907514794,-8.78464730418214,10.646569505448,6.23702262641971,-2.46278095277826,-3.32608342500181,-11.9994339708017,4.78595728883319,10.1004626161565,-14.0854228157649,7.11563097701212,-3.35268081168093,11.2651997047495,-5.11895583150842,-10.9498110847956,-6.78685441429928,-13.9667144729033,3.19715576239278,7.66434786434726,-14.0155111023421,-6.23364047608626,-10.5932224233214,-13.2109844382228,7.7868944659012,-10.8365314353441,7.57081927345916,10.72335241332,-3.7232025873966,2.65036000281584,3.05988412708265,-3.41732955929093,9.62208983522594,2.4041545341629,-2.82137499922696,10.8093579261054,-6.06474366432108,7.62195715175079,7.59637948642491,6.1109066943915,-16.4797181727674,-7.01528517137479,-2.15360715931152,-11.7738516352146,-8.83953071922091,3.86737733893302,-1.20069981809382,-2.715492437111,-8.21232322755488,2.13932134820078,-8.76068582757213,2.17047392431433,10.4171908216825,5.40644041323777,10.2313878323923,-1.37376226948617,0.672197857752152,-12.5284917213217,-9.72213533062268,-15.0534595981337,-2.79203323676675,-0.795172957832658,6.22536395110988,-13.622218871723,-10.7960227323767,-10.1821594286835,0.130571295687463,1.21353874847712,4.65471198806589,-17.4813038107817,-8.03636110772787,7.00714741638335,2.61557346020311,-6.49582629789168,9.98447415557156,-12.4319361717574,4.98994819641734,-10.2922069562845,4.15105991583381,-6.13060666993313,9.7459362422876,-1.50030216202154,10.112396741618,-6.60131977511768,0.152023997005444,-8.0878030317311,-14.5141855649691,9.3041642813024,-9.61653552327437,-15.4088469327069,-1.46647589381195,-6.10026229643796,-10.7228584739178,3.35477992160217,-8.64448573233908,0.810216909208728,-8.18835435137973,1.47545522992215,8.17655875575261,6.94351802584242,4.99121655893888,-12.2001833095526,8.23983376841392,5.08508410049415,-0.19144892564878,-2.15080996698666,3.05305762261268,3.27855265597793,2.8255953921857,-0.199305439454856,3.07838114462375,-7.95372136419564,4.48744260557881,-3.00441739893663,-2.08236999039003,-7.41668049262339,4.10275902944458,-3.6697836394086,11.9901917760387,6.56274637827125,6.90033151976202,9.83015451386409,-9.68079557349856,7.4701131100295,-11.8108389200304,-14.8622937010971,-11.0635992246399,8.07968803706528,-13.5747680802732,3.20612307421428,9.64472845844451,-3.35022835109835,9.32532694051381,-1.58215914467997,6.81347418097091,1.06436527474142,3.17120508230376,-3.66711732098798,-2.98244750703895,-11.0645368570523,-9.40135268997227,5.55212476112239,-6.16560493452022,3.81873019124052,-1.27030861456813,-11.1959796197472,2.96144423219601,5.20116990332279,-5.22434283445764,6.83515194188371,-11.6664765045506,-1.78128658383716,6.27810516453127,5.6509142931066,2.78277732669555,7.70356117259486,-14.1027219497052,6.58500357982688,9.65950771855894,-14.5457196925591,-13.4435243927939,6.52260281146573,6.90576457774171,6.23752392817671,6.86910783375688,-14.4532693433643,7.42649178348599,-7.20622652350954,-0.550317965567239,-0.611697750365122,-8.13406693871669,1.325187784636,-9.54157969318261,-7.09189932007124,-1.23712731787688,9.18406881853282,-14.0227312612812,9.31155063438081,-13.0109435734237,6.5098992248851,-16.6779390834791,-7.16494029513774,-5.08923495179521,1.5963118888362,-8.97359580462543,-3.60962659757962,-0.61744387483345,-2.85701156634217,2.56357794696911,2.98747824076449,-12.896102287132,-13.9258736873381,2.98671548638628,8.49153238398527,7.08553815402189,-15.9867652858164,-13.6709538394743,-3.65088878315723,3.11953849342822,-13.1839496917453,8.75766847081078,-3.88420442655663,9.64350275686616,-3.59943552623882,7.89382320624922,-14.9878224817506,-3.95301432540554,7.02835741300142,-9.12678758665595,6.21723769253142,4.08111628731198,10.9990127174105,2.01010014786725,-0.878415037347965,10.3845028865434,3.40155729752614,-12.1418086386029,-1.71673740896422,-2.65388907888998,10.4333713655889,10.1158335067172,3.20112670404568,-1.01033115770864,-3.1756773065346,4.22578116202339,-4.40176738214793,9.12595870466929,7.96244806136765,-12.4770167606737,2.87518122474179,-4.23078435556712,-12.5771694231855,8.37341467262872,5.75138764679351,0.660279006477143,7.3323395626482,6.06139339432244,4.13183137810494,2.19975638204812,-10.5504892958463,-2.82072296151232,-14.1858394386605,9.2789493402567,-16.5799941812136,-8.90464766502288,9.21875256640506,9.20421894411271,2.10932795320815,-3.9976735942059,2.10512781362829,9.33830611652755,2.50730663695904,4.58318311997114,6.80932128478773,3.92607583300854,-1.23540773182524,-7.51064271365029,10.5357372122005,-5.5218875911005,0.00976673020773924,-9.89805005605661,-2.23483889784124,-0.832349705887485,7.88706968943287,0.96543954928539,4.97476417641664,0.244998614532728,-9.10127472597457,4.28473610982041,5.22274727155551,-13.0070939544239,-11.8493001484245,1.42854381602167,-12.7399866144193,7.07007002175112,1.24385949720144,-13.4335350527399,7.35756042659514,-12.1372952236963,-14.2731920527005,-8.58410173741731,-7.35729850580197,-14.2132663520284,7.77145318355852,-2.01806303375981,2.11165533581418,3.0771901181428,-8.90779277253557,-16.9509982281864,-3.55023891533676,-14.0097814184945,7.32963773682705,9.118271566155,10.3223779667283,11.9914218289086,-7.40357547883626,-3.21503236779638,-4.90486210994078,-13.6901823001047,1.40596362647126,6.42591343768377,1.98140451255794,-0.259143915494176,1.22751045600258,-12.5335842699494,-10.1679865991152,5.11157833173426,9.92632957743197,-9.70017982570916,3.22030478152524,6.43676328908583,-0.739480456406954,-0.976495840637493,-0.568353632806302,10.2018934153319,-4.22612674752566,-7.44511756534601,5.5549194184107,0.601330692589122,-0.620886096735016,7.99427464095841,-3.93334559288339,-10.8504684645923,2.84081317661909,6.83395463308155,-3.78073461754307,3.78409018387511,-1.30541425020812,-12.3357203394803,6.38971578616204,9.65684994542042,-2.75438339932516,-14.4803163665767,-2.15501430053395,0.465994702172914,3.2285167988725,4.8884276486059,-2.29902687961026,9.16434995883591,9.40110109511421,1.1837201930044,10.4419501548189,-14.8429672895073,-0.564433723719789,-2.05830651686259,-4.35391670968321,11.414165116044,8.5939396898019,-3.7853091020217,-8.46395013637652,-8.06935307815328,8.8385487744995,3.84313804530459,-3.05304359390583,7.08273347127422,8.40531559988768,3.97870544551576,-16.4670822395134,-7.07753069567801,-14.2384247196042,-0.126657088594808,-5.28809161792464,-12.5874350120199,-10.5913232687267,-2.32011198439004,-10.4884599256429,-4.00501773898503,-1.66675170750261,-1.44492856125172,6.59171897248965,-13.7807630629173,-3.34071056786941,-9.92595191234454,-0.871271531215126,4.84447210190695,-7.1683656823241,0.220125787243174,4.18600892926953,-3.66702122765043,-5.8709026100168,-9.61498001990717,-11.1673490949517,-7.50753628267548,-4.18769204949873,-10.2328153946908,-1.29671711423883,9.25233922256825,11.6739934569865,0.0996158734085468,3.96691514485562,-9.12681537118177,-2.81762341296063,-7.24269479141646,-12.8997467944318,1.26425093913796,-11.9080891106839,-9.60075867733841,4.57872269421269,10.100918332724,2.93114678782632,0.971223867035387,2.88436550294712,-12.8614336085156,-8.12749823276476,-13.75374088855,-12.3035540169631,2.32327514643619,7.46189835034588,4.33386843396052,-9.17945031266364,-5.55991360900063,-4.39404665637217,7.36862763331266,4.21658567315317,8.8030100448261,5.54592921961176,11.4502358224436,-4.94818308226012,10.8379170747792,-7.90282113886091,8.68292250505573,-2.51049372240199,-10.2590582809269,0.414952157253194,5.13842097257281,7.88167915832968,9.33209008128285,9.77688304066469,-3.09939171531768,6.96408772603081,4.3295620612701,-15.332191387827,3.46344178929219,2.33018685450472,4.29597182025093,-1.47876778696363,-13.0381138315334,-3.12570613346694,-2.73059870786524,-8.63795891628221,1.69157077101361,-12.1278478231357,8.80881877372487,4.53269780406071,-2.5785420050338,-3.02785550085931,9.03179903908925,-8.30283467289226,-3.84538757753671,10.4030243228389,-10.8869128348097,-11.0365835810929,-9.80976296813444,0.672843607644832,-11.1581879938641,3.52455081731651,1.24233166113872,-12.5760171546041,10.5665549718346,10.1568243344168,-2.36676340444677,0.86883969650285,-11.6771019361012,-5.67916944004976,-13.114908550882,-16.7699164496718,-4.26972676319082,3.46789248006443,-3.71584694999347,6.49582498715062,8.51423657394286,10.5617539414593,11.7707552627807,-4.52441167404108,5.25270585839545,0.789519676614693,-6.46361634924249,-0.561773394102143,7.10202796386736,-15.165033503964,-3.14938720237319,-3.10205777486574,-12.3142986537011,3.92461712474966,-4.35439725062635,7.27740366109258,-2.66093884507689,-2.69122531011063,1.16265003024978,2.54606165930274,-5.33757755794002,10.4707150312347,5.30053421230119,-10.6125172138372,-8.29851165258077,6.6694061446567,-3.46212287384644,-10.8633090396677,-1.98841667427302,-7.84047504370984,0.934151589473817,-3.3548279262894,-11.8910231717265,4.87870037834936,7.64330829935797,3.29250827097822,-14.3121121453113,-2.45711302943458,-1.46618076547506,4.32191941222138,-2.36503119749703,-16.8222330026763,-1.51368749211814,-9.79123124114864,-9.51879561798784,-13.9987247818322,1.27830781675901,2.48925240981731,5.01034774217534,-8.3226926630704,9.65498894519923,-12.4866849083789,10.3136304346567,-4.30743442868922,-11.2332928482887,6.94753258461691],"y":[5.66975964902548,-8.77818950821644,-2.13961178993674,-19.6984183705609,-0.196920975539678,-2.42580987010058,-19.2343069267998,-2.99109571081673,9.52752074000473,17.1364426797165,-15.6402161539033,9.78267413804593,9.43263556966627,5.06757808058878,-4.47926752294106,-17.3691746558434,3.99760455244532,1.4151029400085,8.89224469808186,-2.83992481423707,-0.492336956733319,3.28290991087231,3.85990793553297,-8.90705092873849,-17.7902663841582,1.74661216774987,-19.6411813602325,19.3742870135737,18.9811333759661,0.765645695938311,-4.73163549436878,-0.855021596928189,-2.48653374675299,-12.6792841846805,-17.4875155763953,17.1627125138593,-2.16264078943451,2.15754423793356,-2.80383147240977,-10.7142090887233,17.9389565154667,18.8395192760639,13.7658831814431,-11.1422906848907,7.91357465907774,5.02020416822446,12.3781104233532,1.20421776039783,7.84583189043147,6.3837089411763,13.8932999344707,-2.35928201920734,0.927266973523188,19.5254608802006,-13.198523180346,3.12796600297153,-20.5434998098939,3.52704695759401,10.3820067840877,-9.02868546572871,1.67331190700338,-0.228720331597061,-1.39100558198826,-0.122412142921674,16.5671611812012,-14.4204757055845,1.81665722687687,-16.8537163561203,-11.9264435258769,2.68955297255271,-13.817486831441,7.87312132250302,8.78501077174469,-2.41065861023483,7.74209477699574,-17.875029477808,-20.3382525365537,-0.156889809164829,-8.66988290236121,7.20077879554241,-16.5236246366409,-17.5383460930866,5.4825751966243,-13.2242586383442,2.04709014195926,-14.1287282778212,3.18596852675273,-0.0870944565277938,-21.4542252074024,21.0191128581882,1.60385474551617,-16.964333485658,7.53925839322867,0.806244469881588,-2.8033779330827,-17.3861728309692,17.494924040051,-4.02931917499083,20.413866737375,6.68150994018296,-10.4460495406797,20.1855077863121,15.3628640532909,5.70775721881636,12.6828090398904,15.4353103914631,11.0990568738171,17.0636916704775,-10.3337881049011,11.8316255098366,-6.68512894750448,9.20532089676397,1.18244122540038,15.3853592458602,-20.5062040646386,-3.85040652471447,17.5423193218868,17.8169330823617,15.8112019462963,21.3387802744448,15.8797497722738,5.41224439717998,20.6249474983657,-8.98080173055824,-0.903288417948641,19.6846563527395,19.7363430603188,-9.34848351542492,19.2118956522669,19.8645388208863,-17.7399069662793,13.7281148329862,-2.73031759082039,-2.81041070006992,8.1957884771828,1.03636643502591,-12.2927630262754,12.4362631504786,-14.4579071556128,17.900888083007,-3.98292286863356,19.4754664953722,-14.5664465530997,2.31148961428687,16.6299468011584,6.27441369187808,8.01395323549763,-12.6676261670212,8.19553323534016,-8.3074271563913,3.84597510272244,11.6956907659842,-2.76544888628933,2.29912225727876,15.5046538207351,17.1014019053288,-2.00312377145404,4.92284235823714,-0.695932334115392,7.76873083402207,9.75931456833239,0.953908160832141,18.0787377677213,-12.1647309934251,-2.42537512431964,-8.10786758225995,9.38031138299535,5.42039734168583,18.89016137245,3.75812702143235,18.1215022624889,-12.4198631850512,-9.68705242633241,-0.462287420125959,16.5428625688585,17.2963388559552,19.5845643045607,1.99839679438684,1.05203043609798,-9.44022344452382,-12.5098966893475,19.9883653260893,-11.4668381940495,-2.51920279720007,-1.94362589422666,1.30041141159447,15.4712630727988,-7.97105542424684,9.0885550700181,-16.0708143259203,13.651996886796,4.11706185657858,1.21517331414382,10.8910790040793,-2.59064794134656,11.5909231940057,17.6927126224925,19.7962819482183,1.31752426671125,-2.6266716631909,-2.9914589958855,-15.4066676597385,21.2287038403327,9.17465382615656,6.0829249596365,-21.4100486909801,15.8998983618823,0.121534486468602,16.6542024316003,-18.7837797889461,18.2713082869209,15.7583643487246,-2.47482895690965,15.6281478652042,-4.89756518440682,-13.0722727188178,-9.24452462160515,-18.549461938582,14.5802721093655,4.04565429687868,7.79383009582645,5.46632268170458,-12.5048047973784,-20.5155466098898,1.54284473769175,-17.8643543468521,14.9389946351783,17.8152148860166,15.0874650458087,4.12253813767634,6.79536626466934,-3.16933669862998,19.2736094883604,-21.2466435802668,7.69934125545749,15.1299277220383,6.46163062266483,-0.515585277589916,7.22444121228801,15.6311472667667,1.57422509992914,15.5932848851086,7.82841272501197,20.4393105600063,14.7704126306148,10.0610786618068,-10.0934141484493,-19.3735458271777,13.3824888085295,-3.91201560727871,-6.17802969035687,-3.0782854722129,18.5672730871287,-0.213116993316094,-3.92745993225775,-12.1339659087895,6.24338226102606,-2.81738502775102,-2.08228378769089,17.8136610420233,13.3151896067032,-2.6487991668168,18.2526662464085,-3.2693215964209,8.72366486429651,2.70168099469592,13.2827947914069,16.572979953092,-14.3405385514874,2.70772730819146,-13.3323497518113,16.4590349549654,-2.24230932647231,17.1724444086406,-10.994384941468,-8.60463894901688,8.96317709717228,-19.3901642733629,14.5168847896221,8.69169027305702,-1.53771585385232,-0.984246464803202,13.6827072255216,-17.9832895498747,20.8282787744234,-17.9281699803905,13.8382915891702,13.9770802016478,19.9704223768714,-3.34561909460168,3.34767777678513,4.43979394280692,-5.74764595566222,-14.2799481430226,8.26328633034095,12.8295408942651,-19.869082967735,-9.48802658676562,16.003876005742,16.0020751450403,16.5498827131526,10.3223313012824,0.207876009194289,7.66663009032203,-3.63817244182129,0.528683552321408,4.48202850203215,19.9210461358447,20.389113945851,14.7172745793256,-18.6724228331844,-20.5754501842944,-5.45855740488608,-6.57079439419139,16.2457160493122,-3.53396956780216,-13.2141498278453,10.3884748029506,8.72763756535123,1.38116179980807,3.52742574951163,-2.04680639205122,-14.3704430620874,-14.7898605268285,2.07214115574314,-1.24163081787943,-20.1604873612004,6.41051763781159,-17.3849461031013,0.518411375416865,2.54199777444288,-10.402762631616,3.16938865516432,2.92341685921823,-0.205227723697595,-17.9325411357957,17.5345607378754,9.89385110045275,-0.767757027691558,17.0659670848245,5.05277920748838,11.0046103480639,19.8772905951954,2.4920515631586,7.18944438465895,5.23412624050007,2.71874127630484,12.4916241216863,11.5684429432305,0.422853835792536,18.1503072466146,-7.44621265828443,14.5780235338787,5.58378617164743,1.20760050517734,3.84678867018867,-10.3670858521612,19.6165993844413,5.71517593971534,15.6485901211095,14.8901614364899,-7.82933930400907,14.2692900046865,-3.18561111362506,10.4087048554138,3.77554647180408,15.8170369844064,2.22511779786275,14.6738227638015,-0.901465467116397,-0.651668428603639,14.4059680995789,9.2294033772844,-12.5101697823064,17.4184586800377,-17.426280146391,5.05283338120363,1.67258858208148,-2.2352070495508,-2.49439076976666,-17.9761502107718,16.7376775395646,8.79808686415993,9.58896387521299,0.614259375566449,1.29394408542557,-1.32625445163692,12.4464633902524,16.048594334689,9.55711796359211,-1.24845211538619,14.2485122683077,14.1230741649444,8.83774829576955,15.8414998896177,18.1796254252336,-12.0142657680521,-5.85742795066542,19.8039687681025,14.2356381590713,-12.3597768573599,-19.5095828495316,11.370482328829,16.7097120707782,-10.3481467503858,17.5443569903107,16.7838508213956,-1.27673547941285,16.4034788498926,-9.71142959076393,-8.25137359370254,-14.8338455410491,8.4099998140794,14.9766472579633,-17.9690356760235,16.6089944916805,-15.1259477866307,-18.4553106420749,20.138651478641,15.8731321364437,-18.7289301428151,18.6225119994419,-1.60319356130381,19.0058014396552,12.6696519109037,-19.3353047884268,7.90722260339127,-1.64623142233308,13.3162789105471,-11.5582763606447,-3.05660753524773,8.6383702549955,-3.19176762395208,-11.1129436308296,16.7462900604341,15.2031185312269,13.5354455967921,14.5437388126716,0.360911927572727,-1.38157104266409,18.392931863343,14.5735525859071,-1.01138202350945,5.13578129156389,15.7360762391944,17.267381228412,-3.17754490026488,-9.19494389485269,8.40233366159696,-4.58927213645346,20.8856941629589,6.25946881583429,0.762827368134978,19.6809767643837,18.0899668568342,4.72906544750177,-10.993287349382,-13.9248106263865,6.96041971373793,15.1737701506904,-14.1175660737513,0.891720192916639,0.515578437033615,12.8907920132349,2.40182642167669,-4.26564994701717,13.5109105393715,1.68161762133074,-0.102606395166109,15.7416421600608,17.0735040655409,5.37112495912424,-2.06419947190856,9.50598069363063,7.8591359210575,8.16061450027677,2.5389377327347,10.0588314859113,16.3241975179064,14.1493181368791,8.9689187411779,4.84202946466112,-8.99565672630343,6.64267618933627,11.305339668824,16.8164087320148,10.2335370628633,1.18051060483815,-8.91174989068111,9.279526665975,-14.9626391890019,-3.54743925160024,-15.5825932740027,9.80249637160744,11.536734485222,-18.158195997143,8.65504572529829,14.5665427077952,16.9890147914619,14.7465324701929,9.46403491185392,-18.6675922727859,-8.69350076898722,19.0108274353206,11.2801540572842,-3.04146782020303,7.60749853195372,7.02783548494267,-11.8650018589081,1.10819839262213,13.1853502798213,-0.81137001408533,-0.666704095578504,-1.17910134422225,-16.5468362602718,3.60282661385323,14.2132971369446,-15.3978288470131,19.4702393886969,-10.4696816694967,1.13322845796472,15.0638196519836,15.3837084614033,9.11368801560278,10.9886534986002,3.66309055326045,-1.66960029582586,-2.29142586827462,-3.76804304592304,8.20451639434588,15.2264758981547,16.6244402265399,3.87545633225048,-1.10973349003385,5.39761494610955,17.1692346844561,-1.17549876120324,4.96799123093356,-2.22814040129757,-20.3913156583966,-2.77443811816909,-3.97399573621483,15.4875875599323,19.5626047152569,-7.97550114439175,1.93839121081026,19.4011905787773,14.4293790519012,16.4376369157374,-13.7781594894936,-3.26005927841387,8.35391776239691,16.6080078493928,-2.28365750710105,-15.8687204609801,-3.00515673429595,-2.17465273551824,-13.0225396773461,2.29235424629154,15.8058080252767,19.9674226884741,-12.1839988688698,-17.1261885940117,8.82661517280576,-8.5550739907339,17.296493292508,-11.3559590810084,-20.7727192209101,-0.429788572160804,14.217692337805,-5.19240840581989,13.0449999445833,-18.8321260165657,17.0389882456598,20.4094249330553,15.3371273469079,11.1986964073298,-17.2008678425196,19.0797795082565,10.8855094569571,2.40168209896513,19.9168014105335,17.2553117514865,17.8522171780002,-20.2222723962623,-9.53046464406806,-16.4295558483845,-1.15391471582,9.34542881783022,3.26312313326077,-2.63711089177538,14.5961155339532,-11.8841138816897,-9.90787752099693,15.3221247031161,7.31537632606183,10.2752625177923,-11.9159128882196,0.449192868289589,17.0352734523319,2.90349567418807,14.6684309469985,8.22109747786773,13.8811626967834,13.6188142248342,-11.7549944345284,4.41789300211265,16.1180147701378,14.1288159298647,14.3379385868962,11.4336450879225,-3.81625715860506,-9.12035471944441,8.84925969324289,18.2390604000628,15.1147434875783,3.53066784936364,-2.55730794272695,19.3574124561834,8.69597319814983,15.8969573833719,-4.43751700619594,-3.49781214597606,7.13597358392323,4.17892692005263,-9.83006458092438,-14.236024260158,2.40572730383288,20.0030711636918,16.2443050712752,13.5894964716118,-12.8385728515398,-4.57778255173067,-18.2581302472305,-21.7217644117845,17.3272879784995,18.4834366614735,-4.5668838163869,18.9812725004085,16.5279336265263,3.1536463570625,7.27988690003319,-10.9992408413667,15.1156199886862,6.34218200942106,-1.74759771989044,3.82200928693169,3.32164201229202,-9.6629663018304,15.1507528644543,2.07699543867406,7.17151566870513,2.65972548383651,-2.55222020811325,18.2618196571966,-7.06106249781447,7.36671558412857,11.5612359416949,-12.8941489491538,-16.8951081129048,19.0252425970689,13.3705204996846,-1.97990681578481,-21.4403644740376,-14.5115651918593,-17.1829381801626,5.30579219982831,5.80812981762389,16.2899141269879,20.4593958498046,3.30394972968619,3.72562259841015,-8.33421125611347,0.424972557420911,1.85736699791352,-21.1430359438421,19.333101311897,15.7473602132762,3.29249246741572,17.8121463279215,0.900072044157013,-20.7552528920612,10.5209344628855,-21.5553368657892,14.2816457511048,-10.8321394728403,9.55760865254239,0.729087732189361,1.26883155784994,-0.59765103640581,-8.05603760278139,19.4229032231311,19.6025498787028,2.57474606672288,-4.53930499474173,0.388110576501327,20.6560793611693,-10.4353293429493,7.65317442890324,1.43240249699367,3.27336207931473,14.2276587589568,17.3190151236262,-2.07468389769746,6.60447381677595,2.16800203691403,18.8098324126826,-2.15843873761192,-22.2326126603977,0.174082379051333,-2.96894671984182,19.6535331394537,-2.42572579917431,-3.69369933084895,15.2822632686775,2.19443563309576,-0.00916421248447897,15.0330020505199,-1.71532678013858,-1.7064764118561,-11.6270438601738,-9.26454032177326,-0.480694220675785,8.23138940430177,-1.77228094960533,-19.8024799628438,-2.23457686316135,-12.0589796861826,14.4567313462072,10.1100635264806,18.705083449952,-1.8053801197738,14.1580909399068,12.643752485126,19.9873244032206,-16.9324782556308,10.4545531705857,-17.9187179635911,-17.3454899940387,15.2696328957819,-19.5107780160869,0.0751085382410047,20.8623405564885,-14.621980999277,-13.5699642051154,1.96253890591315,15.8398235424118,-9.10123590695494,-9.73111640168443,8.38491059501091,15.2469748983534,12.1729888611388,-2.19371414743663,5.938134576989,-0.796182141560785,2.69190214953539,-0.161806611707093,19.6900701487769,0.57290472349682,11.8143424471561,-2.7505665508003,-13.3960900834486,15.7170308985772,-13.6680830285086,16.506365408677,6.74678884926463,20.4588207905883,9.87846066161024,9.96469233767841,-2.51598940114582,-0.979431479890049,19.2478578288578,-10.9087608052963,19.3903194869668,-9.63609447203665,2.09166768531411,19.8408129340323,9.69023832779171,7.05596320797161,13.8621824686197,-2.28899041931767,14.9904019068918,-19.3186243401973,9.19114174801527,-20.1638671218294,13.9522958245874,-3.12013199725636,12.9979427134782,-2.55646438981654,1.5771938578123,1.92678821446162,-7.35741387977289,-9.33568939974354,19.6389851756646,18.4335016408565,-2.02843902686987,18.7170765163384,4.34718714154463,-14.565310362859,18.711219812327,6.20476625038319,8.97853137326519,4.48777763912365,-1.75226295272448,17.0472460909636,16.6180218811418,-1.10887933425826,14.5593694794081,-0.352991532538151,17.4120864341467,-0.041668469963273,-0.621690368820052,8.12929424612562,-10.6215285316348,0.353813545611738,16.2256897254895,19.5961743419478,17.6263672434147,14.0128251449006,8.70010978178972,-1.61829291509501,-0.988706838742032,-10.4673041301781,16.6716515651436,13.2365923454686,0.430013306399646,0.27495061153459,13.5491427369848,-9.40492819783824,3.03575397766656,8.1308741111949,17.9385420330635,13.3393570161314,-13.5762293354778,9.89487617730381,-0.153984270042586,-8.96438283106515,16.6675799038749,1.47270080371427,-20.9785748877748,-17.5296719644304,15.2483850673073,19.9798562679143,-9.5237715986463,14.4700228293009,19.9161407097141,0.959397204237898,18.8625751413655,14.7695880933912,5.63845411616412,7.74390247570908,13.2540381426418,15.3659450420157,9.4065629238653,19.7161887993213,11.6769491717758,-1.60534684618136,18.5505570505702,-1.93733020555345,11.8261834124673,14.9931209836848,-1.45495527104816,9.93978974911447,14.9217098534065,-19.7394980397688,7.8549693892823,7.75663425744448,20.9422658748666,20.8019699424477,0.85893574860937,10.3764259158204,-1.78500155199551,15.4485988274013,-3.97561722291679,-1.87500774338994,5.09878374110306,5.2179290157884,-19.1254647914821,7.46864481741188,-11.1960305529515,8.4935616554094,-14.2523828714132,-19.9761762745815,-8.60175717835101,-17.1630731728224,-16.7201291384846,-6.91464845314963,10.9192029630302,8.72416905753062,-9.38851296960255,3.2192728128208,-12.3710648628355,-13.5123755779893,8.19577274135588,-10.1895330746395,18.5368910430836,18.4951535750688,-4.05391199324103,19.4818918813363,-20.0692261361627,0.706705250713441,-0.704858315696957,-18.6350291618185,-5.54863086101619,13.8673574724741,15.0816942906005,1.23253475253951,13.3774146163719,-0.255135073963282,4.08779531461649,0.629557551379091,6.31263917320316,0.375907984189696,17.3177989775091,-9.39244761227013,19.5266656043227,-22.2877749722028,2.9931788056219,2.49161762964059,-12.5111852310286,1.42014864874895,9.02740869929596,14.3018852512707,7.87077030986005,10.9729051559684,5.86241827080051,-13.5215021294372,13.0355403767206,-3.80915641184492,18.0108214051236,18.9157277221578,13.6831366928957,20.7278460559288,-17.2361633156262,1.84826284862035,0.432035640654324,8.59737999131398,-18.1455846950282,2.45760126095541,-15.7674047738025,18.5702610298533,-15.9598464307772,-8.75022627142851,-18.1853231679671,7.88150534900053,-11.576337948329,3.40512300979407,18.5448930772796,-12.4866655906516,-17.0130616029137,8.17315836275974,10.3860841964863,1.9142555341536,-19.4830231764535,18.0886180483037,15.2140264091526,-19.1755068282761,17.9325299986165,2.21423069629377,-14.3491769022764,-2.47638031500891,-9.10398558954643,-5.95706679238743,-10.1744001789963,-15.4702347090409,-10.4323103092065,16.4843193962816,17.6047038748644,13.4644105585632,-2.19592475909374,-18.8947934457866,11.8381243113958,1.7151862558127,-8.67570683478086,-11.534044300752,9.08556760702293,14.9377623573207,18.4683314773426,9.63513491095147,1.31401915324597,-1.271225224239,15.397118521621,16.1527441846277,15.4629089159033,-10.0877367905372,8.15232419539049,8.12238751713012,-0.205833274392683,-4.84138526244564,-2.77894224395762,-13.9448332729583,10.1871378895179,-5.61887869764122,-4.8646317704411,10.0490569905279,-3.78895015051356,-10.4082211497873,16.1497195428697,-17.7882167027861,7.54066807039838,-0.408065406356117,-8.40547288859975,2.64177130706061,-7.97186409424854,13.359357562061,-3.93616855691398,-15.8960856219169,20.577686134897,13.9427721977091,6.15354020451476,-5.09228915686128,1.16633154919136,-2.74347047940198,11.0529867657383,0.803549222062129,-13.6239142359406,13.8178430857289,-17.4693556163821,-9.03507213606613,-15.4892150185873,-6.53126428249449,16.34413616629,-10.0671349499422,-5.87789549981324,9.02832461999755,5.64875186058826,-3.92103396030346,-19.9757099484824,11.5119662435307,-20.4291824270241,16.5062183118915,-11.7302757271135,-0.578599471146989,-5.05305668594502,5.81965401449357,-2.67231847003062,-14.2825822772759,7.10698253044451,-17.8438621769918,0.247612054058772,-10.8695012639889,7.84571768660693,15.0760936521291,-20.9896925695329,11.8489908805816,-20.9762946461049,11.3572062431146,6.91518816788796,13.7032299605268,-3.33281966814274,11.3488702383265,-12.1253005943129,-1.03986794129841,19.2839456431107,17.6928660283789,-14.1593242890703,-2.29093196191276,-2.93440806063435,-11.9658361061073,6.50239323778827,18.9046768716738,-0.105132073970499,18.7564823711172,13.9330544270098,-14.8785073119708,17.987779310703,-2.69247151637152,-8.41990274471359,17.7478670478794,-0.72170821221358,17.3930206723904,0.839712519444847,12.1770556828123,-14.5088592050095,-9.41808655186277,15.7704811143105,17.0577410238385,-4.31006002406029,11.3179990400539,15.0064872579722,-7.00072914645733,0.671524174425753,-5.62430408468967,15.8281324761621,-2.54609926546576,-18.9987209218952,17.559650939614,0.0391167638735266,-17.0451463956825,7.17743331285697,18.7830821145138,21.1871887619488,-1.37783388861623,4.39999947594913,-1.06905161418157,0.00537903355749417,9.83466669189674,19.7337454827457,8.78045774583373,-19.7092401521396,16.9509332803418,15.2192815999903,-16.116060876017,7.55614040969096,13.5453902298381,15.4296801221977,4.55327606829284,17.1853626664548,-10.2110878965165,-1.1557859858247,-11.1687145813132,16.8557798760247,-1.1893675458757,-18.3156070345885,6.46004018607397,6.57408912951245,-8.63285797086896,16.6770500324721,-15.3413750858785,16.3645765587824,5.54272545528201,-17.1014383596195,20.5682045889648,3.50373413625571,5.15603422399348,-18.9273024416562,11.8649366522599,5.83506239276883,-9.46712003146065,4.8708977670112,-13.3430000735059,-16.6237041717262,0.510803400526167,19.8292226059539,-21.9601089146488,-16.4192070967549,0.715291138696762,-9.26215837807002,-16.9938542258804,-17.1268705713455,15.6054871165768,-0.986028339001036,10.0658485168423,-3.30425427896296,-3.80908961717448,-0.577962518282289,18.6995134848471,13.8014950290531,-20.4561685707944,3.9512791602266,5.41351864330652,-3.47403412902778,-2.60907998598067,15.8630352320114,3.06069548794654,-20.1797265139826],"type":"scatter","mode":"markers","name":"T cell","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"line":{"color":"rgba(141,160,203,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="sessioninfo" class="section level3">
<h3><span class="header-section-number">8.9.7</span> sessionInfo()</h3>
<pre><code>## R version 3.6.0 (2019-04-26)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 7 x64 (build 7601) Service Pack 1
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=Chinese (Simplified)_People&#39;s Republic of China.936 
## [2] LC_CTYPE=Chinese (Simplified)_People&#39;s Republic of China.936   
## [3] LC_MONETARY=Chinese (Simplified)_People&#39;s Republic of China.936
## [4] LC_NUMERIC=C                                                   
## [5] LC_TIME=Chinese (Simplified)_People&#39;s Republic of China.936    
## 
## attached base packages:
##  [1] splines   parallel  stats4    stats     graphics  grDevices utils    
##  [8] datasets  methods   base     
## 
## other attached packages:
##  [1] plotly_4.9.0                scfind_3.2.0               
##  [3] scmap_1.7.0                 googleVis_0.6.4            
##  [5] corrplot_0.84               ggbeeswarm_0.6.0           
##  [7] ggthemes_4.2.0              scater_1.13.9              
##  [9] ouija_0.99.0                Rcpp_1.0.1                 
## [11] SLICER_0.2.0                destiny_2.15.0             
## [13] monocle_2.13.0              DDRTree_0.1.5              
## [15] irlba_2.3.3                 VGAM_1.1-1                 
## [17] ggplot2_3.2.0               Matrix_1.2-17              
## [19] TSCAN_1.23.0                SingleCellExperiment_1.7.0 
## [21] SummarizedExperiment_1.15.5 DelayedArray_0.11.4        
## [23] BiocParallel_1.19.0         Biobase_2.45.0             
## [25] GenomicRanges_1.37.14       GenomeInfoDb_1.21.1        
## [27] IRanges_2.19.10             S4Vectors_0.23.17          
## [29] BiocGenerics_0.31.5         RColorBrewer_1.1-2         
## [31] M3Drop_1.11.4               numDeriv_2016.8-1.1        
## [33] matrixStats_0.54.0          scRNA.seq.funcs_0.1.0      
## [35] knitr_1.23                 
## 
## loaded via a namespace (and not attached):
##   [1] R.methodsS3_1.7.1        coda_0.19-3             
##   [3] tidyr_0.8.3              acepack_1.4.1           
##   [5] R.utils_2.9.0            data.table_1.12.2       
##   [7] rpart_4.1-15             inline_0.3.15           
##   [9] RCurl_1.95-4.12          callr_3.3.0             
##  [11] cowplot_1.0.0            RANN_2.6.1              
##  [13] combinat_0.0-8           proxy_0.4-23            
##  [15] spatstat.data_1.4-0      httpuv_1.5.1            
##  [17] StanHeaders_2.18.1-10    assertthat_0.2.1        
##  [19] viridis_0.5.1            lle_1.1                 
##  [21] xfun_0.8                 hms_0.5.0               
##  [23] evaluate_0.14            promises_1.0.1          
##  [25] DEoptimR_1.0-8           caTools_1.17.1.2        
##  [27] readxl_1.3.1             igraph_1.2.4.1          
##  [29] htmlwidgets_1.3          sparsesvd_0.1-4         
##  [31] tensorA_0.36.1           hash_2.2.6.1            
##  [33] purrr_0.3.2              crosstalk_1.0.0         
##  [35] dplyr_0.8.3              backports_1.1.4         
##  [37] bookdown_0.12            moments_0.14            
##  [39] deldir_0.1-22            vctrs_0.2.0             
##  [41] TTR_0.23-4               abind_1.4-5             
##  [43] RcppEigen_0.3.3.5.0      withr_2.1.2             
##  [45] robustbase_0.93-5        checkmate_1.9.4         
##  [47] vcd_1.4-4                xts_0.11-2              
##  [49] prettyunits_1.0.2        mclust_5.4.5            
##  [51] goftest_1.1-1            cluster_2.1.0           
##  [53] splancs_2.01-40          ape_5.3                 
##  [55] lazyeval_0.2.2           laeken_0.5.0            
##  [57] crayon_1.3.4             elliptic_1.4-0          
##  [59] labeling_0.3             pkgconfig_2.0.2         
##  [61] slam_0.1-45              nlme_3.1-140            
##  [63] vipor_0.4.5              nnet_7.3-12             
##  [65] rlang_0.4.0              sgeostat_1.0-27         
##  [67] rsvd_1.0.1               randomForest_4.6-14     
##  [69] cellranger_1.1.0         polyclip_1.10-0         
##  [71] lmtest_0.9-37            loo_2.1.0               
##  [73] carData_3.0-2            boot_1.3-23             
##  [75] zoo_1.8-6                base64enc_0.1-3         
##  [77] beeswarm_0.2.3           processx_3.4.0          
##  [79] pheatmap_1.0.12          png_0.1-7               
##  [81] viridisLite_0.3.0        bitops_1.0-6            
##  [83] R.oo_1.22.0              KernSmooth_2.23-15      
##  [85] DelayedMatrixStats_1.7.1 stringr_1.4.0           
##  [87] tripack_1.3-8            scales_1.0.0            
##  [89] magrittr_1.5             plyr_1.8.4              
##  [91] gplots_3.0.1.1           gdata_2.18.0            
##  [93] zlibbioc_1.31.0          compiler_3.6.0          
##  [95] HSMMSingleCell_1.5.0     bbmle_1.0.20            
##  [97] cli_1.1.0                XVector_0.25.0          
##  [99] ps_1.3.0                 htmlTable_1.13.1        
## [101] Formula_1.2-3            MASS_7.3-51.4           
## [103] mgcv_1.8-28              tidyselect_0.2.5        
## [105] stringi_1.4.3            forcats_0.4.0           
## [107] highr_0.8                densityClust_0.3        
## [109] yaml_2.2.0               BiocSingular_1.1.5      
## [111] latticeExtra_0.6-28      ggrepel_0.8.1           
## [113] grid_3.6.0               orthopolynom_1.0-5      
## [115] tools_3.6.0              rio_0.5.16              
## [117] rstudioapi_0.10          foreign_0.8-71          
## [119] snowfall_1.84-6.1        gridExtra_2.3           
## [121] cubature_2.0.3           smoother_1.1            
## [123] alphahull_2.2            scatterplot3d_0.3-41    
## [125] Rtsne_0.15               digest_0.6.20           
## [127] FNN_1.1.3                shiny_1.3.2             
## [129] qlcMatrix_0.9.7          car_3.0-3               
## [131] later_0.8.0              httr_1.4.0              
## [133] contfrac_1.1-12          hypergeo_1.2-13         
## [135] colorspace_1.4-1         tensor_1.5              
## [137] ranger_0.11.2            reldist_1.6-6           
## [139] MCMCglmm_2.29            statmod_1.4.32          
## [141] spatstat.utils_1.13-0    sp_1.3-1                
## [143] xtable_1.8-4             jsonlite_1.6            
## [145] spatstat_1.60-1          corpcor_1.6.9           
## [147] rstan_2.19.2             zeallot_0.1.0           
## [149] R6_2.4.0                 Hmisc_4.2-0             
## [151] pillar_1.4.2             htmltools_0.3.6         
## [153] mime_0.7                 DT_0.7                  
## [155] glue_1.3.1               VIM_4.8.0               
## [157] BiocNeighbors_1.3.2      deSolve_1.23            
## [159] class_7.3-15             codetools_0.2-16        
## [161] pkgbuild_1.0.3           lattice_0.20-38         
## [163] tibble_2.1.3             curl_3.3                
## [165] gtools_3.8.1             zip_2.0.3               
## [167] openxlsx_4.1.0.1         survival_2.44-1.1       
## [169] limma_3.41.6             rmarkdown_1.14          
## [171] docopt_0.6.1             fastICA_1.2-2           
## [173] munsell_0.5.0            e1071_1.7-2             
## [175] GenomeInfoDbData_1.2.1   haven_2.1.1             
## [177] reshape2_1.4.3           gtable_0.3.0</code></pre>

</div>
</div>
</div>
<h3> References</h3>
<div id="refs" class="references">
<div id="ref-Altschul1990-ts">
<p>Altschul, Stephen F., Warren Gish, Webb Miller, Eugene W. Myers, and David J. Lipman. 1990. “Basic Local Alignment Search Tool.” <em>Journal of Molecular Biology</em> 215 (3): 403–10. <a href="https://doi.org/10.1016/s0022-2836(05)80360-2">https://doi.org/10.1016/s0022-2836(05)80360-2</a>.</p>
</div>
<div id="ref-Cannoodt2016-uj">
<p>Cannoodt, Robrecht, Wouter Saelens, and Yvan Saeys. 2016. “Computational Methods for Trajectory Inference from Single-Cell Transcriptomics.” <em>Eur. J. Immunol.</em> 46 (11): 2496–2506. <a href="https://doi.org/10.1002/eji.201646347">https://doi.org/10.1002/eji.201646347</a>.</p>
</div>
<div id="ref-tabula2018single">
<p>Consortium, Tabula Muris, and others. 2018. “Single-Cell Transcriptomics of 20 Mouse Organs Creates a Tabula Muris.” <em>Nature</em> 562 (7727): 367.</p>
</div>
<div id="ref-Deng2014-mx">
<p>Deng, Q., D. Ramskold, B. Reinius, and R. Sandberg. 2014. “Single-Cell RNA-Seq Reveals Dynamic, Random Monoallelic Gene Expression in Mammalian Cells.” <em>Science</em> 343 (6167): 193–96. <a href="https://doi.org/10.1126/science.1245316">https://doi.org/10.1126/science.1245316</a>.</p>
</div>
<div id="ref-Van_Dijk2017-bh">
<p>Dijk, David van, Juozas Nainys, Roshan Sharma, Pooja Kathail, Ambrose J Carr, Kevin R Moon, Linas Mazutis, Guy Wolf, Smita Krishnaswamy, and Dana Pe’er. 2017. “MAGIC: A Diffusion-Based Imputation Method Reveals Gene-Gene Interactions in Single-Cell RNA-sequencing Data.” <em>bioRxiv</em>, February, 111591.</p>
</div>
<div id="ref-Guo2015-ok">
<p>Guo, Minzhe, Hui Wang, S. Steven Potter, Jeffrey A. Whitsett, and Yan Xu. 2015. “SINCERA: A Pipeline for Single-Cell RNA-Seq Profiling Analysis.” <em>PLoS Comput Biol</em> 11 (11): e1004575. <a href="https://doi.org/10.1371/journal.pcbi.1004575">https://doi.org/10.1371/journal.pcbi.1004575</a>.</p>
</div>
<div id="ref-Kiselev2017-nb">
<p>Kiselev, Vladimir Yu, and Martin Hemberg. 2017. “Scmap - a Tool for Unsupervised Projection of Single Cell RNA-seq Data.” <em>bioRxiv</em>, July, 150292.</p>
</div>
<div id="ref-Kiselev2016-bq">
<p>Kiselev, Vladimir Yu, Kristina Kirschner, Michael T Schaub, Tallulah Andrews, Andrew Yiu, Tamir Chandra, Kedar N Natarajan, et al. 2017. “SC3: Consensus Clustering of Single-Cell RNA-Seq Data.” <em>Nat Meth</em> 14 (5): 483–86. <a href="https://doi.org/10.1038/nmeth.4236">https://doi.org/10.1038/nmeth.4236</a>.</p>
</div>
<div id="ref-Levine2015-fk">
<p>Levine, Jacob H., Erin F. Simonds, Sean C. Bendall, Kara L. Davis, El-ad D. Amir, Michelle D. Tadmor, Oren Litvin, et al. 2015. “Data-Driven Phenotypic Dissection of AML Reveals Progenitor-Like Cells That Correlate with Prognosis.” <em>Cell</em> 162 (1): 184–97. <a href="https://doi.org/10.1016/j.cell.2015.05.047">https://doi.org/10.1016/j.cell.2015.05.047</a>.</p>
</div>
<div id="ref-Li2017-tz">
<p>Li, Wei Vivian, and Jingyi Jessica Li. 2017. “scImpute: Accurate and Robust Imputation for Single Cell RNA-Seq Data.” <em>bioRxiv</em>, June, 141598.</p>
</div>
<div id="ref-Muraro2016-yk">
<p>Muraro, Mauro J., Gitanjali Dharmadhikari, Dominic Grün, Nathalie Groen, Tim Dielen, Erik Jansen, Leon van Gurp, et al. 2016. “A Single-Cell Transcriptome Atlas of the Human Pancreas.” <em>Cell Systems</em> 3 (4): 385–394.e3. <a href="https://doi.org/10.1016/j.cels.2016.09.002">https://doi.org/10.1016/j.cels.2016.09.002</a>.</p>
</div>
<div id="ref-Regev2017-mw">
<p>Regev, Aviv, Sarah Teichmann, Eric S Lander, Ido Amit, Christophe Benoist, Ewan Birney, Bernd Bodenmiller, et al. 2017. “The Human Cell Atlas.” <em>bioRxiv</em>, May, 121202.</p>
</div>
<div id="ref-Segerstolpe2016-wc">
<p>Segerstolpe, Åsa, Athanasia Palasantza, Pernilla Eliasson, Eva-Marie Andersson, Anne-Christine Andréasson, Xiaoyan Sun, Simone Picelli, et al. 2016. “Single-Cell Transcriptome Profiling of Human Pancreatic Islets in Health and Type 2 Diabetes.” <em>Cell Metabolism</em> 24 (4): 593–607. <a href="https://doi.org/10.1016/j.cmet.2016.08.020">https://doi.org/10.1016/j.cmet.2016.08.020</a>.</p>
</div>
<div id="ref-Welch2016-jr">
<p>Welch, Joshua D., Alexander J. Hartemink, and Jan F. Prins. 2016. “SLICER: Inferring Branched, Nonlinear Cellular Trajectories from Single Cell RNA-Seq Data.” <em>Genome Biol</em> 17 (1). <a href="https://doi.org/10.1186/s13059-016-0975-3">https://doi.org/10.1186/s13059-016-0975-3</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="cleaning-the-expression-matrix.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": true,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/lemonbases/scRNA.seq.course.CN/edit/master/08biological-analysis.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["scRNA-seq-course.pdf"],
"toc": {
"collapse": "section"
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
