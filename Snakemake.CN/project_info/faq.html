

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Frequently Asked Questions &mdash; Snakemake 5.6.0+8.g89bc383.dirty documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx-argparse.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Contributing" href="contributing.html" />
    <link rel="prev" title="More Resources" href="more_resources.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Snakemake
          

          
          </a>

          
            
            
              <div class="version">
                5.6.0+8.g89bc383.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/installation.html">安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/tutorial.html">Snakemake Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/short.html">Short tutorial</a></li>
</ul>
<p class="caption"><span class="caption-text">Executing workflows</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../executable.html">Executing Snakemake</a></li>
</ul>
<p class="caption"><span class="caption-text">Defining workflows</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/writing_snakefiles.html">Writing Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/rules.html">Rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/modularization.html">Modularization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/remote_files.html">Remote files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/utils.html">Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/deployment.html">Distribution and Reproducibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/reporting.html">Reports</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/snakemake.html">The Snakemake API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/snakemake_utils.html">Additional utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/internal/modules.html">Internal API</a></li>
</ul>
<p class="caption"><span class="caption-text">Project Info</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="citations.html">Citing and Citations</a></li>
<li class="toctree-l1"><a class="reference internal" href="more_resources.html">More Resources</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-the-key-idea-of-snakemake-workflows">What is the key idea of Snakemake workflows?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-is-the-recommended-way-to-distribute-a-snakemake-workflow">What is the recommended way to distribute a Snakemake workflow?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#my-shell-command-fails-with-with-errors-about-an-unbound-variable-what-s-wrong">My shell command fails with with errors about an “unbound variable”, what’s wrong?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#my-shell-command-fails-with-exit-code-0-from-within-a-pipe-what-s-wrong">My shell command fails with exit code != 0 from within a pipe, what’s wrong?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#i-don-t-want-snakemake-to-detect-an-error-if-my-shell-command-exits-with-an-exitcode-1-what-can-i-do">I don’t want Snakemake to detect an error if my shell command exits with an exitcode &gt; 1. What can I do?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-do-i-run-my-rule-on-all-files-of-a-certain-directory">How do I run my rule on all files of a certain directory?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#snakemake-complains-about-a-cyclic-dependency-or-a-periodicwildcarderror-what-can-i-do">Snakemake complains about a cyclic dependency or a PeriodicWildcardError. What can I do?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#is-it-possible-to-pass-variable-values-to-the-workflow-via-the-command-line">Is it possible to pass variable values to the workflow via the command line?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#i-get-a-nameerror-with-my-shell-command-are-braces-unsupported">I get a NameError with my shell command. Are braces unsupported?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-do-i-incorporate-files-that-do-not-follow-a-consistent-naming-scheme">How do I incorporate files that do not follow a consistent naming scheme?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-do-i-force-snakemake-to-rerun-all-jobs-from-the-rule-i-just-edited">How do I force Snakemake to rerun all jobs from the rule I just edited?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-do-i-enable-syntax-highlighting-in-vim-for-snakefiles">How do I enable syntax highlighting in Vim for Snakefiles?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#i-want-to-import-some-helper-functions-from-another-python-file-is-that-possible">I want to import some helper functions from another python file. Is that possible?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-can-i-run-snakemake-on-a-cluster-where-its-main-process-is-not-allowed-to-run-on-the-head-node">How can I run Snakemake on a cluster where its main process is not allowed to run on the head node?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#can-the-output-of-a-rule-be-a-symlink">Can the output of a rule be a symlink?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#can-the-input-of-a-rule-be-a-symlink">Can the input of a rule be a symlink?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#i-would-like-to-receive-a-mail-upon-snakemake-exit-how-can-this-be-achieved">I would like to receive a mail upon snakemake exit. How can this be achieved?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#i-want-to-pass-variables-between-rules-is-that-possible">I want to pass variables between rules. Is that possible?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#why-do-my-global-variables-behave-strangely-when-i-run-my-job-on-a-cluster">Why do my global variables behave strangely when I run my job on a cluster?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#i-want-to-configure-the-behavior-of-my-shell-for-all-rules-how-can-that-be-achieved-with-snakemake">I want to configure the behavior of my shell for all rules. How can that be achieved with Snakemake?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#some-command-line-arguments-like-config-cannot-be-followed-by-rule-or-file-targets-is-that-intended-behavior">Some command line arguments like –config cannot be followed by rule or file targets. Is that intended behavior?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-do-i-enforce-config-values-given-at-the-command-line-to-be-interpreted-as-strings">How do I enforce config values given at the command line to be interpreted as strings?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-do-i-make-my-rule-fail-if-an-output-file-is-empty">How do I make my rule fail if an output file is empty?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-does-snakemake-lock-the-working-directory">How does Snakemake lock the working directory?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#snakemake-does-not-trigger-re-runs-if-i-add-additional-input-files-what-can-i-do">Snakemake does not trigger re-runs if I add additional input files. What can I do?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-do-i-trigger-re-runs-for-rules-with-updated-code-or-parameters">How do I trigger re-runs for rules with updated code or parameters?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-do-i-remove-all-files-created-by-snakemake-i-e-like-make-clean">How do I remove all files created by snakemake, i.e. like <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#why-can-t-i-use-the-conda-directive-with-a-run-block">Why can’t I use the conda directive with a run block?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#my-workflow-is-very-large-how-do-i-stop-snakemake-from-printing-all-this-rule-job-information-in-a-dry-run">My workflow is very large, how do I stop Snakemake from printing all this rule/job information in a dry-run?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#git-is-messing-up-the-modification-times-of-my-input-files-what-can-i-do">Git is messing up the modification times of my input files, what can I do?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-do-i-exit-a-running-snakemake-workflow">How do I exit a running Snakemake workflow?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-can-i-make-use-of-node-local-storage-when-running-cluster-jobs">How can I make use of node-local storage when running cluster jobs?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-do-i-access-elements-of-input-or-output-by-a-variable-index">How do I access elements of input or output by a variable index?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#there-is-a-compiler-error-when-installing-snakemake-with-pip-or-easy-install-what-shall-i-do">There is a compiler error when installing Snakemake with pip or easy_install, what shall I do?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-enable-autocompletion-for-the-zsh-shell">How to enable autocompletion for the zsh shell?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Snakemake</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Frequently Asked Questions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/project_info/faq.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="frequently-asked-questions">
<span id="project-info-faq"></span><h1><a class="toc-backref" href="#id6">Frequently Asked Questions</a><a class="headerlink" href="#frequently-asked-questions" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#frequently-asked-questions" id="id6">Frequently Asked Questions</a><ul>
<li><a class="reference internal" href="#what-is-the-key-idea-of-snakemake-workflows" id="id7">What is the key idea of Snakemake workflows?</a></li>
<li><a class="reference internal" href="#what-is-the-recommended-way-to-distribute-a-snakemake-workflow" id="id8">What is the recommended way to distribute a Snakemake workflow?</a></li>
<li><a class="reference internal" href="#my-shell-command-fails-with-with-errors-about-an-unbound-variable-what-s-wrong" id="id9">My shell command fails with with errors about an “unbound variable”, what’s wrong?</a></li>
<li><a class="reference internal" href="#my-shell-command-fails-with-exit-code-0-from-within-a-pipe-what-s-wrong" id="id10">My shell command fails with exit code != 0 from within a pipe, what’s wrong?</a></li>
<li><a class="reference internal" href="#i-don-t-want-snakemake-to-detect-an-error-if-my-shell-command-exits-with-an-exitcode-1-what-can-i-do" id="id11">I don’t want Snakemake to detect an error if my shell command exits with an exitcode &gt; 1. What can I do?</a></li>
<li><a class="reference internal" href="#how-do-i-run-my-rule-on-all-files-of-a-certain-directory" id="id12">How do I run my rule on all files of a certain directory?</a></li>
<li><a class="reference internal" href="#snakemake-complains-about-a-cyclic-dependency-or-a-periodicwildcarderror-what-can-i-do" id="id13">Snakemake complains about a cyclic dependency or a PeriodicWildcardError. What can I do?</a></li>
<li><a class="reference internal" href="#is-it-possible-to-pass-variable-values-to-the-workflow-via-the-command-line" id="id14">Is it possible to pass variable values to the workflow via the command line?</a></li>
<li><a class="reference internal" href="#i-get-a-nameerror-with-my-shell-command-are-braces-unsupported" id="id15">I get a NameError with my shell command. Are braces unsupported?</a></li>
<li><a class="reference internal" href="#how-do-i-incorporate-files-that-do-not-follow-a-consistent-naming-scheme" id="id16">How do I incorporate files that do not follow a consistent naming scheme?</a></li>
<li><a class="reference internal" href="#how-do-i-force-snakemake-to-rerun-all-jobs-from-the-rule-i-just-edited" id="id17">How do I force Snakemake to rerun all jobs from the rule I just edited?</a></li>
<li><a class="reference internal" href="#how-do-i-enable-syntax-highlighting-in-vim-for-snakefiles" id="id18">How do I enable syntax highlighting in Vim for Snakefiles?</a></li>
<li><a class="reference internal" href="#i-want-to-import-some-helper-functions-from-another-python-file-is-that-possible" id="id19">I want to import some helper functions from another python file. Is that possible?</a></li>
<li><a class="reference internal" href="#how-can-i-run-snakemake-on-a-cluster-where-its-main-process-is-not-allowed-to-run-on-the-head-node" id="id20">How can I run Snakemake on a cluster where its main process is not allowed to run on the head node?</a></li>
<li><a class="reference internal" href="#can-the-output-of-a-rule-be-a-symlink" id="id21">Can the output of a rule be a symlink?</a></li>
<li><a class="reference internal" href="#can-the-input-of-a-rule-be-a-symlink" id="id22">Can the input of a rule be a symlink?</a></li>
<li><a class="reference internal" href="#i-would-like-to-receive-a-mail-upon-snakemake-exit-how-can-this-be-achieved" id="id23">I would like to receive a mail upon snakemake exit. How can this be achieved?</a></li>
<li><a class="reference internal" href="#i-want-to-pass-variables-between-rules-is-that-possible" id="id24">I want to pass variables between rules. Is that possible?</a></li>
<li><a class="reference internal" href="#why-do-my-global-variables-behave-strangely-when-i-run-my-job-on-a-cluster" id="id25">Why do my global variables behave strangely when I run my job on a cluster?</a></li>
<li><a class="reference internal" href="#i-want-to-configure-the-behavior-of-my-shell-for-all-rules-how-can-that-be-achieved-with-snakemake" id="id26">I want to configure the behavior of my shell for all rules. How can that be achieved with Snakemake?</a></li>
<li><a class="reference internal" href="#some-command-line-arguments-like-config-cannot-be-followed-by-rule-or-file-targets-is-that-intended-behavior" id="id27">Some command line arguments like –config cannot be followed by rule or file targets. Is that intended behavior?</a></li>
<li><a class="reference internal" href="#how-do-i-enforce-config-values-given-at-the-command-line-to-be-interpreted-as-strings" id="id28">How do I enforce config values given at the command line to be interpreted as strings?</a></li>
<li><a class="reference internal" href="#how-do-i-make-my-rule-fail-if-an-output-file-is-empty" id="id29">How do I make my rule fail if an output file is empty?</a></li>
<li><a class="reference internal" href="#how-does-snakemake-lock-the-working-directory" id="id30">How does Snakemake lock the working directory?</a></li>
<li><a class="reference internal" href="#snakemake-does-not-trigger-re-runs-if-i-add-additional-input-files-what-can-i-do" id="id31">Snakemake does not trigger re-runs if I add additional input files. What can I do?</a></li>
<li><a class="reference internal" href="#how-do-i-trigger-re-runs-for-rules-with-updated-code-or-parameters" id="id32">How do I trigger re-runs for rules with updated code or parameters?</a></li>
<li><a class="reference internal" href="#how-do-i-remove-all-files-created-by-snakemake-i-e-like-make-clean" id="id33">How do I remove all files created by snakemake, i.e. like <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code></a></li>
<li><a class="reference internal" href="#why-can-t-i-use-the-conda-directive-with-a-run-block" id="id34">Why can’t I use the conda directive with a run block?</a></li>
<li><a class="reference internal" href="#my-workflow-is-very-large-how-do-i-stop-snakemake-from-printing-all-this-rule-job-information-in-a-dry-run" id="id35">My workflow is very large, how do I stop Snakemake from printing all this rule/job information in a dry-run?</a></li>
<li><a class="reference internal" href="#git-is-messing-up-the-modification-times-of-my-input-files-what-can-i-do" id="id36">Git is messing up the modification times of my input files, what can I do?</a></li>
<li><a class="reference internal" href="#how-do-i-exit-a-running-snakemake-workflow" id="id37">How do I exit a running Snakemake workflow?</a></li>
<li><a class="reference internal" href="#how-can-i-make-use-of-node-local-storage-when-running-cluster-jobs" id="id38">How can I make use of node-local storage when running cluster jobs?</a></li>
<li><a class="reference internal" href="#how-do-i-access-elements-of-input-or-output-by-a-variable-index" id="id39">How do I access elements of input or output by a variable index?</a></li>
<li><a class="reference internal" href="#there-is-a-compiler-error-when-installing-snakemake-with-pip-or-easy-install-what-shall-i-do" id="id40">There is a compiler error when installing Snakemake with pip or easy_install, what shall I do?</a></li>
<li><a class="reference internal" href="#how-to-enable-autocompletion-for-the-zsh-shell" id="id41">How to enable autocompletion for the zsh shell?</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="what-is-the-key-idea-of-snakemake-workflows">
<h2><a class="toc-backref" href="#id7">What is the key idea of Snakemake workflows?</a><a class="headerlink" href="#what-is-the-key-idea-of-snakemake-workflows" title="Permalink to this headline">¶</a></h2>
<p>The key idea is very similar to GNU Make. The workflow is determined automatically from top (the files you want) to bottom (the files you have), by applying very general rules with wildcards you give to Snakemake:</p>
<img alt="Snakemake idea" src="../_images/idea.png" />
<p>When you start using Snakemake, please make sure to walk through the <a class="reference internal" href="../tutorial/tutorial.html#tutorial"><span class="std std-ref">official tutorial</span></a>.
It is crucial to understand how to properly use the system.</p>
</div>
<div class="section" id="what-is-the-recommended-way-to-distribute-a-snakemake-workflow">
<h2><a class="toc-backref" href="#id8">What is the recommended way to distribute a Snakemake workflow?</a><a class="headerlink" href="#what-is-the-recommended-way-to-distribute-a-snakemake-workflow" title="Permalink to this headline">¶</a></h2>
<p>It is recommended that a Snakemake workflow is structured in the following way:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>├── config.yaml
├── environment.yaml
├── scripts
│   ├── script1.py
│   └── script2.R
└── Snakefile
</pre></div>
</div>
<p>This structure can be put into a git repository, allowing to setup the workflow with the following steps:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># clone workflow into working directory</span>
git clone https://bitbucket.org/user/myworkflow.git path/to/workdir
<span class="nb">cd</span> path/to/workdir

<span class="c1"># edit config as needed</span>
vim config.yaml

<span class="c1"># install dependencies into an isolated conda environment</span>
conda env create -n myworkflow --file environment.yaml
<span class="c1"># activate environment</span>
<span class="nb">source</span> activate myworkflow

<span class="c1"># execute workflow</span>
snakemake -n
</pre></div>
</div>
<p>In certain cases, it might be necessary to extend or modify a given workflow (the Snakefile). Here, git provides the ideal mechanisms to track such changes. Any modifications can happen in either a separate branch or a fork.
When the changes are general enough, they can be reintegrated later into the master branch using pull requests.</p>
</div>
<div class="section" id="my-shell-command-fails-with-with-errors-about-an-unbound-variable-what-s-wrong">
<h2><a class="toc-backref" href="#id9">My shell command fails with with errors about an “unbound variable”, what’s wrong?</a><a class="headerlink" href="#my-shell-command-fails-with-with-errors-about-an-unbound-variable-what-s-wrong" title="Permalink to this headline">¶</a></h2>
<p>This happens often when calling virtual environments from within Snakemake. Snakemake is using <a class="reference external" href="http://redsymbol.net/articles/unofficial-bash-strict-mode/">bash strict mode</a>, to ensure e.g. proper error behavior of shell scripts.
Unfortunately, virtualenv and some other tools violate bash strict mode.
he quick fix for virtualenv is to temporarily deactivate the check for unbound variables</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> +u<span class="p">;</span> <span class="nb">source</span> /path/to/venv/bin/activate<span class="p">;</span> <span class="nb">set</span> -u
</pre></div>
</div>
<p>For more details on bash strict mode, see the <a class="reference external" href="http://redsymbol.net/articles/unofficial-bash-strict-mode/">here</a>.</p>
</div>
<div class="section" id="my-shell-command-fails-with-exit-code-0-from-within-a-pipe-what-s-wrong">
<h2><a class="toc-backref" href="#id10">My shell command fails with exit code != 0 from within a pipe, what’s wrong?</a><a class="headerlink" href="#my-shell-command-fails-with-exit-code-0-from-within-a-pipe-what-s-wrong" title="Permalink to this headline">¶</a></h2>
<p>Snakemake is using <a class="reference external" href="http://redsymbol.net/articles/unofficial-bash-strict-mode/">bash strict mode</a> to ensure best practice error reporting in shell commands.
This entails the pipefail option, which reports errors from within a pipe to outside. If you don’t want this, e.g., to handle empty output in the pipe, you can disable pipefail via prepending</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> +o pipefail<span class="p">;</span>
</pre></div>
</div>
<p>to your shell command in the problematic rule.</p>
</div>
<div class="section" id="i-don-t-want-snakemake-to-detect-an-error-if-my-shell-command-exits-with-an-exitcode-1-what-can-i-do">
<h2><a class="toc-backref" href="#id11">I don’t want Snakemake to detect an error if my shell command exits with an exitcode &gt; 1. What can I do?</a><a class="headerlink" href="#i-don-t-want-snakemake-to-detect-an-error-if-my-shell-command-exits-with-an-exitcode-1-what-can-i-do" title="Permalink to this headline">¶</a></h2>
<p>Sometimes, tools encode information in exit codes bigger than 1. Snakemake by default treats anything &gt; 0 as an error. Special cases have to be added by yourself. For example, you can write</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">shell</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    set +e</span>
<span class="sd">    somecommand ...</span>
<span class="sd">    exitcode=$?</span>
<span class="sd">    if [ $exitcode -eq 1 ]</span>
<span class="sd">    then</span>
<span class="sd">        exit 1</span>
<span class="sd">    else</span>
<span class="sd">        exit 0</span>
<span class="sd">    fi</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>This way, Snakemake only treats exit code 1 as an error, and thinks that everything else is fine.
Note that such tools are an excellent use case for contributing a <a class="reference external" href="https://snakemake-wrappers.readthedocs.io">wrapper</a>.</p>
</div>
<div class="section" id="how-do-i-run-my-rule-on-all-files-of-a-certain-directory">
<span id="glob-wildcards"></span><h2><a class="toc-backref" href="#id12">How do I run my rule on all files of a certain directory?</a><a class="headerlink" href="#how-do-i-run-my-rule-on-all-files-of-a-certain-directory" title="Permalink to this headline">¶</a></h2>
<p>In Snakemake, similar to GNU Make, the workflow is determined from the top, i.e. from the target files. Imagine you have a directory with files <code class="docutils literal notranslate"><span class="pre">1.fastq,</span> <span class="pre">2.fastq,</span> <span class="pre">3.fastq,</span> <span class="pre">...</span></code>, and you want to produce files <code class="docutils literal notranslate"><span class="pre">1.bam,</span> <span class="pre">2.bam,</span> <span class="pre">3.bam,</span> <span class="pre">...</span></code> you should specify these as target files, using the ids <code class="docutils literal notranslate"><span class="pre">1,2,3,...</span></code>. You could end up with at least two rules like this (or any number of intermediate steps):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">IDS</span> <span class="o">=</span> <span class="s2">&quot;1 2 3 ...&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="c1"># the list of desired ids</span>

<span class="c1"># a pseudo-rule that collects the target files</span>
<span class="n">rule</span> <span class="nb">all</span><span class="p">:</span>
    <span class="nb">input</span><span class="p">:</span>  <span class="n">expand</span><span class="p">(</span><span class="s2">&quot;otherdir/{id}.bam&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">IDS</span><span class="p">)</span>

<span class="c1"># a general rule using wildcards that does the work</span>
<span class="n">rule</span><span class="p">:</span>
    <span class="nb">input</span><span class="p">:</span>  <span class="s2">&quot;thedir/{id}.fastq&quot;</span>
    <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;otherdir/{id}.bam&quot;</span>
    <span class="n">shell</span><span class="p">:</span>  <span class="s2">&quot;...&quot;</span>
</pre></div>
</div>
<p>Snakemake will then go down the line and determine which files it needs from your initial directory.</p>
<p>In order to infer the IDs from present files, Snakemake provides the <code class="docutils literal notranslate"><span class="pre">glob_wildcards</span></code> function, e.g.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">IDS</span><span class="p">,</span> <span class="o">=</span> <span class="n">glob_wildcards</span><span class="p">(</span><span class="s2">&quot;thedir/{id}.fastq&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The function matches the given pattern against the files present in the filesystem and thereby infers the values for all wildcards in the pattern. A named tuple that contains a list of values for each wildcard is returned. Here, this named tuple has only one item, that is the list of values for the wildcard <code class="docutils literal notranslate"><span class="pre">{id}</span></code>.</p>
</div>
<div class="section" id="snakemake-complains-about-a-cyclic-dependency-or-a-periodicwildcarderror-what-can-i-do">
<h2><a class="toc-backref" href="#id13">Snakemake complains about a cyclic dependency or a PeriodicWildcardError. What can I do?</a><a class="headerlink" href="#snakemake-complains-about-a-cyclic-dependency-or-a-periodicwildcarderror-what-can-i-do" title="Permalink to this headline">¶</a></h2>
<p>One limitation of Snakemake is that graphs of jobs have to be acyclic (similar to GNU Make). This means, that no path in the graph may be a cycle. Although you might have considered this when designing your workflow, Snakemake sometimes runs into situations where a cyclic dependency cannot be avoided without further information, although the solution seems obvious for the developer. Consider the following example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>rule all:
    input:
        &quot;a&quot;

rule unzip:
    input:
        &quot;{sample}.tar.gz&quot;
    output:
        &quot;{sample}&quot;
    shell:
        &quot;tar -xf {input}&quot;
</pre></div>
</div>
<p>If this workflow is executed with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">snakemake -n</span>
</pre></div>
</div>
<p>two things may happen.</p>
<ol class="arabic">
<li><p class="first">If the file <code class="docutils literal notranslate"><span class="pre">a.tar.gz</span></code> is present in the filesystem, Snakemake will propose the following (expected and correct) plan:</p>
<blockquote>
<div><div class="highlight-text notranslate"><div class="highlight"><pre><span></span>rule a:
        input: a.tar.gz
    output: a
    wildcards: sample=a
localrule all:
        input: a
Job counts:
        count   jobs
        1       a
        1       all
        2
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">If the file <code class="docutils literal notranslate"><span class="pre">a.tar.gz</span></code> is not present and cannot be created by any other rule than rule <code class="docutils literal notranslate"><span class="pre">a</span></code>, Snakemake will try to run rule <code class="docutils literal notranslate"><span class="pre">a</span></code> again, with <code class="docutils literal notranslate"><span class="pre">{sample}=a.tar.gz</span></code>. This would infinitely go on recursively. Snakemake detects this case and produces a <code class="docutils literal notranslate"><span class="pre">PeriodicWildcardError</span></code>.</p>
</li>
</ol>
<p>In summary, <code class="docutils literal notranslate"><span class="pre">PeriodicWildcardErrors</span></code> hint to a problem where a rule or a set of rules can be applied to create its own input. If you are lucky, Snakemake can be smart and avoid the error by stopping the recursion if a file exists in the filesystem. Importantly, however, bugs upstream of that rule can manifest as <code class="docutils literal notranslate"><span class="pre">PeriodicWildcardError</span></code>, although in reality just a file is missing or named differently.
In such cases, it is best to restrict the wildcard of the output file(s), or follow the general rule of putting output files of different rules into unique subfolders of your working directory. This way, you can discover the true source of your error.</p>
</div>
<div class="section" id="is-it-possible-to-pass-variable-values-to-the-workflow-via-the-command-line">
<h2><a class="toc-backref" href="#id14">Is it possible to pass variable values to the workflow via the command line?</a><a class="headerlink" href="#is-it-possible-to-pass-variable-values-to-the-workflow-via-the-command-line" title="Permalink to this headline">¶</a></h2>
<p>Yes, this is possible. Have a look at <a class="reference internal" href="../snakefiles/configuration.html#snakefiles-configuration"><span class="std std-ref">Configuration</span></a>.
Previously it was necessary to use environment variables like so:
E.g. write</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nv">SAMPLES</span><span class="o">=</span><span class="s2">&quot;1 2 3 4 5&quot;</span> snakemake
</pre></div>
</div>
<p>and have in the Snakefile some Python code that reads this environment variable, i.e.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">SAMPLES</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SAMPLES&quot;</span><span class="p">,</span> <span class="s2">&quot;10 20&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="i-get-a-nameerror-with-my-shell-command-are-braces-unsupported">
<h2><a class="toc-backref" href="#id15">I get a NameError with my shell command. Are braces unsupported?</a><a class="headerlink" href="#i-get-a-nameerror-with-my-shell-command-are-braces-unsupported" title="Permalink to this headline">¶</a></h2>
<p>You can use the entire Python <a class="reference external" href="http://docs.python.org/3/library/string.html#formatspec">format minilanguage</a> in shell commands. Braces in shell commands that are not intended to insert variable values thus have to be escaped by doubling them:</p>
<p>This:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">shell</span><span class="p">:</span> <span class="s2">&quot;awk &#39;{print $1}&#39; {input}&quot;</span>
</pre></div>
</div>
<p>becomes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">shell</span><span class="p">:</span> <span class="s2">&quot;awk &#39;{{print $1}}&#39; {input}&quot;</span>
</pre></div>
</div>
<p>Here the double braces are escapes, i.e. there will remain single braces in the final command. In contrast, <code class="docutils literal notranslate"><span class="pre">{input}</span></code> is replaced with an input filename.</p>
<p>In addition, if your shell command has literal backslashes, <code class="docutils literal notranslate"><span class="pre">\\</span></code>, you must escape them with a backslash, <code class="docutils literal notranslate"><span class="pre">\\\\</span></code>. For example:</p>
<p>This:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">shell</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;printf </span><span class="se">\&quot;</span><span class="s2">&gt;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">&quot; {{input}}&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>becomes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">shell</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;printf </span><span class="se">\\</span><span class="s2">&quot;&gt;</span><span class="si">%s</span><span class="se">\\</span><span class="s2">&quot;&quot; {{input}}&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="how-do-i-incorporate-files-that-do-not-follow-a-consistent-naming-scheme">
<h2><a class="toc-backref" href="#id16">How do I incorporate files that do not follow a consistent naming scheme?</a><a class="headerlink" href="#how-do-i-incorporate-files-that-do-not-follow-a-consistent-naming-scheme" title="Permalink to this headline">¶</a></h2>
<p>The best solution is to have a dictionary that translates a sample id to the inconsistently named files and use a function (see <a class="reference internal" href="../snakefiles/rules.html#snakefiles-input-functions"><span class="std std-ref">Functions as Input Files</span></a>) to provide an input file like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">FILENAME</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>  <span class="c1"># map sample ids to the irregular filenames here</span>

<span class="n">rule</span><span class="p">:</span>
    <span class="c1"># use a function as input to delegate to the correct filename</span>
    <span class="nb">input</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">wildcards</span><span class="p">:</span> <span class="n">FILENAME</span><span class="p">[</span><span class="n">wildcards</span><span class="o">.</span><span class="n">sample</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;somefolder/{sample}.csv&quot;</span>
    <span class="n">shell</span><span class="p">:</span> <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="how-do-i-force-snakemake-to-rerun-all-jobs-from-the-rule-i-just-edited">
<h2><a class="toc-backref" href="#id17">How do I force Snakemake to rerun all jobs from the rule I just edited?</a><a class="headerlink" href="#how-do-i-force-snakemake-to-rerun-all-jobs-from-the-rule-i-just-edited" title="Permalink to this headline">¶</a></h2>
<p>This can be done by invoking Snakemake with the <code class="docutils literal notranslate"><span class="pre">--forcerules</span></code> or <code class="docutils literal notranslate"><span class="pre">-R</span></code> flag, followed by the rules that should be re-executed:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> snakemake -R somerule
</pre></div>
</div>
<p>This will cause Snakemake to re-run all jobs of that rule and everything downstream (i.e. directly or indirectly depending on the rules output).</p>
</div>
<div class="section" id="how-do-i-enable-syntax-highlighting-in-vim-for-snakefiles">
<h2><a class="toc-backref" href="#id18">How do I enable syntax highlighting in Vim for Snakefiles?</a><a class="headerlink" href="#how-do-i-enable-syntax-highlighting-in-vim-for-snakefiles" title="Permalink to this headline">¶</a></h2>
<p>A vim syntax highlighting definition for Snakemake is available <a class="reference external" href="https://bitbucket.org/snakemake/snakemake/raw/master/misc/vim/syntax/snakemake.vim">here</a>.
You can copy that file to <code class="docutils literal notranslate"><span class="pre">$HOME/.vim/syntax</span></code> directory and add</p>
<div class="highlight-vim notranslate"><div class="highlight"><pre><span></span><span class="k">au</span> <span class="nb">BufNewFile</span><span class="p">,</span><span class="nb">BufRead</span> Snakefile <span class="k">set</span> <span class="nb">syntax</span><span class="p">=</span>snakemake
<span class="k">au</span> <span class="nb">BufNewFile</span><span class="p">,</span><span class="nb">BufRead</span> *.smk <span class="k">set</span> <span class="nb">syntax</span><span class="p">=</span>snakemake
</pre></div>
</div>
<p>to your <code class="docutils literal notranslate"><span class="pre">$HOME/.vimrc</span></code> file. Highlighting can be forced in a vim session with <code class="docutils literal notranslate"><span class="pre">:set</span> <span class="pre">syntax=snakemake</span></code>.</p>
</div>
<div class="section" id="i-want-to-import-some-helper-functions-from-another-python-file-is-that-possible">
<h2><a class="toc-backref" href="#id19">I want to import some helper functions from another python file. Is that possible?</a><a class="headerlink" href="#i-want-to-import-some-helper-functions-from-another-python-file-is-that-possible" title="Permalink to this headline">¶</a></h2>
<p>Yes, from version 2.4.8 on, Snakemake allows to import python modules (and also simple python files) from the same directory where the Snakefile resides.</p>
</div>
<div class="section" id="how-can-i-run-snakemake-on-a-cluster-where-its-main-process-is-not-allowed-to-run-on-the-head-node">
<h2><a class="toc-backref" href="#id20">How can I run Snakemake on a cluster where its main process is not allowed to run on the head node?</a><a class="headerlink" href="#how-can-i-run-snakemake-on-a-cluster-where-its-main-process-is-not-allowed-to-run-on-the-head-node" title="Permalink to this headline">¶</a></h2>
<p>This can be achived by submitting the main Snakemake invocation as a job to the cluster. If it is not allowed to submit a job from a non-head cluster node, you can provide a submit command that goes back to the head node before submitting:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>qsub -N PIPE -cwd -j yes python snakemake --cluster <span class="s2">&quot;ssh user@headnode_address &#39;qsub -N pipe_task -j yes -cwd -S /bin/sh &#39; &quot;</span> -j
</pre></div>
</div>
<p>This hint was provided by Inti Pedroso.</p>
</div>
<div class="section" id="can-the-output-of-a-rule-be-a-symlink">
<h2><a class="toc-backref" href="#id21">Can the output of a rule be a symlink?</a><a class="headerlink" href="#can-the-output-of-a-rule-be-a-symlink" title="Permalink to this headline">¶</a></h2>
<p>Yes. As of Snakemake 3.8, output files are removed before running a rule and then touched after the rule completes to ensure they are newer than the input.  Symlinks are treated just the same as normal files in this regard, and Snakemake ensures that it only modifies the link and not the target when doing this.</p>
<p>Here is an example where you want to merge N files together, but if N == 1 a symlink will do.  This is easier than attempting to implement workflow logic that skips the step entirely.  Note the <strong>-r</strong> flag, supported by modern versions of ln, is useful to achieve correct linking between files in subdirectories.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rule</span> <span class="n">merge_files</span><span class="p">:</span>
    <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;{foo}/all_merged.txt&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="n">my_input_func</span>  <span class="c1"># some function that yields 1 or more files to merge</span>
    <span class="n">run</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">shell</span><span class="p">(</span><span class="s2">&quot;cat {input} | sort &gt; {output}&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shell</span><span class="p">(</span><span class="s2">&quot;ln -sr {input} {output}&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Do be careful with symlinks in combination with <a class="reference internal" href="../tutorial/advanced.html#tutorial-temp-and-protected-files"><span class="std std-ref">Step 6: Temporary and protected files</span></a>.
When the original file is deleted, this can cause various errors once the symlink does not point to a valid file any more.</p>
<p>If you get a message like <code class="docutils literal notranslate"><span class="pre">Unable</span> <span class="pre">to</span> <span class="pre">set</span> <span class="pre">utime</span> <span class="pre">on</span> <span class="pre">symlink</span> <span class="pre">....</span> <span class="pre">Your</span> <span class="pre">Python</span> <span class="pre">build</span> <span class="pre">does</span> <span class="pre">not</span> <span class="pre">support</span> <span class="pre">it.</span></code> this means that Snakemake is unable to properly adjust the modification time of the symlink.
In this case, a workaround is to add the shell command <cite>touch -h {output}</cite> to the end of the rule.</p>
</div>
<div class="section" id="can-the-input-of-a-rule-be-a-symlink">
<h2><a class="toc-backref" href="#id22">Can the input of a rule be a symlink?</a><a class="headerlink" href="#can-the-input-of-a-rule-be-a-symlink" title="Permalink to this headline">¶</a></h2>
<p>Yes.  In this case, since Snakemake 3.8, one extra consideration is applied.  If <em>either</em> the link itself or the target of the link is newer than the output files for the rule then it will trigger the rule to be re-run.</p>
</div>
<div class="section" id="i-would-like-to-receive-a-mail-upon-snakemake-exit-how-can-this-be-achieved">
<h2><a class="toc-backref" href="#id23">I would like to receive a mail upon snakemake exit. How can this be achieved?</a><a class="headerlink" href="#i-would-like-to-receive-a-mail-upon-snakemake-exit-how-can-this-be-achieved" title="Permalink to this headline">¶</a></h2>
<p>On unix, you can make use of the commonly pre-installed <cite>mail</cite> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>snakemake <span class="m">2</span>&gt; snakemake.log
mail -s <span class="s2">&quot;snakemake finished&quot;</span> youremail@provider.com &lt; snakemake.log
</pre></div>
</div>
<p>In case your administrator does not provide you with a proper configuration of the sendmail framework, you can configure <cite>mail</cite> to work e.g. via Gmail (see <a class="reference external" href="http://www.cyberciti.biz/tips/linux-use-gmail-as-a-smarthost.html">here</a>).</p>
</div>
<div class="section" id="i-want-to-pass-variables-between-rules-is-that-possible">
<h2><a class="toc-backref" href="#id24">I want to pass variables between rules. Is that possible?</a><a class="headerlink" href="#i-want-to-pass-variables-between-rules-is-that-possible" title="Permalink to this headline">¶</a></h2>
<p>Because of the cluster support and the ability to resume a workflow where you stopped last time, Snakemake in general should be used in a way that information is stored in the output files of your jobs. Sometimes it might though be handy to have a kind of persistent storage for simple values between jobs and rules. Using plain python objects like a global dict for this will not work as each job is run in a separate process by snakemake. What helps here is the <cite>PersistentDict</cite> from the <a class="reference external" href="https://github.com/inducer/pytools">pytools</a> package. Here is an example of a Snakemake workflow using this facility:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytools.persistent_dict</span> <span class="kn">import</span> <span class="n">PersistentDict</span>

<span class="n">storage</span> <span class="o">=</span> <span class="n">PersistentDict</span><span class="p">(</span><span class="s2">&quot;mystorage&quot;</span><span class="p">)</span>

<span class="n">rule</span> <span class="n">a</span><span class="p">:</span>
    <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;test.in&quot;</span>
    <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;test.out&quot;</span>
    <span class="n">run</span><span class="p">:</span>
        <span class="n">myvar</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;myvar&quot;</span><span class="p">)</span>
        <span class="c1"># do stuff</span>

<span class="n">rule</span> <span class="n">b</span><span class="p">:</span>
    <span class="n">output</span><span class="p">:</span> <span class="n">temp</span><span class="p">(</span><span class="s2">&quot;test.in&quot;</span><span class="p">)</span>
    <span class="n">run</span><span class="p">:</span>
        <span class="n">storage</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="s2">&quot;myvar&quot;</span><span class="p">,</span> <span class="mf">3.14</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, the output rule b has to be temp in order to ensure that <code class="docutils literal notranslate"><span class="pre">myvar</span></code> is stored in each run of the workflow as rule a relies on it. In other words, the PersistentDict is persistent between the job processes, but not between different runs of this workflow. If you need to conserve information between different runs, use output files for them.</p>
</div>
<div class="section" id="why-do-my-global-variables-behave-strangely-when-i-run-my-job-on-a-cluster">
<h2><a class="toc-backref" href="#id25">Why do my global variables behave strangely when I run my job on a cluster?</a><a class="headerlink" href="#why-do-my-global-variables-behave-strangely-when-i-run-my-job-on-a-cluster" title="Permalink to this headline">¶</a></h2>
<p>This is closely related to the question above.  Any Python code you put outside of a rule definition is normally run once before Snakemake starts to process rules, but on a cluster it is re-run again for each submitted job, because Snakemake implements jobs by re-running itself.</p>
<p>Consider the following…</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mydatabase</span> <span class="kn">import</span> <span class="n">get_connection</span>

<span class="n">dbh</span> <span class="o">=</span> <span class="n">get_connection</span><span class="p">()</span>
<span class="n">latest_parameters</span> <span class="o">=</span> <span class="n">dbh</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="o">.</span><span class="n">latest</span><span class="p">()</span>

<span class="n">rule</span> <span class="n">a</span><span class="p">:</span>
    <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;{foo}.in&quot;</span>
    <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;{foo}.out&quot;</span>
    <span class="n">shell</span><span class="p">:</span> <span class="s2">&quot;do_op -params {latest_parameters}  {input} {output}&quot;</span>
</pre></div>
</div>
<p>When run a single machine, you will see a single connection to your database and get a single value for <em>latest_parameters</em> for the duration of the run.  On a cluster you will see a connection attempt from the cluster node for each job submitted, regardless of whether it happens to involve rule a or not, and the parameters will be recalculated for each job.</p>
</div>
<div class="section" id="i-want-to-configure-the-behavior-of-my-shell-for-all-rules-how-can-that-be-achieved-with-snakemake">
<h2><a class="toc-backref" href="#id26">I want to configure the behavior of my shell for all rules. How can that be achieved with Snakemake?</a><a class="headerlink" href="#i-want-to-configure-the-behavior-of-my-shell-for-all-rules-how-can-that-be-achieved-with-snakemake" title="Permalink to this headline">¶</a></h2>
<p>You can set a prefix that will prepended to all shell commands by adding e.g.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">shell</span><span class="o">.</span><span class="n">prefix</span><span class="p">(</span><span class="s2">&quot;set -o pipefail; &quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>to the top of your Snakefile. Make sure that the prefix ends with a semicolon, such that it will not interfere with the subsequent commands.
To simulate a bash login shell, you can do the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">shell</span><span class="o">.</span><span class="n">executable</span><span class="p">(</span><span class="s2">&quot;/bin/bash&quot;</span><span class="p">)</span>
<span class="n">shell</span><span class="o">.</span><span class="n">prefix</span><span class="p">(</span><span class="s2">&quot;source ~/.bashrc; &quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="some-command-line-arguments-like-config-cannot-be-followed-by-rule-or-file-targets-is-that-intended-behavior">
<h2><a class="toc-backref" href="#id27">Some command line arguments like –config cannot be followed by rule or file targets. Is that intended behavior?</a><a class="headerlink" href="#some-command-line-arguments-like-config-cannot-be-followed-by-rule-or-file-targets-is-that-intended-behavior" title="Permalink to this headline">¶</a></h2>
<p>This is a limitation of the argparse module, which cannot distinguish between the perhaps next arg of <code class="docutils literal notranslate"><span class="pre">--config</span></code> and a target.
As a solution, you can put the <cite>–config</cite> at the end of your invocation, or prepend the target with a single <code class="docutils literal notranslate"><span class="pre">--</span></code>, i.e.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> snakemake --config <span class="nv">foo</span><span class="o">=</span>bar -- mytarget
<span class="gp">$</span> snakemake mytarget --config <span class="nv">foo</span><span class="o">=</span>bar
</pre></div>
</div>
</div>
<div class="section" id="how-do-i-enforce-config-values-given-at-the-command-line-to-be-interpreted-as-strings">
<h2><a class="toc-backref" href="#id28">How do I enforce config values given at the command line to be interpreted as strings?</a><a class="headerlink" href="#how-do-i-enforce-config-values-given-at-the-command-line-to-be-interpreted-as-strings" title="Permalink to this headline">¶</a></h2>
<p>When passing config values like this</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> snakemake --config <span class="nv">version</span><span class="o">=</span>2018_1
</pre></div>
</div>
<p>Snakemake will first try to interpret the given value as number.
Only if that fails, it will interpret the value as string.
Here, it does not fail, because the underscore <cite>_</cite> is interpreted as thousand separator.
In order to ensure that the value is interpreted as string, you have to pass it in quotes.
Since bash otherwise automatically removes quotes, you have to also wrap the entire entry into quotes, e.g.:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> snakemake --config <span class="s1">&#39;version=&quot;2018_1&quot;&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="how-do-i-make-my-rule-fail-if-an-output-file-is-empty">
<h2><a class="toc-backref" href="#id29">How do I make my rule fail if an output file is empty?</a><a class="headerlink" href="#how-do-i-make-my-rule-fail-if-an-output-file-is-empty" title="Permalink to this headline">¶</a></h2>
<p>Snakemake expects shell commands to behave properly, meaning that failures should cause an exit status other than zero. If a command does not exit with a status other than zero, Snakemake assumes everything worked fine, even if output files are empty. This is because empty output files are also a reasonable tool to indicate progress where no real output was produced. However, sometimes you will have to deal with tools that do not properly report their failure with an exit status. Here, the recommended way is to use bash to check for non-empty output files, e.g.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rule</span><span class="p">:</span>
    <span class="nb">input</span><span class="p">:</span>  <span class="o">...</span>
    <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;my/output/file.txt&quot;</span>
    <span class="n">shell</span><span class="p">:</span>  <span class="s2">&quot;somecommand {input} {output} &amp;&amp; [[ -s {output} ]]&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="how-does-snakemake-lock-the-working-directory">
<h2><a class="toc-backref" href="#id30">How does Snakemake lock the working directory?</a><a class="headerlink" href="#how-does-snakemake-lock-the-working-directory" title="Permalink to this headline">¶</a></h2>
<p>Per default, Snakemake will lock a working directory by output and input files. Two Snakemake instances that want to create the same output file are not possible. Two instances creating disjoint sets of output files are possible.
With the command line option <code class="docutils literal notranslate"><span class="pre">--nolock</span></code>, you can disable this mechanism on your own risk. With <code class="docutils literal notranslate"><span class="pre">--unlock</span></code>, you can be remove a stale lock. Stale locks can appear if your machine is powered off with a running Snakemake instance.</p>
</div>
<div class="section" id="snakemake-does-not-trigger-re-runs-if-i-add-additional-input-files-what-can-i-do">
<h2><a class="toc-backref" href="#id31">Snakemake does not trigger re-runs if I add additional input files. What can I do?</a><a class="headerlink" href="#snakemake-does-not-trigger-re-runs-if-i-add-additional-input-files-what-can-i-do" title="Permalink to this headline">¶</a></h2>
<p>Snakemake has a kind of “lazy” policy about added input files if their modification date is older than that of the output files. One reason is that information what to do cannot be inferred just from the input and output files. You need additional information about the last run to be stored. Since behaviour would be inconsistent between cases where that information is available and where it is not, this functionality has been encoded as an extra switch. To trigger updates for jobs with changed input files, you can use the command line argument –list-input-changes in the following way:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> snakemake -n -R <span class="sb">`</span>snakemake --list-input-changes<span class="sb">`</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">snakemake</span> <span class="pre">--list-input-changes</span></code> returns the list of output files with changed input files, which is fed into <code class="docutils literal notranslate"><span class="pre">-R</span></code> to trigger a re-run.</p>
</div>
<div class="section" id="how-do-i-trigger-re-runs-for-rules-with-updated-code-or-parameters">
<h2><a class="toc-backref" href="#id32">How do I trigger re-runs for rules with updated code or parameters?</a><a class="headerlink" href="#how-do-i-trigger-re-runs-for-rules-with-updated-code-or-parameters" title="Permalink to this headline">¶</a></h2>
<p>Similar to the solution above, you can use</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> snakemake -n -R <span class="sb">`</span>snakemake --list-params-changes<span class="sb">`</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> snakemake -n -R <span class="sb">`</span>snakemake --list-code-changes<span class="sb">`</span>
</pre></div>
</div>
<p>Again, the list commands in backticks return the list of output files with changes, which are fed into <code class="docutils literal notranslate"><span class="pre">-R</span></code> to trigger a re-run.</p>
</div>
<div class="section" id="how-do-i-remove-all-files-created-by-snakemake-i-e-like-make-clean">
<h2><a class="toc-backref" href="#id33">How do I remove all files created by snakemake, i.e. like <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code></a><a class="headerlink" href="#how-do-i-remove-all-files-created-by-snakemake-i-e-like-make-clean" title="Permalink to this headline">¶</a></h2>
<p>To remove all files created by snakemake as output files to start from scratch, you can use</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> snakemake some_target --delete-all-output
</pre></div>
</div>
<p>Only files that are output of snakemake rules will be removed, not those that serve as primary inputs to the workflow.
Note that this will only affect the files involved in reaching the specified target(s).
It is strongly advised to first run together with <code class="docutils literal notranslate"><span class="pre">--dry-run</span></code> to list the files that would be removed without actually deleting anything.
The flag <code class="docutils literal notranslate"><span class="pre">--delete-temp-output</span></code> can be used in a similar manner to only delete files flagged as temporary.</p>
</div>
<div class="section" id="why-can-t-i-use-the-conda-directive-with-a-run-block">
<h2><a class="toc-backref" href="#id34">Why can’t I use the conda directive with a run block?</a><a class="headerlink" href="#why-can-t-i-use-the-conda-directive-with-a-run-block" title="Permalink to this headline">¶</a></h2>
<p>The run block of a rule (see <a class="reference internal" href="../snakefiles/rules.html#snakefiles-rules"><span class="std std-ref">Rules</span></a>) has access to anything defined in the Snakefile, outside of the rule.
Hence, it has to share the conda environment with the main Snakemake process.
To avoid confusion we therefore disallow the conda directive together with the run block.
It is recommended to use the script directive instead (see <a class="reference internal" href="../snakefiles/rules.html#snakefiles-external-scripts"><span class="std std-ref">External scripts</span></a>).</p>
</div>
<div class="section" id="my-workflow-is-very-large-how-do-i-stop-snakemake-from-printing-all-this-rule-job-information-in-a-dry-run">
<h2><a class="toc-backref" href="#id35">My workflow is very large, how do I stop Snakemake from printing all this rule/job information in a dry-run?</a><a class="headerlink" href="#my-workflow-is-very-large-how-do-i-stop-snakemake-from-printing-all-this-rule-job-information-in-a-dry-run" title="Permalink to this headline">¶</a></h2>
<p>Indeed, the information for each individual job can slow down a dry-run if there are tens of thousands of jobs.
If you are just interested in the final summary, you can use the <code class="docutils literal notranslate"><span class="pre">--quiet</span></code> flag to suppress this.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> snakemake -n --quiet
</pre></div>
</div>
</div>
<div class="section" id="git-is-messing-up-the-modification-times-of-my-input-files-what-can-i-do">
<h2><a class="toc-backref" href="#id36">Git is messing up the modification times of my input files, what can I do?</a><a class="headerlink" href="#git-is-messing-up-the-modification-times-of-my-input-files-what-can-i-do" title="Permalink to this headline">¶</a></h2>
<p>When you checkout a git repository, the modification times of updated files are set to the time of the checkout. If you rely on these files as input <strong>and</strong> output files in your workflow, this can cause trouble. For example, Snakemake could think that a certain (git-tracked) output has to be re-executed, just because its input has been checked out a bit later. In such cases, it is advisable to set the file modification dates to the last commit date after an update has been pulled. See <a class="reference external" href="https://stackoverflow.com/questions/2458042/restore-files-modification-time-in-git/22638823#22638823">here</a> for a solution to achieve this.</p>
</div>
<div class="section" id="how-do-i-exit-a-running-snakemake-workflow">
<h2><a class="toc-backref" href="#id37">How do I exit a running Snakemake workflow?</a><a class="headerlink" href="#how-do-i-exit-a-running-snakemake-workflow" title="Permalink to this headline">¶</a></h2>
<p>There are two ways to exit a currently running workflow.</p>
<ol class="arabic">
<li><p class="first">If you want to kill all running jobs, hit Ctrl+C. Note that when using <code class="docutils literal notranslate"><span class="pre">--cluster</span></code>, this will only cancel the main Snakemake process.</p>
</li>
<li><p class="first">If you want to stop the scheduling of new jobs and wait for all running jobs to be finished, you can send a TERM signal, e.g., via</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>killall -TERM snakemake
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="how-can-i-make-use-of-node-local-storage-when-running-cluster-jobs">
<h2><a class="toc-backref" href="#id38">How can I make use of node-local storage when running cluster jobs?</a><a class="headerlink" href="#how-can-i-make-use-of-node-local-storage-when-running-cluster-jobs" title="Permalink to this headline">¶</a></h2>
<p>When running jobs on a cluster you might want to make use of a node-local scratch
directory in order to reduce cluster network traffic and/or get more efficient disk
storage for temporary files. There is currently no way of doing this in Snakemake,
but a possible workaround involves the <code class="docutils literal notranslate"><span class="pre">shadow</span></code> directive and setting the
<code class="docutils literal notranslate"><span class="pre">--shadow-prefix</span></code> flag to e.g. <code class="docutils literal notranslate"><span class="pre">/scratch</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rule</span><span class="p">:</span>
    <span class="n">output</span><span class="p">:</span>
        <span class="s2">&quot;some_summary_statistics.txt&quot;</span>
    <span class="n">shadow</span><span class="p">:</span> <span class="s2">&quot;minimal&quot;</span>
    <span class="n">shell</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        generate huge_file.csv</span>
<span class="sd">        summarize huge_file.csv &gt; {output}</span>
<span class="sd">        &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>The following would then lead to the job being executed in <code class="docutils literal notranslate"><span class="pre">/scratch/shadow/some_unique_hash/</span></code>, and the
temporary file <code class="docutils literal notranslate"><span class="pre">huge_file.csv</span></code> could be kept at the compute node.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> snakemake --shadow-prefix /scratch some_summary_statistics.txt --cluster ...
</pre></div>
</div>
</div>
<div class="section" id="how-do-i-access-elements-of-input-or-output-by-a-variable-index">
<h2><a class="toc-backref" href="#id39">How do I access elements of input or output by a variable index?</a><a class="headerlink" href="#how-do-i-access-elements-of-input-or-output-by-a-variable-index" title="Permalink to this headline">¶</a></h2>
<p>Assuming you have something like the following rule</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rule</span> <span class="n">a</span><span class="p">:</span>
    <span class="n">output</span><span class="p">:</span>
        <span class="n">expand</span><span class="p">(</span><span class="s2">&quot;test.{i}.out&quot;</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
    <span class="n">run</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
            <span class="n">shell</span><span class="p">(</span><span class="s2">&quot;echo test &gt; {output[i]}&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Snakemake will fail upon execution with the error <code class="docutils literal notranslate"><span class="pre">'OutputFiles'</span> <span class="pre">object</span> <span class="pre">has</span> <span class="pre">no</span> <span class="pre">attribute</span> <span class="pre">'i'</span></code>. The reason is that the shell command is using the <a class="reference external" href="https://docs.python.org/3/library/string.html#formatspec">Python format mini language</a>, which does only allow indexing via constants, e.g., <code class="docutils literal notranslate"><span class="pre">output[1]</span></code>, but not via variables. Variables are treated as attribute names instead. The solution is to write</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rule</span> <span class="n">a</span><span class="p">:</span>
    <span class="n">output</span><span class="p">:</span>
        <span class="n">expand</span><span class="p">(</span><span class="s2">&quot;test.{i}.out&quot;</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
    <span class="n">run</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">shell</span><span class="p">(</span><span class="s2">&quot;echo test &gt; {f}&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>or, more concise in this special case:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rule</span> <span class="n">a</span><span class="p">:</span>
    <span class="n">output</span><span class="p">:</span>
        <span class="n">expand</span><span class="p">(</span><span class="s2">&quot;test.{i}.out&quot;</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
    <span class="n">run</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">shell</span><span class="p">(</span><span class="s2">&quot;echo test &gt; {f}&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="there-is-a-compiler-error-when-installing-snakemake-with-pip-or-easy-install-what-shall-i-do">
<h2><a class="toc-backref" href="#id40">There is a compiler error when installing Snakemake with pip or easy_install, what shall I do?</a><a class="headerlink" href="#there-is-a-compiler-error-when-installing-snakemake-with-pip-or-easy-install-what-shall-i-do" title="Permalink to this headline">¶</a></h2>
<p>Snakemake itself is plain Python, hence the compiler error must come from one of the dependencies, like e.g., datrie.
You should have a look if maybe you are missing some library or a certain compiler package.
If everything seems fine, please report to the upstream developers of the failing dependency.</p>
<p>Note that in general it is recommended to install Snakemake via <a class="reference external" href="https://conda.io">Conda</a> which gives you precompiled packages and the additional benefit of having <a class="reference internal" href="../snakefiles/deployment.html#integrated-package-management"><span class="std std-ref">automatic software deployment</span></a> integrated into your workflow execution.</p>
</div>
<div class="section" id="how-to-enable-autocompletion-for-the-zsh-shell">
<h2><a class="toc-backref" href="#id41">How to enable autocompletion for the zsh shell?</a><a class="headerlink" href="#how-to-enable-autocompletion-for-the-zsh-shell" title="Permalink to this headline">¶</a></h2>
<p>For users of the <a class="reference external" href="https://www.zsh.org/">Z shell</a> (zsh), just run the following (assuming an activated zsh) to activate autocompletion for snakemake:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">compdef _gnu_generic snakemake</span>
</pre></div>
</div>
<p>Example:
Say you have forgotten how to use the various options starting <code class="docutils literal notranslate"><span class="pre">force</span></code>, just type the partial match i.e. <code class="docutils literal notranslate"><span class="pre">--force</span></code> which results in a list of all potential hits along with a description:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>snakemake --force**pressing tab**

<span class="go">--force              -- Force the execution of the selected target or the</span>
<span class="go">--force-use-threads  -- Force threads rather than processes. Helpful if shared</span>
<span class="go">--forceall           -- Force the execution of the selected (or the first)</span>
<span class="go">--forcerun           -- (TARGET (TARGET ...)), -R (TARGET (TARGET ...))</span>
</pre></div>
</div>
<p>To activate this autocompletion permanently, put this line in <code class="docutils literal notranslate"><span class="pre">~/.zshrc</span></code>.</p>
<p><a class="reference external" href="https://github.com/zsh-users/zsh-completions/blob/master/zsh-completions-howto.org">Here</a> is some further reading.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="contributing.html" class="btn btn-neutral float-right" title="Contributing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="more_resources.html" class="btn btn-neutral float-left" title="More Resources" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014-2016, Johannes Koester

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>