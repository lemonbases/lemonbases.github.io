

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Examples &mdash; Snakemake 5.6.0+8.g89bc383.dirty documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx-argparse.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Snakemake Tutorial" href="../tutorial/tutorial.html" />
    <link rel="prev" title="安装" href="installation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Snakemake
          

          
          </a>

          
            
            
              <div class="version">
                5.6.0+8.g89bc383.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">安装</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#cufflinks">Cufflinks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-a-c-program">Building a C Program</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-a-paper-with-latex">Building a Paper with LaTeX</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/tutorial.html">Snakemake Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/short.html">Short tutorial</a></li>
</ul>
<p class="caption"><span class="caption-text">Executing workflows</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../executable.html">Executing Snakemake</a></li>
</ul>
<p class="caption"><span class="caption-text">Defining workflows</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/writing_snakefiles.html">Writing Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/rules.html">Rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/modularization.html">Modularization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/remote_files.html">Remote files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/utils.html">Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/deployment.html">Distribution and Reproducibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../snakefiles/reporting.html">Reports</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/snakemake.html">The Snakemake API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/snakemake_utils.html">Additional utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/internal/modules.html">Internal API</a></li>
</ul>
<p class="caption"><span class="caption-text">Project Info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../project_info/citations.html">Citing and Citations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project_info/more_resources.html">More Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project_info/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project_info/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project_info/authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project_info/history.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project_info/license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Snakemake</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Examples</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/getting_started/examples.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h1>
<p>Most of the examples below assume that Snakemake is executed in a project-specific root directory.
The paths in the Snakefiles below are relative to this directory.
We follow the convention to use different subdirectories for different intermediate results, e.g., <code class="docutils literal notranslate"><span class="pre">mapped/</span></code> for mapped sequence reads in <code class="docutils literal notranslate"><span class="pre">.bam</span></code> files, etc.</p>
<div class="section" id="cufflinks">
<h2>Cufflinks<a class="headerlink" href="#cufflinks" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://cole-trapnell-lab.github.io/cufflinks/">Cufflinks</a> is a tool to assemble transcripts, calculate abundance and conduct a differential expression analysis on RNA-Seq data. This example shows how to create a typical Cufflinks workflow with Snakemake.
It assumes that mapped RNA-Seq data for four samples 101-104 is given as bam files.</p>
<ul class="simple">
<li>For each sample, transcripts are assembled with <code class="docutils literal notranslate"><span class="pre">cufflinks</span></code> (rule <code class="docutils literal notranslate"><span class="pre">assembly</span></code>).</li>
<li>Assemblies are merged into one gtf with <code class="docutils literal notranslate"><span class="pre">cuffmerge</span></code> (rule <code class="docutils literal notranslate"><span class="pre">merge_assemblies</span></code>).</li>
<li>A comparison to the hg19 gtf-track is conducted (rule <code class="docutils literal notranslate"><span class="pre">compare_assemblies</span></code>).</li>
<li>Finally, differential expressions are calculated on the found transcripts (rule <code class="docutils literal notranslate"><span class="pre">diffexp</span></code>).</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># path to track and reference</span>
<span class="n">TRACK</span>   <span class="o">=</span> <span class="s1">&#39;hg19.gtf&#39;</span>
<span class="n">REF</span>     <span class="o">=</span> <span class="s1">&#39;hg19.fa&#39;</span>


<span class="c1"># sample names and classes</span>
<span class="n">CLASS1</span>  <span class="o">=</span> <span class="s1">&#39;101 102&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">CLASS2</span>  <span class="o">=</span> <span class="s1">&#39;103 104&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">SAMPLES</span> <span class="o">=</span> <span class="n">CLASS1</span> <span class="o">+</span> <span class="n">CLASS2</span>


<span class="c1"># path to bam files</span>
<span class="n">CLASS1_BAM</span> <span class="o">=</span> <span class="n">expand</span><span class="p">(</span><span class="s1">&#39;mapped/{sample}.bam&#39;</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="n">CLASS1</span><span class="p">)</span>
<span class="n">CLASS2_BAM</span> <span class="o">=</span> <span class="n">expand</span><span class="p">(</span><span class="s1">&#39;mapped/{sample}.bam&#39;</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="n">CLASS2</span><span class="p">)</span>


<span class="n">rule</span> <span class="nb">all</span><span class="p">:</span>
    <span class="nb">input</span><span class="p">:</span>
        <span class="s1">&#39;diffexp/isoform_exp.diff&#39;</span><span class="p">,</span>
        <span class="s1">&#39;assembly/comparison&#39;</span>


<span class="n">rule</span> <span class="n">assembly</span><span class="p">:</span>
    <span class="nb">input</span><span class="p">:</span>
        <span class="s1">&#39;mapped/{sample}.bam&#39;</span>
    <span class="n">output</span><span class="p">:</span>
        <span class="s1">&#39;assembly/{sample}/transcripts.gtf&#39;</span><span class="p">,</span>
        <span class="nb">dir</span><span class="o">=</span><span class="s1">&#39;assembly/{sample}&#39;</span>
    <span class="n">threads</span><span class="p">:</span> <span class="mi">4</span>
    <span class="n">shell</span><span class="p">:</span>
        <span class="s1">&#39;cufflinks --num-threads {threads} -o {output.dir} &#39;</span>
        <span class="s1">&#39;--frag-bias-correct {REF} {input}&#39;</span>


<span class="n">rule</span> <span class="n">compose_merge</span><span class="p">:</span>
    <span class="nb">input</span><span class="p">:</span>
        <span class="n">expand</span><span class="p">(</span><span class="s1">&#39;assembly/{sample}/transcripts.gtf&#39;</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="n">SAMPLES</span><span class="p">)</span>
    <span class="n">output</span><span class="p">:</span>
        <span class="n">txt</span><span class="o">=</span><span class="s1">&#39;assembly/assemblies.txt&#39;</span>
    <span class="n">run</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">txt</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="o">*</span><span class="nb">input</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>


<span class="n">rule</span> <span class="n">merge_assemblies</span><span class="p">:</span>
    <span class="nb">input</span><span class="p">:</span>
        <span class="s1">&#39;assembly/assemblies.txt&#39;</span>
    <span class="n">output</span><span class="p">:</span>
        <span class="s1">&#39;assembly/merged/merged.gtf&#39;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="s1">&#39;assembly/merged&#39;</span>
    <span class="n">shell</span><span class="p">:</span>
        <span class="s1">&#39;cuffmerge -o {output.dir} -s {REF} {input}&#39;</span>


<span class="n">rule</span> <span class="n">compare_assemblies</span><span class="p">:</span>
    <span class="nb">input</span><span class="p">:</span>
        <span class="s1">&#39;assembly/merged/merged.gtf&#39;</span>
    <span class="n">output</span><span class="p">:</span>
        <span class="s1">&#39;assembly/comparison/all.stats&#39;</span><span class="p">,</span>
        <span class="nb">dir</span><span class="o">=</span><span class="s1">&#39;assembly/comparison&#39;</span>
    <span class="n">shell</span><span class="p">:</span>
        <span class="s1">&#39;cuffcompare -o {output.dir}all -s {REF} -r {TRACK} {input}&#39;</span>


<span class="n">rule</span> <span class="n">diffexp</span><span class="p">:</span>
    <span class="nb">input</span><span class="p">:</span>
        <span class="n">class1</span><span class="o">=</span><span class="n">CLASS1_BAM</span><span class="p">,</span>
        <span class="n">class2</span><span class="o">=</span><span class="n">CLASS2_BAM</span><span class="p">,</span>
        <span class="n">gtf</span><span class="o">=</span><span class="s1">&#39;assembly/merged/merged.gtf&#39;</span>
    <span class="n">output</span><span class="p">:</span>
        <span class="s1">&#39;diffexp/gene_exp.diff&#39;</span><span class="p">,</span> <span class="s1">&#39;diffexp/isoform_exp.diff&#39;</span>
    <span class="n">params</span><span class="p">:</span>
        <span class="n">class1</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">CLASS1_BAM</span><span class="p">),</span>
        <span class="n">class2</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">CLASS2_BAM</span><span class="p">)</span>
    <span class="n">threads</span><span class="p">:</span> <span class="mi">8</span>
    <span class="n">shell</span><span class="p">:</span>
        <span class="s1">&#39;cuffdiff --num-threads {threads} {gtf} {params.class1} {params.class2}&#39;</span>
</pre></div>
</div>
<p>The execution plan of Snakemake for this workflow can be visualized with the following DAG.</p>
<img alt="Cufflinks Workflow DAG" src="../_images/cufflinks-dag.png" />
</div>
<div class="section" id="building-a-c-program">
<h2>Building a C Program<a class="headerlink" href="#building-a-c-program" title="Permalink to this headline">¶</a></h2>
<p>GNU Make is primarily used to build C/C++ code.
Snakemake can do the same, while providing a superior readability due to less obscure variables inside the rules.</p>
<p>The following example Makefile was adapted from <a class="reference external" href="http://www.cs.colby.edu/maxwell/courses/tutorials/maketutor/">http://www.cs.colby.edu/maxwell/courses/tutorials/maketutor/</a>.</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="nv">IDIR</span><span class="o">=</span>../include
<span class="nv">ODIR</span><span class="o">=</span>obj
<span class="nv">LDIR</span><span class="o">=</span>../lib

<span class="nv">LIBS</span><span class="o">=</span>-lm

<span class="nv">CC</span><span class="o">=</span>gcc
<span class="nv">CFLAGS</span><span class="o">=</span>-I<span class="k">$(</span>IDIR<span class="k">)</span>

<span class="nv">_HEADERS</span> <span class="o">=</span> hello.h
<span class="nv">HEADERS</span> <span class="o">=</span> <span class="k">$(</span>patsubst %,<span class="k">$(</span>IDIR<span class="k">)</span>/%,<span class="k">$(</span>_HEADERS<span class="k">))</span>

<span class="nv">_OBJS</span> <span class="o">=</span> hello.o hellofunc.o
<span class="nv">OBJS</span> <span class="o">=</span> <span class="k">$(</span>patsubst %,<span class="k">$(</span>ODIR<span class="k">)</span>/%,<span class="k">$(</span>_OBJS<span class="k">))</span>

<span class="c"># build the executable from the object files</span>
<span class="nf">hello</span><span class="o">:</span> <span class="k">$(</span><span class="nv">OBJS</span><span class="k">)</span>
        <span class="k">$(</span>CC<span class="k">)</span> -o <span class="nv">$@</span> $^ <span class="k">$(</span>CFLAGS<span class="k">)</span>

<span class="c"># compile a single .c file to an .o file</span>
<span class="nf">$(ODIR)/%.o</span><span class="o">:</span> %.<span class="n">c</span> <span class="k">$(</span><span class="nv">HEADERS</span><span class="k">)</span>
        <span class="k">$(</span>CC<span class="k">)</span> -c -o <span class="nv">$@</span> $&lt; <span class="k">$(</span>CFLAGS<span class="k">)</span>


<span class="c"># clean up temporary files</span>
<span class="nf">.PHONY</span><span class="o">:</span> <span class="n">clean</span>
<span class="nf">clean</span><span class="o">:</span>
        rm -f <span class="k">$(</span>ODIR<span class="k">)</span>/*.o *~ core <span class="k">$(</span>IDIR<span class="k">)</span>/*~
</pre></div>
</div>
<p>A Snakefile can be easily written as</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span>

<span class="n">IDIR</span> <span class="o">=</span> <span class="s1">&#39;../include&#39;</span>
<span class="n">ODIR</span> <span class="o">=</span> <span class="s1">&#39;obj&#39;</span>
<span class="n">LDIR</span> <span class="o">=</span> <span class="s1">&#39;../lib&#39;</span>

<span class="n">LIBS</span> <span class="o">=</span> <span class="s1">&#39;-lm&#39;</span>

<span class="n">CC</span> <span class="o">=</span> <span class="s1">&#39;gcc&#39;</span>
<span class="n">CFLAGS</span> <span class="o">=</span> <span class="s1">&#39;-I&#39;</span> <span class="o">+</span> <span class="n">IDIR</span>


<span class="n">_HEADERS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hello.h&#39;</span><span class="p">]</span>
<span class="n">HEADERS</span> <span class="o">=</span> <span class="p">[</span><span class="n">join</span><span class="p">(</span><span class="n">IDIR</span><span class="p">,</span> <span class="n">hfile</span><span class="p">)</span> <span class="k">for</span> <span class="n">hfile</span> <span class="ow">in</span> <span class="n">_HEADERS</span><span class="p">]</span>

<span class="n">_OBJS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hello.o&#39;</span><span class="p">,</span> <span class="s1">&#39;hellofunc.o&#39;</span><span class="p">]</span>
<span class="n">OBJS</span> <span class="o">=</span> <span class="p">[</span><span class="n">join</span><span class="p">(</span><span class="n">ODIR</span><span class="p">,</span> <span class="n">ofile</span><span class="p">)</span> <span class="k">for</span> <span class="n">ofile</span> <span class="ow">in</span> <span class="n">_OBJS</span><span class="p">]</span>


<span class="n">rule</span> <span class="n">hello</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;build the executable from the object files&quot;&quot;&quot;</span>
    <span class="n">output</span><span class="p">:</span>
        <span class="s1">&#39;hello&#39;</span>
    <span class="nb">input</span><span class="p">:</span>
        <span class="n">OBJS</span>
    <span class="n">shell</span><span class="p">:</span>
        <span class="s2">&quot;{CC} -o {output} {input} {CFLAGS} {LIBS}&quot;</span>

<span class="n">rule</span> <span class="n">c_to_o</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;compile a single .c file to an .o file&quot;&quot;&quot;</span>
    <span class="n">output</span><span class="p">:</span>
        <span class="n">temp</span><span class="p">(</span><span class="s1">&#39;{ODIR}/{name}.o&#39;</span><span class="p">)</span>
    <span class="nb">input</span><span class="p">:</span>
        <span class="n">src</span><span class="o">=</span><span class="s1">&#39;{name}.c&#39;</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span>
    <span class="n">shell</span><span class="p">:</span>
        <span class="s2">&quot;{CC} -c -o {output} {input.src} {CFLAGS}&quot;</span>

<span class="n">rule</span> <span class="n">clean</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;clean up temporary files&quot;&quot;&quot;</span>
    <span class="n">shell</span><span class="p">:</span>
        <span class="s2">&quot;rm -f   *~  core  {IDIR}/*~&quot;</span>
</pre></div>
</div>
<p>As can be seen, the shell calls become more readable, e.g. <code class="docutils literal notranslate"><span class="pre">&quot;{CC}</span> <span class="pre">-c</span> <span class="pre">-o</span> <span class="pre">{output}</span> <span class="pre">{input}</span> <span class="pre">{CFLAGS}&quot;</span></code> instead of <code class="docutils literal notranslate"><span class="pre">$(CC)</span> <span class="pre">-c</span> <span class="pre">-o</span> <span class="pre">$&#64;</span> <span class="pre">$&lt;</span> <span class="pre">$(CFLAGS)</span></code>. Further, Snakemake automatically deletes <code class="docutils literal notranslate"><span class="pre">.o</span></code>-files when they are not needed anymore since they are marked as <code class="docutils literal notranslate"><span class="pre">temp</span></code>.</p>
<img alt="C Workflow DAG" src="../_images/c-dag.png" />
</div>
<div class="section" id="building-a-paper-with-latex">
<h2>Building a Paper with LaTeX<a class="headerlink" href="#building-a-paper-with-latex" title="Permalink to this headline">¶</a></h2>
<p>Building a scientific paper can be automated by Snakemake as well.
Apart from compiling LaTeX code and invoking BibTeX, we provide a special rule to zip the needed files for online submission.</p>
<p>We first provide a Snakefile <code class="docutils literal notranslate"><span class="pre">tex.rules</span></code> that contains rules that can be shared for any latex build task:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ruleorder</span><span class="p">:</span>  <span class="n">tex2pdf_with_bib</span> <span class="o">&gt;</span> <span class="n">tex2pdf_without_bib</span>

<span class="n">rule</span> <span class="n">tex2pdf_with_bib</span><span class="p">:</span>
    <span class="nb">input</span><span class="p">:</span>
        <span class="s1">&#39;{name}.tex&#39;</span><span class="p">,</span>
        <span class="s1">&#39;{name}.bib&#39;</span>
    <span class="n">output</span><span class="p">:</span>
        <span class="s1">&#39;{name}.pdf&#39;</span>
    <span class="n">shell</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        pdflatex {wildcards.name}</span>
<span class="sd">        bibtex {wildcards.name}</span>
<span class="sd">        pdflatex {wildcards.name}</span>
<span class="sd">        pdflatex {wildcards.name}</span>
<span class="sd">        &quot;&quot;&quot;</span>

<span class="n">rule</span> <span class="n">tex2pdf_without_bib</span><span class="p">:</span>
    <span class="nb">input</span><span class="p">:</span>
        <span class="s1">&#39;{name}.tex&#39;</span>
    <span class="n">output</span><span class="p">:</span>
        <span class="s1">&#39;{name}.pdf&#39;</span>
    <span class="n">shell</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        pdflatex {wildcards.name}</span>
<span class="sd">        pdflatex {wildcards.name}</span>
<span class="sd">        &quot;&quot;&quot;</span>

<span class="n">rule</span> <span class="n">texclean</span><span class="p">:</span>
    <span class="n">shell</span><span class="p">:</span>
        <span class="s2">&quot;rm -f  *.log *.aux *.bbl *.blg *.synctex.gz&quot;</span>
</pre></div>
</div>
<p>Note how we distinguish between a <code class="docutils literal notranslate"><span class="pre">.tex</span></code> file with and without a corresponding <code class="docutils literal notranslate"><span class="pre">.bib</span></code> with the same name.
Assuming that both <code class="docutils literal notranslate"><span class="pre">paper.tex</span></code> and <code class="docutils literal notranslate"><span class="pre">paper.bib</span></code> exist, an ambiguity arises: Both rules are, in principle, applicable.
This would lead to an <code class="docutils literal notranslate"><span class="pre">AmbiguousRuleException</span></code>, but since we have specified an explicit rule order in the file, it is clear that in this case the rule <code class="docutils literal notranslate"><span class="pre">tex2pdf_with_bib</span></code> is to be preferred.
If the <code class="docutils literal notranslate"><span class="pre">paper.bib</span></code> file does not exist, that rule is not even applicable, and the only option is to execute rule <code class="docutils literal notranslate"><span class="pre">tex2pdf_without_bib</span></code>.</p>
<p>Assuming that the above file is saved as <code class="docutils literal notranslate"><span class="pre">tex.rules</span></code>, the actual documents are then built from a specific Snakefile that includes these common rules:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">DOCUMENTS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;document&#39;</span><span class="p">,</span> <span class="s1">&#39;response-to-editor&#39;</span><span class="p">]</span>
<span class="n">TEXS</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="o">+</span><span class="s2">&quot;.tex&quot;</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">DOCUMENTS</span><span class="p">]</span>
<span class="n">PDFS</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="o">+</span><span class="s2">&quot;.pdf&quot;</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">DOCUMENTS</span><span class="p">]</span>
<span class="n">FIGURES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fig1.pdf&#39;</span><span class="p">]</span>

<span class="n">include</span><span class="p">:</span>
    <span class="s1">&#39;tex.smrules&#39;</span>

<span class="n">rule</span> <span class="nb">all</span><span class="p">:</span>
    <span class="nb">input</span><span class="p">:</span>
        <span class="n">PDFS</span>

<span class="n">rule</span> <span class="n">zipit</span><span class="p">:</span>
    <span class="n">output</span><span class="p">:</span>
        <span class="s1">&#39;upload.zip&#39;</span>
    <span class="nb">input</span><span class="p">:</span>
        <span class="n">TEXS</span><span class="p">,</span> <span class="n">FIGURES</span><span class="p">,</span> <span class="n">PDFS</span>
    <span class="n">shell</span><span class="p">:</span>
        <span class="s1">&#39;zip -T {output} {input}&#39;</span>

<span class="n">rule</span> <span class="n">pdfclean</span><span class="p">:</span>
    <span class="n">shell</span><span class="p">:</span>
        <span class="s2">&quot;rm -f  {PDFS}&quot;</span>
</pre></div>
</div>
<p>Hence the user can perform 4 different tasks.
Build all PDFs:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> snakemake
</pre></div>
</div>
<p>Create a zip-file for online submissions:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> snakemake zipit
</pre></div>
</div>
<p>Clean up all PDFs:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> snakemake pdfclean
</pre></div>
</div>
<p>Clean up latex temporary files:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> snakemake texclean
</pre></div>
</div>
<p>The following DAG of jobs would be executed upon a full run:</p>
<img alt="LaTeX Workflow DAG" src="../_images/latex-dag.png" />
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../tutorial/tutorial.html" class="btn btn-neutral float-right" title="Snakemake Tutorial" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation.html" class="btn btn-neutral float-left" title="安装" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014-2016, Johannes Koester

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>