

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Modularization &mdash; Snakemake 5.6.0+8.g89bc383.dirty documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx-argparse.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Remote files" href="remote_files.html" />
    <link rel="prev" title="Configuration" href="configuration.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Snakemake
          

          
          </a>

          
            
            
              <div class="version">
                5.6.0+8.g89bc383.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/installation.html">安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/tutorial.html">Snakemake Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/short.html">Short tutorial</a></li>
</ul>
<p class="caption"><span class="caption-text">Executing workflows</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../executable.html">Executing Snakemake</a></li>
</ul>
<p class="caption"><span class="caption-text">Defining workflows</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="writing_snakefiles.html">Writing Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="rules.html">Rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Modularization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#wrappers">Wrappers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#common-workflow-language-cwl-support">Common-Workflow-Language (CWL) support</a></li>
<li class="toctree-l2"><a class="reference internal" href="#includes">Includes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sub-workflows">Sub-Workflows</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="remote_files.html">Remote files</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html">Distribution and Reproducibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="reporting.html">Reports</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/snakemake.html">The Snakemake API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/snakemake_utils.html">Additional utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/internal/modules.html">Internal API</a></li>
</ul>
<p class="caption"><span class="caption-text">Project Info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../project_info/citations.html">Citing and Citations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project_info/more_resources.html">More Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project_info/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project_info/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project_info/authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project_info/history.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project_info/license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Snakemake</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Modularization</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/snakefiles/modularization.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="modularization">
<h1>Modularization<a class="headerlink" href="#modularization" title="Permalink to this headline">¶</a></h1>
<p>Modularization in Snakemake comes at different levels.</p>
<ol class="arabic simple">
<li>The most fine-grained level are wrappers. They are available and can be published at the <a class="reference external" href="https://snakemake-wrappers.readthedocs.io">Snakemake Wrapper Repository</a>. These wrappers can then be composed and customized according to your needs, by copying skeleton rules into your workflow. In combination with conda integration, wrappers also automatically deploy the needed software dependencies into isolated environments.</li>
<li>For larger, reusable parts that shall be integrated into a common workflow, it is recommended to write small Snakefiles and include them into a master Snakefile via the include statement. In such a setup, all rules share a common config file.</li>
<li>The third level of separation are subworkflows. Importantly, these are rather meant as links between otherwise separate data analyses.</li>
</ol>
<div class="section" id="wrappers">
<span id="snakefiles-wrappers"></span><h2>Wrappers<a class="headerlink" href="#wrappers" title="Permalink to this headline">¶</a></h2>
<p>The wrapper directive allows to have re-usable wrapper scripts around e.g. command line tools.
In contrast to modularization strategies like <code class="docutils literal notranslate"><span class="pre">include</span></code> or subworkflows, the wrapper directive allows to re-wire the DAG of jobs.
For example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rule</span> <span class="n">samtools_sort</span><span class="p">:</span>
    <span class="nb">input</span><span class="p">:</span>
        <span class="s2">&quot;mapped/{sample}.bam&quot;</span>
    <span class="n">output</span><span class="p">:</span>
        <span class="s2">&quot;mapped/{sample}.sorted.bam&quot;</span>
    <span class="n">params</span><span class="p">:</span>
        <span class="s2">&quot;-m 4G&quot;</span>
    <span class="n">threads</span><span class="p">:</span> <span class="mi">8</span>
    <span class="n">wrapper</span><span class="p">:</span>
        <span class="s2">&quot;0.0.8/bio/samtools_sort&quot;</span>
</pre></div>
</div>
<p>Refers to the wrapper <code class="docutils literal notranslate"><span class="pre">&quot;0.0.8/bio/samtools_sort&quot;</span></code> to create the output from the input.
Snakemake will automatically download the wrapper from the <a class="reference external" href="https://snakemake-wrappers.readthedocs.io">Snakemake Wrapper Repository</a>.
Thereby, 0.0.8 can be replaced with the git version tag you want to use, or a commit id (see <a class="reference external" href="https://bitbucket.org/snakemake/snakemake-wrappers/commits">here</a>).
This ensures reproducibility since changes in the wrapper implementation won’t be propagated automatically to your workflow.
Alternatively, e.g., for development, the wrapper directive can also point to full URLs, including URLs to local files with absolute paths <code class="docutils literal notranslate"><span class="pre">file://</span></code> or relative paths <code class="docutils literal notranslate"><span class="pre">file:</span></code>.
Examples for each wrapper can be found in the READMEs located in the wrapper subdirectories at the <a class="reference external" href="https://snakemake-wrappers.readthedocs.io">Snakemake Wrapper Repository</a>.</p>
<p>The <a class="reference external" href="https://snakemake-wrappers.readthedocs.io">Snakemake Wrapper Repository</a> is meant as a collaborative project and pull requests are very welcome.</p>
</div>
<div class="section" id="common-workflow-language-cwl-support">
<span id="cwl"></span><h2>Common-Workflow-Language (CWL) support<a class="headerlink" href="#common-workflow-language-cwl-support" title="Permalink to this headline">¶</a></h2>
<p>With Snakemake 4.8.0, it is possible to refer to <a class="reference external" href="http://www.commonwl.org/">CWL</a> tool definitions in rules instead of specifying a wrapper or a plain shell command.
A CWL tool definition can be used as follows.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rule</span> <span class="n">samtools_sort</span><span class="p">:</span>
    <span class="nb">input</span><span class="p">:</span>
        <span class="nb">input</span><span class="o">=</span><span class="s2">&quot;mapped/{sample}.bam&quot;</span>
    <span class="n">output</span><span class="p">:</span>
        <span class="n">output_name</span><span class="o">=</span><span class="s2">&quot;mapped/{sample}.sorted.bam&quot;</span>
    <span class="n">params</span><span class="p">:</span>
        <span class="n">threads</span><span class="o">=</span><span class="k">lambda</span> <span class="n">wildcards</span><span class="p">,</span> <span class="n">threads</span><span class="p">:</span> <span class="n">threads</span><span class="p">,</span>
        <span class="n">memory</span><span class="o">=</span><span class="s2">&quot;4G&quot;</span>
    <span class="n">threads</span><span class="p">:</span> <span class="mi">8</span>
    <span class="n">cwl</span><span class="p">:</span>
        <span class="s2">&quot;https://github.com/common-workflow-language/workflows/blob/&quot;</span>
        <span class="s2">&quot;fb406c95/tools/samtools-sort.cwl&quot;</span>
</pre></div>
</div>
<p>It is advisable to use a github URL that includes the commit as above instead of a branch name, in order to ensure reproducible results.
Snakemake will execute the rule by invoking <cite>cwltool</cite>, which has to be available via your <cite>$PATH</cite> variable, and can be, e.g., installed via <cite>conda</cite> or <cite>pip</cite>.
When using in combination with <a class="reference internal" href="deployment.html#singularity"><span class="std std-ref">–use-singularity</span></a>, Snakemake will instruct <cite>cwltool</cite> to execute the command via Singularity in user space.
Otherwise, <cite>cwltool</cite> will in most cases use a Docker container, which requires Docker to be set up properly.</p>
<p>The advantage is that predefined tools available via any <a class="reference external" href="http://www.commonwl.org/#Repositories_of_CWL_Tools_and_Workflows">repository of CWL tool definitions</a> can be used in any supporting workflow management system.
In contrast to a <a class="reference internal" href="#snakefiles-wrappers"><span class="std std-ref">Snakemake wrapper</span></a>, CWL tool definitions are in general not suited to alter the behavior of a tool, e.g., by normalizing output names or special input handling.
As you can see in comparison to the analog <a class="reference internal" href="#snakefiles-wrappers"><span class="std std-ref">wrapper declaration</span></a> above, the rule becomes slightly more verbose, because input, output, and params have to be dispatched to the specific expectations of the CWL tool definition.</p>
</div>
<div class="section" id="includes">
<span id="snakefiles-includes"></span><h2>Includes<a class="headerlink" href="#includes" title="Permalink to this headline">¶</a></h2>
<p>Another Snakefile with all its rules can be included into the current:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">include</span><span class="p">:</span> <span class="s2">&quot;path/to/other/snakefile&quot;</span>
</pre></div>
</div>
<p>The default target rule (often called the <code class="docutils literal notranslate"><span class="pre">all</span></code>-rule), won’t be affected by the include.
I.e. it will always be the first rule in your Snakefile, no matter how many includes you have above your first rule.
Includes are relative to the directory of the Snakefile in which they occur.
For example, if above Snakefile resides in the directory <code class="docutils literal notranslate"><span class="pre">my/dir</span></code>, then Snakemake will search for the include at <code class="docutils literal notranslate"><span class="pre">my/dir/path/to/other/snakefile</span></code>, regardless of the working directory.</p>
</div>
<div class="section" id="sub-workflows">
<span id="snakefiles-sub-workflows"></span><h2>Sub-Workflows<a class="headerlink" href="#sub-workflows" title="Permalink to this headline">¶</a></h2>
<p>In addition to including rules of another workflow, Snakemake allows to depend on the output of other workflows as sub-workflows.
A sub-workflow is executed independently before the current workflow is executed.
Thereby, Snakemake ensures that all files the current workflow depends on are created or updated if necessary.
This allows to create links between otherwise separate data analyses.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">subworkflow</span> <span class="n">otherworkflow</span><span class="p">:</span>
    <span class="n">workdir</span><span class="p">:</span>
        <span class="s2">&quot;../path/to/otherworkflow&quot;</span>
    <span class="n">snakefile</span><span class="p">:</span>
        <span class="s2">&quot;../path/to/otherworkflow/Snakefile&quot;</span>
    <span class="n">configfile</span><span class="p">:</span>
        <span class="s2">&quot;path/to/custom_configfile.yaml&quot;</span>

<span class="n">rule</span> <span class="n">a</span><span class="p">:</span>
    <span class="nb">input</span><span class="p">:</span>
        <span class="n">otherworkflow</span><span class="p">(</span><span class="s2">&quot;test.txt&quot;</span><span class="p">)</span>
    <span class="n">output</span><span class="p">:</span> <span class="o">...</span>
    <span class="n">shell</span><span class="p">:</span>  <span class="o">...</span>
</pre></div>
</div>
<p>Here, the subworkflow is named “otherworkflow” and it is located in the working directory <code class="docutils literal notranslate"><span class="pre">../path/to/otherworkflow</span></code>.
The snakefile is in the same directory and called <code class="docutils literal notranslate"><span class="pre">Snakefile</span></code>.
If <code class="docutils literal notranslate"><span class="pre">snakefile</span></code> is not defined for the subworkflow, it is assumed be located in the workdir location and called <code class="docutils literal notranslate"><span class="pre">Snakefile</span></code>, hence, above we could have left the <code class="docutils literal notranslate"><span class="pre">snakefile</span></code> keyword out as well.
If <code class="docutils literal notranslate"><span class="pre">workdir</span></code> is not specified, it is assumed to be the same as the current one.
The (optional) definition of a <code class="docutils literal notranslate"><span class="pre">configfile</span></code> allows to parameterize the subworkflow as needed.
Files that are output from the subworkflow that we depend on are marked with the <code class="docutils literal notranslate"><span class="pre">otherworkflow</span></code> function (see the input of rule a).
This function automatically determines the absolute path to the file (here <code class="docutils literal notranslate"><span class="pre">../path/to/otherworkflow/test.txt</span></code>).</p>
<p>When executing, snakemake first tries to create (or update, if necessary) <code class="docutils literal notranslate"><span class="pre">test.txt</span></code> (and all other possibly mentioned dependencies) by executing the subworkflow.
Then the current workflow is executed.
This can also happen recursively, since the subworkflow may have its own subworkflows as well.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="remote_files.html" class="btn btn-neutral float-right" title="Remote files" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="configuration.html" class="btn btn-neutral float-left" title="Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014-2016, Johannes Koester

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>