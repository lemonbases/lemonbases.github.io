<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 R/Bioconductor介绍 | scRNA-seq数据分析</title>
  <meta name="description" content="5 R/Bioconductor介绍 | scRNA-seq数据分析" />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="5 R/Bioconductor介绍 | scRNA-seq数据分析" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 R/Bioconductor介绍 | scRNA-seq数据分析" />
  
  
  

<meta name="author" content="碱基吃柠檬" />


<meta name="date" content="2019-06-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="construction-of-expression-matrix.html">
<link rel="next" href="tabula-muris.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- for Facebook -->  
<meta property="og:url" content="https://github.com/sdbiodog" />
<meta property="og:description" content="本项目是将github上经典的scRNA-seq分析教程进行汉化，源项目参见hemberg-lab/scRNA.seq.course" />
<meta property="og:image" content="http://hemberg-lab.github.io/scRNA.seq.course/figures/RNA-Seq_workflow-5.pdf.jpg" />

<!-- for Twitter -->          
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="5 R/Bioconductor介绍 | scRNA-seq数据分析" />
<meta name="twitter:description" content="本项目是将github上经典的scRNA-seq分析教程进行汉化，源项目参见hemberg-lab/scRNA.seq.course" />
<meta name="twitter:image" content="http://hemberg-lab.github.io/scRNA.seq.course/figures/RNA-Seq_workflow-5.pdf.jpg" />

<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-71525309-1', 'auto');
  ga('send', 'pageview');

</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="index.html">Table of Contents</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> 说在前面的话</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#section-1"><i class="fa fa-check"></i><b>1.1</b> 关于本项目</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#section-2"><i class="fa fa-check"></i><b>1.2</b> 视频</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#github"><i class="fa fa-check"></i><b>1.3</b> GitHub</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#docker-"><i class="fa fa-check"></i><b>1.4</b> Docker 镜像</a><ul>
<li class="chapter" data-level="1.4.1" data-path="index.html"><a href="index.html#section-3"><i class="fa fa-check"></i><b>1.4.1</b> 运行镜像</a></li>
<li class="chapter" data-level="1.4.2" data-path="index.html"><a href="index.html#section-4"><i class="fa fa-check"></i><b>1.4.2</b> 下载数据或其它文件</a></li>
<li class="chapter" data-level="1.4.3" data-path="index.html"><a href="index.html#rstudio"><i class="fa fa-check"></i><b>1.4.3</b> RStudio</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#section-5"><i class="fa fa-check"></i><b>1.5</b> 手动安装</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#section-6"><i class="fa fa-check"></i><b>1.6</b> 许可</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#section-7"><i class="fa fa-check"></i><b>1.7</b> 准备知识</a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#section-8"><i class="fa fa-check"></i><b>1.8</b> 联系我们</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-single-cell-rna-seq.html"><a href="introduction-to-single-cell-rna-seq.html"><i class="fa fa-check"></i><b>2</b> scRNA-seq介绍</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-single-cell-rna-seq.html"><a href="introduction-to-single-cell-rna-seq.html#bulk-rna-seq"><i class="fa fa-check"></i><b>2.1</b> Bulk RNA-seq</a></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-single-cell-rna-seq.html"><a href="introduction-to-single-cell-rna-seq.html#scrna-seq"><i class="fa fa-check"></i><b>2.2</b> scRNA-seq</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-single-cell-rna-seq.html"><a href="introduction-to-single-cell-rna-seq.html#section-9"><i class="fa fa-check"></i><b>2.3</b> 工作流程</a></li>
<li class="chapter" data-level="2.4" data-path="introduction-to-single-cell-rna-seq.html"><a href="introduction-to-single-cell-rna-seq.html#section-10"><i class="fa fa-check"></i><b>2.4</b> 计算分析</a></li>
<li class="chapter" data-level="2.5" data-path="introduction-to-single-cell-rna-seq.html"><a href="introduction-to-single-cell-rna-seq.html#section-11"><i class="fa fa-check"></i><b>2.5</b> 挑战</a></li>
<li class="chapter" data-level="2.6" data-path="introduction-to-single-cell-rna-seq.html"><a href="introduction-to-single-cell-rna-seq.html#section-12"><i class="fa fa-check"></i><b>2.6</b> 实验方法</a></li>
<li class="chapter" data-level="2.7" data-path="introduction-to-single-cell-rna-seq.html"><a href="introduction-to-single-cell-rna-seq.html#section-13"><i class="fa fa-check"></i><b>2.7</b> 如何选择合适的平台</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html"><i class="fa fa-check"></i><b>3</b> scRNA-seq原始数据处理</a><ul>
<li class="chapter" data-level="3.1" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#fastqc"><i class="fa fa-check"></i><b>3.1</b> FastQC</a><ul>
<li class="chapter" data-level="3.1.1" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#section-14"><i class="fa fa-check"></i><b>3.1.1</b> 解决方案并下载报告</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#section-15"><i class="fa fa-check"></i><b>3.2</b> 移除接头和低质量碱基</a><ul>
<li class="chapter" data-level="3.2.1" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#solution"><i class="fa fa-check"></i><b>3.2.1</b> Solution</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#section-16"><i class="fa fa-check"></i><b>3.3</b> 文件格式</a><ul>
<li class="chapter" data-level="3.3.1" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#fastq"><i class="fa fa-check"></i><b>3.3.1</b> FastQ</a></li>
<li class="chapter" data-level="3.3.2" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#bam"><i class="fa fa-check"></i><b>3.3.2</b> BAM</a></li>
<li class="chapter" data-level="3.3.3" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#cram"><i class="fa fa-check"></i><b>3.3.3</b> CRAM</a></li>
<li class="chapter" data-level="3.3.4" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#section-17"><i class="fa fa-check"></i><b>3.3.4</b> 手动查看文件</a></li>
<li class="chapter" data-level="3.3.5" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#genome-fasta-gtf"><i class="fa fa-check"></i><b>3.3.5</b> Genome (FASTA, GTF)</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#section-18"><i class="fa fa-check"></i><b>3.4</b> 测序文库拆分</a><ul>
<li class="chapter" data-level="3.4.1" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#section-19"><i class="fa fa-check"></i><b>3.4.1</b> 鉴定含有细胞的液滴/微孔</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#starread"><i class="fa fa-check"></i><b>3.5</b> 使用STAR比对read</a><ul>
<li class="chapter" data-level="3.5.1" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#star"><i class="fa fa-check"></i><b>3.5.1</b> STAR比对命令</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#kallistopseudo-alignment"><i class="fa fa-check"></i><b>3.6</b> Kallisto和Pseudo-Alignment</a><ul>
<li class="chapter" data-level="3.6.1" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#k-mer"><i class="fa fa-check"></i><b>3.6.1</b> k-mer是什么?</a></li>
<li class="chapter" data-level="3.6.2" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#k-merreads"><i class="fa fa-check"></i><b>3.6.2</b> 为什么比对k-mer而不是reads?</a></li>
<li class="chapter" data-level="3.6.3" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#kallisto"><i class="fa fa-check"></i><b>3.6.3</b> Kallisto伪比对模式</a></li>
<li class="chapter" data-level="3.6.4" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#kallisto-pseudo-alignment"><i class="fa fa-check"></i><b>3.6.4</b> Kallisto Pseudo-Alignment命令</a></li>
<li class="chapter" data-level="3.6.5" data-path="processing-raw-scrna-seq-data.html"><a href="processing-raw-scrna-seq-data.html#kallisto-1"><i class="fa fa-check"></i><b>3.6.5</b> 理解Kallisto输出结果</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html"><i class="fa fa-check"></i><b>4</b> 构建表达矩阵</a><ul>
<li class="chapter" data-level="4.1" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html#section-20"><i class="fa fa-check"></i><b>4.1</b> 质量控制</a></li>
<li class="chapter" data-level="4.2" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html#reads-"><i class="fa fa-check"></i><b>4.2</b> Reads 比对</a></li>
<li class="chapter" data-level="4.3" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html#section-21"><i class="fa fa-check"></i><b>4.3</b> 比对示例</a></li>
<li class="chapter" data-level="4.4" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html#mapping-qc"><i class="fa fa-check"></i><b>4.4</b> Mapping QC</a></li>
<li class="chapter" data-level="4.5" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html#reads"><i class="fa fa-check"></i><b>4.5</b> Reads定量</a></li>
<li class="chapter" data-level="4.6" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html#section-22"><i class="fa fa-check"></i><b>4.6</b> 唯一分子标识符</a><ul>
<li class="chapter" data-level="4.6.1" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html#umi"><i class="fa fa-check"></i><b>4.6.1</b> UMI介绍</a></li>
<li class="chapter" data-level="4.6.2" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html#section-23"><i class="fa fa-check"></i><b>4.6.2</b> 比对条形码序列</a></li>
<li class="chapter" data-level="4.6.3" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html#barcodes"><i class="fa fa-check"></i><b>4.6.3</b> Barcodes计数</a></li>
<li class="chapter" data-level="4.6.4" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html#section-24"><i class="fa fa-check"></i><b>4.6.4</b> 错误校正</a></li>
<li class="chapter" data-level="4.6.5" data-path="construction-of-expression-matrix.html"><a href="construction-of-expression-matrix.html#section-25"><i class="fa fa-check"></i><b>4.6.5</b> 下游分析</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html"><i class="fa fa-check"></i><b>5</b> R/Bioconductor介绍</a><ul>
<li class="chapter" data-level="5.1" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#r"><i class="fa fa-check"></i><b>5.1</b> 安装R包</a><ul>
<li class="chapter" data-level="5.1.1" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#cran"><i class="fa fa-check"></i><b>5.1.1</b> CRAN</a></li>
<li class="chapter" data-level="5.1.2" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#github-1"><i class="fa fa-check"></i><b>5.1.2</b> Github</a></li>
<li class="chapter" data-level="5.1.3" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#bioconductor"><i class="fa fa-check"></i><b>5.1.3</b> Bioconductor</a></li>
<li class="chapter" data-level="5.1.4" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#section-26"><i class="fa fa-check"></i><b>5.1.4</b> 源码安装</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#section-27"><i class="fa fa-check"></i><b>5.2</b> 安装说明:</a></li>
<li class="chapter" data-level="5.3" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#section-28"><i class="fa fa-check"></i><b>5.3</b> 数据类型/类</a><ul>
<li class="chapter" data-level="5.3.1" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#section-29"><i class="fa fa-check"></i><b>5.3.1</b> 数值</a></li>
<li class="chapter" data-level="5.3.2" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#section-30"><i class="fa fa-check"></i><b>5.3.2</b> 字符/字符串</a></li>
<li class="chapter" data-level="5.3.3" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#logical"><i class="fa fa-check"></i><b>5.3.3</b> Logical</a></li>
<li class="chapter" data-level="5.3.4" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#factors"><i class="fa fa-check"></i><b>5.3.4</b> Factors</a></li>
<li class="chapter" data-level="5.3.5" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#checking-classtype"><i class="fa fa-check"></i><b>5.3.5</b> Checking class/type</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#basic-data-structures"><i class="fa fa-check"></i><b>5.4</b> Basic data structures</a></li>
<li class="chapter" data-level="5.5" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#more-information"><i class="fa fa-check"></i><b>5.5</b> More information</a></li>
<li class="chapter" data-level="5.6" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#data-types"><i class="fa fa-check"></i><b>5.6</b> Data Types</a><ul>
<li class="chapter" data-level="5.6.1" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#what-is-tidy-data"><i class="fa fa-check"></i><b>5.6.1</b> What is Tidy Data?</a></li>
<li class="chapter" data-level="5.6.2" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#what-is-rich-data"><i class="fa fa-check"></i><b>5.6.2</b> What is Rich Data?</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#bioconductor-singlecellexperiment-and-scater"><i class="fa fa-check"></i><b>5.7</b> Bioconductor, <code>SingleCellExperiment</code> and <code>scater</code></a><ul>
<li class="chapter" data-level="5.7.1" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#bioconductor-1"><i class="fa fa-check"></i><b>5.7.1</b> Bioconductor</a></li>
<li class="chapter" data-level="5.7.2" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#singlecellexperiment-class"><i class="fa fa-check"></i><b>5.7.2</b> <code>SingleCellExperiment</code> class</a></li>
<li class="chapter" data-level="5.7.3" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#scater-package"><i class="fa fa-check"></i><b>5.7.3</b> <code>scater</code> package</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#an-introduction-to-ggplot2"><i class="fa fa-check"></i><b>5.8</b> An Introduction to ggplot2</a><ul>
<li class="chapter" data-level="5.8.1" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#what-is-ggplot2"><i class="fa fa-check"></i><b>5.8.1</b> What is ggplot2?</a></li>
<li class="chapter" data-level="5.8.2" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#principles-of-ggplot2"><i class="fa fa-check"></i><b>5.8.2</b> Principles of ggplot2</a></li>
<li class="chapter" data-level="5.8.3" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#using-the-aes-mapping-function"><i class="fa fa-check"></i><b>5.8.3</b> Using the <code>aes</code> mapping function</a></li>
<li class="chapter" data-level="5.8.4" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#geoms"><i class="fa fa-check"></i><b>5.8.4</b> Geoms</a></li>
<li class="chapter" data-level="5.8.5" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#plotting-data-from-more-than-2-cells"><i class="fa fa-check"></i><b>5.8.5</b> Plotting data from more than 2 cells</a></li>
<li class="chapter" data-level="5.8.6" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#plotting-heatmaps"><i class="fa fa-check"></i><b>5.8.6</b> Plotting heatmaps</a></li>
<li class="chapter" data-level="5.8.7" data-path="intro-r-bioc.html"><a href="intro-r-bioc.html#principal-component-analysis"><i class="fa fa-check"></i><b>5.8.7</b> Principal Component Analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="tabula-muris.html"><a href="tabula-muris.html"><i class="fa fa-check"></i><b>6</b> Tabula Muris</a><ul>
<li class="chapter" data-level="6.1" data-path="tabula-muris.html"><a href="tabula-muris.html#introduction"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="tabula-muris.html"><a href="tabula-muris.html#downloading-the-data"><i class="fa fa-check"></i><b>6.2</b> Downloading the data</a></li>
<li class="chapter" data-level="6.3" data-path="tabula-muris.html"><a href="tabula-muris.html#reading-the-data-smartseq2"><i class="fa fa-check"></i><b>6.3</b> Reading the data (Smartseq2)</a></li>
<li class="chapter" data-level="6.4" data-path="tabula-muris.html"><a href="tabula-muris.html#building-a-scater-object"><i class="fa fa-check"></i><b>6.4</b> Building a scater object</a></li>
<li class="chapter" data-level="6.5" data-path="tabula-muris.html"><a href="tabula-muris.html#reading-the-data-10x"><i class="fa fa-check"></i><b>6.5</b> Reading the data (10X)</a></li>
<li class="chapter" data-level="6.6" data-path="tabula-muris.html"><a href="tabula-muris.html#building-a-scater-object-1"><i class="fa fa-check"></i><b>6.6</b> Building a scater object</a></li>
<li class="chapter" data-level="6.7" data-path="tabula-muris.html"><a href="tabula-muris.html#advanced-exercise"><i class="fa fa-check"></i><b>6.7</b> Advanced Exercise</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>7</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/lemonbases/scRNA.seq.course.CN" target="blank">碱基吃柠檬</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">scRNA-seq数据分析</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="intro_r_bioc" class="section level1">
<h1><span class="header-section-number">5</span> R/Bioconductor介绍</h1>
<div id="r" class="section level2">
<h2><span class="header-section-number">5.1</span> 安装R包</h2>
<div id="cran" class="section level3">
<h3><span class="header-section-number">5.1.1</span> CRAN</h3>
<p>The Comprehensive R Archive Network <a href="https://cran.r-project.org/">CRAN</a> 是最大的R包库。除了成功build和安装之外，对上传R包要求很少，因此文档和相关支持通常很少，弄清楚如何使用这些R包本身成为一个挑战。CRAN是R搜索安装R包的默认库：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)
<span class="kw">require</span>(<span class="st">&quot;devtools&quot;</span>)</code></pre>
</div>
<div id="github-1" class="section level3">
<h3><span class="header-section-number">5.1.2</span> Github</h3>
<p><a href="https://github.com/">Github</a> 并不特定于R，任何状态的任何类型的代码都可以上传。但无法保证上传到github的软件包可以安装，也不保证它声称做的事情。可以使用上述安装的“devtools”软件包直接从github下载和安装R软件包。</p>
<pre class="sourceCode r"><code class="sourceCode r">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;tallulandrews/M3Drop&quot;</span>)</code></pre>
<p>Github同时也是一个版本控制系统，可以存储任何软件包的多个版本。默认情况下，会安装最新的“master”版本的软件包。如果您想使用旧版本或开发分支，可以使用“ref”参数指定：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># different branch</span>
devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;tallulandrews/M3D&quot;</span>, <span class="dt">ref=</span><span class="st">&quot;nbumi&quot;</span>)
<span class="co"># previous commit</span>
devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;tallulandrews/M3Drop&quot;</span>, <span class="dt">ref=</span><span class="st">&quot;434d2da28254acc8de4940c1dc3907ac72973135&quot;</span>)</code></pre>
<p>注意: 确保重新安装M3Drop master分支以便后续课堂使用。</p>
</div>
<div id="bioconductor" class="section level3">
<h3><span class="header-section-number">5.1.3</span> Bioconductor</h3>
<p>Bioconductor是专门用于生物分析的R包库。它对提交有最严格的要求，包括在各平台上安装，以及完整的文档和教程（称为vignette），解释如何使用包。Bioconductor还鼓励使用标准数据结构/类。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">source</span>(<span class="st">&quot;https://bioconductor.org/biocLite.R&quot;</span>)
<span class="kw">biocLite</span>(<span class="st">&quot;edgeR&quot;</span>)</code></pre>
<p>注意: 某些情况下有必要将上述的“<a href="http://" class="uri">http://</a>” 替换为 “<a href="https://" class="uri">https://</a>” ,这取决于网络连接的安全属性。</p>
<p>Bioconductor还要求作者维护他们的R包，并定期6个月发布更新。 在尝试安装课程所需R包之前，请确保使用最新版本的bioconductor。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">source</span>(<span class="st">&quot;https://bioconductor.org/biocLite.R&quot;</span>)
<span class="kw">biocLite</span>(<span class="st">&quot;BiocUpgrade&quot;</span>)</code></pre>
</div>
<div id="section-26" class="section level3">
<h3><span class="header-section-number">5.1.4</span> 源码安装</h3>
<p>安装包的最后一种方法是直接从源码安装。 在这种情况下，必须下载完整构建的源代码文件，通常是packagename.tar.gz，或克隆github仓并重新build软件包。通常，只有在编辑包或者由于某种原因前一种方法失败时才会这样做。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;M3Drop_3.05.00.tar.gz&quot;</span>, <span class="dt">type=</span><span class="st">&quot;source&quot;</span>)</code></pre>
</div>
</div>
<div id="section-27" class="section level2">
<h2><span class="header-section-number">5.2</span> 安装说明:</h2>
<p>本课程所需的所有软件包都可以在<a href="https://github.com/hemberg-lab/scRNA.seq.course/blob/master/Dockerfile">这里</a>获得。从“RUN Rscript -e”install.packages(‘devtools’)" “开始，在命令行或者R session运行引号内的命令(移除”RUN")。注意，某些情况下安装顺序也很重要，请确保按顺序执行。</p>
</div>
<div id="section-28" class="section level2">
<h2><span class="header-section-number">5.3</span> 数据类型/类</h2>
<p>R是一种高级语言，因此底层数据类型通常并不重要。 如果您使用其他语言（如C）直接访问R数据，则需要考虑，但这超出了本课程的范围。 相反，我们将考虑基本数据类型：数值(numeric)，整数(integer)，逻辑(logical)和字符(character)，以及高级数据类“因子”。 使用“class（）”函数检查数据的类型。</p>
<p>除此之外：R还可以将数据存储为“复数(complex)”，但通常这与生物分析无关。</p>
<div id="section-29" class="section level3">
<h3><span class="header-section-number">5.3.1</span> 数值</h3>
<p>“数值”类型是存储任何数值数据的默认类 - 整数，十进制数，科学计数法中的数字等…</p>
<pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="fl">1.141</span>
<span class="kw">class</span>(x)</code></pre>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">y =<span class="st"> </span><span class="dv">42</span>
<span class="kw">class</span>(y)</code></pre>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">z =<span class="st"> </span><span class="fl">6.02e23</span>
<span class="kw">class</span>(z)</code></pre>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<p>即使R有一个“整数”类型，42可以更有效地存储为整数，默认是将其存储为“数值”类型。 如果我们想要将42存储为整数，我们必须<code>强制</code>类型转换：</p>
<pre class="sourceCode r"><code class="sourceCode r">y =<span class="st"> </span><span class="kw">as.integer</span>(<span class="dv">42</span>)
<span class="kw">class</span>(y)</code></pre>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<p>强制R将数据存储为特定类，如果我们的数据与该类不兼容，它仍将执行此操作，但数据将转换为NA：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.numeric</span>(<span class="st">&quot;H&quot;</span>)</code></pre>
<pre><code>## Warning: 强制改变过程中产生了NA</code></pre>
<pre><code>## [1] NA</code></pre>
<p>上述将“字符”数据强制转换为无意义的数值，因此触发（“抛出”）警告消息。 由于这只是一个警告信息，R将继续执行脚本/函数中的后续命令，而“错误”将导致R停止执行。</p>
</div>
<div id="section-30" class="section level3">
<h3><span class="header-section-number">5.3.2</span> 字符/字符串</h3>
<p>“character”类型存储各种文本数据。 编程约定将包含多个字母的数据称为“字符串”，因此大多数作用于字符数据的R函数将数据称为“字符串”，并且通常在其名称中包含“str”或“string”。字符串通过双引号标识，而变量/函数名称则不是：</p>
<pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="dv">5</span>

a =<span class="st"> &quot;x&quot;</span> <span class="co"># character &quot;x&quot;</span>
a</code></pre>
<pre><code>## [1] &quot;x&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">b =<span class="st"> </span>x <span class="co"># variable x</span>
b</code></pre>
<pre><code>## [1] 5</code></pre>
<p>In addition to standard alphanumeric characters, strings can also store various special characters. Special characters are identified using a backlash followed by a single character, the most relevant are the special character for tab : <code>\t</code> and new line : <code>\n</code>. To demonstrate the these special characters lets concatenate (cat) together two strings with these characters separating (sep) them:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(<span class="st">&quot;Hello&quot;</span>, <span class="st">&quot;World&quot;</span>, <span class="dt">sep=</span> <span class="st">&quot; &quot;</span>)</code></pre>
<pre><code>## Hello World</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(<span class="st">&quot;Hello&quot;</span>, <span class="st">&quot;World&quot;</span>, <span class="dt">sep=</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>)</code></pre>
<pre><code>## Hello    World</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(<span class="st">&quot;Hello&quot;</span>, <span class="st">&quot;World&quot;</span>, <span class="dt">sep=</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</code></pre>
<pre><code>## Hello
## World</code></pre>
<p>Note that special characters work differently in different functions. For instance the <code>paste</code> function does the same thing as <code>cat</code> but does not recognize special characters.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">paste</span>(<span class="st">&quot;Hello&quot;</span>, <span class="st">&quot;World&quot;</span>, <span class="dt">sep=</span> <span class="st">&quot; &quot;</span>)</code></pre>
<pre><code>## [1] &quot;Hello World&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">paste</span>(<span class="st">&quot;Hello&quot;</span>, <span class="st">&quot;World&quot;</span>, <span class="dt">sep=</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>)</code></pre>
<pre><code>## [1] &quot;Hello\tWorld&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">paste</span>(<span class="st">&quot;Hello&quot;</span>, <span class="st">&quot;World&quot;</span>, <span class="dt">sep=</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</code></pre>
<pre><code>## [1] &quot;Hello\nWorld&quot;</code></pre>
<p>Single or double backslash is also used as an <code>escape</code> character to turn off special characters or allow quotation marks to be included in strings:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(<span class="st">&quot;This </span><span class="ch">\&quot;</span><span class="st">string</span><span class="ch">\&quot;</span><span class="st"> contains quotation marks.&quot;</span>)</code></pre>
<pre><code>## This &quot;string&quot; contains quotation marks.</code></pre>
<p>Special characters are generally only used in pattern matching, and reading/writing data to files. For instance this is how you would read a tab-separated file into R.</p>
<pre class="sourceCode r"><code class="sourceCode r">dat =<span class="st"> </span><span class="kw">read.delim</span>(<span class="st">&quot;file.tsv&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>)</code></pre>
<p>Another special type of character data are colours. Colours can be specified in three main ways: by name from those <a href="http://bxhorn.com/r-color-tables/">available</a>, by red, green, blue values using the <code>rgb</code> function, and by hue (colour), saturation (colour vs white) and value (colour/white vs black) using the <code>hsv</code> function. By default rgb and hsv expect three values in 0-1 with an optional fourth value for transparency. Alternatively, sets of predetermined colours with useful properties can be loaded from many different packages with <a href="http://colorbrewer2.org/">RColorBrewer</a> being one of the most popular.</p>
<pre class="sourceCode r"><code class="sourceCode r">reds =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="kw">rgb</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="kw">hsv</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>))
reds</code></pre>
<pre><code>## [1] &quot;red&quot;     &quot;#FF0000&quot; &quot;#FF0000&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barplot</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="dt">col=</span>reds, <span class="dt">names=</span><span class="kw">c</span>(<span class="st">&quot;by_name&quot;</span>, <span class="st">&quot;by_rgb&quot;</span>, <span class="st">&quot;by_hsv&quot;</span>))</code></pre>
<p><img src="05intro-R-Bioc_files/figure-html/unnamed-chunk-16-1.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<div id="logical" class="section level3">
<h3><span class="header-section-number">5.3.3</span> Logical</h3>
<p>The <code>logical</code> class stores boolean truth values, i.e. TRUE and FALSE. It is used for storing the results of logical operations and conditional statements will be coerced to this class. Most other data-types can be coerced to boolean without triggering (or “throwing”) error messages, which may cause unexpected behaviour.</p>
<pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="ot">TRUE</span>
<span class="kw">class</span>(x)</code></pre>
<pre><code>## [1] &quot;logical&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">y =<span class="st"> &quot;T&quot;</span>
<span class="kw">as.logical</span>(y)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">z =<span class="st"> </span><span class="dv">5</span>
<span class="kw">as.logical</span>(z)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="ot">FALSE</span>
<span class="kw">class</span>(x)</code></pre>
<pre><code>## [1] &quot;logical&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">y =<span class="st"> &quot;F&quot;</span>
<span class="kw">as.logical</span>(y)</code></pre>
<pre><code>## [1] FALSE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">z =<span class="st"> </span><span class="dv">0</span>
<span class="kw">as.logical</span>(z)</code></pre>
<pre><code>## [1] FALSE</code></pre>
<p><strong>Exercise 1</strong>
Experiment with other character and numeric values, which are coerced to TRUE or FALSE? which are coerced to neither?
Do you ever throw a warning/error message?</p>
</div>
<div id="factors" class="section level3">
<h3><span class="header-section-number">5.3.4</span> Factors</h3>
<p>String/Character data is very memory inefficient to store, each letter generally requires the same amount of memory as any integer. Thus when storing a vector of strings with repeated elements it is more efficient assign each element to an integer and store the vector as integers and an additional string-to-integer association table. Thus, by default R will read in text columns of a data table as factors.</p>
<pre class="sourceCode r"><code class="sourceCode r">str_vector =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Apple&quot;</span>, <span class="st">&quot;Apple&quot;</span>, <span class="st">&quot;Banana&quot;</span>, <span class="st">&quot;Banana&quot;</span>, <span class="st">&quot;Banana&quot;</span>, <span class="st">&quot;Carrot&quot;</span>, <span class="st">&quot;Carrot&quot;</span>, <span class="st">&quot;Apple&quot;</span>, <span class="st">&quot;Banana&quot;</span>) 
factored_vector =<span class="st"> </span><span class="kw">factor</span>(str_vector)
factored_vector</code></pre>
<pre><code>## [1] Apple  Apple  Banana Banana Banana Carrot Carrot Apple  Banana
## Levels: Apple Banana Carrot</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.numeric</span>(factored_vector)</code></pre>
<pre><code>## [1] 1 1 2 2 2 3 3 1 2</code></pre>
<p>The double nature of factors can cause some unintuitive behaviour. E.g. joining two factors together will convert them to the numeric form and the original strings will be lost.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(factored_vector, factored_vector)</code></pre>
<pre><code>##  [1] 1 1 2 2 2 3 3 1 2 1 1 2 2 2 3 3 1 2</code></pre>
<p>Likewise if due to formatting issues numeric data is mistakenly interpretted as strings, then you must convert the factor back to strings before coercing to numeric values:</p>
<pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;20&quot;</span>, <span class="st">&quot;25&quot;</span>, <span class="st">&quot;23&quot;</span>, <span class="st">&quot;38&quot;</span>, <span class="st">&quot;20&quot;</span>, <span class="st">&quot;40&quot;</span>, <span class="st">&quot;25&quot;</span>, <span class="st">&quot;30&quot;</span>)
x =<span class="st"> </span><span class="kw">factor</span>(x)
<span class="kw">as.numeric</span>(x)</code></pre>
<pre><code>## [1] 1 3 2 5 1 6 3 4</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(x))</code></pre>
<pre><code>## [1] 20 25 23 38 20 40 25 30</code></pre>
<p>To make R read text as character data instead of factors set the environment option <code>stringsAsFactors=FALSE</code>. This must be done at the start of each R session.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">options</span>(<span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>)</code></pre>
<p><strong>Exercise</strong>
How would you use factors to create a vector of colours for an arbitrarily long vector of fruits like <code>str_vector</code> above?
<strong>Answer</strong></p>
</div>
<div id="checking-classtype" class="section level3">
<h3><span class="header-section-number">5.3.5</span> Checking class/type</h3>
<p>We recommend checking your data is of the correct class after reading from files:</p>
<pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="fl">1.4</span>
<span class="kw">is.numeric</span>(x)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">is.character</span>(x)</code></pre>
<pre><code>## [1] FALSE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">is.logical</span>(x)</code></pre>
<pre><code>## [1] FALSE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">is.factor</span>(x)</code></pre>
<pre><code>## [1] FALSE</code></pre>
</div>
</div>
<div id="basic-data-structures" class="section level2">
<h2><span class="header-section-number">5.4</span> Basic data structures</h2>
<p>So far we have only looked at single values and vectors. Vectors are the simplest data structure in R. They are a 1-dimensional array of data all of the same type. If the input when creating a vector is of different types it will be coerced to the data-type that is most consistent with the data.</p>
<pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Hello&quot;</span>, <span class="dv">5</span>, <span class="ot">TRUE</span>)
x</code></pre>
<pre><code>## [1] &quot;Hello&quot; &quot;5&quot;     &quot;TRUE&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(x)</code></pre>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>Here we tried to put character, numeric and logical data into a single vector so all the values were coerced to <code>character</code> data.</p>
<p>A <code>matrix</code> is the two dimensional version of a vector, it also requires all data to be of the same type.
If we combine a character vector and a numeric vector into a matrix, all the data will be coerced to characters:</p>
<pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>)
y =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)
<span class="kw">class</span>(x)</code></pre>
<pre><code>## [1] &quot;character&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(y)</code></pre>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">m =<span class="st"> </span><span class="kw">cbind</span>(x, y)
m</code></pre>
<pre><code>##      x   y  
## [1,] &quot;A&quot; &quot;1&quot;
## [2,] &quot;B&quot; &quot;2&quot;
## [3,] &quot;C&quot; &quot;3&quot;</code></pre>
<p>The quotation marks indicate that the numeric vector has been coerced to characters. Alternatively, to store data with columns of different data-types we can use a dataframe.</p>
<pre class="sourceCode r"><code class="sourceCode r">z =<span class="st"> </span><span class="kw">data.frame</span>(x, y)
z</code></pre>
<pre><code>##   x y
## 1 A 1
## 2 B 2
## 3 C 3</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(z[,<span class="dv">1</span>])</code></pre>
<pre><code>## [1] &quot;character&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(z[,<span class="dv">2</span>])</code></pre>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<p>If you have set stringsAsFactors=FALSE as above you will find the first column remains characters, otherwise it will be automatically converted to a factor.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">options</span>(<span class="dt">stringsAsFactors=</span><span class="ot">TRUE</span>)
z =<span class="st"> </span><span class="kw">data.frame</span>(x, y)
<span class="kw">class</span>(z[,<span class="dv">1</span>])</code></pre>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<p>Another difference between matrices and dataframes is the ability to select columns using the <code>$</code> operator:</p>
<pre class="sourceCode r"><code class="sourceCode r">m<span class="op">$</span>x <span class="co"># throws an error</span>
z<span class="op">$</span>x <span class="co"># ok</span></code></pre>
<p>The final basic data structure is the <code>list</code>. Lists allow data of different types and different lengths to be stored in a single object. Each element of a list can be any other R object : data of any type, any data structure, even other lists or functions.</p>
<pre class="sourceCode r"><code class="sourceCode r">l =<span class="st"> </span><span class="kw">list</span>(m, z)
ll =<span class="st"> </span><span class="kw">list</span>(<span class="dt">sublist=</span>l, <span class="dt">a_matrix=</span>m, <span class="dt">numeric_value=</span><span class="dv">42</span>, <span class="dt">this_string=</span><span class="st">&quot;Hello World&quot;</span>, <span class="dt">even_a_function=</span>cbind)
ll</code></pre>
<pre><code>## $sublist
## $sublist[[1]]
##      x   y  
## [1,] &quot;A&quot; &quot;1&quot;
## [2,] &quot;B&quot; &quot;2&quot;
## [3,] &quot;C&quot; &quot;3&quot;
## 
## $sublist[[2]]
##   x y
## 1 A 1
## 2 B 2
## 3 C 3
## 
## 
## $a_matrix
##      x   y  
## [1,] &quot;A&quot; &quot;1&quot;
## [2,] &quot;B&quot; &quot;2&quot;
## [3,] &quot;C&quot; &quot;3&quot;
## 
## $numeric_value
## [1] 42
## 
## $this_string
## [1] &quot;Hello World&quot;
## 
## $even_a_function
## function (..., deparse.level = 1) 
## .Internal(cbind(deparse.level, ...))
## &lt;bytecode: 0x0000000008278de8&gt;
## &lt;environment: namespace:base&gt;</code></pre>
<p>Lists are most commonly used when returning a large number of results from a function that do not fit into any of the previous data structures.</p>
</div>
<div id="more-information" class="section level2">
<h2><span class="header-section-number">5.5</span> More information</h2>
<p>You can get more information about any R commands relevant to these datatypes using by typing <code>?function</code> in an interactive session.</p>
</div>
<div id="data-types" class="section level2">
<h2><span class="header-section-number">5.6</span> Data Types</h2>
<div id="what-is-tidy-data" class="section level3">
<h3><span class="header-section-number">5.6.1</span> What is Tidy Data?</h3>
<p>Tidy data is a concept largely defined by Hadley Wickham <span class="citation">(Wickham <a href="#ref-wickham_2014">2014</a>)</span>. Tidy data has the following three characteristics:</p>
<ol style="list-style-type: decimal">
<li>Each variable has its own column.</li>
<li>Each observation has its own row.</li>
<li>Each value has its own cell.</li>
</ol>
<p>Here is an example of some tidy data:</p>
<pre><code>##   Students   Subject Years Score
## 1     Mark     Maths     1     5
## 2     Jane   Biology     2     6
## 3 Mohammed   Physics     3     4
## 4      Tom     Maths     2     7
## 5    Celia Computing     3     9</code></pre>
<p>Here is an example of some untidy data:</p>
<pre><code>##    Students    Sport Category Counts
## 1      Matt   Tennis     Wins      0
## 2      Matt   Tennis   Losses      1
## 3     Ellie    Rugby     Wins      3
## 4     Ellie    Rugby   Losses      2
## 5       Tim Football     Wins      1
## 6       Tim Football   Losses      4
## 7    Louise Swimming     Wins      2
## 8    Louise Swimming   Losses      2
## 9     Kelly  Running     Wins      5
## 10    Kelly  Running   Losses      1</code></pre>
<p>Task 1: In what ways is the untidy data not tidy? How could we make the untidy data tidy?</p>
<p>Tidy data is generally easier to work with than untidy data, especially if you are working with packages such as ggplot. Fortunately, packages are available to make untidy data tidy. Today we will explore a few of the functions available in the tidyr package which can be used to make untidy data tidy. If you are interested in finding out more about tidying data, we recommend reading “R for Data Science”, by Garrett Grolemund and Hadley Wickham. An electronic copy is available here: <a href="http://r4ds.had.co.nz/" class="uri">http://r4ds.had.co.nz/</a></p>
<p>The untidy data above is untidy because two variables (<code>Wins</code> and <code>Losses</code>) are stored in one column (<code>Category</code>). This is a common way in which data can be untidy. To tidy this data, we need to make <code>Wins</code> and <code>Losses</code> into columns, and store the values in <code>Counts</code> in these columns. Fortunately, there is a function from the tidyverse packages to perform this operation. The function is called <code>spread</code>, and it takes two arguments, <code>key</code> and <code>value</code>. You should pass the name of the column which contains multiple variables to <code>key</code>, and pass the name of the column which contains values from multiple variables to <code>value</code>. For example:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
sports&lt;-<span class="kw">data.frame</span>(<span class="dt">Students=</span><span class="kw">c</span>(<span class="st">&quot;Matt&quot;</span>, <span class="st">&quot;Matt&quot;</span>, <span class="st">&quot;Ellie&quot;</span>, <span class="st">&quot;Ellie&quot;</span>, <span class="st">&quot;Tim&quot;</span>, <span class="st">&quot;Tim&quot;</span>, <span class="st">&quot;Louise&quot;</span>, <span class="st">&quot;Louise&quot;</span>, <span class="st">&quot;Kelly&quot;</span>, <span class="st">&quot;Kelly&quot;</span>), <span class="dt">Sport=</span><span class="kw">c</span>(<span class="st">&quot;Tennis&quot;</span>,<span class="st">&quot;Tennis&quot;</span>, <span class="st">&quot;Rugby&quot;</span>, <span class="st">&quot;Rugby&quot;</span>,<span class="st">&quot;Football&quot;</span>, <span class="st">&quot;Football&quot;</span>,<span class="st">&quot;Swimming&quot;</span>,<span class="st">&quot;Swimming&quot;</span>, <span class="st">&quot;Running&quot;</span>, <span class="st">&quot;Running&quot;</span>), <span class="dt">Category=</span><span class="kw">c</span>(<span class="st">&quot;Wins&quot;</span>, <span class="st">&quot;Losses&quot;</span>, <span class="st">&quot;Wins&quot;</span>, <span class="st">&quot;Losses&quot;</span>, <span class="st">&quot;Wins&quot;</span>, <span class="st">&quot;Losses&quot;</span>, <span class="st">&quot;Wins&quot;</span>, <span class="st">&quot;Losses&quot;</span>, <span class="st">&quot;Wins&quot;</span>, <span class="st">&quot;Losses&quot;</span>), <span class="dt">Counts=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">1</span>))
sports</code></pre>
<pre><code>##    Students    Sport Category Counts
## 1      Matt   Tennis     Wins      0
## 2      Matt   Tennis   Losses      1
## 3     Ellie    Rugby     Wins      3
## 4     Ellie    Rugby   Losses      2
## 5       Tim Football     Wins      1
## 6       Tim Football   Losses      4
## 7    Louise Swimming     Wins      2
## 8    Louise Swimming   Losses      2
## 9     Kelly  Running     Wins      5
## 10    Kelly  Running   Losses      1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">spread</span>(sports, <span class="dt">key=</span>Category, <span class="dt">value=</span>Counts)</code></pre>
<pre><code>##   Students    Sport Losses Wins
## 1    Ellie    Rugby      2    3
## 2    Kelly  Running      1    5
## 3   Louise Swimming      2    2
## 4     Matt   Tennis      1    0
## 5      Tim Football      4    1</code></pre>
<p>Task 2: The dataframe <code>foods</code> defined below is untidy. Work out why and use <code>spread()</code> to tidy it</p>
<pre class="sourceCode r"><code class="sourceCode r">foods&lt;-<span class="kw">data.frame</span>(<span class="dt">student=</span><span class="kw">c</span>(<span class="st">&quot;Antoinette&quot;</span>,<span class="st">&quot;Antoinette&quot;</span>,<span class="st">&quot;Taylor&quot;</span>, <span class="st">&quot;Taylor&quot;</span>, <span class="st">&quot;Alexa&quot;</span>, <span class="st">&quot;Alexa&quot;</span>), <span class="dt">Category=</span><span class="kw">c</span>(<span class="st">&quot;Dinner&quot;</span>, <span class="st">&quot;Dessert&quot;</span>, <span class="st">&quot;Dinner&quot;</span>, <span class="st">&quot;Dessert&quot;</span>, <span class="st">&quot;Dinner&quot;</span>,<span class="st">&quot;Dessert&quot;</span>), <span class="dt">Frequency=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">1</span>))</code></pre>
<p>The other common way in which data can be untidy is if the columns are values instead of variables. For example, the dataframe below shows the percentages some students got in tests they did in May and June. The data is untidy because the columns <code>May</code> and <code>June</code> are values, not variables.</p>
<pre class="sourceCode r"><code class="sourceCode r">percentages&lt;-<span class="kw">data.frame</span>(<span class="dt">student=</span><span class="kw">c</span>(<span class="st">&quot;Alejandro&quot;</span>, <span class="st">&quot;Pietro&quot;</span>, <span class="st">&quot;Jane&quot;</span>), <span class="st">&quot;May&quot;</span>=<span class="kw">c</span>(<span class="dv">90</span>,<span class="dv">12</span>,<span class="dv">45</span>), <span class="st">&quot;June&quot;</span>=<span class="kw">c</span>(<span class="dv">80</span>,<span class="dv">30</span>,<span class="dv">100</span>))</code></pre>
<p>Fortunately, there is a function in the tidyverse packages to deal with this problem too. <code>gather()</code> takes the names of the columns which are values, the <code>key</code> and the <code>value</code> as arguments. This time, the <code>key</code> is the name of the variable with values as column names, and the <code>value</code> is the name of the variable with values spread over multiple columns. Ie:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">gather</span>(percentages, <span class="st">&quot;May&quot;</span>, <span class="st">&quot;June&quot;</span>, <span class="dt">key=</span><span class="st">&quot;Month&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;Percentage&quot;</span>)</code></pre>
<pre><code>##     student Month Percentage
## 1 Alejandro   May         90
## 2    Pietro   May         12
## 3      Jane   May         45
## 4 Alejandro  June         80
## 5    Pietro  June         30
## 6      Jane  June        100</code></pre>
<p>These examples don’t have much to do with single-cell RNA-seq analysis, but are designed to help illustrate the features of tidy and untidy data. You will find it much easier to analyse your single-cell RNA-seq data if your data is stored in a tidy format. Fortunately, the data structures we commonly use to facilitate single-cell RNA-seq analysis usually encourage store your data in a tidy manner.</p>
</div>
<div id="what-is-rich-data" class="section level3">
<h3><span class="header-section-number">5.6.2</span> What is Rich Data?</h3>
<p>If you google ‘rich data’, you will find lots of different definitions for this term. In this course, we will use ‘rich data’ to mean data which is generated by combining information from multiple sources. For example, you could make rich data by creating an object in R which contains a matrix of gene expression values across the cells in your single-cell RNA-seq experiment, but also information about how the experiment was performed. Objects of the <code>SingleCellExperiment</code> class, which we will discuss below, are an example of rich data.</p>
</div>
</div>
<div id="bioconductor-singlecellexperiment-and-scater" class="section level2">
<h2><span class="header-section-number">5.7</span> Bioconductor, <code>SingleCellExperiment</code> and <code>scater</code></h2>
<div id="bioconductor-1" class="section level3">
<h3><span class="header-section-number">5.7.1</span> Bioconductor</h3>
<p>From <a href="https://en.wikipedia.org/wiki/Bioconductor">Wikipedia</a>:
<a href="https://www.bioconductor.org/">Bioconductor</a> is a free, open source and open development software project for the analysis and comprehension of genomic data generated by wet lab experiments in molecular biology. Bioconductor is based primarily on the statistical R programming language, but does contain contributions in other programming languages. It has two releases each year that follow the semiannual releases of R. At any one time there is a release version, which corresponds to the released version of R, and a development version, which corresponds to the development version of R. Most users will find the release version appropriate for their needs.</p>
<p>We strongly recommend all new comers and even experienced high-throughput data analysts to use well developed and maintained <a href="https://www.bioconductor.org/developers/how-to/commonMethodsAndClasses/">Bioconductor methods and classes</a>.</p>
</div>
<div id="singlecellexperiment-class" class="section level3">
<h3><span class="header-section-number">5.7.2</span> <code>SingleCellExperiment</code> class</h3>
<p><a href="http://bioconductor.org/packages/SingleCellExperiment"><code>SingleCellExperiment</code></a> (SCE) is a S4 class for storing data from single-cell experiments. This includes specialized methods to store and retrieve spike-in information, dimensionality reduction coordinates and size factors for each cell, along with the usual metadata for genes and libraries.</p>
<p>In practice, an object of this class can be created using its constructor:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(SingleCellExperiment)
counts &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rpois</span>(<span class="dv">100</span>, <span class="dt">lambda =</span> <span class="dv">10</span>), <span class="dt">ncol=</span><span class="dv">10</span>, <span class="dt">nrow=</span><span class="dv">10</span>)
<span class="kw">rownames</span>(counts) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;gene&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)
<span class="kw">colnames</span>(counts) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;cell&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)
sce &lt;-<span class="st"> </span><span class="kw">SingleCellExperiment</span>(
    <span class="dt">assays =</span> <span class="kw">list</span>(<span class="dt">counts =</span> counts),
    <span class="dt">rowData =</span> <span class="kw">data.frame</span>(<span class="dt">gene_names =</span> <span class="kw">paste</span>(<span class="st">&quot;gene_name&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)),
    <span class="dt">colData =</span> <span class="kw">data.frame</span>(<span class="dt">cell_names =</span> <span class="kw">paste</span>(<span class="st">&quot;cell_name&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))
)
sce</code></pre>
<pre><code>## class: SingleCellExperiment 
## dim: 10 10 
## metadata(0):
## assays(1): counts
## rownames(10): gene1 gene2 ... gene9 gene10
## rowData names(1): gene_names
## colnames(10): cell1 cell2 ... cell9 cell10
## colData names(1): cell_names
## reducedDimNames(0):
## spikeNames(0):</code></pre>
<p>In the <code>SingleCellExperiment</code>, users can assign arbitrary names to entries of assays. To assist interoperability between packages, some suggestions for what the names should be for particular types of data are provided by the authors:</p>
<ul>
<li><strong>counts</strong>: Raw count data, e.g., number of reads or transcripts for a particular gene.</li>
<li><strong>normcounts</strong>: Normalized values on the same scale as the original counts. For example, counts divided by cell-specific size factors that are centred at unity.</li>
<li><strong>logcounts</strong>: Log-transformed counts or count-like values. In most cases, this will be defined as log-transformed normcounts, e.g., using log base 2 and a pseudo-count of 1.</li>
<li><strong>cpm</strong>: Counts-per-million. This is the read count for each gene in each cell, divided by the library size of each cell in millions.</li>
<li><strong>tpm</strong>: Transcripts-per-million. This is the number of transcripts for each gene in each cell, divided by the total number of transcripts in that cell (in millions).</li>
</ul>
<p>Each of these suggested names has an appropriate getter/setter method for convenient manipulation of the <code>SingleCellExperiment</code>. For example, we can take the (very specifically named) <code>counts</code> slot, normalise it and assign it to <code>normcounts</code> instead:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">normcounts</span>(sce) &lt;-<span class="st"> </span><span class="kw">log2</span>(<span class="kw">counts</span>(sce) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)
sce</code></pre>
<pre><code>## class: SingleCellExperiment 
## dim: 10 10 
## metadata(0):
## assays(2): counts normcounts
## rownames(10): gene1 gene2 ... gene9 gene10
## rowData names(1): gene_names
## colnames(10): cell1 cell2 ... cell9 cell10
## colData names(1): cell_names
## reducedDimNames(0):
## spikeNames(0):</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(<span class="kw">normcounts</span>(sce))</code></pre>
<pre><code>## [1] 10 10</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">normcounts</span>(sce))</code></pre>
<pre><code>##          cell1    cell2    cell3    cell4    cell5    cell6    cell7
## gene1 3.169925 3.169925 2.000000 2.584963 2.584963 3.321928 3.584963
## gene2 3.459432 1.584963 3.584963 3.807355 3.700440 3.700440 3.000000
## gene3 3.000000 3.169925 3.807355 3.169925 3.321928 3.321928 3.321928
## gene4 3.584963 3.459432 3.000000 3.807355 3.700440 3.700440 3.700440
## gene5 3.906891 3.000000 3.169925 3.321928 3.584963 3.459432 3.807355
## gene6 3.700440 3.700440 3.584963 4.000000 3.169925 3.000000 3.459432
##          cell8    cell9   cell10
## gene1 3.321928 3.807355 2.807355
## gene2 3.807355 3.700440 4.000000
## gene3 2.584963 4.000000 3.700440
## gene4 3.169925 3.584963 3.700440
## gene5 3.807355 2.584963 3.584963
## gene6 3.321928 3.459432 4.000000</code></pre>
</div>
<div id="scater-package" class="section level3">
<h3><span class="header-section-number">5.7.3</span> <code>scater</code> package</h3>
<p><a href="http://bioconductor.org/packages/scater/"><code>scater</code></a> is a R package for single-cell RNA-seq analysis <span class="citation">(McCarthy et al. <a href="#ref-McCarthy2017-kb">2017</a>)</span>. The package contains several useful methods for quality control, visualisation and pre-processing of data prior to further downstream analysis.</p>
<p><code>scater</code> features the following functionality:</p>
<ul>
<li>Automated computation of QC metrics</li>
<li>Transcript quantification from read data with pseudo-alignment</li>
<li>Data format standardisation</li>
<li>Rich visualizations for exploratory analysis</li>
<li>Seamless integration into the Bioconductor universe</li>
<li>Simple normalisation methods</li>
</ul>
<p>We highly recommend to use <code>scater</code> for all single-cell RNA-seq analyses and <code>scater</code> is the basis of the first part of the course.</p>
<p>As illustrated in the figure below, <code>scater</code> will help you with quality control, filtering and normalization of your expression matrix following mapping and alignment. <span style="color:red">Keep in mind that this figure represents the original version of <code>scater</code> where an <code>SCESet</code> class was used. In the newest version this figure is still correct, except that <code>SCESet</code> can be substituted with the <code>SingleCellExperiment</code> class.</span></p>
<p><img src="figures/scater_qc_workflow.png" /></p>
</div>
</div>
<div id="an-introduction-to-ggplot2" class="section level2">
<h2><span class="header-section-number">5.8</span> An Introduction to ggplot2</h2>
<div id="what-is-ggplot2" class="section level3">
<h3><span class="header-section-number">5.8.1</span> What is ggplot2?</h3>
<p>ggplot2 is an R package designed by Hadley Wickham which facilitates data plotting. In this lab, we will touch briefly on some of the features of the package. If you would like to learn more about how to use ggplot2, we would recommend reading “ggplot2 Elegant graphics for data analysis”, by Hadley Wickham.</p>
</div>
<div id="principles-of-ggplot2" class="section level3">
<h3><span class="header-section-number">5.8.2</span> Principles of ggplot2</h3>
<ul>
<li>Your data must be a dataframe if you want to plot it using ggplot2.</li>
<li>Use the <code>aes</code> mapping function to specify how variables in the dataframe map to features on your plot</li>
<li>Use geoms to specify how your data should be represented on your graph eg. as a scatterplot, a barplot, a boxplot etc.</li>
</ul>
</div>
<div id="using-the-aes-mapping-function" class="section level3">
<h3><span class="header-section-number">5.8.3</span> Using the <code>aes</code> mapping function</h3>
<p>The <code>aes</code> function specifies how variables in your dataframe map to features on your plot. To understand how this works, let’s look at an example:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(tidyverse)
<span class="kw">set.seed</span>(<span class="dv">1</span>)
counts &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">matrix</span>(<span class="kw">rpois</span>(<span class="dv">100</span>, <span class="dt">lambda =</span> <span class="dv">10</span>), <span class="dt">ncol=</span><span class="dv">10</span>, <span class="dt">nrow=</span><span class="dv">10</span>))
Gene_ids &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;gene&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)
<span class="kw">colnames</span>(counts) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;cell&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)
counts&lt;-<span class="kw">data.frame</span>(Gene_ids, counts)
counts</code></pre>
<pre><code>##    Gene_ids cell1 cell2 cell3 cell4 cell5 cell6 cell7 cell8 cell9 cell10
## 1     gene1     8     8     3     5     5     9    11     9    13      6
## 2     gene2    10     2    11    13    12    12     7    13    12     15
## 3     gene3     7     8    13     8     9     9     9     5    15     12
## 4     gene4    11    10     7    13    12    12    12     8    11     12
## 5     gene5    14     7     8     9    11    10    13    13     5     11
## 6     gene6    12    12    11    15     8     7    10     9    10     15
## 7     gene7    11    11    14    11    11     5     9    13    13      7
## 8     gene8     9    12     9     8     6    14     7    12    12     10
## 9     gene9    14    12    11     7    10    10     8    14     7     10
## 10   gene10    11    10     9     7    11    16     8     7     7      4</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> counts, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cell1, <span class="dt">y =</span> cell2))</code></pre>
<p><img src="05intro-R-Bioc_files/figure-html/unnamed-chunk-40-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>Let’s take a closer look at the final command, <code>ggplot(data = counts, mapping = aes(x = cell1, y = cell2))</code>. <code>ggplot()</code> initialises a ggplot object and takes the arguments <code>data</code> and <code>mapping</code>. We pass our dataframe of counts to <code>data</code> and use the <code>aes()</code> function to specify that we would like to use the variable cell1 as our x variable and the variable cell2 as our y variable.</p>
<p>Task 1: Modify the command above to initialise a ggplot object where cell10 is the x variable and cell8 is the y variable.</p>
<p>Clearly, the plots we have just created are not very informative because no data is displayed on them. To display data, we will need to use geoms.</p>
</div>
<div id="geoms" class="section level3">
<h3><span class="header-section-number">5.8.4</span> Geoms</h3>
<p>We can use geoms to specify how we would like data to be displayed on our graphs. For example, our choice of geom could specify that we would like our data to be displayed as a scatterplot, a barplot or a boxplot.</p>
<p>Let’s see how our graph would look as a scatterplot.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> counts, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cell1, <span class="dt">y =</span> cell2)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre>
<p><img src="05intro-R-Bioc_files/figure-html/unnamed-chunk-41-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>Now we can see that there doesn’t seem to be any correlation between gene expression in cell1 and cell2. Given we generated <code>counts</code> randomly, this isn’t too surprising.</p>
<p>Task 2: Modify the command above to create a line plot. Hint: execute <code>?ggplot</code> and scroll down the help page. At the bottom is a link to the ggplot package index. Scroll through the index until you find the geom options.</p>
</div>
<div id="plotting-data-from-more-than-2-cells" class="section level3">
<h3><span class="header-section-number">5.8.5</span> Plotting data from more than 2 cells</h3>
<p>So far we’ve been considering the gene counts from 2 of the cells in our dataframe. But there are actually 10 cells in our dataframe and it would be nice to compare all of them. What if we wanted to plot data from all 10 cells at the same time?</p>
<p>At the moment we can’t do this because we are treating each individual cell as a variable and assigning that variable to either the x or the y axis. We could create a 10 dimensional graph to plot data from all 10 cells on, but this is a) not possible to do with ggplot and b) not very easy to interpret. What we could do instead is to tidy our data so that we had one variable representing cell ID and another variable representing gene counts, and plot those against each other. In code, this would look like:</p>
<pre class="sourceCode r"><code class="sourceCode r">counts&lt;-<span class="kw">gather</span>(counts, <span class="kw">colnames</span>(counts)[<span class="dv">2</span><span class="op">:</span><span class="dv">11</span>], <span class="dt">key =</span> <span class="st">&#39;Cell_ID&#39;</span>, <span class="dt">value=</span><span class="st">&#39;Counts&#39;</span>)
<span class="kw">head</span>(counts)</code></pre>
<pre><code>##   Gene_ids Cell_ID Counts
## 1    gene1   cell1      8
## 2    gene2   cell1     10
## 3    gene3   cell1      7
## 4    gene4   cell1     11
## 5    gene5   cell1     14
## 6    gene6   cell1     12</code></pre>
<p>Essentially, the problem before was that our data was not tidy because one variable (Cell_ID) was spread over multiple columns. Now that we’ve fixed this problem, it is much easier for us to plot data from all 10 cells on one graph.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(counts,<span class="kw">aes</span>(<span class="dt">x=</span>Cell_ID, <span class="dt">y=</span>Counts)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</code></pre>
<p><img src="05intro-R-Bioc_files/figure-html/unnamed-chunk-43-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>Task 3: Use the updated <code>counts</code> dataframe to plot a barplot with Cell_ID as the x variable and Counts as the y variable. Hint: you may find it helpful to read <code>?geom_bar</code>.</p>
<p>Task 4: Use the updated <code>counts</code> dataframe to plot a scatterplot with Gene_ids as the x variable and Counts as the y variable.</p>
</div>
<div id="plotting-heatmaps" class="section level3">
<h3><span class="header-section-number">5.8.6</span> Plotting heatmaps</h3>
<p>A common method for visualising gene expression data is with a heatmap. Here we will use the R package <code>pheatmap</code> to perform this analysis with some gene expression data we will name <code>test</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(pheatmap)</code></pre>
<pre><code>## Warning: 程辑包&#39;pheatmap&#39;是用R版本3.5.2 来建造的</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">2</span>)
test =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">200</span>), <span class="dv">20</span>, <span class="dv">10</span>)
test[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">2</span>)] =<span class="st"> </span>test[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">2</span>)] <span class="op">+</span><span class="st"> </span><span class="dv">3</span>
test[<span class="dv">11</span><span class="op">:</span><span class="dv">20</span>, <span class="kw">seq</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">2</span>)] =<span class="st"> </span>test[<span class="dv">11</span><span class="op">:</span><span class="dv">20</span>, <span class="kw">seq</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">2</span>)] <span class="op">+</span><span class="st"> </span><span class="dv">2</span>
test[<span class="dv">15</span><span class="op">:</span><span class="dv">20</span>, <span class="kw">seq</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">2</span>)] =<span class="st"> </span>test[<span class="dv">15</span><span class="op">:</span><span class="dv">20</span>, <span class="kw">seq</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">2</span>)] <span class="op">+</span><span class="st"> </span><span class="dv">4</span>
<span class="kw">colnames</span>(test) =<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Cell&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)
<span class="kw">rownames</span>(test) =<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Gene&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)
<span class="kw">pheatmap</span>(test)</code></pre>
<p><img src="05intro-R-Bioc_files/figure-html/unnamed-chunk-44-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>Let’s take a moment to work out what this graphic is showing us. Each row represents a gene and each column represents a cell. How highly expressed each gene is in each cell is represented by the colour of the corresponding box. For example, we can tell from this plot that gene18 is highly expressed in cell10 but lowly expressed in cell1.</p>
<p>This plot also gives us information on the results of a clustering algorithm. In general, clustering algorithms aim to split datapoints (eg.cells) into groups whose members are more alike one another than they are alike the rest of the datapoints. The trees drawn on the top and left hand sides of the graph are the results of clustering algorithms and enable us to see, for example, that cells 4,8,2,6 and 10 are more alike one another than they are alike cells 7,3,5,1 and 9. The tree on the left hand side of the graph represents the results of a clustering algorithm applied to the genes in our dataset.</p>
<p>If we look closely at the trees, we can see that eventually they have the same number of branches as there are cells and genes. In other words, the total number of cell clusters is the same as the total number of cells, and the total number of gene clusters is the same as the total number of genes. Clearly, this is not very informative, and will become impractical when we are looking at more than 10 cells and 20 genes. Fortunately, we can set the number of clusters we see on the plot. Let’s try setting the number of gene clusters to 2:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pheatmap</span>(test, <span class="dt">kmeans_k =</span> <span class="dv">2</span>)</code></pre>
<p><img src="05intro-R-Bioc_files/figure-html/unnamed-chunk-45-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>Now we can see that the genes fall into two clusters - a cluster of 8 genes which are upregulated in cells 2, 10, 6, 4 and 8 relative to the other cells and a cluster of 12 genes which are downregulated in cells 2, 10, 6, 4 and 8 relative to the other cells.</p>
<p>Task 5: Try setting the number of clusters to 3. Which number of clusters do you think is more informative?</p>
</div>
<div id="principal-component-analysis" class="section level3">
<h3><span class="header-section-number">5.8.7</span> Principal Component Analysis</h3>
<p>Principal component analysis (PCA) is a statistical procedure that uses a transformation to convert a set of observations into a set of values of linearly uncorrelated variables called principal components. The transformation is carried out so that the first principle component accounts for as much of the variability in the data as possible, and each following principle component accounts for the greatest amount of variance possible under the contraint that it must be orthogonal to the previous components.</p>
<p>PCA plots are a good way to get an overview of your data, and can sometimes help identify confounders which explain a high amount of the variability in your data. We will investigate how we can use PCA plots in single-cell RNA-seq analysis in more depth in a future lab, here the aim is to give you an overview of what PCA plots are and how they are generated.</p>
<p>Let’s make a PCA plot for our <code>test</code> data. We can use the <code>ggfortify</code> package to let ggplot know how to interpret principle components.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggfortify)</code></pre>
<pre><code>## Warning: 程辑包&#39;ggfortify&#39;是用R版本3.5.3 来建造的</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">Principal_Components&lt;-<span class="kw">prcomp</span>(test)
<span class="kw">autoplot</span>(Principal_Components, <span class="dt">label=</span><span class="ot">TRUE</span>)</code></pre>
<p><img src="05intro-R-Bioc_files/figure-html/unnamed-chunk-46-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>Task 6: Compare your clusters to the pheatmap clusters. Are they related? (Hint: have a look at the gene tree for the first pheatmap we plotted)</p>
<p>Task 7: Produce a heatmap and PCA plot for <code>counts</code> (below):</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1</span>)
counts &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">matrix</span>(<span class="kw">rpois</span>(<span class="dv">100</span>, <span class="dt">lambda =</span> <span class="dv">10</span>), <span class="dt">ncol=</span><span class="dv">10</span>, <span class="dt">nrow=</span><span class="dv">10</span>))
<span class="kw">rownames</span>(counts) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;gene&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)
<span class="kw">colnames</span>(counts) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;cell&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</code></pre>

</div>
</div>
</div>
<h3> References</h3>
<div id="refs" class="references">
<div id="ref-McCarthy2017-kb">
<p>McCarthy, Davis J., Kieran R. Campbell, Aaron T. L. Lun, and Quin F. Wills. 2017. “Scater: Pre-processing, Quality Control, Normalization and Visualization of Single-Cell RNA-Seq Data in R.” <em>Bioinformatics</em>, January, btw777. <a href="https://doi.org/10.1093/bioinformatics/btw777">https://doi.org/10.1093/bioinformatics/btw777</a>.</p>
</div>
<div id="ref-wickham_2014">
<p>Wickham, Hadley. 2014. “Tidy Data.” <em>J Stat Softw</em> 59 (10). <a href="https://doi.org/10.18637/jss.v059.i10">https://doi.org/10.18637/jss.v059.i10</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="construction-of-expression-matrix.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tabula-muris.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": true,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/lemonbases/scRNA.seq.course.CN/edit/master/05intro-R-Bioc.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["scRNA-seq-course.pdf"],
"toc": {
"collapse": "section"
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
