

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>snakemake.jobs &mdash; Snakemake 5.6.0+8.g89bc383.dirty documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sphinx-argparse.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Snakemake
          

          
          </a>

          
            
            
              <div class="version">
                5.6.0+8.g89bc383.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/installation.html">安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/tutorial.html">Snakemake Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/short.html">Short tutorial</a></li>
</ul>
<p class="caption"><span class="caption-text">Executing workflows</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../executable.html">Executing Snakemake</a></li>
</ul>
<p class="caption"><span class="caption-text">Defining workflows</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../snakefiles/writing_snakefiles.html">Writing Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snakefiles/rules.html">Rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snakefiles/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snakefiles/modularization.html">Modularization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snakefiles/remote_files.html">Remote files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snakefiles/utils.html">Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snakefiles/deployment.html">Distribution and Reproducibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snakefiles/reporting.html">Reports</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api_reference/snakemake.html">The Snakemake API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_reference/snakemake_utils.html">Additional utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_reference/internal/modules.html">Internal API</a></li>
</ul>
<p class="caption"><span class="caption-text">Project Info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../project_info/citations.html">Citing and Citations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project_info/more_resources.html">More Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project_info/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project_info/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project_info/authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project_info/history.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project_info/license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Snakemake</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../snakemake.html">snakemake</a> &raquo;</li>
        
      <li>snakemake.jobs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for snakemake.jobs</h1><div class="highlight"><pre>
<span></span><span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Johannes Köster&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright 2015, Johannes Köster&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s2">&quot;koester@jimmy.harvard.edu&quot;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;MIT&quot;</span>

<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">chain</span><span class="p">,</span> <span class="n">filterfalse</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="k">import</span> <span class="n">attrgetter</span>
<span class="kn">from</span> <span class="nn">urllib.request</span> <span class="k">import</span> <span class="n">urlopen</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="k">import</span> <span class="n">urlparse</span>

<span class="kn">from</span> <span class="nn">snakemake.io</span> <span class="k">import</span> <span class="n">IOFile</span><span class="p">,</span> <span class="n">Wildcards</span><span class="p">,</span> <span class="n">Resources</span><span class="p">,</span> <span class="n">_IOFile</span><span class="p">,</span> <span class="n">is_flagged</span><span class="p">,</span> <span class="n">get_flag_value</span><span class="p">,</span> <span class="n">contains_wildcard</span><span class="p">,</span> <span class="n">lstat</span>
<span class="kn">from</span> <span class="nn">snakemake.utils</span> <span class="k">import</span> <span class="nb">format</span><span class="p">,</span> <span class="n">listfiles</span>
<span class="kn">from</span> <span class="nn">snakemake.exceptions</span> <span class="k">import</span> <span class="n">RuleException</span><span class="p">,</span> <span class="n">ProtectedOutputException</span><span class="p">,</span> <span class="n">WorkflowError</span>
<span class="kn">from</span> <span class="nn">snakemake.exceptions</span> <span class="k">import</span> <span class="n">UnexpectedOutputException</span><span class="p">,</span> <span class="n">CreateCondaEnvironmentException</span>
<span class="kn">from</span> <span class="nn">snakemake.logging</span> <span class="k">import</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">snakemake.common</span> <span class="k">import</span> <span class="n">DYNAMIC_FILL</span><span class="p">,</span> <span class="n">lazy_property</span><span class="p">,</span> <span class="n">get_uuid</span>
<span class="kn">from</span> <span class="nn">snakemake</span> <span class="k">import</span> <span class="n">conda</span><span class="p">,</span> <span class="n">wrapper</span>


<div class="viewcode-block" id="format_files"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.format_files">[docs]</a><span class="k">def</span> <span class="nf">format_files</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">io</span><span class="p">,</span> <span class="n">dynamicio</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">io</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">dynamicio</span><span class="p">:</span>
            <span class="k">yield</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> (dynamic)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">format_dynamic</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">is_flagged</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;pipe&quot;</span><span class="p">):</span>
            <span class="k">yield</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> (pipe)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">is_flagged</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;checkpoint_target&quot;</span><span class="p">):</span>
            <span class="k">yield</span> <span class="s2">&quot;&lt;TBD&gt;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">f</span></div>


<div class="viewcode-block" id="jobfiles"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.jobfiles">[docs]</a><span class="k">def</span> <span class="nf">jobfiles</span><span class="p">(</span><span class="n">jobs</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="n">attrgetter</span><span class="p">(</span><span class="nb">type</span><span class="p">),</span> <span class="n">jobs</span><span class="p">))</span></div>


<div class="viewcode-block" id="AbstractJob"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.AbstractJob">[docs]</a><span class="k">class</span> <span class="nc">AbstractJob</span><span class="p">:</span>
<div class="viewcode-block" id="AbstractJob.is_group"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.AbstractJob.is_group">[docs]</a>    <span class="k">def</span> <span class="nf">is_group</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="AbstractJob.log_info"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.AbstractJob.log_info">[docs]</a>    <span class="k">def</span> <span class="nf">log_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skip_dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="AbstractJob.log_error"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.AbstractJob.log_error">[docs]</a>    <span class="k">def</span> <span class="nf">log_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="AbstractJob.remove_existing_output"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.AbstractJob.remove_existing_output">[docs]</a>    <span class="k">def</span> <span class="nf">remove_existing_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="AbstractJob.download_remote_input"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.AbstractJob.download_remote_input">[docs]</a>    <span class="k">def</span> <span class="nf">download_remote_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="AbstractJob.properties"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.AbstractJob.properties">[docs]</a>    <span class="k">def</span> <span class="nf">properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">omit_resources</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;_cores&quot;</span><span class="p">,</span> <span class="s2">&quot;_nodes&quot;</span><span class="p">],</span>
                   <span class="o">**</span><span class="n">aux_properties</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="Job"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job">[docs]</a><span class="k">class</span> <span class="nc">Job</span><span class="p">(</span><span class="n">AbstractJob</span><span class="p">):</span>
    <span class="n">HIGHEST_PRIORITY</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rule&quot;</span><span class="p">,</span> <span class="s2">&quot;dag&quot;</span><span class="p">,</span> <span class="s2">&quot;wildcards_dict&quot;</span><span class="p">,</span> <span class="s2">&quot;wildcards&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;_format_wildcards&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;dependencies&quot;</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;_params&quot;</span><span class="p">,</span> <span class="s2">&quot;_log&quot;</span><span class="p">,</span> <span class="s2">&quot;_benchmark&quot;</span><span class="p">,</span> <span class="s2">&quot;_resources&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;_conda_env_file&quot;</span><span class="p">,</span> <span class="s2">&quot;_conda_env&quot;</span><span class="p">,</span> <span class="s2">&quot;shadow_dir&quot;</span><span class="p">,</span> <span class="s2">&quot;_inputsize&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;dynamic_output&quot;</span><span class="p">,</span> <span class="s2">&quot;dynamic_input&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;temp_output&quot;</span><span class="p">,</span> <span class="s2">&quot;protected_output&quot;</span><span class="p">,</span> <span class="s2">&quot;touch_output&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;subworkflow_input&quot;</span><span class="p">,</span> <span class="s2">&quot;_hash&quot;</span><span class="p">,</span> <span class="s2">&quot;_attempt&quot;</span><span class="p">,</span> <span class="s2">&quot;_group&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;targetfile&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">dag</span><span class="p">,</span>
                 <span class="n">wildcards_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">format_wildcards</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">targetfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rule</span> <span class="o">=</span> <span class="n">rule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dag</span> <span class="o">=</span> <span class="n">dag</span>

        <span class="c1"># the targetfile that led to the job</span>
        <span class="c1"># it is important to record this, since we need it to submit the</span>
        <span class="c1"># job on a cluster. In contrast, an arbitrary targetfile could</span>
        <span class="c1"># lead to a different composition of wildcard values (in case of</span>
        <span class="c1"># ambiguity in matching).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targetfile</span> <span class="o">=</span> <span class="n">targetfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wildcards_dict</span> <span class="o">=</span> <span class="n">wildcards_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wildcards</span> <span class="o">=</span> <span class="n">Wildcards</span><span class="p">(</span><span class="n">fromdict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wildcards_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_format_wildcards</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wildcards</span> <span class="k">if</span> <span class="n">format_wildcards</span> <span class="ow">is</span> <span class="kc">None</span>
                                  <span class="k">else</span> <span class="n">Wildcards</span><span class="p">(</span><span class="n">fromdict</span><span class="o">=</span><span class="n">format_wildcards</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="n">input_mapping</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">expand_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wildcards_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">output_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">expand_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wildcards_dict</span><span class="p">)</span>
        <span class="c1"># other properties are lazy to be able to use additional parameters and check already existing files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_benchmark</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resources</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_conda_env_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_conda_env</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_group</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shadow_dir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inputsize</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_updated</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_attempt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">attempt</span>

        <span class="c1"># TODO get rid of these</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_input</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(),</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protected_output</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(),</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">touch_output</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subworkflow_input</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
            <span class="n">f_</span> <span class="o">=</span> <span class="n">output_mapping</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">f_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">dynamic_output</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_output</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">f_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">temp_output</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">temp_output</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">f_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">protected_output</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">protected_output</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">f_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">touch_output</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">touch_output</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">:</span>
            <span class="n">f_</span> <span class="o">=</span> <span class="n">input_mapping</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">f_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">dynamic_input</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_input</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">f_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">subworkflow_input</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">subworkflow_input</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">subworkflow_input</span><span class="p">[</span><span class="n">f_</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s2">&quot;subworkflow&quot;</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">flags</span><span class="p">:</span>
                <span class="n">sub</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">flags</span><span class="p">[</span><span class="s2">&quot;subworkflow&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subworkflow_input</span><span class="p">:</span>
                    <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subworkflow_input</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">sub</span> <span class="o">!=</span> <span class="n">other</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">WorkflowError</span><span class="p">(</span><span class="s2">&quot;The input file </span><span class="si">{}</span><span class="s2"> is ambiguously &quot;</span>
                                            <span class="s2">&quot;associated with two subworkflows </span><span class="si">{}</span><span class="s2"> &quot;</span>
                                            <span class="s2">&quot;and </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">other</span><span class="p">),</span>
                                            <span class="n">rule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">subworkflow_input</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="fm">__hash__</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">wildcard_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wildcards_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span> <span class="o">^=</span> <span class="n">wildcard_value</span><span class="o">.</span><span class="fm">__hash__</span><span class="p">()</span>

<div class="viewcode-block" id="Job.updated"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job.updated">[docs]</a>    <span class="k">def</span> <span class="nf">updated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">job</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="p">,</span>
                  <span class="n">wildcards_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wildcards_dict</span><span class="p">,</span>
                  <span class="n">targetfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">targetfile</span><span class="p">)</span>
        <span class="n">job</span><span class="o">.</span><span class="n">is_updated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">job</span></div>

<div class="viewcode-block" id="Job.is_valid"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job.is_valid">[docs]</a>    <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if job is valid&quot;&quot;&quot;</span>
        <span class="c1"># these properties have to work in dry-run as well. Hence we check them here:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">expand_benchmark</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wildcards_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">expand_log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wildcards_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="Job.outputs_older_than_script"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job.outputs_older_than_script">[docs]</a>    <span class="k">def</span> <span class="nf">outputs_older_than_script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return output that&#39;s older than script, i.e. script has changed&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_script</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">script</span><span class="p">)</span><span class="c1"># to make sure lstat works</span>
        <span class="n">script_mtime</span> <span class="o">=</span> <span class="n">lstat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">script</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">expanded_output</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">is_newer</span><span class="p">(</span><span class="n">script_mtime</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">f</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threads</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">_cores</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">expand_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wildcards_dict</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">expand_log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wildcards_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">benchmark</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_benchmark</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_benchmark</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">expand_benchmark</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wildcards_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_benchmark</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">benchmark_repeats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_flag_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span><span class="p">,</span> <span class="s2">&quot;repeat&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">1</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">group</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">expand_group</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wildcards_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group</span>

    <span class="nd">@group</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_group</span> <span class="o">=</span> <span class="n">group</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">attempt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attempt</span>

    <span class="nd">@attempt</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">attempt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attempt</span><span class="p">):</span>
        <span class="c1"># reset resources</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resources</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attempt</span> <span class="o">=</span> <span class="n">attempt</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">resources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resources</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">expand_resources</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wildcards_dict</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">attempt</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resources</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">conda_env_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conda_env_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">expanded_env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">expand_conda_env</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wildcards_dict</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">expanded_env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">scheme</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">expanded_env</span><span class="p">)</span>
                <span class="c1"># Normalize &#39;file:///my/path.yml&#39; to &#39;/my/path.yml&#39;</span>
                <span class="k">if</span> <span class="n">scheme</span> <span class="o">==</span> <span class="s1">&#39;file&#39;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">scheme</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_conda_env_file</span> <span class="o">=</span> <span class="n">path</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_conda_env_file</span> <span class="o">=</span> <span class="n">expanded_env</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conda_env_file</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">conda_env</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conda_env_file</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conda_env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_conda_env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">conda_envs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conda_env_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">singularity_img_url</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conda_env</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">conda_env_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">conda_env</span><span class="o">.</span><span class="n">path</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conda_env</span> <span class="k">else</span> <span class="kc">None</span>

<div class="viewcode-block" id="Job.archive_conda_env"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job.archive_conda_env">[docs]</a>    <span class="k">def</span> <span class="nf">archive_conda_env</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Archive a conda environment into a custom local channel.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conda_env_file</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">conda_env</span><span class="o">.</span><span class="n">create_archive</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">needs_singularity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">singularity_img</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">singularity_img_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">singularity_img</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">singularity_img</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">singularity_img_url</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">singularity_imgs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">singularity_img_url</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">singularity_img_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">singularity_img</span><span class="o">.</span><span class="n">path</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">singularity_img</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_shadow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">shadow_depth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">priority</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">priority</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">b64id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
            <span class="s2">&quot;utf-8&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">inputsize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the size of the input files.</span>
<span class="sd">        Input files need to be present.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inputsize</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputsize</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the message for this job. &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_wildcards</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">message</span><span class="p">)</span> <span class="k">if</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">message</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RuleException</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">),</span> <span class="n">rule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RuleException</span><span class="p">(</span><span class="s2">&quot;Unknown variable in message &quot;</span>
                                <span class="s2">&quot;of shell command: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)),</span>
                                <span class="n">rule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shellcmd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the shell command. &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_wildcards</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">shellcmd</span><span class="p">)</span> <span class="k">if</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">shellcmd</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RuleException</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">),</span> <span class="n">rule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RuleException</span><span class="p">(</span><span class="s2">&quot;Unknown variable when printing &quot;</span>
                                <span class="s2">&quot;shell command: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)),</span>
                                <span class="n">rule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_shell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">shellcmd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_norun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">norun</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">script</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">wrapper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_cwl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">cwl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_shell</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_norun</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_script</span> <span class="ow">or</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">is_wrapper</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_cwl</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">expanded_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterate over output files while dynamic output is expanded. &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">f_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">output</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_output</span><span class="p">:</span>
                <span class="n">expansion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_dynamic</span><span class="p">(</span><span class="n">f_</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">expansion</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">f_</span>
                <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">expansion</span><span class="p">:</span>
                    <span class="n">file_to_yield</span> <span class="o">=</span> <span class="n">IOFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="p">)</span>
                    <span class="n">file_to_yield</span><span class="o">.</span><span class="n">clone_flags</span><span class="p">(</span><span class="n">f_</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="n">file_to_yield</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">f</span>

<div class="viewcode-block" id="Job.shadowed_path"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job.shadowed_path">[docs]</a>    <span class="k">def</span> <span class="nf">shadowed_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the shadowed path of IOFile f. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">shadow_dir</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span>
        <span class="n">f_</span> <span class="o">=</span> <span class="n">IOFile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shadow_dir</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">f_</span><span class="o">.</span><span class="n">clone_flags</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f_</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dynamic_wildcards</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return all wildcard values determined from dynamic output. &quot;&quot;&quot;</span>
        <span class="n">combinations</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">f_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">output</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_output</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_dynamic</span><span class="p">(</span><span class="n">f_</span><span class="p">):</span>
                    <span class="n">combinations</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
        <span class="n">wildcards</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">combination</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">combination</span><span class="p">:</span>
                <span class="n">wildcards</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wildcards</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">missing_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return missing input files. &quot;&quot;&quot;</span>
        <span class="c1"># omit file if it comes from a subworkflow</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">f</span>
                   <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span>
                   <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">exists</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subworkflow_input</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">existing_remote_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_remote</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">exists_remote</span><span class="p">:</span>
                    <span class="n">files</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">files</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">existing_remote_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_output</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">exists_remote</span><span class="p">:</span>
                <span class="n">files</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">files</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">missing_remote_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_input</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">existing_remote_input</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">missing_remote_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_output</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">existing_remote_output</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">output_mintime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return oldest output file. &quot;&quot;&quot;</span>
        <span class="n">existing</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">mtime</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">expanded_output</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">exists</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
            <span class="n">existing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span><span class="o">.</span><span class="n">mtime</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">existing</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">existing</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">output_mintime_local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">existing</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">mtime_local</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">expanded_output</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">exists</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
            <span class="n">existing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span><span class="o">.</span><span class="n">mtime_local</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">existing</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">existing</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">input_maxtime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return newest input file. &quot;&quot;&quot;</span>
        <span class="n">existing</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">mtime</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">exists</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">existing</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">existing</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="Job.missing_output"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job.missing_output">[docs]</a>    <span class="k">def</span> <span class="nf">missing_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">requested</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return missing output files. &quot;&quot;&quot;</span>
        <span class="n">files</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span> <span class="ow">and</span> <span class="p">(</span><span class="n">requested</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span> <span class="ow">in</span> <span class="n">requested</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
                <span class="n">files</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">f_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">output</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">requested</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">requested</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_output</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_dynamic</span><span class="p">(</span><span class="n">f_</span><span class="p">):</span>
                        <span class="n">files</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> (dynamic)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f_</span><span class="p">))</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
                    <span class="n">files</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">requested</span> <span class="ow">and</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">requested</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
                <span class="n">files</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">files</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">local_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">is_remote</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">f</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">unique_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">filterfalse</span><span class="p">(</span><span class="n">seen</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">):</span>
            <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">element</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">local_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">is_remote</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">f</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">remote_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_remote</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">f</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">remote_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_remote</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">f</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">remote_input_newer_than_local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_input</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">exists_remote</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">exists_local</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">mtime</span> <span class="o">&gt;</span> <span class="n">f</span><span class="o">.</span><span class="n">mtime_local</span><span class="p">):</span>
                <span class="n">files</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">files</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">remote_input_older_than_local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_input</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">exists_remote</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">exists_local</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">mtime</span> <span class="o">&lt;</span> <span class="n">f</span><span class="o">.</span><span class="n">mtime_local</span><span class="p">):</span>
                <span class="n">files</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">files</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">remote_output_newer_than_local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_output</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">exists_remote</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">exists_local</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">mtime</span> <span class="o">&gt;</span> <span class="n">f</span><span class="o">.</span><span class="n">mtime_local</span><span class="p">):</span>
                <span class="n">files</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">files</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">remote_output_older_than_local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_output</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">exists_remote</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">exists_local</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">mtime</span> <span class="o">&lt;</span> <span class="n">f</span><span class="o">.</span><span class="n">mtime_local</span><span class="p">):</span>
                <span class="n">files</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">files</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">files_to_download</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">toDownload</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_remote</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">exists_local</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">exists_remote</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">norun</span> <span class="ow">or</span> <span class="n">f</span><span class="o">.</span><span class="n">remote_object</span><span class="o">.</span><span class="n">keep_local</span><span class="p">):</span>
                    <span class="n">toDownload</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="n">toDownload</span> <span class="o">=</span> <span class="n">toDownload</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_input_newer_than_local</span>
        <span class="k">return</span> <span class="n">toDownload</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">files_to_upload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_remote_input</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_input_older_than_local</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">existing_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">exists</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expanded_output</span><span class="p">)</span>

<div class="viewcode-block" id="Job.check_protected_output"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job.check_protected_output">[docs]</a>    <span class="k">def</span> <span class="nf">check_protected_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">protected</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">protected</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expanded_output</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">protected</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ProtectedOutputException</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="p">,</span> <span class="n">protected</span><span class="p">)</span></div>

<div class="viewcode-block" id="Job.remove_existing_output"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job.remove_existing_output">[docs]</a>    <span class="k">def</span> <span class="nf">remove_existing_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clean up both dynamic and regular output before rules actually run</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_output</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expand_dynamic</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">dynamic_output</span><span class="p">)):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">f_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">output</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># remove_non_empty_dir only applies to directories which aren&#39;t</span>
                <span class="c1"># flagged with directory().</span>
                <span class="n">f</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">remove_non_empty_dir</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                <span class="c1">#No file == no problem</span>
                <span class="k">pass</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">remove_non_empty_dir</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="Job.download_remote_input"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job.download_remote_input">[docs]</a>    <span class="k">def</span> <span class="nf">download_remote_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files_to_download</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">download_from_remote</span><span class="p">()</span></div>

<div class="viewcode-block" id="Job.prepare"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job.prepare">[docs]</a>    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare execution of job.</span>
<span class="sd">        This includes creation of directories and deletion of previously</span>
<span class="sd">        created dynamic files.</span>
<span class="sd">        Creates a shadow directory for the job if specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_protected_output</span><span class="p">()</span>

        <span class="n">unexpected_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">reason</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">missing_output</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">existing_output</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unexpected_output</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Warning: the following output files of rule </span><span class="si">{}</span><span class="s2"> were not &quot;</span>
                <span class="s2">&quot;present when the DAG was created:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="p">,</span> <span class="n">unexpected_output</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">remove_existing_output</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">f_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">output</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">prepare</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">download_remote_input</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">prepare</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span><span class="o">.</span><span class="n">prepare</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_shadow</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Create shadow directory structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shadow_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span>
            <span class="nb">dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">persistence</span><span class="o">.</span><span class="n">shadow_path</span><span class="p">)</span>
        <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">shadow_depth</span> <span class="o">==</span> <span class="s2">&quot;minimal&quot;</span><span class="p">:</span>
            <span class="c1"># Re-create the directory structure in the shadow directory</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">([(</span><span class="n">item</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">item</span><span class="p">))</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">]</span> <span class="k">if</span> <span class="n">sublist</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">d</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                    <span class="n">rel_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                    <span class="c1"># Only create subdirectories</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">rel_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;..&quot;</span><span class="p">:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shadow_dir</span><span class="p">,</span> <span class="n">rel_path</span><span class="p">),</span> <span class="n">exist_ok</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">RuleException</span><span class="p">(</span><span class="s2">&quot;The following file name references a parent directory relative to your workdir.</span><span class="se">\n</span><span class="s2">&quot;</span>
                                            <span class="s2">&quot;This isn&#39;t supported for shadow: </span><span class="se">\&quot;</span><span class="s2">minimal</span><span class="se">\&quot;</span><span class="s2">. Consider using an absolute path instead.</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">),</span><span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="p">)</span>

            <span class="c1"># Symlink the input files</span>
            <span class="k">for</span> <span class="n">rel_path</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">f</span><span class="p">)]):</span>
                <span class="n">link</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shadow_dir</span><span class="p">,</span> <span class="n">rel_path</span><span class="p">)</span>
                <span class="n">original</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">rel_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">link</span><span class="p">))</span>
                <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span>

        <span class="c1"># Shallow simply symlink everything in the working directory.</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">shadow_depth</span> <span class="o">==</span> <span class="s2">&quot;shallow&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">):</span>
                <span class="n">link</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shadow_dir</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">source</span><span class="p">),</span> <span class="n">link</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">shadow_depth</span> <span class="o">==</span> <span class="s2">&quot;full&quot;</span><span class="p">:</span>
            <span class="n">snakemake_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="s2">&quot;.snakemake&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">cwd</span><span class="p">):</span>
                <span class="c1"># Must exclude .snakemake and its children to avoid infinite</span>
                <span class="c1"># loop of symlinks.</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">commonprefix</span><span class="p">([</span><span class="n">snakemake_dir</span><span class="p">,</span> <span class="n">dirpath</span>
                                         <span class="p">])</span> <span class="o">==</span> <span class="n">snakemake_dir</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">for</span> <span class="n">dirname</span> <span class="ow">in</span> <span class="n">dirnames</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">dirname</span> <span class="o">==</span> <span class="s2">&quot;.snakemake&quot;</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">relative_source</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span>
                                                                   <span class="n">dirname</span><span class="p">))</span>
                    <span class="n">shadow</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shadow_dir</span><span class="p">,</span> <span class="n">relative_source</span><span class="p">)</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">shadow</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
                    <span class="n">source</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                    <span class="n">relative_source</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
                    <span class="n">link</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shadow_dir</span><span class="p">,</span> <span class="n">relative_source</span><span class="p">)</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span></div>

<div class="viewcode-block" id="Job.close_remote"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job.close_remote">[docs]</a>    <span class="k">def</span> <span class="nf">close_remote</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_remote</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">remote_object</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="Job.cleanup"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job.cleanup">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Cleanup output files. &quot;&quot;&quot;</span>
        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">expanded_output</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">exists</span><span class="p">]</span>

        <span class="n">to_remove</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_input</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">exists_local</span><span class="p">])</span>
        <span class="n">to_remove</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
            <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_output</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">exists_remote</span> <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_remote</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">should_stay_on_remote</span><span class="p">)</span> <span class="k">else</span> <span class="n">f</span><span class="o">.</span><span class="n">exists_local</span><span class="p">)</span>
        <span class="p">])</span>
        <span class="k">if</span> <span class="n">to_remove</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Removing output files of failed job </span><span class="si">{}</span><span class="s2">&quot;</span>
                        <span class="s2">&quot; since they might be corrupted:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">to_remove</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">rmdir_empty_remote_dirs</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">empty_remote_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_remote</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">should_stay_on_remote</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">f</span><span class="p">))):</span>
                    <span class="k">yield</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<div class="viewcode-block" id="Job.rmdir_empty_remote_dirs"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job.rmdir_empty_remote_dirs">[docs]</a>    <span class="k">def</span> <span class="nf">rmdir_empty_remote_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_remote_dirs</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">removedirs</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c1"># it&#39;s ok if we can&#39;t remove the leaf</span></div>

<div class="viewcode-block" id="Job.format_wildcards"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job.format_wildcards">[docs]</a>    <span class="k">def</span> <span class="nf">format_wildcards</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">variables</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Format a string with variables from the job. &quot;&quot;&quot;</span>
        <span class="n">_variables</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">_variables</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">globals</span><span class="p">)</span>
        <span class="n">_variables</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">,</span>
                               <span class="n">output</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">,</span>
                               <span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
                               <span class="n">wildcards</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_wildcards</span><span class="p">,</span>
                               <span class="n">threads</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">threads</span><span class="p">,</span>
                               <span class="n">resources</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">,</span>
                               <span class="n">log</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
                               <span class="n">jobid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">jobid</span><span class="p">,</span>
                               <span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
                               <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                               <span class="n">rule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                               <span class="n">rulename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                               <span class="n">bench_iteration</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
        <span class="n">_variables</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">format</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">_variables</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NameError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RuleException</span><span class="p">(</span><span class="s2">&quot;NameError: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">),</span> <span class="n">rule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RuleException</span><span class="p">(</span><span class="s2">&quot;IndexError: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">),</span> <span class="n">rule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="p">)</span></div>

<div class="viewcode-block" id="Job.properties"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job.properties">[docs]</a>    <span class="k">def</span> <span class="nf">properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">omit_resources</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;_cores&quot;</span><span class="p">,</span> <span class="s2">&quot;_nodes&quot;</span><span class="p">],</span>
                   <span class="o">**</span><span class="n">aux_properties</span><span class="p">):</span>
        <span class="n">resources</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">name</span><span class="p">:</span> <span class="n">res</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">omit_resources</span>
        <span class="p">}</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;single&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rule&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;local&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_local</span><span class="p">,</span>
            <span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">,</span>
            <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">,</span>
            <span class="s2">&quot;wildcards&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">wildcards_dict</span><span class="p">,</span>
            <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">,</span>
            <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
            <span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">threads</span><span class="p">,</span>
            <span class="s2">&quot;resources&quot;</span><span class="p">:</span> <span class="n">resources</span><span class="p">,</span>
            <span class="s2">&quot;jobid&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">jobid</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">aux_properties</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">is_local</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">rule</span> <span class="ow">and</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wildcards_dict</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">wildcards_dict</span><span class="p">)</span> <span class="ow">and</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">input</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="fm">__lt__</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">rule</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="fm">__gt__</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">rule</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span>

<div class="viewcode-block" id="Job.expand_dynamic"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job.expand_dynamic">[docs]</a>    <span class="k">def</span> <span class="nf">expand_dynamic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Expand dynamic files. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">listfiles</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span>
                              <span class="n">restriction</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wildcards</span><span class="p">,</span>
                              <span class="n">omit_value</span><span class="o">=</span><span class="n">DYNAMIC_FILL</span><span class="p">))</span></div>

<div class="viewcode-block" id="Job.is_group"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job.is_group">[docs]</a>    <span class="k">def</span> <span class="nf">is_group</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Job.log_info"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job.log_info">[docs]</a>    <span class="k">def</span> <span class="nf">log_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skip_dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">printshellcmd</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># skip dynamic jobs that will be &quot;executed&quot; only in dryrun mode</span>
        <span class="k">if</span> <span class="n">skip_dynamic</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">dynamic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">priority</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">priority</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">job_info</span><span class="p">(</span><span class="n">jobid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">jobid</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                        <span class="n">msg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">local</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">is_local</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="p">),</span>
                        <span class="nb">input</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">format_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_input</span><span class="p">)),</span>
                        <span class="n">output</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">format_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">,</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_output</span><span class="p">)),</span>
                        <span class="n">log</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">),</span>
                        <span class="n">benchmark</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span><span class="p">,</span>
                        <span class="n">wildcards</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wildcards_dict</span><span class="p">,</span>
                        <span class="n">reason</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">reason</span><span class="p">(</span><span class="bp">self</span><span class="p">)),</span>
                        <span class="n">resources</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">,</span>
                        <span class="n">priority</span><span class="o">=</span><span class="s2">&quot;highest&quot;</span>
                        <span class="k">if</span> <span class="n">priority</span> <span class="o">==</span> <span class="n">Job</span><span class="o">.</span><span class="n">HIGHEST_PRIORITY</span> <span class="k">else</span> <span class="n">priority</span><span class="p">,</span>
                        <span class="n">threads</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">threads</span><span class="p">,</span>
                        <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">,</span>
                        <span class="n">is_checkpoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">is_checkpoint</span><span class="p">,</span>
                        <span class="n">printshellcmd</span><span class="o">=</span><span class="n">printshellcmd</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">shellcmd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shellcmd</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_output</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Subsequent jobs will be added dynamically &quot;</span>
                        <span class="s2">&quot;depending on the output of this job&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Job.log_error"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job.log_error">[docs]</a>    <span class="k">def</span> <span class="nf">log_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">job_error</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                         <span class="n">jobid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">jobid</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                         <span class="n">output</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">format_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_output</span><span class="p">)),</span>
                         <span class="n">log</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">),</span>
                         <span class="n">conda_env</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conda_env</span><span class="o">.</span><span class="n">path</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conda_env</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">aux</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
                         <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">,</span>
                         <span class="n">shellcmd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shellcmd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">msg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="Job.register"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job.register">[docs]</a>    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">persistence</span><span class="o">.</span><span class="n">started</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Job.get_wait_for_files"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job.get_wait_for_files">[docs]</a>    <span class="k">def</span> <span class="nf">get_wait_for_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">wait_for_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">wait_for_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_input</span><span class="p">)</span>
        <span class="n">wait_for_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_input</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">should_stay_on_remote</span><span class="p">)</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shadow_dir</span><span class="p">:</span>
            <span class="n">wait_for_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shadow_dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">use_conda</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">conda_env</span><span class="p">:</span>
            <span class="n">wait_for_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conda_env_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wait_for_files</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">jobid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">jobid</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="Job.postprocess"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job.postprocess">[docs]</a>    <span class="k">def</span> <span class="nf">postprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">upload_remote</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">handle_log</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">handle_touch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">handle_temp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">ignore_missing_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">assume_shared_fs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">latency_wait</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">assume_shared_fs</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">error</span> <span class="ow">and</span> <span class="n">handle_touch</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">handle_touch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">handle_log</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">handle_log</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">error</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">check_and_touch_output</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span>
                    <span class="n">wait</span><span class="o">=</span><span class="n">latency_wait</span><span class="p">,</span>
                    <span class="n">ignore_missing_output</span><span class="o">=</span><span class="n">ignore_missing_output</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">unshadow_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">only_log</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">error</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">handle_remote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">upload</span><span class="o">=</span><span class="n">upload_remote</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">handle_protected</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close_remote</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">error</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">check_and_touch_output</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span>
                    <span class="n">wait</span><span class="o">=</span><span class="n">latency_wait</span><span class="p">,</span>
                    <span class="n">no_touch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">force_stay_on_remote</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">persistence</span><span class="o">.</span><span class="n">finished</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Error recording metadata for finished job &quot;</span>
                               <span class="s2">&quot;(</span><span class="si">{}</span><span class="s2">). Please ensure write permissions for the &quot;</span>
                               <span class="s2">&quot;directory </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">persistence</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">handle_temp</span><span class="p">:</span>
                <span class="c1"># temp handling has to happen after calling finished(),</span>
                <span class="c1"># because we need to access temp output files to record</span>
                <span class="c1"># start and end times.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">handle_temp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">priority</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">priority</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">products</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">products</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span><span class="p">:</span>
            <span class="n">products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span><span class="p">)</span>
        <span class="n">products</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">products</span>

<div class="viewcode-block" id="Job.get_targets"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Job.get_targets">[docs]</a>    <span class="k">def</span> <span class="nf">get_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetfile</span> <span class="ow">or</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">name</span><span class="p">]</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_branched</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">is_branched</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">restart_times</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">restart_times</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_checkpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">is_checkpoint</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span></div>


<div class="viewcode-block" id="GroupJob"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.GroupJob">[docs]</a><span class="k">class</span> <span class="nc">GroupJob</span><span class="p">(</span><span class="n">AbstractJob</span><span class="p">):</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;groupid&quot;</span><span class="p">,</span> <span class="s2">&quot;jobs&quot;</span><span class="p">,</span> <span class="s2">&quot;_resources&quot;</span><span class="p">,</span> <span class="s2">&quot;_input&quot;</span><span class="p">,</span> <span class="s2">&quot;_output&quot;</span><span class="p">,</span> <span class="s2">&quot;_log&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;_inputsize&quot;</span><span class="p">,</span> <span class="s2">&quot;_all_products&quot;</span><span class="p">,</span> <span class="s2">&quot;_attempt&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">jobs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupid</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resources</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inputsize</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_products</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attempt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">attempt</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">))</span><span class="o">.</span><span class="n">dag</span>

<div class="viewcode-block" id="GroupJob.merge"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.GroupJob.merge">[docs]</a>    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">other</span><span class="o">.</span><span class="n">groupid</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span> <span class="o">|</span> <span class="n">other</span><span class="o">.</span><span class="n">jobs</span></div>

<div class="viewcode-block" id="GroupJob.finalize"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.GroupJob.finalize">[docs]</a>    <span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TODO determine resources based on toposort</span>
        <span class="n">dag</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">job</span><span class="p">:</span> <span class="p">{</span><span class="n">dep</span> <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">dependencies</span><span class="p">[</span><span class="n">job</span><span class="p">]</span> <span class="k">if</span> <span class="n">dep</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span>
        <span class="p">}</span>
        <span class="kn">from</span> <span class="nn">toposort</span> <span class="k">import</span> <span class="n">toposort</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">toposort</span><span class="p">(</span><span class="n">dag</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">all_products</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_products</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_all_products</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">f</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">job</span><span class="o">.</span><span class="n">products</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_products</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;JobGroup(</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupid</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span>

<div class="viewcode-block" id="GroupJob.is_group"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.GroupJob.is_group">[docs]</a>    <span class="k">def</span> <span class="nf">is_group</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_checkpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">is_checkpoint</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_updated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">is_updated</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">)</span>

<div class="viewcode-block" id="GroupJob.log_info"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.GroupJob.log_info">[docs]</a>    <span class="k">def</span> <span class="nf">log_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skip_dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">group_info</span><span class="p">(</span><span class="n">groupid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">groupid</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">j</span><span class="p">:</span> <span class="n">j</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
            <span class="n">job</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="n">skip_dynamic</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="GroupJob.log_error"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.GroupJob.log_error">[docs]</a>    <span class="k">def</span> <span class="nf">log_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">group_error</span><span class="p">(</span><span class="n">groupid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">groupid</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">:</span>
            <span class="n">job</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GroupJob.register"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.GroupJob.register">[docs]</a>    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">:</span>
            <span class="n">job</span><span class="o">.</span><span class="n">register</span><span class="p">()</span></div>

<div class="viewcode-block" id="GroupJob.remove_existing_output"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.GroupJob.remove_existing_output">[docs]</a>    <span class="k">def</span> <span class="nf">remove_existing_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">:</span>
            <span class="n">job</span><span class="o">.</span><span class="n">remove_existing_output</span><span class="p">()</span></div>

<div class="viewcode-block" id="GroupJob.download_remote_input"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.GroupJob.download_remote_input">[docs]</a>    <span class="k">def</span> <span class="nf">download_remote_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">:</span>
            <span class="n">job</span><span class="o">.</span><span class="n">download_remote_input</span><span class="p">()</span></div>

<div class="viewcode-block" id="GroupJob.get_wait_for_files"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.GroupJob.get_wait_for_files">[docs]</a>    <span class="k">def</span> <span class="nf">get_wait_for_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">local_input</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span>
                       <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">job</span><span class="o">.</span><span class="n">local_input</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_products</span><span class="p">]</span>
        <span class="n">remote_input</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span>
                        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">job</span><span class="o">.</span><span class="n">remote_input</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_products</span><span class="p">]</span>

        <span class="n">wait_for_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">wait_for_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">local_input</span><span class="p">)</span>
        <span class="n">wait_for_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">remote_input</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">should_stay_on_remote</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">shadow_dir</span><span class="p">:</span>
                <span class="n">wait_for_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">shadow_dir</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">use_conda</span> <span class="ow">and</span> <span class="n">job</span><span class="o">.</span><span class="n">conda_env</span><span class="p">:</span>
                <span class="n">wait_for_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">conda_env_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wait_for_files</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">resources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resources</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resources</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">pipe_group</span> <span class="o">=</span> <span class="nb">any</span><span class="p">([</span><span class="nb">any</span><span class="p">([</span><span class="n">is_flagged</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="s2">&quot;pipe&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">job</span><span class="o">.</span><span class="n">output</span><span class="p">])</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">job_resources</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">resources</span>
                <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                    <span class="c1"># Skip job if resource evaluation leads to a file not found error.</span>
                    <span class="c1"># This will be caused by an inner job, which needs files created by the same group.</span>
                    <span class="c1"># All we can do is to ignore such jobs for now.</span>
                    <span class="k">continue</span>
                <span class="k">for</span> <span class="n">res</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">job_resources</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">run_local</span> <span class="ow">or</span> <span class="n">pipe_group</span><span class="p">:</span>
                        <span class="c1"># in case of local execution, this must be a</span>
                        <span class="c1"># group of jobs that are connected with pipes</span>
                        <span class="c1"># and have to run simultaneously</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_resources</span><span class="p">[</span><span class="n">res</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># take the maximum over all jobs</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_resources</span><span class="p">[</span><span class="n">res</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span>
                                                   <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Resources</span><span class="p">(</span><span class="n">fromdict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_resources</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_input</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span>
                             <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">job</span><span class="o">.</span><span class="n">input</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_products</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">all_input</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">f</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">job</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_output</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span>
                              <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">job</span><span class="o">.</span><span class="n">output</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_input</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">job</span><span class="o">.</span><span class="n">log</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">products</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">all_input</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">f</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">job</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span>
                  <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">job</span><span class="o">.</span><span class="n">products</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_input</span><span class="p">]</span>

<div class="viewcode-block" id="GroupJob.properties"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.GroupJob.properties">[docs]</a>    <span class="k">def</span> <span class="nf">properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">omit_resources</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;_cores&quot;</span><span class="p">,</span> <span class="s2">&quot;_nodes&quot;</span><span class="p">],</span>
                   <span class="o">**</span><span class="n">aux_properties</span><span class="p">):</span>
        <span class="n">resources</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">name</span><span class="p">:</span> <span class="n">res</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">omit_resources</span>
        <span class="p">}</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;group&quot;</span><span class="p">,</span>
            <span class="s2">&quot;groupid&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupid</span><span class="p">,</span>
            <span class="s2">&quot;local&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_local</span><span class="p">,</span>
            <span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">,</span>
            <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">,</span>
            <span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">threads</span><span class="p">,</span>
            <span class="s2">&quot;resources&quot;</span><span class="p">:</span> <span class="n">resources</span><span class="p">,</span>
            <span class="s2">&quot;jobid&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobid</span>
        <span class="p">}</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">aux_properties</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">jobid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">get_uuid</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">jobid</span><span class="p">)</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">)))</span>

<div class="viewcode-block" id="GroupJob.cleanup"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.GroupJob.cleanup">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">:</span>
            <span class="n">job</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span></div>

<div class="viewcode-block" id="GroupJob.postprocess"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.GroupJob.postprocess">[docs]</a>    <span class="k">def</span> <span class="nf">postprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">:</span>
            <span class="n">job</span><span class="o">.</span><span class="n">postprocess</span><span class="p">(</span><span class="n">handle_temp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Handle temp after per-job postprocess.</span>
        <span class="c1"># This is necessary because group jobs are not topologically sorted,</span>
        <span class="c1"># and we might otherwise delete a temp input file before it has been</span>
        <span class="c1"># postprocessed by the outputting job in the same group.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">handle_temp</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
        <span class="c1"># remove all pipe outputs since all jobs of this group are done and the</span>
        <span class="c1"># pipes are no longer needed</span>
        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">job</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_flagged</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;pipe&quot;</span><span class="p">):</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupid</span><span class="p">)</span>

<div class="viewcode-block" id="GroupJob.check_protected_output"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.GroupJob.check_protected_output">[docs]</a>    <span class="k">def</span> <span class="nf">check_protected_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">:</span>
            <span class="n">job</span><span class="o">.</span><span class="n">check_protected_output</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dynamic_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">job</span><span class="o">.</span><span class="n">dynamic_input</span>
                <span class="k">if</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_products</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">inputsize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inputsize</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputsize</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">priority</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">priority</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">is_local</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">)</span>

<div class="viewcode-block" id="GroupJob.format_wildcards"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.GroupJob.format_wildcards">[docs]</a>    <span class="k">def</span> <span class="nf">format_wildcards</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">variables</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Format a string with variables from the job. &quot;&quot;&quot;</span>
        <span class="n">_variables</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">_variables</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dag</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">globals</span><span class="p">)</span>
        <span class="n">_variables</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">,</span>
                               <span class="n">output</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">,</span>
                               <span class="n">threads</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">threads</span><span class="p">,</span>
                               <span class="n">jobid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">jobid</span><span class="p">,</span>
                               <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                               <span class="n">rule</span><span class="o">=</span><span class="s2">&quot;GROUP&quot;</span><span class="p">,</span>
                               <span class="n">rulename</span><span class="o">=</span><span class="s2">&quot;GROUP&quot;</span><span class="p">,</span>
                               <span class="n">resources</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">))</span>
        <span class="n">_variables</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">format</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">_variables</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NameError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">WorkflowError</span><span class="p">(</span><span class="s2">&quot;NameError with group job </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">jobid</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)))</span>
        <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">WorkflowError</span><span class="p">(</span><span class="s2">&quot;IndexError with group job </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">jobid</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)))</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threads</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">[</span><span class="s2">&quot;_cores&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="GroupJob.get_targets"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.GroupJob.get_targets">[docs]</a>    <span class="k">def</span> <span class="nf">get_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># jobs without output are targeted by rule name</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="p">[</span><span class="n">job</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">products</span><span class="p">]</span>
        <span class="n">targets</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">products</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">targets</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">attempt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attempt</span>

    <span class="nd">@attempt</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">attempt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attempt</span><span class="p">):</span>
        <span class="c1"># reset resources</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resources</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attempt</span> <span class="o">=</span> <span class="n">attempt</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_branched</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">is_branched</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">needs_singularity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">needs_singularity</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">job</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">expanded_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Yields the entire expanded output of all jobs&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">:</span>
            <span class="k">yield from</span> <span class="n">job</span><span class="o">.</span><span class="n">expanded_output</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">restart_times</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">restart_times</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">is_group</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">jobs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Reason"><a class="viewcode-back" href="../../api_reference/internal/snakemake.html#snakemake.jobs.Reason">[docs]</a><span class="k">class</span> <span class="nc">Reason</span><span class="p">:</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;_updated_input&quot;</span><span class="p">,</span> <span class="s2">&quot;_updated_input_run&quot;</span><span class="p">,</span> <span class="s2">&quot;_missing_output&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;_incomplete_output&quot;</span><span class="p">,</span> <span class="s2">&quot;forced&quot;</span><span class="p">,</span> <span class="s2">&quot;noio&quot;</span><span class="p">,</span> <span class="s2">&quot;nooutput&quot;</span><span class="p">,</span> <span class="s2">&quot;derived&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updated_input</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updated_input_run</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_missing_output</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_incomplete_output</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forced</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noio</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nooutput</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derived</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@lazy_property</span>
    <span class="k">def</span> <span class="nf">updated_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>

    <span class="nd">@lazy_property</span>
    <span class="k">def</span> <span class="nf">updated_input_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>

    <span class="nd">@lazy_property</span>
    <span class="k">def</span> <span class="nf">missing_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>

    <span class="nd">@lazy_property</span>
    <span class="k">def</span> <span class="nf">incomplete_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">forced</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Forced execution&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">noio</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Rules with neither input nor &quot;</span>
                         <span class="s2">&quot;output files are always executed.&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">nooutput</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Rules with a run or shell declaration but no output &quot;</span>
                         <span class="s2">&quot;are always executed.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_missing_output</span><span class="p">:</span>
                    <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing output files: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">missing_output</span><span class="p">)))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_incomplete_output</span><span class="p">:</span>
                    <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Incomplete output files: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">incomplete_output</span><span class="p">)))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updated_input</span><span class="p">:</span>
                    <span class="n">updated_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">updated_input</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">updated_input_run</span>
                    <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Updated input files: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">updated_input</span><span class="p">)))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updated_input_run</span><span class="p">:</span>
                    <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Input files updated by another job: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">updated_input_run</span><span class="p">)))</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">updated_input</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_output</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">forced</span> <span class="ow">or</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">updated_input_run</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">noio</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">nooutput</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014-2016, Johannes Koester

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>